(()=>{var e,t,i={3608:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AdIndicator=void 0;const r=i(1258),n=i(1798);t.AdIndicator=class{constructor(e,t){this.parent=e,this.element=document.createElement("div");const{style:i}=this.element;i.backgroundColor=(0,n.getAdIndicatorColorByBroadcastAdType)(t),i.width="10px",i.height="10px",i.cssFloat="left",i.marginRight="1px"}setVisibility(e){e?this.show():this.hide()}show(){this.parent.appendChild(this.element)}hide(){(0,r.removeNodeFromParent)(this.element)}}},2740:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BroadcastAdType=void 0,function(e){e.original="original"}(t.BroadcastAdType||(t.BroadcastAdType={}))},1798:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAdIndicatorColorByBroadcastAdType=void 0;const r=i(2740);t.getAdIndicatorColorByBroadcastAdType=function(e){if(e===r.BroadcastAdType.original)return"rgba(0, 255, 0, 0.5)";throw new Error(`Unexpected BroadcastAdType [${e}]`)}},5522:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AdIndicators=void 0;const r=i(3608);t.AdIndicators=class{constructor(e){this.element=document.createElement("div"),e.appendChild(this.element);const{style:t}=this.element;t.position="absolute",t.bottom="1px",t.left="1px"}createIndicator(e){return new r.AdIndicator(this.element,e)}}},4614:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AdIntervalStorage=void 0;const r=i(2210),n=i(7791),a=i(3307),s=i(8291),o=i(7713),l=i(7103),u=i(7197),d=i(3781);class c extends a.EventEmitter{constructor(e){super(),this.logger=e,this.adIntervals=[]}handleInrollFrame(e){var t;if(!(0,d.isValidInrollFrame)(e))return null===(t=this.logger)||void 0===t||t.warn("invalid inroll frame:",e),void this.handleInvalidInrollFrame(e,o.InvalidateReason.INVALID_INROLL_FRAME);const i=this.adIntervals.find((({cueId:t})=>t===e.cue_id));if(!i)return this.addAdIntervalByFastFrame(e);this.updateAdIntervalByInrollFrame(i,e)}validateAdIntervalsByTimestamp(e){for(let t=0;t<this.adIntervals.length;t++){const i=this.adIntervals[t];if(i.start>e)return;if(!i.isValid||i.isEndReceived)continue;if(e-i.start>s.MAX_AD_DURATION){this.invalidateAdInterval(i,o.InvalidateReason.MAX_DURATION);continue}const r=this.adIntervals[t+1];if(!r)return;r.start<=e&&this.invalidateAdInterval(i,o.InvalidateReason.CROSSED_BY_INVALID)}}handleInvalidInrollFrame(e,t){const i=this.adIntervals.find((({cueId:t})=>t===e.cue_id));if(i)return this.invalidateAdInterval(i,t),void this.updateAdIntervalByInrollFrame(i,e);const r=(0,l.convertInrollFrameToAdInterval)(e);this.invalidateAdInterval(r,t),this.pushAdInterval(r)}addAdIntervalByFastFrame(e){const t=(0,l.convertInrollFrameToAdInterval)(e);return this.pushAdInterval(t),t.isValid?t:void 0}updateAdIntervalByInrollFrame(e,t){const i=t.pts+t.offset;if(Math.abs(e.start-i)>n.ONE_SECOND)return void this.invalidateAdInterval(e,o.InvalidateReason.INVALID_START);if(e.isEndReceived)return;const a=void 0!==t.cutoff,s=a?(0,r.add)(t.pts,t.cutoff):(0,u.getPtsOut)(t.pts,e.start);e.isEndReceived=a,e.end=s,this.handleUpdatedAdInterval(e)}findCrossedAdIntervals(e){return this.adIntervals.filter((t=>e!==t&&(e.start<t.start?e.end>t.start:t.end>e.start)))}pushAdInterval(e){const t=this.findCrossedAdIntervals(e);t.length&&this.invalidateAdInterval(e,o.InvalidateReason.CROSSED_BY_INVALID),this.adIntervals.push(e),this.adIntervals.sort((({start:e},{start:t})=>e-t)),this.invalidate(t,o.InvalidateReason.CROSSED_BY_INVALID),e.isValid&&this.emit("AdIntervalUpdated",e)}handleUpdatedAdInterval(e){const t=this.findCrossedAdIntervals(e);if(t.length)return t.push(e),void this.invalidate(t,o.InvalidateReason.CROSSED_BY_INVALID);e.isValid&&this.emit("AdIntervalUpdated",e)}invalidate(e,t){e.forEach((e=>{this.invalidateAdInterval(e,t)}))}invalidateAdInterval(e,t){e.isValid&&(e.isValid=!1,e.invalidateReason=t,this.emit("InvalidAdInterval",{reason:t,cueId:e.cueId}))}}t.AdIntervalStorage=c},9932:function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(n,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,o)}l((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.AdManager=void 0;const n=i(4119),a=i(6722),s=i(2210),o=i(9346),l=i(1006),u=i(8368),d=i(8210),c=i(8378),h=i(336),p=i(2242),f=i(8588),m=i(4012),g=i(6471),v=i(8707),S=i(1534),y=i(9859),T=i(7064),E=i(3993),b=i(4748),_=i(8410),A=i(7715),R=i(9358),w=i(2290),P=i(5647),O=i(1915),C=i(6226),L=i(3414),I=i(8534),x=i(5972),M=i(8185),N=i(8183),D=i(3307);class k extends D.EventEmitter{constructor(e){super(),this.config=e,this.multiroll=b.dummyMultiroll,this.plannedAdViewers=[],this.broadcastAd=void 0,this.currentAdPlaybackQueue=void 0,this.stopAd=()=>Promise.resolve(),this.playAdViewers=(e,t,i,n,a)=>r(this,void 0,void 0,(function*(){try{yield this.playAdViewersInternal(e,t,i,n,a)}catch(r){this.emit("PlayAdViewersError",{error:r,adType:e,adViewersWithData:t,adDisplayConfig:i})}})),this.playAdViewersInternal=(e,t,i,a,o)=>r(this,void 0,void 0,(function*(){const l=this.config.getAdInfo(),c=this.config.getControllerIsFullscreen(),h=this.config.getControllerIsPip(),m=c&&(0,u.getFullscreenElement)(this.config.getPlayerContainerDocument().defaultView,this.config.playerVideoElement)===this.config.playerVideoElement,y=m||h?t.filter((e=>{const{adViewer:t}=e;return t.filterAdPodsIndependentOnHtmlControls(`StreamPlayer can't play CPC ads: [${h?"PiP":m?"FullScreen":"unknown"}] mode`),t.getAdPodsCount()>0})):t,T=y.map((({adViewer:e})=>e)),E=(0,L.getAdViewersAdPodsCount)(T),b=(0,I.getAdViewersDuration)(T);if(0===E)return void this.emit("NoAdPodsToPlayAd");l&&this.emit("AdIsAlreadyPlayingError",{currentAdType:l.adType,adType:e}),this.prepareBeforeOrAfterAd(!1,e),this.emit("PlayAdViewers",{adType:e,adPodsCount:E,isDelayed:o});const _=e===S.AdType.inroll?{cueId:this.config.getAdOriginalBroadcastAdCueId(),startProgramDateTime:(0,s.toSeconds)(this.config.getControllerProgramDateTime()/1e3),startVideoTime:(0,s.toSeconds)(this.config.getVideoControllerCurrentTime()||this.config.getControllerCurrentTime()),startTimestamp:(0,s.toSeconds)(Date.now()/1e3)}:{};let A=!1;const R=(0,d.once)((({data:t,stopAdReason:i})=>r(this,void 0,void 0,(function*(){var a,s;this.config.shouldCaptureScreenshot()&&(this.config.resetPosterFitStyle(),this.config.setBackgroundVisibility(!0),null===(s=(a=this.config).onceCanPlay)||void 0===s||s.call(a,(()=>{this.config.setBackgroundImage(),this.config.clearVideoControllerScreenshot()})));const o=this.config.getInStreamPlayingState();A=!0,this.currentAdPlaybackQueue&&(this.currentAdPlaybackQueue.destroy(i),this.currentAdPlaybackQueue=void 0),e!==S.AdType.postroll&&(this.config.logger.log("videoController.play()"),o!==g.VideoPlayingState.PAUSE&&(0,n.muffleUncaughtErrors)(this.config.playVideoController())),this.config.updateAdInfo(void 0),this.config.callbacks.onExpectedStalledChange(this.config.createExpectedStalled(f.ExpectedStalledReason.AdEnd,{adType:e})),this.prepareBeforeOrAfterAd(!0,e);const l=()=>r(this,void 0,void 0,(function*(){yield this.config.attachEncoder()}));if(i===p.StopAdReason.InsertIntoCalled)return l();const{loadPositionAfterAd:u}=t;u&&(this.config.putStartPosition(u),yield l())}))));this.stopAd=R;const w=this.getSeekPositionAfterAd({adType:e,adViewersDuration:b});if(this.config.putStartPosition(w),this.config.shouldCaptureScreenshot()&&this.config.captureVideoControllerScreenshot(this.config.playerVideoElement).then((e=>{e&&(this.config.setBackgroundImage(e),this.config.setBackgroundVisibility(!1))})),yield this.config.detachEncoder(),(()=>{this.config.updateAdInfo({adType:e,params:_})})(),A)return;const P=this.createAbPlaybackQueue(e);this.currentAdPlaybackQueue=P,y.forEach((({adViewer:t,additionalData:r,adType:n})=>{P.playAdViewers({adType:e,adPodType:n,adViewer:t,additionalData:r,adDisplayConfig:i,adElement:a.adProvider===v.AdProvider.MT?this.config.playerAdVideo:this.config.playerAdDiv,posterUrl:this.getPosterUrlForAd()})})),this.plannedAdViewers=[],yield P.getDestroyPromise(),A||(yield R({stopAdReason:p.StopAdReason.AdCompleted,data:{loadPositionAfterAd:w}}))}))}getConfig(){return this.config}getCurrentAdPlaybackQueue(){return this.currentAdPlaybackQueue}getAdman(){return this.adman}getTimer(){return this.timer}getPlannerAdViewers(){return this.plannedAdViewers}getBroadcastAd(){return this.broadcastAd}planAdViewers(e){this.plannedAdViewers=e}resetPlannedAdViewers(){this.plannedAdViewers=[]}getMultiroll(){return this.multiroll}resetMultiroll(){this.multiroll=b.dummyMultiroll}destroy(){this.multiroll.destroy()}skipAdmanAd(){var e,t;null===(e=this.getAdman())||void 0===e||e.skip(),null===(t=this.getTimer())||void 0===t||t.setSkipAdTime(Number.POSITIVE_INFINITY)}stopAdmanAd(){var e,t;null===(e=this.getAdman())||void 0===e||e.stop(),null===(t=this.getTimer())||void 0===t||t.setSkipAdTime(Number.POSITIVE_INFINITY)}getUtcPosition(){return this.config.getVideoControllerUtcPosition()}getSeekPositionAfterAd({adType:e,adViewersDuration:t}){const i=this.getUtcPosition();if(e===S.AdType.inroll){const e=(0,s.add)(this.config.getControllerCurrentTime(),t);return{utc:i?(0,s.add)(i,t):void 0,videoTime:e}}return e===S.AdType.preroll?this.config.getControllerStartPosition():e===S.AdType.midroll||e===S.AdType.postPauseroll?{utc:(0,s.toSeconds)(i)||void 0,videoTime:(0,s.toSeconds)(this.config.getVideoControllerCurrentTime()||0)}:e===S.AdType.postroll?{videoTime:(0,s.toSeconds)(0)}:((0,l.isNever)(e),{})}getPosterUrlForAd(){const e=this.config.getControllerSourcePreviewParam();return e&&e!==this.config.getDefaultSourcePreviewParam()?e:null}createAbPlaybackQueue(e){let t=!1;return new x.AdPlaybackQueue({video:this.config.playerVideoElement,onUnrecognizedAdType:()=>{this.emit("UnrecognizedAdTypeError")},onAdStartRejected:e=>{this.config.rejectPlayerPlayDeferred(e)},onAdSkippableStateChange:e=>{this.config.callbacks.onAdSkippableStateChange(e)},onAdPodCloseStateChange:e=>{this.config.callbacks.onAdPodCloseStateChange(e)},onAdVolumeAvailabilityStateChange:e=>{this.config.callbacks.onAdVolumeAvailabilityStateChange(e)},onAdPodError:({code:e,additionalData:t,adPodIndex:i,adPodsCount:r,adType:n})=>{this.config.callbacks.onAdError(),this.emit("AdPodError",{code:e,additionalData:t,adPodsCount:r,adType:n,adPodIndex:i,adProvider:v.AdProvider.DIRECT})},onAdPodDurationChange:e=>{this.config.callbacks.onAdPodDurationChange(e)},onAdPodCurrentTimeChange:e=>{this.config.callbacks.onAdPodCurrentTimeChange(e)},onAdPodTimeToSkipChange:e=>{this.config.callbacks.onAdPodTimeToSkipChange(e)},onAdInteraction:()=>{this.config.callbacks.onAdInteraction()},onFirstAdPodStarted:()=>{this.config.hidePlayerPoster(),e!==S.AdType.postroll&&this.config.preloadVideoControllerSource(),this.config.resolvePlayerPlayDeferred()},onLastAdPodStopped:e=>{this.multiroll.dispatchEvent({event:"AdBreakEnd",data:e})},onBeforeAdPodStart:e=>{this.config.callbacks.onBeforeAdPodStart(e)},onAdPodStarted:({isFullyClickable:e,adPodDuration:t,adPodIndex:i,adPodsCount:r,adType:n,additionalData:a,width:s,height:o})=>{this.emit("AdPodStart",{adPodIndex:i,adPodsCount:r,adType:n,additionalData:a,isFullyClickable:e||!1,adPodDuration:t,width:s,height:o,adProvider:v.AdProvider.DIRECT}),this.config.putResourcesIdle(!0),this.config.callbacks.onAdPodStart({isFullyClickable:e,adPodDuration:t})},onAdPodSkipped:({adPodsCount:e,adType:t,adPodIndex:i,additionalData:r})=>{this.config.callbacks.onAdPodSkip(),this.emit("AdPodSkip",{adPodsCount:e,adType:t,adPodIndex:i,additionalData:r,adProvider:v.AdProvider.DIRECT})},onAdPodStopped:()=>{t=!0,this.config.putInStreamPlayingState(void 0),this.config.callbacks.onAdPodEnd()},onAdPodPlayingStateChange:({playingState:e,expectedStalledReason:t,adType:i})=>{e===g.VideoPlayingState.BUFFERING&&this.config.callbacks.onExpectedStalledChange(this.config.createExpectedStalled(t,{adType:i})),this.config.putInStreamPlayingState(e)},onAdClickThru:({adPodIndex:e,adPodsCount:t,adType:i,additionalData:r})=>{this.config.callbacks.onAdPodClick(),this.emit("AdClickThru",{adPodIndex:e,adPodsCount:t,adType:i,additionalData:r,adProvider:v.AdProvider.DIRECT})},onAdSizeChange:e=>{this.config.putVideoSize({videoWidth:(0,s.toPixels)(void 0===e.width?NaN:e.width),videoHeight:(0,s.toPixels)(void 0===e.height?NaN:e.height)})},getControlsSettings:this.config.getAdControlsSettings,adConfig:this.config.getAdConfig(),playerContainer:this.config.getPlayerContainer(),lang:this.config.lang,yaDirectPixel:this.preparePixelData(),logger:this.config.logger,isSkipAllPodsFlagEnabled:this.config.isSkipAllPodsFlagEnabled,onAdStart:({adPodsCount:e,adType:t})=>{this.emit("AdStart",{adProvider:v.AdProvider.DIRECT,adPodsCount:e,adType:t})},onInrollAdStart:({adPodsCount:e})=>{this.emit("InrollAdStart",{adPodsCount:e})},onAdEnd:({adPodsCount:e,adType:t,stopAdReason:i})=>{this.emit("AdEnd",{stopAdReason:i,adPodsCount:e,adType:t,adProvider:v.AdProvider.DIRECT})},onInrollAdEnd:({adPodsCount:e})=>{this.emit("InrollAdEnd",{adPodsCount:e})},onAdPodPause:({adType:e,adPodIndex:t,adPodsCount:i,additionalData:r})=>{this.emit("AdPodPause",{adType:e,adPodsCount:i,adPodIndex:t,additionalData:r})},onAdPodResume:({adType:e,adPodIndex:t,adPodsCount:i,additionalData:r})=>{this.emit("AdPodResume",{adType:e,adPodsCount:i,adPodIndex:t,additionalData:r})},onAdPodLoading:({adType:e,adPodsCount:t,additionalData:i})=>{this.emit("AdPodLoading",{adPodsCount:t,adType:e,additionalData:i})},onInrollAdPodStart:({adPodsCount:e,cueId:t})=>{this.emit("InrollAdPodStart",{adPodsCount:e,cueId:t})},onAdPodImpression:({adPodsCount:e,adType:t,additionalData:i})=>{this.emit("AdPodImpression",{adPodsCount:e,adType:t,additionalData:i})},onAdPodEnd:({adPodIndex:e,adPodsCount:t,adType:i,additionalData:r})=>{this.emit("AdPodEnd",{adProvider:v.AdProvider.DIRECT,adPodIndex:e,adPodsCount:t,adType:i,additionalData:r})},onInrollAdPodEnd:({adPodsCount:e,cueId:t})=>{this.emit("InrollAdPodEnd",{adPodsCount:e,cueId:t})}})}preparePixelData(){const{yaDirectPixelUrl:e,yaDirectPixelData:t}=this.config.yaDirectPixel||{};if(e&&t)return{url:e,data:Object.assign(Object.assign({},t),{containerId:t.containerId||this.config.playerContainerElement.id,pageId:this.config.adConfigPartnerId,impId:this.config.adConfigImpId})}}initMultirollModule(e,t){var i,l,u,d,c,f,g,L,I,x;return r(this,void 0,void 0,(function*(){let r=b.dummyMultiroll;if(!e)return r;switch(e.adProvider){case v.AdProvider.MT:try{if(this.config.isIOS&&!this.config.isMyTargetOnIOSEnabled)break;const h=localStorage.getItem("zen-player-mytarget-testmode"),b=Object.assign(Object.assign({duration:Math.floor(e.duration||this.config.getVideoControllerDuration()),group_id:e.statId||e.partnerId,video_id:e.videoContentId,content_id:e.mytargetId,autoplay:this.config.getControllerAutoplay(),genre:e.videoGenreName,live:this.config.getPlayerIsLive()?1:0,brandsafety:"yanewstragic"===this.config.getControllerFrom()?1:0},this.config.admanMeta),{preview:h?4:void 0,SkipAd:h?1:void 0}),_=e.adStatType&&e.adStatType!==m.AdStatType.PIXEL?void 0:this.preparePixelData(),A=(0,R.initMultirollModule)(window,e,this.config.getControllerVsid(),!0,this.config.playerVersion,{slot:e.slotId,wrapper:this.config.playerAdMtDiv,videoEl:this.config.playerAdVideo,audioEl:this.config.playerAdVideo,clickEl:this.config.playerDiv,midrollPoints:h?[10]:void 0,forcePreloadAdditionalData:!0,params:h?Object.assign(Object.assign({},b),{test_mode:1}):b,browser:{adBlock:!1,mobile:!1}},_),M=yield Promise.race([A,t.stopPromise.then((()=>{}))]);if(void 0===M)return r;let N;this.adman=M,this.timer=T.timer.createInstance(this.adman,Math.floor(e.duration||this.config.getVideoControllerDuration()),this),null===(i=this.adman)||void 0===i||i.onReady((e=>{var t;null===(t=this.timer)||void 0===t||t.start()})),null===(l=this.adman)||void 0===l||l.adMidrollPoint((e=>{var t,i;this.config.shouldPlayAd()&&(_&&(0,y.yaDirectPixelRequest)(_.url,Object.assign(Object.assign({},_.data),{eventUnixTime:Math.floor(Date.now()/1e3),eventType:"ads_rendered",inventory:"instream",count:void 0,bidReqId:void 0})),this.config.callbacks.onAdLoaded({adType:S.AdType.midroll}),null===(t=this.adman)||void 0===t||t.start(E.AdmanAdType.MIDROLL),this.config.hasPlayerVideoController()&&(this.config.playerAdVideo.style.display="block",this.config.pauseVideoController(),this.config.updateAdInfo({adType:S.AdType.midroll,params:{}})),null===(i=this.adman)||void 0===i||i.setVolume(this.config.getControllerMuted()?0:this.config.getControllerVolume()*w.ADMAN_VOLUME_COEFFICIENT))})),null===(u=this.adman)||void 0===u||u.onTimeRemained((e=>{var t;null===(t=this.adman)||void 0===t||t.setVolume(this.config.getControllerMuted()?0:this.config.getControllerVolume()*w.ADMAN_VOLUME_COEFFICIENT),this.config.callbacks.onAdPodCurrentTimeChange((0,s.toSeconds)(e.currentTime))}));let D=!1;if(null===(d=this.adman)||void 0===d||d.onStarted(((t,i)=>{var r;D=!1,N=P.ADMAN_AD_TYPE_MAP[i.type],this.emit("AdStart",{adProvider:v.AdProvider.MT,adPodsCount:0,adType:N}),this.emit("AdPodStart",{adPodsCount:0,adPodIndex:-1,adType:N,adProvider:v.AdProvider.MT,additionalData:{},isFullyClickable:!0,adPodDuration:(0,s.toSeconds)(i.duration),width:i.width||0,height:i.height||0}),this.config.playerVideoElement.style.opacity="0",this.config.putShowAdSkin(!0),this.config.callbacks.onAdPodStart({isFullyClickable:!0,adPodDuration:(0,s.toSeconds)(i.duration)}),this.config.callbacks.onAdVolumeAvailabilityStateChange(!0),this.config.callbacks.onAdPodDurationChange((0,s.toSeconds)(i.duration)),this.config.toggleVideoControllerAdShown(!0),this.config.hidePlayerPoster(),this.config.preloadVideoControllerSource(),this.config.resolvePlayerPlayDeferred(),this.config.putResourcesIdle(!0),i.duration>6&&i.allowClose&&i.allowCloseDelay&&!e.hideAdControls&&(null===(r=this.timer)||void 0===r||r.setSkipAdTime(i.allowCloseDelay),this.config.putShowSkipAdButton(!0))})),null===(c=this.adman)||void 0===c||c.onClicked((()=>{this.emit("AdClickThru",{adType:N||S.AdType.midroll,adPodsCount:0,additionalData:{},adPodIndex:-1,adProvider:v.AdProvider.MT})})),null===(f=this.adman)||void 0===f||f.onCompleted((()=>{var e;this.config.hasPlayerVideoController()&&(this.config.playerAdVideo.style.display="none",this.config.playerVideoElement.style.opacity="1",this.config.toggleVideoControllerAdShown(!1),this.config.playVideoController(),this.config.callbacks.onAdPodTimeToSkipChange((0,s.toSeconds)(Number.POSITIVE_INFINITY)),null===(e=this.timer)||void 0===e||e.setSkipAdTime(Number.POSITIVE_INFINITY),this.config.putShowSkipAdButton(!1),this.config.putShowAdSkin(!1),this.config.callbacks.onAdVolumeAvailabilityStateChange(!1),this.config.updateAdInfo(void 0)),this.emit("AdPodEnd",{adProvider:v.AdProvider.MT,adPodIndex:-1,adPodsCount:0,adType:N||S.AdType.midroll,additionalData:{}}),this.emit("AdEnd",{adType:N||S.AdType.midroll,adPodsCount:0,adProvider:v.AdProvider.MT,stopAdReason:D?p.StopAdReason.AdSkipped:p.StopAdReason.AdCompleted})})),null===(g=this.adman)||void 0===g||g.onSkipped((()=>{var e;D=!0,this.config.hasPlayerVideoController()&&(this.config.playerAdVideo.style.display="none",this.config.playerVideoElement.style.opacity="1",this.config.toggleVideoControllerAdShown(!1),this.config.playVideoController(),this.config.callbacks.onAdPodTimeToSkipChange((0,s.toSeconds)(Number.POSITIVE_INFINITY)),null===(e=this.timer)||void 0===e||e.setSkipAdTime(Number.POSITIVE_INFINITY),this.config.putShowSkipAdButton(!1),this.config.putShowAdSkin(!1),this.config.callbacks.onAdVolumeAvailabilityStateChange(!1),this.config.updateAdInfo(void 0)),this.emit("AdPodSkip",{adType:N||S.AdType.midroll,adPodIndex:-1,adPodsCount:0,adProvider:v.AdProvider.MT,additionalData:{}})})),null===(L=this.adman)||void 0===L||L.onClosed((()=>{this.emit("AdEnd",{adType:N||S.AdType.midroll,adPodsCount:0,adProvider:v.AdProvider.MT,stopAdReason:p.StopAdReason.AdSkipped})})),null===(I=this.adman)||void 0===I||I.onError((e=>{_&&(0,y.yaDirectPixelRequest)(_.url,Object.assign(Object.assign({},_.data),{eventUnixTime:Math.floor(Date.now()/1e3),eventType:"ads_render_failed",inventory:"instream",count:void 0,bidReqId:void 0})),e&&(this.config.logger.log("Adman error:"+e),this.config.callbacks.onAdError(),this.emit("AdPodError",{adPodIndex:-1,adPodsCount:0,adType:N||S.AdType.midroll,additionalData:{},code:e,adProvider:v.AdProvider.MT}))})),(0,n.muffleUncaughtErrors)(t.stopPromise.then((()=>{var e;return null===(e=this.adman)||void 0===e?void 0:e.destroy()}))),r={destroy:null===(x=this.adman)||void 0===x?void 0:x.destroy,setStatsRootFields:o.noop,dispatchEvent:o.noop,getNextAdInfo:()=>{var e;return{adType:S.AdType.midroll,additionalData:{},remainingTime:null===(e=this.timer)||void 0===e?void 0:e.getNextAdTime()}},preroll:{loadViewers:()=>Promise.resolve([])},midroll:{loadViewers:()=>Promise.resolve([])},inroll:{loadViewers:()=>Promise.resolve([]),schedule:o.noop},postroll:{loadViewers:()=>Promise.resolve([])},postPauseroll:{loadViewers:()=>Promise.resolve([])}},e.adStatType===m.AdStatType.WATERFALL){const i=(0,O.initWaterfallRequestToDirect)(window,Object.assign(Object.assign({},e),{partnerId:1798264,duration:b.duration}),this.config.getControllerVsid(),this.config.playerVersion),r=yield Promise.race([i,t.stopPromise.then((()=>{}))]),{loadMultiroll:n}=r;n(Object.assign(Object.assign({},e),{partnerId:1798264,duration:b.duration,secureMode:"Safe",getSTRMChunkHost:()=>{const e=this.config.getSTRMChunkUrls();if(0===e.length)return;const{hostname:t,protocol:i}=(0,a.parseUrl)(e[0]);return`${i}//${t}/`}}),{preroll:{shouldPreload:()=>!1},midroll:{preloadOffset:20,preloadMinTime:(0,s.toSeconds)(5)},postroll:{preloadOffset:20,preloadMinTime:(0,s.toSeconds)(5)},getPreloadParams:()=>{const e={videoSlot:this.config.playerVideoElement};if(!this.config.hasPlayerVideoController()||!this.config.getNextAdInfo())return e;const t=this.config.getVideoControllerBandwidthEstimate();return t.value?Object.assign(Object.assign({},e),{desiredBitrate:t.value/1e3}):e},adLoaded:()=>null}),setTimeout((()=>{var e;return null===(e=document.querySelector(`script[src='${C.AD_SDK_URL}']`))||void 0===e?void 0:e.remove()}),1e3)}}catch(t){location.href.includes("dzen.ru/news")||(this.config.callbacks.onAdError(),this.emit("MultirollInitError",{error:t,adConfig:e}))}break;case v.AdProvider.DIRECT:default:try{const i=(0,R.initMultirollModule)(window,e,this.config.getControllerVsid(),!1,this.config.playerVersion,{},e.adStatType&&e.adStatType!==m.AdStatType.PIXEL?void 0:this.preparePixelData()),o=yield Promise.race([i,t.stopPromise.then((()=>{}))]);if(void 0===o)return r;const{loadMultiroll:l}=o,u={adSdkVersion:(0,A.getAdSdkVersion)(window),adSdkLoaderVersion:(0,_.getAdSdkLoaderVersion)(window)};this.config.callbacks.onAdSDKVersionDefined(u);const d=l(Object.assign(Object.assign({},e),{secureMode:"Safe",getSTRMChunkHost:()=>{const e=this.config.getSTRMChunkUrls();if(0===e.length)return;const{hostname:t,protocol:i}=(0,a.parseUrl)(e[0]);return`${i}//${t}/`}}),{preroll:{shouldPreload:()=>{const e=this.config.getControllerStartStage();return this.config.getControllerPreload()&&(e===h.PlayerStartStage.waitForUserPlay||e===h.PlayerStartStage.waitForDocumentVisibility)}},midroll:{preloadOffset:20,preloadMinTime:(0,s.toSeconds)(5)},postroll:{preloadOffset:20,preloadMinTime:(0,s.toSeconds)(5)},getPreloadParams:()=>{const e={videoSlot:this.config.playerVideoElement};if(!this.config.hasPlayerVideoController()||!this.config.getNextAdInfo())return e;const t=this.config.getVideoControllerBandwidthEstimate();return t.value?Object.assign(Object.assign({},e),{desiredBitrate:t.value/1e3}):e},adLoaded:({adBreakType:e})=>{const t=(()=>{switch(e){case S.AdType.preroll:return S.AdType.preroll;case S.AdType.midroll:return S.AdType.midroll;case S.AdType.postroll:return S.AdType.postroll;case S.AdType.inroll:return S.AdType.inroll;case S.AdType.postPauseroll:return S.AdType.postPauseroll}})();void 0!==t&&this.config.callbacks.onAdLoaded({adType:t})}});(0,n.muffleUncaughtErrors)(t.stopPromise.then((()=>d)).then((e=>e.destroy())));const c=yield Promise.race([d,t.stopPromise.then((()=>{}))]);if(void 0===c)return r;r=c}catch(t){this.config.callbacks.onAdError(),this.emit("MultirollInitError",{error:t,adConfig:e})}}return this.multiroll=r,r}))}prepareBeforeOrAfterAd(e,t){this.broadcastAd&&t!==S.AdType.inroll&&this.broadcastAd.setEnabled(e)}initBroadcastAd(){var e,t;const{playerVideoElement:i}=this.config;if(this.broadcastAd=new M.BroadcastAd(i,i.parentElement,(()=>this.config.getCueId()),(()=>this.config.getUtcPositionMs()),this.getMultiroll,(e=>{this.emit("InvalidMetadataError",e)}),this.config.logger),this.config.getVideoControllerVideoEngine()===c.VideoControllerEngine.NATIVE){let e=0;i.addEventListener("timeupdate",(()=>{const{currentTime:t}=i;this.config.getPlayerIsLive()&&t<e&&this.broadcastAd&&this.config.putOriginalBroadcastAdCues({}),e=t}))}null===(t=(e=this.config).onMetadataChange)||void 0===t||t.call(e,(e=>{const{fragmentMetadataArray:t,fragmentStart:i}=e;if(this.config.logger.log("receive metadata: ",t),!this.broadcastAd)return;const r=this.config.getControllerProgramDateTime();if(void 0===r)return;const n=(0,s.add)(r,(0,s.multiply)(i,1e3));let a;Math.random()<this.config.getMinimalChance()&&this.emit("ReceivedMetadata",e),t.forEach((e=>{try{const t=JSON.parse(e);if(!(0,N.isInrollFrame)(t))return;a=Object.assign(Object.assign({},t),{pts:n})}catch(t){this.config.logger.log(`metadata is not valid [${e}]`)}})),a&&this.broadcastAd.handleInrollFrame(a).catch((e=>{this.config.logger.error(e),this.emit("BroadcastAdBlockInitError",{error:e,metadata:{cueId:a.cue_id,podStart:n+a.offset}})}))})),this.broadcastAd.on("AdIntervalRemoved",(e=>{this.emit("AdIntervalRemoved",e)})),this.broadcastAd.on("AdIntervalUpdated",(e=>{this.emit("AdIntervalUpdated",e)})),this.broadcastAd.on("InrollAdPlayRequest",(e=>{this.emit("InrollAdPlayRequest",e),this.playAdViewers(S.AdType.inroll,e,{},{})})),this.broadcastAd.on("BeforeInrollHandle",(()=>{this.emit("BeforeInrollHandle")})),this.broadcastAd.on("BroadcastAdReceived",(e=>{this.emit("BroadcastAdReceived",e)})),this.broadcastAd.on("BroadcastAdInit",(e=>{this.emit("BroadcastAdInit",e)}))}}t.AdManager=k},5972:function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(n,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,o)}l((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.AdPlaybackQueue=void 0;const n=i(8210),a=i(618),s=i(2265),o=i(1006),l=i(2562),u=i(2210),d=i(2242),c=i(8588),h=i(1534),p=i(6471),f=i(9859),m={play:p.VideoPlayingState.PLAY,pause:p.VideoPlayingState.PAUSE,end:p.VideoPlayingState.END,idle:p.VideoPlayingState.PAUSE};class g extends s.Destroyable{constructor(e){super(),this.params=e,this.previousAdPlayingState="",this.destroyPromise=new Promise((e=>{this.addDestroyHandler((()=>{e()}))})),this.currentAdPlaybackController=void 0,this.playbackQueue=[],this.logAdStart=(0,n.once)((()=>{const e=this.getAdTypeForLogs(),t=this.playbackQueue.length;this.params.onAdStart({adPodsCount:t,adType:e}),e===h.AdType.inroll&&this.params.onInrollAdStart({adPodsCount:t})})),this.logAdEnd=(0,n.once)((()=>{const e=this.getAdTypeForLogs(),t=this.playbackQueue.length;e===h.AdType.inroll&&this.params.onInrollAdEnd({adPodsCount:t}),this.params.onAdEnd({stopAdReason:this.destroyReason||d.StopAdReason.AdCompleted,adPodsCount:t,adType:e})})),this.adPodIndex=0,this.startPlayingAd=(0,n.once)((()=>r(this,void 0,void 0,(function*(){if(this.logAdStart(),this.params.yaDirectPixel&&this.playbackQueue.length>0){const e=this.playbackQueue[0],t=e.adViewer.getYandexBidReqIdArray();(0,f.yaDirectPixelRequest)(this.params.yaDirectPixel.url,Object.assign(Object.assign({},this.params.yaDirectPixel.data),{eventUnixTime:Math.floor(Date.now()/1e3),eventType:"ads_rendered",inventory:"instream",count:e.adViewer.getAdPodsCount(),bidReqId:t&&t.length>0?t[0]:void 0}))}for(;this.adPodIndex<this.playbackQueue.length&&!this.isDestroyed;)yield this.playAdPod(this.playbackQueue[this.adPodIndex]),this.adPodIndex++;this.logAdEnd();const e=this.playbackQueue[this.playbackQueue.length-1];this.isDestroyed||void 0===e||(0,l.tryCatch)((()=>{this.params.onLastAdPodStopped({adType:e.adViewer.getAdBreakType()})})),this.destroy(d.StopAdReason.AdCompleted)})))),this.dispatchOnFirstAdPodStarted=(0,n.once)((()=>{this.params.onFirstAdPodStarted()})),this.updateAdPodCloseState=e=>{this.params.onAdPodCloseStateChange(e.getAdPodCloseState())},this.updateAdVolumeAvailabilityStateChange=e=>{this.params.onAdVolumeAvailabilityStateChange(e.getAdVolumeAvailabilityState())},this.updateAdPodTimeToSkip=e=>{const t=e.getAdPodTimeToSkip();this.params.onAdPodTimeToSkipChange((0,a.isFiniteNumber)(t)?(0,u.toSeconds)(Math.ceil(t)):void 0)},this.playAdPod=({adType:e,adViewer:t,additionalData:i,adDisplayConfig:n,posterUrl:s,adElement:o})=>r(this,void 0,void 0,(function*(){if(0===t.getAdPodsCount())return void this.params.logger.log("AdViewer is empty");if(this.params.onAdPodLoading({adPodsCount:this.playbackQueue.length,adType:this.playbackQueue[this.adPodIndex].adPodType,additionalData:i}),e===h.AdType.inroll){const{cueId:e}=i;this.params.onInrollAdPodStart({adPodsCount:this.playbackQueue.length,cueId:e}),t.setStatsRootFields({cueid:e})}const r=t.createPlaybackController(this.params.video,o,Object.assign({videoSlotCanAutoPlay:!0,controlsSettings:this.params.getControlsSettings(),visibilitySlot:this.params.playerContainer,lang:this.params.lang,contentAfterAd:this.getContentAfterAd(e,s),enableNewSkin:!0,adSequence:{index:this.adPodIndex,count:this.playbackQueue.length}},n));this.currentAdPlaybackController=r,this.updateAdPodDuration(r),this.params.onAdPodCurrentTimeChange((0,u.toSeconds)(0)),this.params.onAdSkippableStateChange(r.getAdSkippableState()),this.updateAdPodCloseState(r),this.updateAdVolumeAvailabilityStateChange(r),r.subscribe("AdPlayingStateChange",(()=>{this.updateAdPodPlayingStateChange()})),r.subscribe("AdMediaStateChange",(()=>{this.updateAdPodPlayingStateChange()})),r.subscribe("AdRemainingTimeChange",(()=>{const e=r.getAdPodRemainingTime(),t=this.updateAdPodDuration(r);this.params.onAdPodCurrentTimeChange((0,u.toSeconds)(t-e)),this.updateAdPodTimeToSkip(r),this.updateAdPodPlayingStateChange()})),r.subscribe("AdPodError",(({code:e})=>{if(this.params.yaDirectPixel){const e=this.playbackQueue[this.adPodIndex],t=e.adViewer.getYandexBidReqIdArray();(0,f.yaDirectPixelRequest)(this.params.yaDirectPixel.url,Object.assign(Object.assign({},this.params.yaDirectPixel.data),{eventUnixTime:Math.floor(Date.now()/1e3),eventType:"ads_render_failed",inventory:"instream",count:e.adViewer.getAdPodsCount(),bidReqId:t&&t.length>0?t[0]:void 0}))}this.params.onAdPodError({additionalData:this.playbackQueue[this.adPodIndex].additionalData,adPodsCount:this.playbackQueue.length,adType:this.playbackQueue[this.adPodIndex].adType,adPodIndex:this.adPodIndex+1,code:e})})),r.subscribe("AdInteraction",(()=>{this.params.onAdInteraction()})),r.subscribe("AdSkippableStateChange",(e=>{this.updateAdPodTimeToSkip(r),this.params.onAdSkippableStateChange(e.skippableState)})),r.subscribe("AdStartRejected",(e=>{this.params.onAdStartRejected(new Error("AdStartRejected"))})),r.subscribe("AdPodDurationChange",(()=>{this.updateAdPodDuration(r)})),r.subscribe("AdPodStartRequest",(()=>{this.params.onBeforeAdPodStart({adPlaybackController:r})})),r.subscribe("AdPodStarted",(()=>{var e;const t=null===(e=r.getCurrentViewerAssets())||void 0===e?void 0:e.isFullyClickable,n=(0,u.toSeconds)(r.getAdPodDuration()),a=r.getAdContentSize();this.dispatchOnFirstAdPodStarted(),this.params.onAdPodStarted({adPodIndex:this.adPodIndex+1,adPodsCount:this.playbackQueue.length,adType:this.playbackQueue[this.adPodIndex].adPodType,additionalData:i,isFullyClickable:t,adPodDuration:n,width:(null==a?void 0:a.width)||0,height:(null==a?void 0:a.height)||0}),this.updateAdPodPlayingStateChange(),this.updateAdPodDuration(r)}));const l=()=>{this.params.onAdPodDurationChange(void 0),this.params.onAdPodCurrentTimeChange(void 0),this.params.onAdSkippableStateChange(!1),this.params.onAdPodTimeToSkipChange(void 0),this.params.onAdPodCloseStateChange(void 0)};r.subscribe("AdPodStopped",(()=>{l(),this.params.onAdPodStopped()})),r.subscribe("AdPodSkipped",(()=>{l(),this.params.onAdPodSkipped({adPodsCount:this.playbackQueue.length,adType:this.playbackQueue[this.adPodIndex].adPodType,adPodIndex:this.adPodIndex+1,additionalData:i})})),r.subscribe("AdContentSizeChange",(()=>{const e=r.getAdContentSize();if(void 0===e)return;const{width:t,height:i}=e;this.params.onAdSizeChange({width:(0,u.toPixels)((0,a.isFiniteNumber)(t)?t:NaN),height:(0,u.toPixels)((0,a.isFiniteNumber)(i)?i:NaN)})})),r.subscribe("AdPodImpression",(()=>{this.params.onAdPodImpression({adPodsCount:this.playbackQueue.length,adType:this.playbackQueue[this.adPodIndex].adPodType,additionalData:i})})),r.subscribe("AdClickThru",(()=>{this.params.onAdClickThru({adPodIndex:this.adPodIndex+1,adPodsCount:this.playbackQueue.length,adType:this.playbackQueue[this.adPodIndex].adPodType,additionalData:i})})),this.shouldSkipAllAdPods()&&r.subscribe("AdPodSkipped",(()=>{this.destroy(d.StopAdReason.AdSkipped)})),r.subscribe("AdPodCloseStateChange",(()=>{this.updateAdPodCloseState(r)})),r.subscribe("AdVolumeAvailabilityStateChange",(()=>{this.updateAdVolumeAvailabilityStateChange(r)})),yield new Promise((t=>{r.subscribe("AdStopped",(()=>{t()})),r.playAd(),this.params.onAdPodPlayingStateChange({adType:e,playingState:p.VideoPlayingState.BUFFERING,expectedStalledReason:0===this.adPodIndex?c.ExpectedStalledReason.AdStart:c.ExpectedStalledReason.AdBetween})})),this.currentAdPlaybackController=void 0,this.params.onAdPodEnd({adPodIndex:this.adPodIndex+1,adPodsCount:this.playbackQueue.length,adType:this.playbackQueue[this.adPodIndex].adPodType,additionalData:i}),e===h.AdType.inroll&&(this.params.onInrollAdPodEnd({adPodsCount:this.playbackQueue.length,cueId:i.cueId}),t.setStatsRootFields({cueid:void 0}))})),this.addDestroyHandler((()=>{this.currentAdPlaybackController&&(this.currentAdPlaybackController.stopAd(),this.currentAdPlaybackController=void 0)}))}playAdViewers(e){this.isDestroyed||(this.playbackQueue.push(e),this.addDestroyHandler((()=>{e.adViewer.destroy()})),Promise.resolve().then((()=>this.startPlayingAd())))}resumeAd(){this.currentAdPlaybackController&&(this.currentAdPlaybackController.resumeAd(),this.updateAdPodPlayingStateChange())}pauseAd(){this.currentAdPlaybackController&&(this.currentAdPlaybackController.pauseAd(),this.updateAdPodPlayingStateChange())}skipAdPod(){this.currentAdPlaybackController&&this.currentAdPlaybackController.skipAd()}setVolume(e){this.currentAdPlaybackController&&this.currentAdPlaybackController.setAdVolume(e)}getDestroyPromise(){return this.destroyPromise}getAdTypeForLogs(){const[e]=this.playbackQueue;return e?e.adType:(this.params.onUnrecognizedAdType(),"unrecognized")}updateAdPodPlayingStateChange(){if(!this.currentAdPlaybackController)return;const e=this.currentAdPlaybackController.getAdMediaState(),t=this.currentAdPlaybackController.getAdPlayingState(),i=this.playbackQueue[this.adPodIndex].adPodType,r=this.params.video.src,n="stalled"===(null==e?void 0:e.name)&&r?{adType:i,playingState:p.VideoPlayingState.BUFFERING,expectedStalledReason:c.ExpectedStalledReason.AdOther}:{adType:i,playingState:m[t],expectedStalledReason:void 0};"pause"===t&&"pause"!==this.previousAdPlayingState&&this.params.onAdPodPause({adPodsCount:this.playbackQueue.length,adType:this.playbackQueue[this.adPodIndex].adType,adPodIndex:this.adPodIndex+1,additionalData:this.playbackQueue[this.adPodIndex].additionalData}),"play"===t&&"pause"===this.previousAdPlayingState&&this.params.onAdPodResume({adPodsCount:this.playbackQueue.length,adType:this.playbackQueue[this.adPodIndex].adType,adPodIndex:this.adPodIndex+1,additionalData:this.playbackQueue[this.adPodIndex].additionalData}),this.params.onAdPodPlayingStateChange(n),this.previousAdPlayingState=t}updateAdPodDuration(e){const t=(0,u.toSeconds)(e.getAdPodDuration());return this.params.onAdPodDurationChange(t),t}shouldSkipAllAdPods(){var e;return Boolean(null===(e=this.params.adConfig)||void 0===e?void 0:e.skipAllAdPods)||this.params.isSkipAllPodsFlagEnabled||!1}getContentAfterAd(e,t){const i=this.playbackQueue.length-1===this.adPodIndex,r=this.shouldSkipAllAdPods(),n=t?[{url:t}]:[];switch(e){case h.AdType.preroll:return i||r?{type:"startVideo",poster:n}:{type:"nextAd",poster:[]};case h.AdType.postroll:return{poster:[]};case h.AdType.midroll:case h.AdType.postPauseroll:case h.AdType.inroll:return i||r?{type:"continueVideo",poster:n}:{type:"nextAd",poster:[]};default:return(0,o.isNever)(e),{poster:[]}}}}t.AdPlaybackQueue=g},8185:function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(n,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,o)}l((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.BroadcastAd=void 0;const n=i(5198),a=i(2210),s=i(1534),o=i(3307),l=i(5522),u=i(2740),d=i(4614),c=i(2774),h=i(8291),p=i(7989),f=i(8534);class m extends o.EventEmitter{constructor(e,t,i,r,n,a,s){let o;super(),this.getCueId=i,this.getUtcPositionMs=r,this.getMultiroll=n,this.onInvalidMetadata=a,this.logger=s,this.isEnabled=!0,this.inrolls=new p.InrollAds,this.adIntervalStorage=new d.AdIntervalStorage(this.logger),this.adIndicators=new l.AdIndicators(t);const c=this.adIndicators.createIndicator(u.BroadcastAdType.original);e.addEventListener("timeupdate",(()=>{const t=this.getCueId();if(o!==t){const e=void 0!==t;c.setVisibility(e),o=t}const i=this.getUtcPositionMs();i&&(this.adIntervalStorage.validateAdIntervalsByTimestamp(i),this.isEnabled&&!e.paused&&(this.emit("BeforeInrollHandle"),this.handleInrolls()))})),this.adIntervalStorage.on("AdIntervalUpdated",(e=>{this.emit("AdIntervalUpdated",{cueId:e.cueId,start:e.start,end:e.end})})),this.adIntervalStorage.on("InvalidAdInterval",(({cueId:e,reason:t})=>{var i;null===(i=this.logger)||void 0===i||i.warn(`invalid ad interval: [cueId=${e}] [reason=${t}]`),this.onInvalidMetadata({cueId:e,reason:t}),this.emit("AdIntervalRemoved",e)}))}handleInrollFrame(e){const t=this.adIntervalStorage.handleInrollFrame(e);if(!t)return Promise.resolve();const{cueId:i,start:r,end:s,isEndReceived:o}=t,l=o?s+c.ADDITIONAL_AD_DURATION*n.MS_IN_SEC:r+h.MAX_AD_DURATION;return this.addInroll(i,r,(0,a.toMilliseconds)(l),{inrollFrame:e})}setEnabled(e){this.isEnabled=e}addInroll(e,t,i,{inrollFrame:n}){return r(this,void 0,void 0,(function*(){this.emit("BroadcastAdReceived",{cueId:e,podStart:t,adType:s.AdType.inroll});const r=this.getMultiroll(),a=yield r.inroll.loadViewers(Object.assign({},n));if(0===a.length)return;const o=(0,f.getAdViewersDuration)(a);this.emit("BroadcastAdInit",{cueId:e,podStart:t,duration:o,adPodsCount:a.length,adType:s.AdType.inroll}),this.inrolls.add({adViewers:a,cueId:e,startTime:t,endTime:i})}))}handleInrolls(){const e=this.getUtcPositionMs();if(!e)return;const t=this.getCueId();if(!t)return;const i=this.inrolls.getAdViewers(e,t);i.length&&this.emit("InrollAdPlayRequest",i)}}t.BroadcastAd=m},3358:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Deferred=void 0;const r=i(9346);t.Deferred=class{constructor(){let e=r.noop,t=r.noop;this.promise=new Promise(((i,r)=>{e=i,t=r})),this.resolve=e,this.reject=t}}},3307:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventEmitter=void 0;t.EventEmitter=class{constructor(){this.handlers=Object.create(null),this.onceHandlers=Object.create(null),this.maxEventListeners=10}setMaxListeners(e){!isFinite(e)||e<=0||(this.maxEventListeners=e)}on(e,t){this.getHandlers(e).push(t),this.checkSubscriptions(e)}once(e,t){this.getOnceHandlers(e).push(t),this.checkSubscriptions(e)}off(e,t){const i=this.getHandlers(e),r=this.getOnceHandlers(e);if(void 0===t)return i.length=0,void(r.length=0);this.removeHandler(t,i),this.removeHandler(t,r)}emit(e,t){const i=this.getHandlers(e),r=this.getOnceHandlers(e).slice();this.getOnceHandlers(e).length=0,i.slice().concat(r).forEach((e=>{try{e(t)}catch(e){setTimeout((()=>{throw e}),0)}}))}getHandlers(e){return void 0===this.handlers[e]&&(this.handlers[e]=[]),this.handlers[e]}getOnceHandlers(e){return void 0===this.onceHandlers[e]&&(this.onceHandlers[e]=[]),this.onceHandlers[e]}checkSubscriptions(e){const t=this.getHandlers(e).length+this.getOnceHandlers(e).length;t>this.maxEventListeners&&console.warn(`There are ${t} subscriptions on event named ${String(e)}`)}removeHandler(e,t){const i=t.indexOf(e);-1!==i&&t.splice(i,1)}}},7989:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InrollAds=void 0;const r=i(28),n=i(5198),a=i(2210),s=i(1534),o=i(2774);t.InrollAds=class{constructor(){this.ads=[],this.postAdsIds=[]}add(e){if(this.postAdsIds.indexOf(e.cueId)>-1)return;const t=this.findById(e.cueId);t?t.startTime=e.startTime:this.ads.push(Object.assign(Object.assign({},e),{adViewers:e.adViewers.reduce(((e,t)=>e.concat(t.separateAdPods())),[])}))}getAdViewers(e,t){const[i,l]=(0,r.separate)(this.ads,(({startTime:i,endTime:r,cueId:a,adViewers:s})=>{if(a!==t)return!1;if(e<i)return!1;if(r-o.ADDITIONAL_AD_DURATION*n.MS_IN_SEC<e)return!1;for(const t of s){if(e+1e3*t.getAdDuration()<r)return!0}return!1}));if(0===i.length)return[];this.postAdsIds.push(...i.map((({cueId:e})=>e))),this.ads=l,i.sort(((e,t)=>e.startTime-t.startTime));let u=(0,a.toSeconds)(0);const d=[];for(const{adViewers:t,endTime:r,cueId:l}of i)for(const i of t){const t=(0,a.add)(e,(0,a.multiply)(u,1e3));if(r-o.ADDITIONAL_AD_DURATION*n.MS_IN_SEC<t)break;r<(0,a.add)(t,(0,a.multiply)(i.getAdDuration(),1e3))||(d.push({adViewer:i,additionalData:{cueId:l},adType:s.AdType.inroll}),u=(0,a.add)(u,(0,a.toSeconds)(i.getAdDuration())))}return d}findById(e){return this.ads.find((({cueId:t})=>t===e))}}},8464:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadSourceSession=void 0;const r=i(3358);t.LoadSourceSession=class{constructor(){this.stopReasonInternal=void 0,this.stopDeferred=new r.Deferred}stop(e){this.stopReasonInternal=e,this.stopDeferred.resolve(e)}get stopReason(){return this.stopReasonInternal}get stopPromise(){return this.stopDeferred.promise}}},2774:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ADDITIONAL_AD_DURATION=void 0;const r=i(2210);t.ADDITIONAL_AD_DURATION=(0,r.toSeconds)(15)},5647:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ADMAN_AD_TYPE_MAP=void 0;const r=i(3993),n=i(1534);t.ADMAN_AD_TYPE_MAP={[r.AdmanAdType.MIDROLL]:n.AdType.midroll,[r.AdmanAdType.POSTROLL]:n.AdType.postroll,[r.AdmanAdType.PREROLL]:n.AdType.preroll}},4806:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ADMAN_SDK_URL=void 0,t.ADMAN_SDK_URL="https://ad.mail.ru/static/admanhtml/rbadman-html5.min.js"},2290:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ADMAN_VOLUME_COEFFICIENT=void 0,t.ADMAN_VOLUME_COEFFICIENT=.7},6226:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AD_SDK_URL=void 0,t.AD_SDK_URL="https://yandex.ru/ads/system/adsdk.js"},8291:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_AD_DURATION=void 0;const r=i(2210);t.MAX_AD_DURATION=(0,r.toMilliseconds)(6e5)},2305:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_INROLL_FRAME_OFFSET=void 0;const r=i(2210),n=i(8291),a=i(8654);t.MAX_INROLL_FRAME_OFFSET=(0,r.add)(n.MAX_AD_DURATION,(0,r.multiply)(a.TRANSCODER_SEGMENT_DURATION,3))},9603:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MIN_INROLL_FRAME_OFFSET=void 0;const r=i(2210),n=i(8291);t.MIN_INROLL_FRAME_OFFSET=(0,r.toMilliseconds)(-n.MAX_AD_DURATION)},7791:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_SECOND=void 0;const r=i(2210);t.ONE_SECOND=(0,r.toMilliseconds)(1e3)},5650:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PLG_SEGMENT_DURATION=void 0;const r=i(2210);t.PLG_SEGMENT_DURATION=(0,r.toMilliseconds)(5e3)},8654:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TRANSCODER_SEGMENT_DURATION=void 0;const r=i(2210);t.TRANSCODER_SEGMENT_DURATION=(0,r.toMilliseconds)(1e4)},4748:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dummyMultiroll=void 0;const r=i(9346);t.dummyMultiroll={destroy:r.noop,setStatsRootFields:r.noop,dispatchEvent:r.noop,getNextAdInfo:()=>{},preroll:{loadViewers:()=>Promise.resolve([])},midroll:{loadViewers:()=>Promise.resolve([])},inroll:{loadViewers:()=>Promise.resolve([]),schedule:r.noop},postroll:{loadViewers:()=>Promise.resolve([])},postPauseroll:{loadViewers:()=>Promise.resolve([])}}},4792:(e,t,i)=>{"use strict";t.GS=t.k_=t.WO=t.Ip=t.X2=void 0;var r=i(9932);Object.defineProperty(t,"X2",{enumerable:!0,get:function(){return r.AdManager}});var n=i(2242);Object.defineProperty(t,"Ip",{enumerable:!0,get:function(){return n.StopAdReason}});var a=i(8464);Object.defineProperty(t,"WO",{enumerable:!0,get:function(){return a.LoadSourceSession}});var s=i(1534);var o=i(336);Object.defineProperty(t,"k_",{enumerable:!0,get:function(){return o.PlayerStartStage}});var l=i(9438);Object.defineProperty(t,"GS",{enumerable:!0,get:function(){return l.StopLoadSourceReason}})},8707:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AdProvider=void 0,function(e){e.DIRECT="direct",e.MT="mt"}(t.AdProvider||(t.AdProvider={}))},4012:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AdStatType=void 0,function(e){e.WATERFALL="waterfall",e.PIXEL="pixel"}(t.AdStatType||(t.AdStatType={}))},1534:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AdType=void 0,function(e){e.preroll="preroll",e.midroll="midroll",e.postPauseroll="postPauseroll",e.postroll="postroll",e.inroll="inroll"}(t.AdType||(t.AdType={}))},3993:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AdmanAdType=void 0,function(e){e.PREROLL="preroll",e.MIDROLL="midroll",e.POSTROLL="postroll"}(t.AdmanAdType||(t.AdmanAdType={}))},8588:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExpectedStalledReason=void 0,function(e){e.AdStart="AdStart",e.AdOther="AdOther",e.AdBetween="AdBetween",e.AdEnd="AdEnd"}(t.ExpectedStalledReason||(t.ExpectedStalledReason={}))},7713:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidateReason=void 0,function(e){e.INVALID_INROLL_FRAME="INVALID_INROLL_FRAME",e.INVALID_START="INVALID_START",e.CROSSED_BY_INVALID="CROSSED_BY_INVALID",e.MAX_DURATION="MAX_DURATION"}(t.InvalidateReason||(t.InvalidateReason={}))},336:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlayerStartStage=void 0,function(e){e.init="init",e.waitForUserPlay="waitForUserPlay",e.waitForDocumentVisibility="waitForDocumentVisibility",e.starting="starting",e.started="started",e.broken="broken",e.destroyed="destroyed"}(t.PlayerStartStage||(t.PlayerStartStage={}))},2242:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StopAdReason=void 0,function(e){e.AdCompleted="AdCompleted",e.LoadSource="LoadSource",e.PlayerDestroy="PlayerDestroy",e.CutOff="CutOff",e.PlayerError="PlayerError",e.AdTypeChange="AdTypeChange",e.InsertIntoCalled="InsertIntoCalled",e.AdSkipped="AdSkipped"}(t.StopAdReason||(t.StopAdReason={}))},9438:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StopLoadSourceReason=void 0,function(e){e.setSource="setSource",e.destroy="destroy",e.end="end"}(t.StopLoadSourceReason||(t.StopLoadSourceReason={}))},8378:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VideoControllerEngine=void 0,function(e){e.NATIVE="NATIVE",e.HLS="HLS",e.MPD="MPD",e.MP4="MP4"}(t.VideoControllerEngine||(t.VideoControllerEngine={}))},6471:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VideoPlayingState=void 0,function(e){e.PLAY="play",e.PAUSE="pause",e.BUFFERING="buffering",e.END="end"}(t.VideoPlayingState||(t.VideoPlayingState={}))},7103:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.convertInrollFrameToAdInterval=void 0;const r=i(2210),n=i(7197);t.convertInrollFrameToAdInterval=function({cue_id:e,pts:t,offset:i,cutoff:a}){const s=(0,r.add)(t,i);return{start:s,isEndReceived:void 0!==a,cueId:e,end:void 0!==a?(0,r.add)(t,a):(0,n.getPtsOut)(t,s),isValid:!0,invalidateReason:void 0}}},8410:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAdSdkLoaderVersion=void 0,t.getAdSdkLoaderVersion=function(e=window){try{return e.ya.videoAd.getBundleVersion()}catch(e){return"none"}}},7715:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAdSdkVersion=void 0,t.getAdSdkVersion=function(e=window){try{return e.ya.videoAd.getModuleVersion()}catch(e){return"none"}}},3414:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAdViewersAdPodsCount=void 0;const r=i(2210);t.getAdViewersAdPodsCount=function(e){return e.reduce(((e,t)=>(0,r.add)(e,(0,r.toUnsignedInt)(t.getAdPodsCount()))),(0,r.toUnsignedInt)(0))}},8534:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAdViewersDuration=void 0;const r=i(2210);t.getAdViewersDuration=function(e){return e.reduce(((e,t)=>(0,r.add)(e,(0,r.toSeconds)(t.getAdDuration()))),(0,r.toSeconds)(0))}},7197:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPtsOut=void 0;const r=i(2210),n=i(5650),a=i(8654);t.getPtsOut=function(e,t){return(0,r.toMilliseconds)(Math.max(e+a.TRANSCODER_SEGMENT_DURATION,t+n.PLG_SEGMENT_DURATION))}},9358:function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(n,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,o)}l((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.initMultirollModule=void 0;const n=i(5216),a=i(9346),s=i(6226),o=i(4806),l=i(8829);t.initMultirollModule=function(e=window,t,i,u=!1,d,c,h){var p;return r(this,void 0,void 0,(function*(){let r;return r=u&&c?(0,l.loadAdmanModule)({loaderUrl:o.ADMAN_SDK_URL,win:e,vkParams:c,yaDirectPixel:h?{url:h.url,data:h.data}:void 0}).promise:(0,n.loadVasModule)({serviceName:"player",serviceVersion:d,vasLoaderUrl:s.AD_SDK_URL,config:Object.assign(Object.assign({},t),{additionalCustomRootFields:{vsid:i,contentPlayerVersion:d,testIds:null===(p=t.additionalParams)||void 0===p?void 0:p.slots}}),win:e,moduleName:"Multiroll",yaDirectPixel:h?{url:h.url,data:h.data}:void 0}).promise,r.catch(a.noop),r}))}},8829:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadAdmanModule=void 0;const r=i(7022),n=i(9859);t.loadAdmanModule=e=>({promise:new Promise(((t,i)=>{(0,r.loadScriptLite)({src:e.loaderUrl,onError:t=>{e.yaDirectPixel&&(0,n.yaDirectPixelRequest)(e.yaDirectPixel.url,Object.assign(Object.assign({},e.yaDirectPixel.data),{eventType:"dsp_request_failed",inventory:"instream",eventUnixTime:Math.floor(Date.now()/1e3)})),i(t)},onLoad:()=>{e.yaDirectPixel&&(0,n.yaDirectPixelRequest)(e.yaDirectPixel.url,Object.assign(Object.assign({},e.yaDirectPixel.data),{eventType:"dsp_request",inventory:"instream",eventUnixTime:Math.floor(Date.now()/1e3)}));const i=new e.win.AdmanHTML;i.init(Object.assign({},e.vkParams)),t(i)}})}))})},5216:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadVasModule=void 0;const r=i(7022),n=i(9859);t.loadVasModule=e=>({promise:new Promise(((t,i)=>{(0,r.loadScriptLite)({src:e.vasLoaderUrl,onError:t=>{e.yaDirectPixel&&(0,n.yaDirectPixelRequest)(e.yaDirectPixel.url,Object.assign(Object.assign({},e.yaDirectPixel.data),{eventType:"dsp_request_failed",inventory:"instream",eventUnixTime:Math.floor(Date.now()/1e3)})),i(t)},onLoad:()=>{e.yaDirectPixel&&(0,n.yaDirectPixelRequest)(e.yaDirectPixel.url,Object.assign(Object.assign({},e.yaDirectPixel.data),{eventType:"dsp_request",inventory:"instream",eventUnixTime:Math.floor(Date.now()/1e3)})),e.win.ya.videoAd.loadModule(e.moduleName).then((e=>t(e))).catch(i)}})}))})},1915:function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(n,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,o)}l((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.initWaterfallRequestToDirect=void 0;const n=i(9346),a=i(6226),s=i(5216);t.initWaterfallRequestToDirect=function(e=window,t,i,o){var l;return r(this,void 0,void 0,(function*(){const r=(0,s.loadVasModule)({serviceName:"player",serviceVersion:o,vasLoaderUrl:a.AD_SDK_URL,config:Object.assign(Object.assign({},t),{additionalCustomRootFields:{vsid:i,contentPlayerVersion:o,testIds:null===(l=t.additionalParams)||void 0===l?void 0:l.slots}}),win:e,moduleName:"Multiroll"}).promise;return r.catch(n.noop),r}))}},8183:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isInrollFrame=void 0;const r=i(618),n=i(957),a=i(4734);t.isInrollFrame=function(e){return(0,n.isObject)(e)&&(0,a.isString)(e.cue_id)&&(0,r.isFiniteNumber)(e.offset)}},3781:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isValidInrollFrame=void 0;const r=i(8291),n=i(2305),a=i(9603),s=i(5650);t.isValidInrollFrame=function(e){if(e.offset<a.MIN_INROLL_FRAME_OFFSET||e.offset>n.MAX_INROLL_FRAME_OFFSET)return!1;if(void 0===e.cutoff)return!0;if(e.cutoff<a.MIN_INROLL_FRAME_OFFSET||e.cutoff>n.MAX_INROLL_FRAME_OFFSET)return!1;const t=e.cutoff-e.offset;return t>=s.PLG_SEGMENT_DURATION&&t<=r.MAX_AD_DURATION}},7064:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.timer=void 0;const r=i(2210);t.timer=function(){let e;return{createInstance:(t,i,n)=>(e&&e.resetTimer(),e=((e,t,i)=>{const n=1e3;let a,s,o=0,l=Number.POSITIVE_INFINITY,u=!1;const d=()=>{const n=Math.floor(i.getConfig().getControllerWatchedTime());Number.isInteger(s)&&n<t&&!u&&(s&&clearTimeout(s),s=setTimeout(d,1e3),o!==n&&(o=n,a=e.setPosition(o,t)),l-=1,i.getConfig().callbacks.onAdPodTimeToSkipChange((0,r.toSeconds)(l)))},c=()=>{o=0,a=void 0,l=Number.POSITIVE_INFINITY,s&&clearTimeout(s)};return{start:()=>{u=!1,c(),s=setTimeout(d,n)},stop:()=>{u=!0,c()},play:()=>{s&&clearTimeout(s),s=setTimeout(d,n)},pause:()=>{s&&clearTimeout(s)},resetTimer:()=>{u=!0,c()},getNextAdTime:()=>a,getSkipAdTime:()=>l,setSkipAdTime:e=>{l=e},getTime:()=>o,setTime:e=>{o=e}}})(t,i,n),e)}}()},9859:function(e,t){"use strict";var i=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(n,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,o)}l((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.yaDirectPixelRequest=void 0;t.yaDirectPixelRequest=(e,t)=>i(void 0,void 0,void 0,(function*(){return fetch(e,{method:"POST",body:JSON.stringify([t])})}))},2611:(e,t,i)=>{"use strict";i.d(t,{e:()=>E});var r=i(9019);const n=[].find,a=(0,r.J)(n)?(e,t)=>n.call(e,t):(e,t)=>{for(let i=0;i<e.length;i++){const r=e[i];if(t(r,i,e))return r}};var s=i(94);var o=i(1258);let l;const u=(e=document.body)=>{const t=function(e){const t=function(e,{content:t,size:i}={}){const r=e.ownerDocument.createElement("iframe");r.scrolling="no",r.setAttribute("allowfullscreen",""),r.style.display="block",i&&(r.height=i.height,r.width=i.width),e.appendChild(r);const n=r.contentDocument;return n.open(),t&&n.write(t),n.close(),n.body.style.margin="0",r.style.borderWidth="0",r}(e);return t.width="0",t.height="0",t.style.position="absolute",t}(e);return{JSON:t.contentWindow.JSON,clean:()=>function(e){e.src="",(0,o.removeNodeFromParent)(e)}(t)}};function d(e=window){return void 0===l&&(l=function(e=window){return e.JSON&&(0,r.J)(e.JSON.stringify)&&(0,r.J)(e.JSON.parse)}(e)?e.JSON:{stringify:c("stringify"),parse:c("parse")}),l}const c=e=>t=>{const{JSON:i,clean:r}=u();try{return i[e](t)}finally{r()}};var h=i(957),p=i(4734);function f(e){return d().stringify(e,function(){const e=[],t=function(){const e="undefined"!=typeof WeakMap?new WeakMap:void 0,t=[];return{set:(i,r)=>{if(void 0!==e)try{e.set(i,r)}catch(e){t.push({path:r,value:i})}else t.push({path:r,value:i})},get:i=>{const r=a(t,(e=>e.value===i));return void 0!==e&&void 0===r?e.get(i):r?r.path:void 0}}}();return(i,r)=>{if((0,s.T)(r))return(0,p.isString)(r.name)?r.name:"[Function]";if(!(0,h.isObject)(r))return r;const n=t.get(r);if(n)return`[Circular ${n}]`;for(;e.length>0&&e[e.length-1].value[i]!==r;)e.pop();const a=(e.length>0?e[e.length-1].path:"")+(i?`/${i}`:"~");return e.push({path:a,value:r}),t.set(r,a),r}}())}const m="DEFAULT_ERROR_MESSAGE",g=0,v="",S="?:?:?",y=!0,T=i(8030);class E extends Error{constructor(e,t={}){const i="object"==typeof e?e:{message:String(e||m)};super(),T(this,E.prototype),this.message=t.message||i.message||m,this.code=t.code||i.code||i.id||g,this.isFatal=Boolean(function(e){const[t]=((e,t,i)=>{const r=[];for(let n=0;n<e.length;n++){const a=e[n];t.call(i,a,n,e)&&r.push(a)}return r})(e,(e=>void 0!==e));return t}([t.isFatal,i.isFatal,y])),this.details=t.details||i.details||v;const r=t.stack||i.stack||function(e){const{url:t,line:i,col:r,fileName:n,columnNumber:a,lineNumber:s}=e;return`${t||n||"?"}:${i||s||"?"}:${r||a||"?"}`}(i);let n=r===S?this.stack:r;if(n&&n!==S)this.stack=n;else if(!this.stack)try{throw new Error(this.message)}catch(e){this.stack=n=e.stack||S}this.toString=()=>f(this.toJSON()),this.toJSON=()=>({message:this.message,code:this.code,isFatal:this.isFatal,details:this.details,stack:n})}}},8368:(e,t,i)=>{"use strict";i.r(t),i.d(t,{getFullscreenElement:()=>a});const r=[{enabled:"webkitFullscreenEnabled",element:"webkitFullscreenElement",request:"webkitRequestFullscreen",exit:"webkitExitFullscreen",events:{change:"webkitfullscreenchange",error:"webkitfullscreenerror"}},{enabled:"fullscreenEnabled",element:"fullscreenElement",request:"requestFullscreen",exit:"exitFullscreen",events:{change:"fullscreenchange",error:"fullscreenerror"}},{enabled:"mozFullScreenEnabled",element:"mozFullScreenElement",request:"mozRequestFullScreen",exit:"mozCancelFullScreen",events:{change:"mozfullscreenchange",error:"mozfullscreenerror"}},{enabled:"msFullscreenEnabled",element:"msFullscreenElement",request:"msRequestFullscreen",exit:"msExitFullscreen",events:{change:"MSFullscreenChange",error:"MSFullscreenError"}},{enabled:"webkitSupportsFullscreen",element:"webkitDisplayingFullscreen",request:"webkitEnterFullscreen",exit:"webkitExitFullscreen",events:{change:"webkitfullscreenchange",error:"webkitfullscreenerror"}}];function n(e,t){const i=function(e=window){const{document:t={}}=e;return r.filter((({enabled:e})=>e in t))}(e);if(i.length>0)return i[0];const n=function(e=window,t=e.HTMLVideoElement&&e.HTMLVideoElement.prototype||{}){return r.filter((({enabled:e})=>e in t))}(e,t);return n.length>0?n[0]:void 0}function a(e,t){const i=n(e,t);if(!i)return null;let r=e.document[i.element];return t&&t[i.element]&&(r=t),r||null}},9325:(e,t,i)=>{"use strict";i.d(t,{y:()=>f});const r=!(0,i(9019).J)(Math.random)||Math.random()==Math.random();var n=i(94);const a=Date&&(0,n.T)(Date.now)?()=>Date.now():()=>(new Date).getTime(),s="undefined"==typeof window?void 0:window.performance,o=s&&(0,n.T)(s.now),l=s&&s.timing&&s.timing.navigationStart?s.timing.navigationStart:a();let u=0;const d=o?()=>s.now():()=>(()=>{const e=a()-l;return u=Math.max(e,u),u})(),c=2147483647;let h=Date.now()*d()%c;const p=c-1;const f=r?function(){return h=16807*h%c,(h-1)/p}:function(){return Math.random()}},9019:(e,t,i)=>{"use strict";function r(e){if(!e||!e.toString)return!1;const t=Function.prototype.toString.call(e);return/\[native code\]/.test(t)||/\/\* source code not available \*\//.test(t)}i.d(t,{J:()=>r})},957:(e,t,i)=>{"use strict";function r(e){const t=typeof e;return Boolean(e)&&("object"===t||"function"===t)}i.r(t),i.d(t,{isObject:()=>r})},393:(e,t,i)=>{"use strict";i.d(t,{c:()=>s});var r=i(1829),n=i(9019);const a=function(e,t){let i=e[t];if(!(0,n.J)(i)){const r=i;try{delete e[t];const n=e[t];"function"==typeof n&&(i=n),e[t]=r}catch(e){}}return i}(Array,"isArray"),s=Boolean(a)?e=>a.call(Array,e):e=>"Array"===(0,r.U)(e)},28:(e,t,i)=>{"use strict";i.r(t),i.d(t,{separate:()=>n});const r=(e,t,i)=>{for(let r=0;r<e.length;r++)t.call(i,e[r],r,e)};function n(e,t){const i=[],n=[];return r(e,((r,a)=>{t(r,a,e)?i.push(r):n.push(r)})),[i,n]}},4891:(e,t,i)=>{"use strict";function r(e){if(e&&e.location){const{location:t}=e;return"function"==typeof t.toString?t.toString():t.href||""}return""}i.d(t,{K:()=>n});const n=e=>{const t=[];for(;e;)try{if(r(e),t.push(e),e.parent===e)break;e=e.parent}catch(e){break}return t}},8210:(e,t,i)=>{"use strict";function r(e){let t=function(){let i;return t=()=>i,i=e.apply(this,arguments),i};return function(){return t.apply(this,arguments)}}i.r(t),i.d(t,{once:()=>r})},1829:(e,t,i)=>{"use strict";i.d(t,{U:()=>a});const r={}.toString,n=/\[object (\w+)\]/,a=e=>{const t=r.call(e);if(!t)return null;const i=t.match(n);if(!i)return null;const a=i[1];return a||null}},2220:(e,t,i)=>{"use strict";i.d(t,{W:()=>n});var r=i(9325);function n(e){let t="";for(let i=0;i<e;i++)t+=(16*(0,r.y)()|0).toString(16);return t}},94:(e,t,i)=>{"use strict";i.d(t,{T:()=>n});var r=i(1829);function n(e){return"function"==typeof e||"Function"===(0,r.U)(e)}},4119:(e,t,i)=>{"use strict";function r(e){e&&"function"==typeof e.catch&&e.catch((e=>{}))}i.r(t),i.d(t,{muffleUncaughtErrors:()=>r})},9346:(e,t,i)=>{"use strict";function r(...e){}i.r(t),i.d(t,{noop:()=>r})},618:(e,t,i)=>{"use strict";function r(e){return"number"==typeof e&&isFinite(e)}i.r(t),i.d(t,{isFiniteNumber:()=>r})},1258:(e,t,i)=>{"use strict";function r(e){if(!e)return;const{parentElement:t}=e;t&&t.removeChild(e)}i.r(t),i.d(t,{removeNodeFromParent:()=>r})},7022:(e,t,i)=>{"use strict";i.r(t),i.d(t,{loadScriptLite:()=>u});var r=i(9346),n=i(1258),a=i(9325);function s(e="a",t="z"){const i=function(e,t){let i=e+(0,a.y)()*(t+1-e);return i=Math.floor(i),i}(e.charCodeAt(0),t.charCodeAt(0));return String.fromCharCode(i)}const o="utf-8",l=e=>!0;function u(e){const{dropCacheOnRetry:t=!1,onBeforeLoad:i=r.noop,retries:n=0}=e;if(e.checkLoad&&e.checkLoad())return void(e.onLoad&&e.onLoad());let a=i,o=0;return t&&n>0&&(a=e=>{if(i(e),o>0){const t=-1===e.src.indexOf("?")?"?":"&",i=function(e){const t=[];for(let i=0;i<e;i++)t.push(s());return t.join("")}(4);e.src+=t+i}o++}),d({...e,onBeforeLoad:a})}function d(e){const{src:t,win:i=window,charset:a=o,async:s=!0,retries:u=0,onRetry:c=r.noop,retryDelay:h=0,checkLoad:p=l,onBeforeLoad:f=r.noop,onLoad:m=r.noop,onError:g=r.noop}=e,v=i.document.createElement("script"),S=i=>{u>0?(c(i),d({...e,src:t,retries:u-1})):g(i),(0,n.removeNodeFromParent)(v)};v.type="text/javascript",v.async=s,v.onload=()=>p(v)?m():S(new Error(`checkLoad for ${t} failed`)),v.onerror=e=>{try{i.setTimeout((()=>{S(e)}),h)}catch(e){}},v.src=t,v.charset=a,f(v),function(e){const t=e.document;let i=t.getElementsByTagName("head")[0];return i||(i=t.createElement("head"),t.documentElement.appendChild(i)),i}(i).appendChild(v)}},4734:(e,t,i)=>{"use strict";function r(e){return"string"==typeof e}i.r(t),i.d(t,{isString:()=>r})},2562:(e,t,i)=>{"use strict";function r(e,t){try{return e()}catch(e){"function"==typeof t&&t(e)}}i.r(t),i.d(t,{tryCatch:()=>r})},2265:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Destroyable:()=>g});var r=i(2611),n=i(393);function a(e,...t){(0,n.c)(e)&&e.forEach((e=>{"function"==typeof e&&e(...t)}))}const s=function(e=document,t){const i=e.currentScript;if(i)return i;{const i=e.getElementsByTagName("script"),r=[];for(let e=0;e<i.length;e++)r.push(i[e]);if("function"==typeof t){const e=r.filter(t);return e[e.length-1]}return r[r.length-1]}}(),o=s?s.src:"";var l=i(2220),u=i(9346),d=i(4891);const c=({propertyName:e,callbackArguments:t,win:i=window})=>{(0,d.K)(i).forEach((i=>{const r=i[e];Array.isArray(r)&&a(r,...t)}))},h=({win:e,propertyName:t})=>{delete e[t]},p=({propertyName:e,win:t,callback:i})=>{const r=t;Array.isArray(r[e])?r[e].push(i):r[e]=[i]},f=(({win:e,propertyName:t})=>({call:i=>c({win:e,propertyName:t,...i}),subscribe:i=>p({win:e,propertyName:t,...i}),wait:i=>(({propertyName:e,win:t})=>new Promise((i=>{p({callback:(...e)=>i(e),propertyName:e,win:t})})))({win:e,propertyName:t,...i}),waitUntil:i=>(({propertyName:e,win:t,comparator:i})=>new Promise((r=>{r(),p({propertyName:e,win:t,callback:(...e)=>{i(...e)&&r()}})})))({win:e,propertyName:t,...i}),clear:i=>h({win:e,propertyName:t,...i})}))({propertyName:"YANDEX_DESTROYABLE_GLOBAL_CALLBACK_PROPERTY_NAME",win:window});let m=0;class g{constructor(){this._isDestroyed=!1,this.destroyHandlers=[];{const e={id:m++,random:(0,l.W)(64),scriptSrc:o,constructorName:this.constructor.name,stack:new r.e({}).stack};f.call({callbackArguments:[{...e,eventName:"create"}]}),this.addDestroyHandler((()=>{f.call({callbackArguments:[{...e,eventName:"destroy"}]})}))}}get destroyReason(){return this._destroyReason}get isDestroyed(){return this._isDestroyed}static addErrorHandler(e){g.errorHandlers.push(e)}onDestroy(e){this._addDestroyHandler(e)}addDestroyListener(e){this._addDestroyHandler(e)}addDestroyHandler(e){this._addDestroyHandler(e)}destroy(...e){const[t]=e;if(!this._isDestroyed){this._isDestroyed=!0,this._destroyReason=t;try{a(this.destroyHandlers,...e)}catch(e){a(g.errorHandlers,e)}this.destroyHandlers.length=0}}getIsDestroyed(){return this._isDestroyed}ignoreAfterDestroy(e){let t=e;return(...e)=>{this.isDestroyed&&(t=u.noop),t.apply(this,e)}}_addDestroyHandler(e){this._isDestroyed?e(this._destroyReason):this.destroyHandlers.push(e)}}g.errorHandlers=[]},5198:(e,t,i)=>{"use strict";i.r(t),i.d(t,{HOUR_IN_DAY:()=>s,MIN_IN_HOUR:()=>a,MS_IN_DAY:()=>u,MS_IN_SEC:()=>r,SEC_IN_DAY:()=>l,SEC_IN_HOUR:()=>o,SEC_IN_MIN:()=>n});const r=1e3,n=60,a=60,s=24,o=a*n,l=s*o,u=l*r},6722:(e,t,i)=>{"use strict";i.r(t),i.d(t,{addParamToUrl:()=>S,addParamsToUrl:()=>y,formatQueryString:()=>v,getFileExt:()=>b,getFileName:()=>E,getParamsFromUrl:()=>m,getPostProtocolIndex:()=>T,parseQueryString:()=>f,parseUrl:()=>c,parseUrlUsingCache:()=>u,urlFromUrlObject:()=>h});var r=i(393);class n{constructor(e){this.cache=e}get(e){return this.cache[e]}has(e){return e in this.cache}set(e,t){this.cache[e]=t}}function a(e,t){return Object.prototype.hasOwnProperty.call(e,t)}const s=document.createElement("a"),o="//",l=2,u=((e,t=e=>e,i=new n({}))=>function(){const r=t.apply(this,arguments);if(i.has(r))return i.get(r);const n=e.apply(this,arguments);return i.set(r,n),n})((e=>({...c(e)}))),d=/^(android-app:|chrome-extension:)/;function c(e){s.href=e;let t=s.pathname||"";"/"!==t.charAt(0)&&(t=`/${t}`);const i=(s.search||"")+(s.hash||""),r=e.lastIndexOf(i),n=-1===r?e:e.slice(0,r);if(d.test(e)){const t=c(e.replace(d,"https:"));return s.href=e,{...t,originalPath:n,protocol:e.slice(0,e.indexOf(":")+1),href:s.href}}const a=s.protocol&&/^[a-z\-]+:/i.test(s.protocol)?s.protocol:"";return{originalPath:n,href:s.href,protocol:a,host:s.host,hostname:s.hostname,port:s.port,pathname:t,search:s.search,hash:s.hash}}function h(e,t=!1){if(t){const t=e.originalPath,i="/"===e.pathname&&"/"!==t[t.length-1];return`${e.originalPath}${i?"/":""}${e.search}${e.hash}`}const i="443"===e.port||"80"===e.port?e.hostname:e.host;return`${e.protocol}//${i}${e.pathname}${e.search}${e.hash}`}const p=e=>{try{return decodeURIComponent(e)}catch(t){return e}};function f(e){const t={},i=e.replace(/^[?#]+/,"").replace(/#.*$/,"").split("&");for(let e=0;e<i.length;e++){const r=i[e].indexOf("=");let n,a;if(-1===r?(n=p(i[e]),a=""):(n=p(i[e].slice(0,r)),a=i[e].slice(r+1)),n){const e=Boolean(/(\[\])$/.exec(n));n=n.replace(/\[\]$/,""),e?void 0===t[n]?t[n]=[p(a)]:t[n]=[].concat(t[n],p(a)):t[n]=p(a)}}return t}function m(e){return f(c(e).search)}const g=(e,t)=>t.map((t=>`${e}[]=${encodeURIComponent(t)}`)).join("&");function v(e){const t=[];for(const i in e)if(e.hasOwnProperty(i)){const n=e[i];(0,r.c)(n)?t.push(g(i,n)):void 0!==n&&t.push(`${i}=${encodeURIComponent(n)}`)}return`?${t.join("&")}`}function S(e,t,i){if(void 0===i)return e;const r=c(e),n=f(r.search);return n[t]=i,h({...r,search:v(n)})}function y(e,t,{override:i=!0,saveOriginalPath:r=!1}={}){const n=c(e),s=f(n.search);!function(e,t,i){for(const r in e)a(e,r)&&t.call(i,e[r],r,e)}(t,((e,t)=>{(void 0===s[t]||i)&&(s[t]=e)}));const o=v(s);return h({...n,search:o},r)}function T(e){const t=e.indexOf(o);return-1!==t?t+l:0}function E(e){return c(e).pathname.split("/").pop()||""}function b(e){const t=E(e).split(".");return t.length>1?t.pop():""}},1006:(e,t,i)=>{"use strict";function r(e){}i.r(t),i.d(t,{isNever:()=>r})},2210:(e,t,i)=>{"use strict";i.r(t),i.d(t,{add:()=>r,divide:()=>s,multiply:()=>a,substract:()=>n,toBits:()=>h,toBps:()=>m,toFloat:()=>l,toHours:()=>E,toInt:()=>u,toKbps:()=>g,toKilobits:()=>p,toMbps:()=>v,toMegabits:()=>f,toMilliseconds:()=>S,toMinutes:()=>T,toPercent:()=>A,toPixels:()=>R,toPortion:()=>_,toSeconds:()=>y,toTimestamp:()=>b,toUnsigned:()=>o,toUnsignedFloat:()=>d,toUnsignedInt:()=>c});const r=(e,...t)=>{let i=e;for(let e=0;e<t.length;e++)i+=t[e];return i},n=(e,...t)=>{let i=e;for(let e=0;e<t.length;e++)i-=t[e];return i},a=(e,...t)=>{let i=e;for(let e=0;e<t.length;e++)i*=t[e];return i},s=(e,...t)=>{let i=e;for(let e=0;e<t.length;e++)i/=t[e];return i};function o(e){return Math.max(e,0)}function l(e){return e}function u(e){return Math.floor(e)}function d(e){return o(e)}function c(e){return o(u(e))}function h(e){return e}function p(e){return e}function f(e){return e}function m(e){return e}function g(e){return e}function v(e){return e}function S(e){return e}function y(e){return e}function T(e){return e}function E(e){return e}function b(e){return e}function _(e){return e}function A(e){return e}function R(e){return e}},7702:()=>{},2849:e=>{e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},6894:(e,t,i)=>{var r=i(5104)("unscopables"),n=Array.prototype;null==n[r]&&i(2559)(n,r,{}),e.exports=function(e){n[r][e]=!0}},9918:(e,t,i)=>{var r=i(3163);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},4070:(e,t,i)=>{var r=i(7971),n=i(2807),a=i(2287);e.exports=function(e){return function(t,i,s){var o,l=r(t),u=n(l.length),d=a(s,u);if(e&&i!=i){for(;u>d;)if((o=l[d++])!=o)return!0}else for(;u>d;d++)if((e||d in l)&&l[d]===i)return e||d||0;return!e&&-1}}},8802:(e,t,i)=>{var r=i(5723),n=i(5104)("toStringTag"),a="Arguments"==r(function(){return arguments}());e.exports=function(e){var t,i,s;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),n))?i:a?r(t):"Object"==(s=r(t))&&"function"==typeof t.callee?"Arguments":s}},5723:e=>{var t={}.toString;e.exports=function(e){return t.call(e).slice(8,-1)}},9340:e=>{var t=e.exports={version:"2.5.7"};"number"==typeof __e&&(__e=t)},7870:(e,t,i)=>{var r=i(2849);e.exports=function(e,t,i){if(r(e),void 0===t)return e;switch(i){case 1:return function(i){return e.call(t,i)};case 2:return function(i,r){return e.call(t,i,r)};case 3:return function(i,r,n){return e.call(t,i,r,n)}}return function(){return e.apply(t,arguments)}}},1462:e=>{e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},5209:(e,t,i)=>{e.exports=!i(9758)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},272:(e,t,i)=>{var r=i(3163),n=i(4868).document,a=r(n)&&r(n.createElement);e.exports=function(e){return a?n.createElement(e):{}}},6526:e=>{e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},9209:(e,t,i)=>{var r=i(4868),n=i(9340),a=i(2559),s=i(7321),o=i(7870),l="prototype",u=function(e,t,i){var d,c,h,p,f=e&u.F,m=e&u.G,g=e&u.S,v=e&u.P,S=e&u.B,y=m?r:g?r[t]||(r[t]={}):(r[t]||{})[l],T=m?n:n[t]||(n[t]={}),E=T[l]||(T[l]={});for(d in m&&(i=t),i)h=((c=!f&&y&&void 0!==y[d])?y:i)[d],p=S&&c?o(h,r):v&&"function"==typeof h?o(Function.call,h):h,y&&s(y,d,h,e&u.U),T[d]!=h&&a(T,d,p),v&&E[d]!=h&&(E[d]=h)};r.core=n,u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,e.exports=u},9758:e=>{e.exports=function(e){try{return!!e()}catch(e){return!0}}},4868:e=>{var t=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)},9871:e=>{var t={}.hasOwnProperty;e.exports=function(e,i){return t.call(e,i)}},2559:(e,t,i)=>{var r=i(8557),n=i(5974);e.exports=i(5209)?function(e,t,i){return r.f(e,t,n(1,i))}:function(e,t,i){return e[t]=i,e}},302:(e,t,i)=>{var r=i(4868).document;e.exports=r&&r.documentElement},3426:(e,t,i)=>{e.exports=!i(5209)&&!i(9758)((function(){return 7!=Object.defineProperty(i(272)("div"),"a",{get:function(){return 7}}).a}))},9279:(e,t,i)=>{var r=i(5723);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},3163:e=>{e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},4922:(e,t,i)=>{"use strict";var r=i(7037),n=i(5974),a=i(1990),s={};i(2559)(s,i(5104)("iterator"),(function(){return this})),e.exports=function(e,t,i){e.prototype=r(s,{next:n(1,i)}),a(e,t+" Iterator")}},6849:(e,t,i)=>{"use strict";var r=i(8240),n=i(9209),a=i(7321),s=i(2559),o=i(8504),l=i(4922),u=i(1990),d=i(6941),c=i(5104)("iterator"),h=!([].keys&&"next"in[].keys()),p="keys",f="values",m=function(){return this};e.exports=function(e,t,i,g,v,S,y){l(i,t,g);var T,E,b,_=function(e){if(!h&&e in P)return P[e];switch(e){case p:case f:return function(){return new i(this,e)}}return function(){return new i(this,e)}},A=t+" Iterator",R=v==f,w=!1,P=e.prototype,O=P[c]||P["@@iterator"]||v&&P[v],C=O||_(v),L=v?R?_("entries"):C:void 0,I="Array"==t&&P.entries||O;if(I&&(b=d(I.call(new e)))!==Object.prototype&&b.next&&(u(b,A,!0),r||"function"==typeof b[c]||s(b,c,m)),R&&O&&O.name!==f&&(w=!0,C=function(){return O.call(this)}),r&&!y||!h&&!w&&P[c]||s(P,c,C),o[t]=C,o[A]=m,v)if(T={values:R?C:_(f),keys:S?C:_(p),entries:L},y)for(E in T)E in P||a(P,E,T[E]);else n(n.P+n.F*(h||w),t,T);return T}},2616:e=>{e.exports=function(e,t){return{value:t,done:!!e}}},8504:e=>{e.exports={}},8240:e=>{e.exports=!1},7037:(e,t,i)=>{var r=i(9918),n=i(5640),a=i(6526),s=i(3740)("IE_PROTO"),o=function(){},l="prototype",u=function(){var e,t=i(272)("iframe"),r=a.length;for(t.style.display="none",i(302).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),u=e.F;r--;)delete u[l][a[r]];return u()};e.exports=Object.create||function(e,t){var i;return null!==e?(o[l]=r(e),i=new o,o[l]=null,i[s]=e):i=u(),void 0===t?i:n(i,t)}},8557:(e,t,i)=>{var r=i(9918),n=i(3426),a=i(4974),s=Object.defineProperty;t.f=i(5209)?Object.defineProperty:function(e,t,i){if(r(e),t=a(t,!0),r(i),n)try{return s(e,t,i)}catch(e){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(e[t]=i.value),e}},5640:(e,t,i)=>{var r=i(8557),n=i(9918),a=i(1445);e.exports=i(5209)?Object.defineProperties:function(e,t){n(e);for(var i,s=a(t),o=s.length,l=0;o>l;)r.f(e,i=s[l++],t[i]);return e}},6941:(e,t,i)=>{var r=i(9871),n=i(5912),a=i(3740)("IE_PROTO"),s=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=n(e),r(e,a)?e[a]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?s:null}},3599:(e,t,i)=>{var r=i(9871),n=i(7971),a=i(4070)(!1),s=i(3740)("IE_PROTO");e.exports=function(e,t){var i,o=n(e),l=0,u=[];for(i in o)i!=s&&r(o,i)&&u.push(i);for(;t.length>l;)r(o,i=t[l++])&&(~a(u,i)||u.push(i));return u}},1445:(e,t,i)=>{var r=i(3599),n=i(6526);e.exports=Object.keys||function(e){return r(e,n)}},5974:e=>{e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},7321:(e,t,i)=>{var r=i(4868),n=i(2559),a=i(9871),s=i(2461)("src"),o="toString",l=Function[o],u=(""+l).split(o);i(9340).inspectSource=function(e){return l.call(e)},(e.exports=function(e,t,i,o){var l="function"==typeof i;l&&(a(i,"name")||n(i,"name",t)),e[t]!==i&&(l&&(a(i,s)||n(i,s,e[t]?""+e[t]:u.join(String(t)))),e===r?e[t]=i:o?e[t]?e[t]=i:n(e,t,i):(delete e[t],n(e,t,i)))})(Function.prototype,o,(function(){return"function"==typeof this&&this[s]||l.call(this)}))},1990:(e,t,i)=>{var r=i(8557).f,n=i(9871),a=i(5104)("toStringTag");e.exports=function(e,t,i){e&&!n(e=i?e:e.prototype,a)&&r(e,a,{configurable:!0,value:t})}},3740:(e,t,i)=>{var r=i(2990)("keys"),n=i(2461);e.exports=function(e){return r[e]||(r[e]=n(e))}},2990:(e,t,i)=>{var r=i(9340),n=i(4868),a="__core-js_shared__",s=n[a]||(n[a]={});(e.exports=function(e,t){return s[e]||(s[e]=void 0!==t?t:{})})("versions",[]).push({version:r.version,mode:i(8240)?"pure":"global",copyright:"© 2018 Denis Pushkarev (zloirock.ru)"})},2287:(e,t,i)=>{var r=i(1441),n=Math.max,a=Math.min;e.exports=function(e,t){return(e=r(e))<0?n(e+t,0):a(e,t)}},1441:e=>{var t=Math.ceil,i=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?i:t)(e)}},7971:(e,t,i)=>{var r=i(9279),n=i(1462);e.exports=function(e){return r(n(e))}},2807:(e,t,i)=>{var r=i(1441),n=Math.min;e.exports=function(e){return e>0?n(r(e),9007199254740991):0}},5912:(e,t,i)=>{var r=i(1462);e.exports=function(e){return Object(r(e))}},4974:(e,t,i)=>{var r=i(3163);e.exports=function(e,t){if(!r(e))return e;var i,n;if(t&&"function"==typeof(i=e.toString)&&!r(n=i.call(e)))return n;if("function"==typeof(i=e.valueOf)&&!r(n=i.call(e)))return n;if(!t&&"function"==typeof(i=e.toString)&&!r(n=i.call(e)))return n;throw TypeError("Can't convert object to primitive value")}},2461:e=>{var t=0,i=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++t+i).toString(36))}},5104:(e,t,i)=>{var r=i(2990)("wks"),n=i(2461),a=i(4868).Symbol,s="function"==typeof a;(e.exports=function(e){return r[e]||(r[e]=s&&a[e]||(s?a:n)("Symbol."+e))}).store=r},1115:(e,t,i)=>{"use strict";var r=i(6894),n=i(2616),a=i(8504),s=i(7971);e.exports=i(6849)(Array,"Array",(function(e,t){this._t=s(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,i=this._i++;return!e||i>=e.length?(this._t=void 0,n(1)):n(0,"keys"==t?i:"values"==t?e[i]:[i,e[i]])}),"values"),a.Arguments=a.Array,r("keys"),r("values"),r("entries")},3232:(e,t,i)=>{"use strict";var r=i(8802),n={};n[i(5104)("toStringTag")]="z",n+""!="[object z]"&&i(7321)(Object.prototype,"toString",(function(){return"[object "+r(this)+"]"}),!0)},2917:(e,t,i)=>{"use strict";var r=i(9209),n=i(4070)(!0);r(r.P,"Array",{includes:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}}),i(6894)("includes")},8030:e=>{e.exports=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){return e.__proto__=t,e}:function(e,t){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i]);return e})}},r={};function n(e){var t=r[e];if(void 0!==t)return t.exports;var a=r[e]={exports:{}};return i[e].call(a.exports,a,a.exports,n),a.exports}n.m=i,n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,i)=>(n.f[i](e,t),t)),[])),n.u=e=>"one-"+e+".modern.bundle.js",n.miniCssF=e=>{},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="manq61gm_gmrrsiiy1go:",n.l=(i,r,a,s)=>{if(e[i])e[i].push(r);else{var o,l;if(void 0!==a)for(var u=document.getElementsByTagName("script"),d=0;d<u.length;d++){var c=u[d];if(c.getAttribute("src")==i||c.getAttribute("data-webpack")==t+a){o=c;break}}o||(l=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,n.nc&&o.setAttribute("nonce",n.nc),o.setAttribute("data-webpack",t+a),o.src=i),e[i]=[r];var h=(t,r)=>{o.onerror=o.onload=null,clearTimeout(p);var n=e[i];if(delete e[i],o.parentNode&&o.parentNode.removeChild(o),n&&n.forEach((e=>e(r))),t)return t(r)},p=setTimeout(h.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=h.bind(null,o.onerror),o.onload=h.bind(null,o.onload),l&&document.head.appendChild(o)}},n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="",(()=>{var e={101:0};n.f.j=(t,i)=>{var r=n.o(e,t)?e[t]:void 0;if(0!==r)if(r)i.push(r[2]);else{var a=new Promise(((i,n)=>r=e[t]=[i,n]));i.push(r[2]=a);var s=n.p+n.u(t),o=new Error;n.l(s,(i=>{if(n.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var a=i&&("load"===i.type?"missing":i.type),s=i&&i.target&&i.target.src;o.message="Loading chunk "+t+" failed.\n("+a+": "+s+")",o.name="ChunkLoadError",o.type=a,o.request=s,r[1](o)}}),"chunk-"+t,t)}};var t=(t,i)=>{var r,a,[s,o,l]=i,u=0;if(s.some((t=>0!==e[t]))){for(r in o)n.o(o,r)&&(n.m[r]=o[r]);if(l)l(n)}for(t&&t(i);u<s.length;u++)a=s[u],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0},i=self.webpackChunkmanq61gm_gmrrsiiy1go=self.webpackChunkmanq61gm_gmrrsiiy1go||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var a={};(()=>{"use strict";n.r(a),n.d(a,{OneVideoPlayer:()=>uV});var e;n(3232),n(1115);let t,i,r,s;!function(e){e.Ready="Ready",e.SkinReady="SkinReady",e.Destroy="Destroy",e.ContentImpression="ContentImpression",e.ResourcesIdle="ResourcesIdle",e.SourceChange="SourceChange",e.StreamChange="StreamChange",e.StreamsWithSupportInfoChange="StreamsWithSupportInfoChange",e.StartStageChange="StartStageChange",e.PlayingStateChange="PlayingStateChange",e.VideoTypeChange="VideoTypeChange",e.UtcStartTimeChange="UtcStartTimeChange",e.DVRStartTimeChange="DVRStartTimeChange",e.DVRDurationChange="DVRDurationChange",e.CurrentTimeChange="CurrentTimeChange",e.WatchedTimeChange="WatchedTimeChange",e.DurationChange="DurationChange",e.VolumeChange="VolumeChange",e.MutedChange="MutedChange",e.VolumeChangeReasonChange="VolumeChangeReasonChange",e.FullscreenStateChange="FullscreenStateChange",e.PictureInPictureStateChange="PictureInPictureStateChange",e.VisibleStateChange="VisibleStateChange",e.VideoSizeChange="VideoSizeChange",e.VideoReadyStateChange="VideoReadyStateChange",e.VideoTracksChange="VideoTracksChange",e.VideoTrackChange="VideoTrackChange",e.AudioTracksChange="AudioTracksChange",e.AudioTrackChange="AudioTrackChange",e.TextTracksChange="TextTracksChange",e.TextTrackChange="TextTrackChange",e.SubtitlesChange="SubtitlesChange",e.ErrorChange="ErrorChange",e.PlaybackRateRangeChange="PlaybackRateRangeChange",e.PlaybackRateChange="PlaybackRateChange",e.AdStateChange="AdStateChange",e.NextAdRemainingTimeChange="NextAdRemainingTimeChange",e.AdPodStart="AdPodStart",e.AdSkippableStateChange="AdSkippableStateChange",e.AdVolumeAvailabilityStateChange="AdVolumeAvailabilityStateChange",e.AdPodCloseStateChange="AdPodCloseStateChange",e.AdPodDurationChange="AdPodDurationChange",e.AdPodCurrentTimeChange="AdPodCurrentTimeChange",e.AdPodTimeToSkipChange="AdPodTimeToSkipChange",e.AdInteraction="AdInteraction",e.BufferedRangesChange="BufferedRangesChange",e.TileMetaInfoChange="TileMetaInfoChange",e.TileMetaInfoUrlChange="TileMetaInfoUrlChange",e.VideoClickerEvent="VideoClickerEvent",e.NetworkScoreChange="NetworkScoreChange",e.NetworkStatusChange="NetworkStatusChange",e.RecoverStart="RecoverStart"}(e||(e={})),function(e){e[e.Unstarted=-1]="Unstarted",e[e.Ended=0]="Ended",e[e.Playing=1]="Playing",e[e.Paused=2]="Paused",e[e.Buffering=3]="Buffering",e[e.Error=4]="Error"}(t||(t={})),function(e){e[e.Unstarted=-1]="Unstarted",e[e.Autoplay=0]="Autoplay",e[e.Autopause=1]="Autopause"}(i||(i={})),function(e){e.NOT_INITED="NOT_INITED",e.INITIALIZING="INITIALIZING",e.SETTINGSOURCE="SETTINGSOURCE",e.TIMEOUT="TIMEOUT",e.INITED="INITED",e.DESTROYED="DESTROYED",e.ERROR="ERROR"}(r||(r={})),function(e){e.Long="long",e.Discrete="discrete"}(s||(s={}));const o=e=>Object.keys(e),l=[.25,.5,.75,1,1.25,1.5,1.75,2],u=(e=>{let t,i;return function(){for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return t&&((e,t)=>{if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0})(t,n)||(i=e(...n),t=n),i}})(((e,t)=>l.filter((i=>e<=i&&i<=t))));class d{constructor(){var e=this;this.handlersList=[],this.on=e=>{e&&this.handlersList.push(e)},this.off=e=>{e&&(this.handlersList=this.handlersList.filter((t=>t!==e)))},this.emit=function(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];e.handlersList.forEach((e=>e(...i)))},this.offAll=()=>{this.handlersList=[]}}}class c{constructor(){this.onAdStateChange=new d,this.onAdResponseReceive=new d,this.onDurationChange=new d,this.onCurrentTimeChange=new d,this.onCurrentAccuracyWatchedTimeChange=new d,this.onError=new d,this.onStateChange=new d,this.onContentImpression=new d,this.onUserPlay=new d,this.onUserPause=new d,this.onSourceUpdate=new d,this.onVolumeChange=new d,this.onMuteChange=new d,this.onMuteChangeByUser=new d,this.onMuteChangeInAd=new d,this.onFullScreenChange=new d,this.onReady=new d,this.onHeartbeat=new d,this.onAutoplayFail=new d,this.onOnlineViewerCountChange=new d,this.onVideoTrackChange=new d,this.onVideoTracksChange=new d,this.onTextTrackChange=new d,this.onTextTracksChange=new d,this.onPlaybackRateChange=new d,this.onPlaybackRatesChange=new d,this.onNextAdRemainingTimeChange=new d,this.onResourcesIdle=new d,this.onErrorScreenRequested=new d,this.onErrorScreenHide=new d,this.onDestroy=new d,this.onSyncStates=new d,this.onAdPodStart=new d,this.onBeforeAdPodStart=new d,this.onAdPodTimeToSkipChange=new d,this.onAdPodDurationChange=new d,this.onAdPodCurrentTimeChange=new d,this.onTileMetaInfoUrlChange=new d,this.onSubtitlesChange=new d,this.onBeforeAdStart=new d,this.onAdEnd=new d,this.onLogEvent=new d}}var h="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof global?global:{},p="1.9.0",f=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;var m=function(e){var t=new Set([e]),i=new Set,r=e.match(f);if(!r)return function(){return!1};var n=+r[1],a=+r[2],s=+r[3];if(null!=r[4])return function(t){return t===e};function o(e){return i.add(e),!1}function l(e){return t.add(e),!0}return function(e){if(t.has(e))return!0;if(i.has(e))return!1;var r=e.match(f);if(!r)return o(e);var u=+r[1],d=+r[2],c=+r[3];return null!=r[4]||n!==u?o(e):0===n?a===d&&s<=c?l(e):o(e):a<=d?l(e):o(e)}}(p),g=p.split(".")[0],v=Symbol.for("opentelemetry.js.api."+g),S=h;function y(e,t,i,r){var n;void 0===r&&(r=!1);var a=S[v]=null!==(n=S[v])&&void 0!==n?n:{version:p};if(!r&&a[e]){var s=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return i.error(s.stack||s.message),!1}if(a.version!==p){s=new Error("@opentelemetry/api: Registration of version v"+a.version+" for "+e+" does not match previously registered API v"+p);return i.error(s.stack||s.message),!1}return a[e]=t,i.debug("@opentelemetry/api: Registered a global for "+e+" v"+p+"."),!0}function T(e){var t,i,r=null===(t=S[v])||void 0===t?void 0:t.version;if(r&&m(r))return null===(i=S[v])||void 0===i?void 0:i[e]}function E(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+p+".");var i=S[v];i&&delete i[e]}var b,_=function e(t){var i=this;i._currentContext=t?new Map(t):new Map,i.getValue=function(e){return i._currentContext.get(e)},i.setValue=function(t,r){var n=new e(i._currentContext);return n._currentContext.set(t,r),n},i.deleteValue=function(t){var r=new e(i._currentContext);return r._currentContext.delete(t),r}},A=new _,R=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,n,a=i.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)s.push(r.value)}catch(e){n={error:e}}finally{try{r&&!r.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return s},w=function(e,t,i){if(i||2===arguments.length)for(var r,n=0,a=t.length;n<a;n++)!r&&n in t||(r||(r=Array.prototype.slice.call(t,0,n)),r[n]=t[n]);return e.concat(r||Array.prototype.slice.call(t))},P=function(){function e(){}return e.prototype.active=function(){return A},e.prototype.with=function(e,t,i){for(var r=[],n=3;n<arguments.length;n++)r[n-3]=arguments[n];return t.call.apply(t,w([i],R(r),!1))},e.prototype.bind=function(e,t){return t},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}(),O=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,n,a=i.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)s.push(r.value)}catch(e){n={error:e}}finally{try{r&&!r.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return s},C=function(e,t,i){if(i||2===arguments.length)for(var r,n=0,a=t.length;n<a;n++)!r&&n in t||(r||(r=Array.prototype.slice.call(t,0,n)),r[n]=t[n]);return e.concat(r||Array.prototype.slice.call(t))},L=function(){function e(e){this._namespace=e.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return I("debug",this._namespace,e)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return I("error",this._namespace,e)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return I("info",this._namespace,e)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return I("warn",this._namespace,e)},e.prototype.verbose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return I("verbose",this._namespace,e)},e}();function I(e,t,i){var r=T("diag");if(r)return i.unshift(t),r[e].apply(r,C([],O(i),!1))}!function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"}(b||(b={}));var x,M=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,n,a=i.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)s.push(r.value)}catch(e){n={error:e}}finally{try{r&&!r.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return s},N=function(e,t,i){if(i||2===arguments.length)for(var r,n=0,a=t.length;n<a;n++)!r&&n in t||(r||(r=Array.prototype.slice.call(t,0,n)),r[n]=t[n]);return e.concat(r||Array.prototype.slice.call(t))},D=function(){function e(){function e(e){return function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var r=T("diag");if(r)return r[e].apply(r,N([],M(t),!1))}}var t=this;t.setLogger=function(e,i){var r,n,a;if(void 0===i&&(i={logLevel:b.INFO}),e===t){var s=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return t.error(null!==(r=s.stack)&&void 0!==r?r:s.message),!1}"number"==typeof i&&(i={logLevel:i});var o=T("diag"),l=function(e,t){function i(i,r){var n=t[i];return"function"==typeof n&&e>=r?n.bind(t):function(){}}return e<b.NONE?e=b.NONE:e>b.ALL&&(e=b.ALL),t=t||{},{error:i("error",b.ERROR),warn:i("warn",b.WARN),info:i("info",b.INFO),debug:i("debug",b.DEBUG),verbose:i("verbose",b.VERBOSE)}}(null!==(n=i.logLevel)&&void 0!==n?n:b.INFO,e);if(o&&!i.suppressOverrideMessage){var u=null!==(a=(new Error).stack)&&void 0!==a?a:"<failed to generate stacktrace>";o.warn("Current logger will be overwritten from "+u),l.warn("Current logger will overwrite one already registered from "+u)}return y("diag",l,t,!0)},t.disable=function(){E("diag",t)},t.createComponentLogger=function(e){return new L(e)},t.verbose=e("verbose"),t.debug=e("debug"),t.info=e("info"),t.warn=e("warn"),t.error=e("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}(),k=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,n,a=i.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)s.push(r.value)}catch(e){n={error:e}}finally{try{r&&!r.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return s},$=function(e,t,i){if(i||2===arguments.length)for(var r,n=0,a=t.length;n<a;n++)!r&&n in t||(r||(r=Array.prototype.slice.call(t,0,n)),r[n]=t[n]);return e.concat(r||Array.prototype.slice.call(t))},V="context",U=new P,B=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(e){return y(V,e,D.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(e,t,i){for(var r,n=[],a=3;a<arguments.length;a++)n[a-3]=arguments[a];return(r=this._getContextManager()).with.apply(r,$([e,t,i],k(n),!1))},e.prototype.bind=function(e,t){return this._getContextManager().bind(e,t)},e.prototype._getContextManager=function(){return T(V)||U},e.prototype.disable=function(){this._getContextManager().disable(),E(V,D.instance())},e}();!function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"}(x||(x={}));var F,H="0000000000000000",j="00000000000000000000000000000000",G={traceId:j,spanId:H,traceFlags:x.NONE},q=function(){function e(e){void 0===e&&(e=G),this._spanContext=e}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(e,t){return this},e.prototype.setAttributes=function(e){return this},e.prototype.addEvent=function(e,t){return this},e.prototype.addLink=function(e){return this},e.prototype.addLinks=function(e){return this},e.prototype.setStatus=function(e){return this},e.prototype.updateName=function(e){return this},e.prototype.end=function(e){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(e,t){},e}(),z=(F="OpenTelemetry Context Key SPAN",Symbol.for(F));function W(e){return e.getValue(z)||void 0}function Q(){return W(B.getInstance().active())}function Y(e,t){return e.setValue(z,t)}function K(e){return e.deleteValue(z)}function X(e,t){return Y(e,new q(t))}function J(e){var t;return null===(t=W(e))||void 0===t?void 0:t.spanContext()}var Z=/^([0-9a-f]{32})$/i,ee=/^[0-9a-f]{16}$/i;function te(e){return i=e.traceId,Z.test(i)&&i!==j&&(t=e.spanId,ee.test(t)&&t!==H);var t,i}function ie(e){return new q(e)}var re=B.getInstance(),ne=function(){function e(){}return e.prototype.startSpan=function(e,t,i){if(void 0===i&&(i=re.active()),Boolean(null==t?void 0:t.root))return new q;var r,n=i&&J(i);return"object"==typeof(r=n)&&"string"==typeof r.spanId&&"string"==typeof r.traceId&&"number"==typeof r.traceFlags&&te(n)?new q(n):new q},e.prototype.startActiveSpan=function(e,t,i,r){var n,a,s;if(!(arguments.length<2)){2===arguments.length?s=t:3===arguments.length?(n=t,s=i):(n=t,a=i,s=r);var o=null!=a?a:re.active(),l=this.startSpan(e,n,o),u=Y(o,l);return re.with(u,s,void 0,l)}},e}();var ae=new ne,se=function(){function e(e,t,i,r){this._provider=e,this.name=t,this.version=i,this.options=r}return e.prototype.startSpan=function(e,t,i){return this._getTracer().startSpan(e,t,i)},e.prototype.startActiveSpan=function(e,t,i,r){var n=this._getTracer();return Reflect.apply(n.startActiveSpan,n,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):ae},e}(),oe=new(function(){function e(){}return e.prototype.getTracer=function(e,t,i){return new ne},e}()),le=function(){function e(){}return e.prototype.getTracer=function(e,t,i){var r;return null!==(r=this.getDelegateTracer(e,t,i))&&void 0!==r?r:new se(this,e,t,i)},e.prototype.getDelegate=function(){var e;return null!==(e=this._delegate)&&void 0!==e?e:oe},e.prototype.setDelegate=function(e){this._delegate=e},e.prototype.getDelegateTracer=function(e,t,i){var r;return null===(r=this._delegate)||void 0===r?void 0:r.getTracer(e,t,i)},e}(),ue="trace",de=function(){function e(){this._proxyTracerProvider=new le,this.wrapSpanContext=ie,this.isSpanContextValid=te,this.deleteSpan=K,this.getSpan=W,this.getActiveSpan=Q,this.getSpanContext=J,this.setSpan=Y,this.setSpanContext=X}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(e){var t=y(ue,this._proxyTracerProvider,D.instance());return t&&this._proxyTracerProvider.setDelegate(e),t},e.prototype.getTracerProvider=function(){return T(ue)||this._proxyTracerProvider},e.prototype.getTracer=function(e,t){return this.getTracerProvider().getTracer(e,t)},e.prototype.disable=function(){E(ue,D.instance()),this._proxyTracerProvider=new le},e}(),ce=de.getInstance(),he=B.getInstance(),pe="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof global?global:{},fe="1.9.0",me=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;var ge=function(e){var t=new Set([e]),i=new Set,r=e.match(me);if(!r)return function(){return!1};var n=+r[1],a=+r[2],s=+r[3];if(null!=r[4])return function(t){return t===e};function o(e){return i.add(e),!1}function l(e){return t.add(e),!0}return function(e){if(t.has(e))return!0;if(i.has(e))return!1;var r=e.match(me);if(!r)return o(e);var u=+r[1],d=+r[2],c=+r[3];return null!=r[4]||n!==u?o(e):0===n?a===d&&s<=c?l(e):o(e):a<=d?l(e):o(e)}}(fe),ve=fe.split(".")[0],Se=Symbol.for("opentelemetry.js.api."+ve),ye=pe;function Te(e,t,i,r){var n;void 0===r&&(r=!1);var a=ye[Se]=null!==(n=ye[Se])&&void 0!==n?n:{version:fe};if(!r&&a[e]){var s=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return i.error(s.stack||s.message),!1}if(a.version!==fe){s=new Error("@opentelemetry/api: Registration of version v"+a.version+" for "+e+" does not match previously registered API v"+fe);return i.error(s.stack||s.message),!1}return a[e]=t,i.debug("@opentelemetry/api: Registered a global for "+e+" v"+fe+"."),!0}function Ee(e){var t,i,r=null===(t=ye[Se])||void 0===t?void 0:t.version;if(r&&ge(r))return null===(i=ye[Se])||void 0===i?void 0:i[e]}function be(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+fe+".");var i=ye[Se];i&&delete i[e]}var _e,Ae=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,n,a=i.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)s.push(r.value)}catch(e){n={error:e}}finally{try{r&&!r.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return s},Re=function(e,t,i){if(i||2===arguments.length)for(var r,n=0,a=t.length;n<a;n++)!r&&n in t||(r||(r=Array.prototype.slice.call(t,0,n)),r[n]=t[n]);return e.concat(r||Array.prototype.slice.call(t))},we=function(){function e(e){this._namespace=e.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Pe("debug",this._namespace,e)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Pe("error",this._namespace,e)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Pe("info",this._namespace,e)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Pe("warn",this._namespace,e)},e.prototype.verbose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Pe("verbose",this._namespace,e)},e}();function Pe(e,t,i){var r=Ee("diag");if(r)return i.unshift(t),r[e].apply(r,Re([],Ae(i),!1))}!function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"}(_e||(_e={}));var Oe=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,n,a=i.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)s.push(r.value)}catch(e){n={error:e}}finally{try{r&&!r.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return s},Ce=function(e,t,i){if(i||2===arguments.length)for(var r,n=0,a=t.length;n<a;n++)!r&&n in t||(r||(r=Array.prototype.slice.call(t,0,n)),r[n]=t[n]);return e.concat(r||Array.prototype.slice.call(t))},Le=function(){function e(){function e(e){return function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var r=Ee("diag");if(r)return r[e].apply(r,Ce([],Oe(t),!1))}}var t=this;t.setLogger=function(e,i){var r,n,a;if(void 0===i&&(i={logLevel:_e.INFO}),e===t){var s=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return t.error(null!==(r=s.stack)&&void 0!==r?r:s.message),!1}"number"==typeof i&&(i={logLevel:i});var o=Ee("diag"),l=function(e,t){function i(i,r){var n=t[i];return"function"==typeof n&&e>=r?n.bind(t):function(){}}return e<_e.NONE?e=_e.NONE:e>_e.ALL&&(e=_e.ALL),t=t||{},{error:i("error",_e.ERROR),warn:i("warn",_e.WARN),info:i("info",_e.INFO),debug:i("debug",_e.DEBUG),verbose:i("verbose",_e.VERBOSE)}}(null!==(n=i.logLevel)&&void 0!==n?n:_e.INFO,e);if(o&&!i.suppressOverrideMessage){var u=null!==(a=(new Error).stack)&&void 0!==a?a:"<failed to generate stacktrace>";o.warn("Current logger will be overwritten from "+u),l.warn("Current logger will overwrite one already registered from "+u)}return Te("diag",l,t,!0)},t.disable=function(){be("diag",t)},t.createComponentLogger=function(e){return new we(e)},t.verbose=e("verbose"),t.debug=e("debug"),t.info=e("info"),t.warn=e("warn"),t.error=e("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}(),Ie=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,n,a=i.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)s.push(r.value)}catch(e){n={error:e}}finally{try{r&&!r.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return s},xe=function(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Me=function(){function e(e){this._entries=e?new Map(e):new Map}return e.prototype.getEntry=function(e){var t=this._entries.get(e);if(t)return Object.assign({},t)},e.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map((function(e){var t=Ie(e,2);return[t[0],t[1]]}))},e.prototype.setEntry=function(t,i){var r=new e(this._entries);return r._entries.set(t,i),r},e.prototype.removeEntry=function(t){var i=new e(this._entries);return i._entries.delete(t),i},e.prototype.removeEntries=function(){for(var t,i,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var a=new e(this._entries);try{for(var s=xe(r),o=s.next();!o.done;o=s.next()){var l=o.value;a._entries.delete(l)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(t)throw t.error}}return a},e.prototype.clear=function(){return new e},e}(),Ne=Symbol("BaggageEntryMetadata"),De=Le.instance();function ke(e){return void 0===e&&(e={}),new Me(new Map(Object.entries(e)))}function $e(e){return"string"!=typeof e&&(De.error("Cannot create baggage metadata from unknown type: "+typeof e),e=""),{__TYPE__:Ne,toString:function(){return e}}}function Ve(e){return Symbol.for(e)}var Ue,Be,Fe=function e(t){var i=this;i._currentContext=t?new Map(t):new Map,i.getValue=function(e){return i._currentContext.get(e)},i.setValue=function(t,r){var n=new e(i._currentContext);return n._currentContext.set(t,r),n},i.deleteValue=function(t){var r=new e(i._currentContext);return r._currentContext.delete(t),r}},He=new Fe,je=[{n:"error",c:"error"},{n:"warn",c:"warn"},{n:"info",c:"info"},{n:"debug",c:"debug"},{n:"verbose",c:"trace"}],Ge=function(){function e(e){return function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];if(console){var r=console[e];if("function"!=typeof r&&(r=console.log),"function"==typeof r)return r.apply(console,t)}}}for(var t=0;t<je.length;t++)this[je[t].n]=e(je[t].c)},qe=(Ue=function(e,t){return Ue=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},Ue(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}Ue(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),ze=function(){function e(){}return e.prototype.createGauge=function(e,t){return nt},e.prototype.createHistogram=function(e,t){return at},e.prototype.createCounter=function(e,t){return rt},e.prototype.createUpDownCounter=function(e,t){return st},e.prototype.createObservableGauge=function(e,t){return lt},e.prototype.createObservableCounter=function(e,t){return ot},e.prototype.createObservableUpDownCounter=function(e,t){return ut},e.prototype.addBatchObservableCallback=function(e,t){},e.prototype.removeBatchObservableCallback=function(e){},e}(),We=function(){},Qe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return qe(t,e),t.prototype.add=function(e,t){},t}(We),Ye=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return qe(t,e),t.prototype.add=function(e,t){},t}(We),Ke=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return qe(t,e),t.prototype.record=function(e,t){},t}(We),Xe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return qe(t,e),t.prototype.record=function(e,t){},t}(We),Je=function(){function e(){}return e.prototype.addCallback=function(e){},e.prototype.removeCallback=function(e){},e}(),Ze=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return qe(t,e),t}(Je),et=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return qe(t,e),t}(Je),tt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return qe(t,e),t}(Je),it=new ze,rt=new Qe,nt=new Ke,at=new Xe,st=new Ye,ot=new Ze,lt=new et,ut=new tt;!function(e){e[e.INT=0]="INT",e[e.DOUBLE=1]="DOUBLE"}(Be||(Be={}));var dt,ct={get:function(e,t){if(null!=e)return e[t]},keys:function(e){return null==e?[]:Object.keys(e)}},ht={set:function(e,t,i){null!=e&&(e[t]=i)}},pt=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,n,a=i.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)s.push(r.value)}catch(e){n={error:e}}finally{try{r&&!r.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return s},ft=function(e,t,i){if(i||2===arguments.length)for(var r,n=0,a=t.length;n<a;n++)!r&&n in t||(r||(r=Array.prototype.slice.call(t,0,n)),r[n]=t[n]);return e.concat(r||Array.prototype.slice.call(t))},mt=function(){function e(){}return e.prototype.active=function(){return He},e.prototype.with=function(e,t,i){for(var r=[],n=3;n<arguments.length;n++)r[n-3]=arguments[n];return t.call.apply(t,ft([i],pt(r),!1))},e.prototype.bind=function(e,t){return t},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}(),gt=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,n,a=i.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)s.push(r.value)}catch(e){n={error:e}}finally{try{r&&!r.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return s},vt=function(e,t,i){if(i||2===arguments.length)for(var r,n=0,a=t.length;n<a;n++)!r&&n in t||(r||(r=Array.prototype.slice.call(t,0,n)),r[n]=t[n]);return e.concat(r||Array.prototype.slice.call(t))},St="context",yt=new mt,Tt=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(e){return Te(St,e,Le.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(e,t,i){for(var r,n=[],a=3;a<arguments.length;a++)n[a-3]=arguments[a];return(r=this._getContextManager()).with.apply(r,vt([e,t,i],gt(n),!1))},e.prototype.bind=function(e,t){return this._getContextManager().bind(e,t)},e.prototype._getContextManager=function(){return Ee(St)||yt},e.prototype.disable=function(){this._getContextManager().disable(),be(St,Le.instance())},e}();!function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"}(dt||(dt={}));var Et="0000000000000000",bt="00000000000000000000000000000000",_t={traceId:bt,spanId:Et,traceFlags:dt.NONE},At=function(){function e(e){void 0===e&&(e=_t),this._spanContext=e}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(e,t){return this},e.prototype.setAttributes=function(e){return this},e.prototype.addEvent=function(e,t){return this},e.prototype.addLink=function(e){return this},e.prototype.addLinks=function(e){return this},e.prototype.setStatus=function(e){return this},e.prototype.updateName=function(e){return this},e.prototype.end=function(e){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(e,t){},e}(),Rt=Ve("OpenTelemetry Context Key SPAN");function wt(e){return e.getValue(Rt)||void 0}function Pt(){return wt(Tt.getInstance().active())}function Ot(e,t){return e.setValue(Rt,t)}function Ct(e){return e.deleteValue(Rt)}function Lt(e,t){return Ot(e,new At(t))}function It(e){var t;return null===(t=wt(e))||void 0===t?void 0:t.spanContext()}var xt=/^([0-9a-f]{32})$/i,Mt=/^[0-9a-f]{16}$/i;function Nt(e){return xt.test(e)&&e!==bt}function Dt(e){return Mt.test(e)&&e!==Et}function kt(e){return Nt(e.traceId)&&Dt(e.spanId)}function $t(e){return new At(e)}var Vt=Tt.getInstance(),Ut=function(){function e(){}return e.prototype.startSpan=function(e,t,i){if(void 0===i&&(i=Vt.active()),Boolean(null==t?void 0:t.root))return new At;var r,n=i&&It(i);return"object"==typeof(r=n)&&"string"==typeof r.spanId&&"string"==typeof r.traceId&&"number"==typeof r.traceFlags&&kt(n)?new At(n):new At},e.prototype.startActiveSpan=function(e,t,i,r){var n,a,s;if(!(arguments.length<2)){2===arguments.length?s=t:3===arguments.length?(n=t,s=i):(n=t,a=i,s=r);var o=null!=a?a:Vt.active(),l=this.startSpan(e,n,o),u=Ot(o,l);return Vt.with(u,s,void 0,l)}},e}();var Bt,Ft,Ht,jt=new Ut,Gt=function(){function e(e,t,i,r){this._provider=e,this.name=t,this.version=i,this.options=r}return e.prototype.startSpan=function(e,t,i){return this._getTracer().startSpan(e,t,i)},e.prototype.startActiveSpan=function(e,t,i,r){var n=this._getTracer();return Reflect.apply(n.startActiveSpan,n,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):jt},e}(),qt=function(){function e(){}return e.prototype.getTracer=function(e,t,i){return new Ut},e}(),zt=new qt,Wt=function(){function e(){}return e.prototype.getTracer=function(e,t,i){var r;return null!==(r=this.getDelegateTracer(e,t,i))&&void 0!==r?r:new Gt(this,e,t,i)},e.prototype.getDelegate=function(){var e;return null!==(e=this._delegate)&&void 0!==e?e:zt},e.prototype.setDelegate=function(e){this._delegate=e},e.prototype.getDelegateTracer=function(e,t,i){var r;return null===(r=this._delegate)||void 0===r?void 0:r.getTracer(e,t,i)},e}();!function(e){e[e.NOT_RECORD=0]="NOT_RECORD",e[e.RECORD=1]="RECORD",e[e.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(Bt||(Bt={})),function(e){e[e.INTERNAL=0]="INTERNAL",e[e.SERVER=1]="SERVER",e[e.CLIENT=2]="CLIENT",e[e.PRODUCER=3]="PRODUCER",e[e.CONSUMER=4]="CONSUMER"}(Ft||(Ft={})),function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"}(Ht||(Ht={}));var Qt="[_0-9a-z-*/]",Yt=new RegExp("^(?:"+("[a-z]"+Qt+"{0,255}")+"|"+("[a-z0-9]"+Qt+"{0,240}@[a-z]"+Qt+"{0,13}")+")$"),Kt=/^[ -~]{0,255}[!-~]$/,Xt=/,|=/;var Jt=function(){function e(e){this._internalState=new Map,e&&this._parse(e)}return e.prototype.set=function(e,t){var i=this._clone();return i._internalState.has(e)&&i._internalState.delete(e),i._internalState.set(e,t),i},e.prototype.unset=function(e){var t=this._clone();return t._internalState.delete(e),t},e.prototype.get=function(e){return this._internalState.get(e)},e.prototype.serialize=function(){var e=this;return this._keys().reduce((function(t,i){return t.push(i+"="+e.get(i)),t}),[]).join(",")},e.prototype._parse=function(e){e.length>512||(this._internalState=e.split(",").reverse().reduce((function(e,t){var i=t.trim(),r=i.indexOf("=");if(-1!==r){var n=i.slice(0,r),a=i.slice(r+1,t.length);(function(e){return Yt.test(e)})(n)&&function(e){return Kt.test(e)&&!Xt.test(e)}(a)&&e.set(n,a)}return e}),new Map),this._internalState.size>32&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,32))))},e.prototype._keys=function(){return Array.from(this._internalState.keys()).reverse()},e.prototype._clone=function(){var t=new e;return t._internalState=new Map(this._internalState),t},e}();var Zt=Tt.getInstance(),ei=Le.instance(),ti=new(function(){function e(){}return e.prototype.getMeter=function(e,t,i){return it},e}()),ii="metrics",ri=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalMeterProvider=function(e){return Te(ii,e,Le.instance())},e.prototype.getMeterProvider=function(){return Ee(ii)||ti},e.prototype.getMeter=function(e,t,i){return this.getMeterProvider().getMeter(e,t,i)},e.prototype.disable=function(){be(ii,Le.instance())},e}(),ni=ri.getInstance(),ai=function(){function e(){}return e.prototype.inject=function(e,t){},e.prototype.extract=function(e,t){return e},e.prototype.fields=function(){return[]},e}(),si=Ve("OpenTelemetry Baggage Key");function oi(e){return e.getValue(si)||void 0}function li(){return oi(Tt.getInstance().active())}function ui(e,t){return e.setValue(si,t)}function di(e){return e.deleteValue(si)}var ci="propagation",hi=new ai,pi=function(){function e(){this.createBaggage=ke,this.getBaggage=oi,this.getActiveBaggage=li,this.setBaggage=ui,this.deleteBaggage=di}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalPropagator=function(e){return Te(ci,e,Le.instance())},e.prototype.inject=function(e,t,i){return void 0===i&&(i=ht),this._getGlobalPropagator().inject(e,t,i)},e.prototype.extract=function(e,t,i){return void 0===i&&(i=ct),this._getGlobalPropagator().extract(e,t,i)},e.prototype.fields=function(){return this._getGlobalPropagator().fields()},e.prototype.disable=function(){be(ci,Le.instance())},e.prototype._getGlobalPropagator=function(){return Ee(ci)||hi},e}(),fi=pi.getInstance(),mi="trace",gi=function(){function e(){this._proxyTracerProvider=new Wt,this.wrapSpanContext=$t,this.isSpanContextValid=kt,this.deleteSpan=Ct,this.getSpan=wt,this.getActiveSpan=Pt,this.getSpanContext=It,this.setSpan=Ot,this.setSpanContext=Lt}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(e){var t=Te(mi,this._proxyTracerProvider,Le.instance());return t&&this._proxyTracerProvider.setDelegate(e),t},e.prototype.getTracerProvider=function(){return Ee(mi)||this._proxyTracerProvider},e.prototype.getTracer=function(e,t){return this.getTracerProvider().getTracer(e,t)},e.prototype.disable=function(){be(mi,Le.instance()),this._proxyTracerProvider=new Wt},e}(),vi=gi.getInstance(),Si={context:Zt,diag:ei,metrics:ni,propagation:fi,trace:vi},yi=Object.freeze({__proto__:null,DiagConsoleLogger:Ge,get DiagLogLevel(){return _e},INVALID_SPANID:Et,INVALID_SPAN_CONTEXT:_t,INVALID_TRACEID:bt,ProxyTracer:Gt,ProxyTracerProvider:Wt,ROOT_CONTEXT:He,get SamplingDecision(){return Bt},get SpanKind(){return Ft},get SpanStatusCode(){return Ht},get TraceFlags(){return dt},get ValueType(){return Be},baggageEntryMetadataFromString:$e,context:Zt,createContextKey:Ve,createNoopMeter:function(){return it},createTraceState:function(e){return new Jt(e)},default:Si,defaultTextMapGetter:ct,defaultTextMapSetter:ht,diag:ei,isSpanContextValid:kt,isValidSpanId:Dt,isValidTraceId:Nt,metrics:ni,propagation:fi,trace:vi}),Ti=Ve("OpenTelemetry SDK Context Key SUPPRESS_TRACING");function Ei(e){return e.setValue(Ti,!0)}function bi(e){return!0===e.getValue(Ti)}var _i=",",Ai="baggage",Ri=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,n,a=i.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)s.push(r.value)}catch(e){n={error:e}}finally{try{r&&!r.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return s};function wi(e){return e.reduce((function(e,t){var i=""+e+(""!==e?_i:"")+t;return i.length>8192?e:i}),"")}function Pi(e){return e.getAllEntries().map((function(e){var t=Ri(e,2),i=t[0],r=t[1],n=encodeURIComponent(i)+"="+encodeURIComponent(r.value);return void 0!==r.metadata&&(n+=";"+r.metadata.toString()),n}))}function Oi(e){var t=e.split(";");if(!(t.length<=0)){var i=t.shift();if(i){var r=i.indexOf("=");if(!(r<=0)){var n,a=decodeURIComponent(i.substring(0,r).trim()),s=decodeURIComponent(i.substring(r+1).trim());return t.length>0&&(n=$e(t.join(";"))),{key:a,value:s,metadata:n}}}}}var Ci=function(){function e(){}return e.prototype.inject=function(e,t,i){var r=fi.getBaggage(e);if(r&&!bi(e)){var n=wi(Pi(r).filter((function(e){return e.length<=4096})).slice(0,180));n.length>0&&i.set(t,Ai,n)}},e.prototype.extract=function(e,t,i){var r=i.get(t,Ai),n=Array.isArray(r)?r.join(_i):r;if(!n)return e;var a={};return 0===n.length?e:(n.split(_i).forEach((function(e){var t=Oi(e);if(t){var i={value:t.value};t.metadata&&(i.metadata=t.metadata),a[t.key]=i}})),0===Object.entries(a).length?e:fi.setBaggage(e,fi.createBaggage(a)))},e.prototype.fields=function(){return[Ai]},e}(),Li=function(){function e(e,t){this._monotonicClock=t,this._epochMillis=e.now(),this._performanceMillis=t.now()}return e.prototype.now=function(){var e=this._monotonicClock.now()-this._performanceMillis;return this._epochMillis+e},e}(),Ii=function(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},xi=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,n,a=i.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)s.push(r.value)}catch(e){n={error:e}}finally{try{r&&!r.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return s};function Mi(e){var t,i,r={};if("object"!=typeof e||null==e)return r;try{for(var n=Ii(Object.entries(e)),a=n.next();!a.done;a=n.next()){var s=xi(a.value,2),o=s[0],l=s[1];Ni(o)?Di(l)?Array.isArray(l)?r[o]=l.slice():r[o]=l:ei.warn("Invalid attribute value set for key: "+o):ei.warn("Invalid attribute key: "+o)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(i=n.return)&&i.call(n)}finally{if(t)throw t.error}}return r}function Ni(e){return"string"==typeof e&&e.length>0}function Di(e){return null==e||(Array.isArray(e)?function(e){var t,i,r;try{for(var n=Ii(e),a=n.next();!a.done;a=n.next()){var s=a.value;if(null!=s){if(!r){if(ki(s)){r=typeof s;continue}return!1}if(typeof s!==r)return!1}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(i=n.return)&&i.call(n)}finally{if(t)throw t.error}}return!0}(e):ki(e))}function ki(e){switch(typeof e){case"number":case"boolean":case"string":return!0}return!1}function $i(){return function(e){ei.error(function(e){return"string"==typeof e?e:JSON.stringify(function(e){var t={},i=e;for(;null!==i;)Object.getOwnPropertyNames(i).forEach((function(e){if(!t[e]){var r=i[e];r&&(t[e]=String(r))}})),i=Object.getPrototypeOf(i);return t}(e))}(e))}}var Vi,Ui=$i();function Bi(e){try{Ui(e)}catch(e){}}!function(e){e.AlwaysOff="always_off",e.AlwaysOn="always_on",e.ParentBasedAlwaysOff="parentbased_always_off",e.ParentBasedAlwaysOn="parentbased_always_on",e.ParentBasedTraceIdRatio="parentbased_traceidratio",e.TraceIdRatio="traceidratio"}(Vi||(Vi={}));var Fi=["OTEL_SDK_DISABLED"];function Hi(e){return Fi.indexOf(e)>-1}var ji=["OTEL_BSP_EXPORT_TIMEOUT","OTEL_BSP_MAX_EXPORT_BATCH_SIZE","OTEL_BSP_MAX_QUEUE_SIZE","OTEL_BSP_SCHEDULE_DELAY","OTEL_BLRP_EXPORT_TIMEOUT","OTEL_BLRP_MAX_EXPORT_BATCH_SIZE","OTEL_BLRP_MAX_QUEUE_SIZE","OTEL_BLRP_SCHEDULE_DELAY","OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT","OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_EVENT_COUNT_LIMIT","OTEL_SPAN_LINK_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT","OTEL_EXPORTER_OTLP_TIMEOUT","OTEL_EXPORTER_OTLP_TRACES_TIMEOUT","OTEL_EXPORTER_OTLP_METRICS_TIMEOUT","OTEL_EXPORTER_OTLP_LOGS_TIMEOUT","OTEL_EXPORTER_JAEGER_AGENT_PORT"];function Gi(e){return ji.indexOf(e)>-1}var qi=["OTEL_NO_PATCH_MODULES","OTEL_PROPAGATORS"];function zi(e){return qi.indexOf(e)>-1}var Wi=1/0,Qi=128,Yi={OTEL_SDK_DISABLED:!1,CONTAINER_NAME:"",ECS_CONTAINER_METADATA_URI_V4:"",ECS_CONTAINER_METADATA_URI:"",HOSTNAME:"",KUBERNETES_SERVICE_HOST:"",NAMESPACE:"",OTEL_BSP_EXPORT_TIMEOUT:3e4,OTEL_BSP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BSP_MAX_QUEUE_SIZE:2048,OTEL_BSP_SCHEDULE_DELAY:5e3,OTEL_BLRP_EXPORT_TIMEOUT:3e4,OTEL_BLRP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BLRP_MAX_QUEUE_SIZE:2048,OTEL_BLRP_SCHEDULE_DELAY:5e3,OTEL_EXPORTER_JAEGER_AGENT_HOST:"",OTEL_EXPORTER_JAEGER_AGENT_PORT:6832,OTEL_EXPORTER_JAEGER_ENDPOINT:"",OTEL_EXPORTER_JAEGER_PASSWORD:"",OTEL_EXPORTER_JAEGER_USER:"",OTEL_EXPORTER_OTLP_ENDPOINT:"",OTEL_EXPORTER_OTLP_TRACES_ENDPOINT:"",OTEL_EXPORTER_OTLP_METRICS_ENDPOINT:"",OTEL_EXPORTER_OTLP_LOGS_ENDPOINT:"",OTEL_EXPORTER_OTLP_HEADERS:"",OTEL_EXPORTER_OTLP_TRACES_HEADERS:"",OTEL_EXPORTER_OTLP_METRICS_HEADERS:"",OTEL_EXPORTER_OTLP_LOGS_HEADERS:"",OTEL_EXPORTER_OTLP_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_TRACES_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_METRICS_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_LOGS_TIMEOUT:1e4,OTEL_EXPORTER_ZIPKIN_ENDPOINT:"http://localhost:9411/api/v2/spans",OTEL_LOG_LEVEL:_e.INFO,OTEL_NO_PATCH_MODULES:[],OTEL_PROPAGATORS:["tracecontext","baggage"],OTEL_RESOURCE_ATTRIBUTES:"",OTEL_SERVICE_NAME:"",OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT:Wi,OTEL_ATTRIBUTE_COUNT_LIMIT:Qi,OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT:Wi,OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT:Qi,OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT:Wi,OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT:Qi,OTEL_SPAN_EVENT_COUNT_LIMIT:128,OTEL_SPAN_LINK_COUNT_LIMIT:128,OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT:128,OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT:128,OTEL_TRACES_EXPORTER:"",OTEL_TRACES_SAMPLER:Vi.ParentBasedAlwaysOn,OTEL_TRACES_SAMPLER_ARG:"",OTEL_LOGS_EXPORTER:"",OTEL_EXPORTER_OTLP_INSECURE:"",OTEL_EXPORTER_OTLP_TRACES_INSECURE:"",OTEL_EXPORTER_OTLP_METRICS_INSECURE:"",OTEL_EXPORTER_OTLP_LOGS_INSECURE:"",OTEL_EXPORTER_OTLP_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_LOGS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_COMPRESSION:"",OTEL_EXPORTER_OTLP_TRACES_COMPRESSION:"",OTEL_EXPORTER_OTLP_METRICS_COMPRESSION:"",OTEL_EXPORTER_OTLP_LOGS_COMPRESSION:"",OTEL_EXPORTER_OTLP_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_LOGS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_LOGS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_TRACES_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_LOGS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_TEMPORALITY_PREFERENCE:"cumulative"};function Ki(e,t,i){if(void 0!==i[e]){var r=String(i[e]);t[e]="true"===r.toLowerCase()}}function Xi(e,t,i,r,n){if(void 0===r&&(r=-1/0),void 0===n&&(n=1/0),void 0!==i[e]){var a=Number(i[e]);isNaN(a)||(t[e]=a<r?r:a>n?n:a)}}function Ji(e,t,i,r){void 0===r&&(r=",");var n=i[e];"string"==typeof n&&(t[e]=n.split(r).map((function(e){return e.trim()})))}var Zi={ALL:_e.ALL,VERBOSE:_e.VERBOSE,DEBUG:_e.DEBUG,INFO:_e.INFO,WARN:_e.WARN,ERROR:_e.ERROR,NONE:_e.NONE};function er(e,t,i){var r=i[e];if("string"==typeof r){var n=Zi[r.toUpperCase()];null!=n&&(t[e]=n)}}function tr(e){var t={};for(var i in Yi){var r=i;if("OTEL_LOG_LEVEL"===r)er(r,t,e);else if(Hi(r))Ki(r,t,e);else if(Gi(r))Xi(r,t,e);else if(zi(r))Ji(r,t,e);else{var n=e[r];null!=n&&(t[r]=String(n))}}return t}var ir="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof global?global:{};function rr(){var e=tr(ir);return Object.assign({},Yi,e)}function nr(){return tr(ir)}function ar(e){return e>=48&&e<=57?e-48:e>=97&&e<=102?e-87:e-55}function sr(e){for(var t=new Uint8Array(e.length/2),i=0,r=0;r<e.length;r+=2){var n=ar(e.charCodeAt(r)),a=ar(e.charCodeAt(r+1));t[i++]=n<<4|a}return t}var or=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,n,a=i.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)s.push(r.value)}catch(e){n={error:e}}finally{try{r&&!r.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return s},lr=function(e,t,i){if(i||2===arguments.length)for(var r,n=0,a=t.length;n<a;n++)!r&&n in t||(r||(r=Array.prototype.slice.call(t,0,n)),r[n]=t[n]);return e.concat(r||Array.prototype.slice.call(t))};var ur=function(){this.generateTraceId=cr(16),this.generateSpanId=cr(8)},dr=Array(32);function cr(e){return function(){for(var t=0;t<2*e;t++)dr[t]=Math.floor(16*Math.random())+48,dr[t]>=58&&(dr[t]+=39);return String.fromCharCode.apply(null,dr.slice(0,2*e))}}var hr=performance,pr="1.26.0";function fr(e){for(var t={},i=e.length,r=0;r<i;r++){var n=e[r];n&&(t[String(n).toUpperCase().replace(/[-.]/g,"_")]=n)}return t}var mr,gr="aws.lambda.invoked_arn",vr="db.system",Sr="db.connection_string",yr="db.user",Tr="db.jdbc.driver_classname",Er="db.name",br="db.statement",_r="db.operation",Ar="db.mssql.instance_name",Rr="db.cassandra.keyspace",wr="db.cassandra.page_size",Pr="db.cassandra.consistency_level",Or="db.cassandra.table",Cr="db.cassandra.idempotence",Lr="db.cassandra.speculative_execution_count",Ir="db.cassandra.coordinator.id",xr="db.cassandra.coordinator.dc",Mr="db.hbase.namespace",Nr="db.redis.database_index",Dr="db.mongodb.collection",kr="db.sql.table",$r="exception.type",Vr="exception.message",Ur="exception.stacktrace",Br="exception.escaped",Fr="faas.trigger",Hr="faas.execution",jr="faas.document.collection",Gr="faas.document.operation",qr="faas.document.time",zr="faas.document.name",Wr="faas.time",Qr="faas.cron",Yr="faas.coldstart",Kr="faas.invoked_name",Xr="faas.invoked_provider",Jr="faas.invoked_region",Zr="net.transport",en="net.peer.ip",tn="net.peer.port",rn="net.peer.name",nn="net.host.ip",an="net.host.port",sn="net.host.name",on="net.host.connection.type",ln="net.host.connection.subtype",un="net.host.carrier.name",dn="net.host.carrier.mcc",cn="net.host.carrier.mnc",hn="net.host.carrier.icc",pn="peer.service",fn="enduser.id",mn="enduser.role",gn="enduser.scope",vn="thread.id",Sn="thread.name",yn="code.function",Tn="code.namespace",En="code.filepath",bn="code.lineno",_n="http.method",An="http.url",Rn="http.target",wn="http.host",Pn="http.scheme",On="http.status_code",Cn="http.flavor",Ln="http.user_agent",In="http.request_content_length",xn="http.request_content_length_uncompressed",Mn="http.response_content_length",Nn="http.response_content_length_uncompressed",Dn="http.server_name",kn="http.route",$n="http.client_ip",Vn="aws.dynamodb.table_names",Un="aws.dynamodb.consumed_capacity",Bn="aws.dynamodb.item_collection_metrics",Fn="aws.dynamodb.provisioned_read_capacity",Hn="aws.dynamodb.provisioned_write_capacity",jn="aws.dynamodb.consistent_read",Gn="aws.dynamodb.projection",qn="aws.dynamodb.limit",zn="aws.dynamodb.attributes_to_get",Wn="aws.dynamodb.index_name",Qn="aws.dynamodb.select",Yn="aws.dynamodb.global_secondary_indexes",Kn="aws.dynamodb.local_secondary_indexes",Xn="aws.dynamodb.exclusive_start_table",Jn="aws.dynamodb.table_count",Zn="aws.dynamodb.scan_forward",ea="aws.dynamodb.segment",ta="aws.dynamodb.total_segments",ia="aws.dynamodb.count",ra="aws.dynamodb.scanned_count",na="aws.dynamodb.attribute_definitions",aa="aws.dynamodb.global_secondary_index_updates",sa="messaging.system",oa="messaging.destination",la="messaging.destination_kind",ua="messaging.temp_destination",da="messaging.protocol",ca="messaging.protocol_version",ha="messaging.url",pa="messaging.message_id",fa="messaging.conversation_id",ma="messaging.message_payload_size_bytes",ga="messaging.message_payload_compressed_size_bytes",va="messaging.operation",Sa="messaging.consumer_id",ya="messaging.rabbitmq.routing_key",Ta="messaging.kafka.message_key",Ea="messaging.kafka.consumer_group",ba="messaging.kafka.client_id",_a="messaging.kafka.partition",Aa="messaging.kafka.tombstone",Ra="rpc.system",wa="rpc.service",Pa="rpc.method",Oa="rpc.grpc.status_code",Ca="rpc.jsonrpc.version",La="rpc.jsonrpc.request_id",Ia="rpc.jsonrpc.error_code",xa="rpc.jsonrpc.error_message",Ma="message.type",Na="message.id",Da="message.compressed_size",ka="message.uncompressed_size",$a=gr,Va=vr,Ua=Sr,Ba=yr,Fa=Tr,Ha=Er,ja=br,Ga=_r,qa=Ar,za=Rr,Wa=wr,Qa=Pr,Ya=Or,Ka=Cr,Xa=Lr,Ja=Ir,Za=xr,es=Mr,ts=Nr,is=Dr,rs=kr,ns=$r,as=Vr,ss=Ur,os=Br,ls=Fr,us=Hr,ds=jr,cs=Gr,hs=qr,ps=zr,fs=Wr,ms=Qr,gs=Yr,vs=Kr,Ss=Xr,ys=Jr,Ts=Zr,Es=en,bs=tn,_s=rn,As=nn,Rs=an,ws=sn,Ps=on,Os=ln,Cs=un,Ls=dn,Is=cn,xs=hn,Ms=pn,Ns=fn,Ds=mn,ks=gn,$s=vn,Vs=Sn,Us=yn,Bs=Tn,Fs=En,Hs=bn,js=_n,Gs=An,qs=Rn,zs=wn,Ws=Pn,Qs=On,Ys=Cn,Ks=Ln,Xs=In,Js=xn,Zs=Mn,eo=Nn,to=Dn,io=kn,ro=$n,no=Vn,ao=Un,so=Bn,oo=Fn,lo=Hn,uo=jn,co=Gn,ho=qn,po=zn,fo=Wn,mo=Qn,go=Yn,vo=Kn,So=Xn,yo=Jn,To=Zn,Eo=ea,bo=ta,_o=ia,Ao=ra,Ro=na,wo=aa,Po=sa,Oo=oa,Co=la,Lo=ua,Io=da,xo=ca,Mo=ha,No=pa,Do=fa,ko=ma,$o=ga,Vo=va,Uo=Sa,Bo=ya,Fo=Ta,Ho=Ea,jo=ba,Go=_a,qo=Aa,zo=Ra,Wo=wa,Qo=Pa,Yo=Oa,Ko=Ca,Xo=La,Jo=Ia,Zo=xa,el=Ma,tl=Na,il=Da,rl=ka,nl=fr([gr,vr,Sr,yr,Tr,Er,br,_r,Ar,Rr,wr,Pr,Or,Cr,Lr,Ir,xr,Mr,Nr,Dr,kr,$r,Vr,Ur,Br,Fr,Hr,jr,Gr,qr,zr,Wr,Qr,Yr,Kr,Xr,Jr,Zr,en,tn,rn,nn,an,sn,on,ln,un,dn,cn,hn,pn,fn,mn,gn,vn,Sn,yn,Tn,En,bn,_n,An,Rn,wn,Pn,On,Cn,Ln,In,xn,Mn,Nn,Dn,kn,$n,Vn,Un,Bn,Fn,Hn,jn,Gn,qn,zn,Wn,Qn,Yn,Kn,Xn,Jn,Zn,ea,ta,ia,ra,na,aa,sa,oa,la,ua,da,ca,ha,pa,fa,ma,ga,va,Sa,ya,Ta,Ea,ba,_a,Aa,Ra,wa,Pa,Oa,Ca,La,Ia,xa,Ma,Na,Da,ka]),al="other_sql",sl="mssql",ol="mysql",ll="oracle",ul="postgresql",dl="redshift",cl="hive",hl="cloudscape",pl="hsqldb",fl="progress",ml="maxdb",gl="hanadb",vl="ingres",Sl="firstsql",yl="cache",Tl="adabas",El="firebird",bl="derby",_l="filemaker",Al="informix",Rl="instantdb",wl="interbase",Pl="mariadb",Ol="netezza",Cl="pervasive",Ll="pointbase",Il="sqlite",xl="sybase",Ml="teradata",Nl="vertica",Dl="coldfusion",kl="cassandra",$l="hbase",Vl="mongodb",Ul="redis",Bl="couchbase",Fl="couchdb",Hl="cosmosdb",jl="dynamodb",Gl="neo4j",ql="geode",zl="elasticsearch",Wl="memcached",Ql="cockroachdb",Yl=al,Kl=sl,Xl=ol,Jl=ll,Zl=ul,eu=dl,tu=cl,iu=hl,ru=pl,nu=fl,au=ml,su=gl,ou=vl,lu=Sl,uu=yl,du=Tl,cu=El,hu=bl,pu=_l,fu=Al,mu=Rl,gu=wl,vu=Pl,Su=Ol,yu=Cl,Tu=Ll,Eu=Il,bu=xl,_u=Ml,Au=Nl,Ru=Dl,wu=kl,Pu=$l,Ou=Vl,Cu=Ul,Lu=Bl,Iu=Fl,xu=Hl,Mu=jl,Nu=Gl,Du=ql,ku=zl,$u=Wl,Vu=Ql,Uu=fr([al,sl,ol,ll,"db2",ul,dl,cl,hl,pl,fl,ml,gl,vl,Sl,"edb",yl,Tl,El,bl,_l,Al,Rl,wl,Pl,Ol,Cl,Ll,Il,xl,Ml,Nl,"h2",Dl,kl,$l,Vl,Ul,Bl,Fl,Hl,jl,Gl,ql,zl,Wl,Ql]),Bu="each_quorum",Fu="quorum",Hu="local_quorum",ju="three",Gu="local_one",qu="serial",zu="local_serial",Wu=Bu,Qu=Fu,Yu=Hu,Ku=ju,Xu=Gu,Ju=qu,Zu=zu,ed=fr(["all",Bu,Fu,Hu,"one","two",ju,Gu,"any",qu,zu]),td="datasource",id="http",rd="pubsub",nd="timer",ad="other",sd=td,od=id,ld=rd,ud=nd,dd=ad,cd=fr([td,id,rd,nd,ad]),hd="insert",pd="edit",fd="delete",md=hd,gd=pd,vd=fd,Sd=fr([hd,pd,fd]),yd="alibaba_cloud",Td="azure",Ed=yd,bd=Td,_d=fr([yd,"aws",Td,"gcp"]),Ad="ip_tcp",Rd="ip_udp",wd="unix",Pd="pipe",Od="inproc",Cd="other",Ld=Ad,Id=Rd,xd=wd,Md=Pd,Nd=Od,Dd=Cd,kd=fr([Ad,Rd,"ip",wd,Pd,Od,Cd]),$d="wifi",Vd="wired",Ud="cell",Bd="unavailable",Fd="unknown",Hd=$d,jd=Vd,Gd=Ud,qd=Bd,zd=Fd,Wd=fr([$d,Vd,Ud,Bd,Fd]),Qd="gprs",Yd="edge",Kd="umts",Xd="cdma",Jd="evdo_0",Zd="evdo_a",ec="cdma2000_1xrtt",tc="hsdpa",ic="hsupa",rc="hspa",nc="iden",ac="evdo_b",sc="ehrpd",oc="hspap",lc="td_scdma",uc="iwlan",dc="nrnsa",cc="lte_ca",hc=Qd,pc=Yd,fc=Kd,mc=Xd,gc=Jd,vc=Zd,Sc=ec,yc=tc,Tc=ic,Ec=rc,bc=nc,_c=ac,Ac=sc,Rc=oc,wc=lc,Pc=uc,Oc=dc,Cc=cc,Lc=fr([Qd,Yd,Kd,Xd,Jd,Zd,ec,tc,ic,rc,nc,ac,"lte",sc,oc,"gsm",lc,uc,"nr",dc,cc]),Ic="SPDY",xc="QUIC",Mc=Ic,Nc=xc,Dc={HTTP_1_0:"1.0",HTTP_1_1:"1.1",HTTP_2_0:"2.0",SPDY:Ic,QUIC:xc},kc="queue",$c="topic",Vc=kc,Uc=$c,Bc=fr([kc,$c]),Fc="receive",Hc="process",jc=Fc,Gc=Hc,qc=fr([Fc,Hc]),zc={OK:0,CANCELLED:1,UNKNOWN:2,INVALID_ARGUMENT:3,DEADLINE_EXCEEDED:4,NOT_FOUND:5,ALREADY_EXISTS:6,PERMISSION_DENIED:7,RESOURCE_EXHAUSTED:8,FAILED_PRECONDITION:9,ABORTED:10,OUT_OF_RANGE:11,UNIMPLEMENTED:12,INTERNAL:13,UNAVAILABLE:14,DATA_LOSS:15,UNAUTHENTICATED:16},Wc="SENT",Qc="RECEIVED",Yc=Wc,Kc=Qc,Xc=fr([Wc,Qc]),Jc="cloud.provider",Zc="cloud.account.id",eh="cloud.region",th="cloud.availability_zone",ih="cloud.platform",rh="aws.ecs.container.arn",nh="aws.ecs.cluster.arn",ah="aws.ecs.launchtype",sh="aws.ecs.task.arn",oh="aws.ecs.task.family",lh="aws.ecs.task.revision",uh="aws.eks.cluster.arn",dh="aws.log.group.names",ch="aws.log.group.arns",hh="aws.log.stream.names",ph="aws.log.stream.arns",fh="container.name",mh="container.id",gh="container.runtime",vh="container.image.name",Sh="container.image.tag",yh="deployment.environment",Th="device.id",Eh="device.model.identifier",bh="device.model.name",_h="faas.name",Ah="faas.id",Rh="faas.version",wh="faas.instance",Ph="faas.max_memory",Oh="host.id",Ch="host.name",Lh="host.type",Ih="host.arch",xh="host.image.name",Mh="host.image.id",Nh="host.image.version",Dh="k8s.cluster.name",kh="k8s.node.name",$h="k8s.node.uid",Vh="k8s.namespace.name",Uh="k8s.pod.uid",Bh="k8s.pod.name",Fh="k8s.container.name",Hh="k8s.replicaset.uid",jh="k8s.replicaset.name",Gh="k8s.deployment.uid",qh="k8s.deployment.name",zh="k8s.statefulset.uid",Wh="k8s.statefulset.name",Qh="k8s.daemonset.uid",Yh="k8s.daemonset.name",Kh="k8s.job.uid",Xh="k8s.job.name",Jh="k8s.cronjob.uid",Zh="k8s.cronjob.name",ep="os.type",tp="os.description",ip="os.name",rp="os.version",np="process.pid",ap="process.executable.name",sp="process.executable.path",op="process.command",lp="process.command_line",up="process.command_args",dp="process.owner",cp="process.runtime.name",hp="process.runtime.version",pp="process.runtime.description",fp="service.name",mp="service.namespace",gp="service.instance.id",vp="service.version",Sp="telemetry.sdk.name",yp="telemetry.sdk.language",Tp="telemetry.sdk.version",Ep="telemetry.auto.version",bp="webengine.name",_p="webengine.version",Ap="webengine.description",Rp=Jc,wp=Zc,Pp=eh,Op=th,Cp=ih,Lp=rh,Ip=nh,xp=ah,Mp=sh,Np=oh,Dp=lh,kp=uh,$p=dh,Vp=ch,Up=hh,Bp=ph,Fp=fh,Hp=mh,jp=gh,Gp=vh,qp=Sh,zp=yh,Wp=Th,Qp=Eh,Yp=bh,Kp=_h,Xp=Ah,Jp=Rh,Zp=wh,ef=Ph,tf=Oh,rf=Ch,nf=Lh,af=Ih,sf=xh,of=Mh,lf=Nh,uf=Dh,df=kh,cf=$h,hf=Vh,pf=Uh,ff=Bh,mf=Fh,gf=Hh,vf=jh,Sf=Gh,yf=qh,Tf=zh,Ef=Wh,bf=Qh,_f=Yh,Af=Kh,Rf=Xh,wf=Jh,Pf=Zh,Of=ep,Cf=tp,Lf=ip,If=rp,xf=np,Mf=ap,Nf=sp,Df=op,kf=lp,$f=up,Vf=dp,Uf=cp,Bf=hp,Ff=pp,Hf=fp,jf=mp,Gf=gp,qf=vp,zf=Sp,Wf=yp,Qf=Tp,Yf=Ep,Kf=bp,Xf=_p,Jf=Ap,Zf=fr([Jc,Zc,eh,th,ih,rh,nh,ah,sh,oh,lh,uh,dh,ch,hh,ph,fh,mh,gh,vh,Sh,yh,Th,Eh,bh,_h,Ah,Rh,wh,Ph,Oh,Ch,Lh,Ih,xh,Mh,Nh,Dh,kh,$h,Vh,Uh,Bh,Fh,Hh,jh,Gh,qh,zh,Wh,Qh,Yh,Kh,Xh,Jh,Zh,ep,tp,ip,rp,np,ap,sp,op,lp,up,dp,cp,hp,pp,fp,mp,gp,vp,Sp,yp,Tp,Ep,bp,_p,Ap]),em="alibaba_cloud",tm="azure",im=em,rm=tm,nm=fr([em,"aws",tm,"gcp"]),am="alibaba_cloud_ecs",sm="alibaba_cloud_fc",om="aws_ec2",lm="aws_ecs",um="aws_eks",dm="aws_lambda",cm="aws_elastic_beanstalk",hm="azure_vm",pm="azure_container_instances",fm="azure_aks",mm="azure_functions",gm="azure_app_service",vm="gcp_compute_engine",Sm="gcp_cloud_run",ym="gcp_kubernetes_engine",Tm="gcp_cloud_functions",Em="gcp_app_engine",bm=am,_m=sm,Am=om,Rm=lm,wm=um,Pm=dm,Om=cm,Cm=hm,Lm=pm,Im=fm,xm=mm,Mm=gm,Nm=vm,Dm=Sm,km=ym,$m=Tm,Vm=Em,Um=fr([am,sm,om,lm,um,dm,cm,hm,pm,fm,mm,gm,vm,Sm,ym,Tm,Em]),Bm="fargate",Fm=Bm,Hm=fr(["ec2",Bm]),jm="amd64",Gm="arm32",qm="arm64",zm="ia64",Wm="ppc32",Qm="ppc64",Ym=jm,Km=Gm,Xm=qm,Jm=zm,Zm=Wm,eg=Qm,tg=fr([jm,Gm,qm,zm,Wm,Qm,"x86"]),ig="windows",rg="linux",ng="darwin",ag="freebsd",sg="netbsd",og="openbsd",lg="dragonflybsd",ug="hpux",dg="solaris",cg="z_os",hg=ig,pg=rg,fg=ng,mg=ag,gg=sg,vg=og,Sg=lg,yg=ug,Tg=dg,Eg=cg,bg=fr([ig,rg,ng,ag,sg,og,lg,ug,"aix",dg,cg]),_g="dotnet",Ag="erlang",Rg="java",wg="nodejs",Pg="python",Og="ruby",Cg="webjs",Lg=_g,Ig=Ag,xg=Rg,Mg=wg,Ng=Pg,Dg=Og,kg=Cg,$g=fr(["cpp",_g,Ag,"go",Rg,wg,"php",Pg,Og,Cg]),Vg=Object.freeze({__proto__:null,ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_ABORTED:"aborted",ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_HANDLED:"handled",ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_SKIPPED:"skipped",ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_UNHANDLED:"unhandled",ASPNETCORE_RATE_LIMITING_RESULT_VALUE_ACQUIRED:"acquired",ASPNETCORE_RATE_LIMITING_RESULT_VALUE_ENDPOINT_LIMITER:"endpoint_limiter",ASPNETCORE_RATE_LIMITING_RESULT_VALUE_GLOBAL_LIMITER:"global_limiter",ASPNETCORE_RATE_LIMITING_RESULT_VALUE_REQUEST_CANCELED:"request_canceled",ASPNETCORE_ROUTING_MATCH_STATUS_VALUE_FAILURE:"failure",ASPNETCORE_ROUTING_MATCH_STATUS_VALUE_SUCCESS:"success",ATTR_ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT:"aspnetcore.diagnostics.exception.result",ATTR_ASPNETCORE_DIAGNOSTICS_HANDLER_TYPE:"aspnetcore.diagnostics.handler.type",ATTR_ASPNETCORE_RATE_LIMITING_POLICY:"aspnetcore.rate_limiting.policy",ATTR_ASPNETCORE_RATE_LIMITING_RESULT:"aspnetcore.rate_limiting.result",ATTR_ASPNETCORE_REQUEST_IS_UNHANDLED:"aspnetcore.request.is_unhandled",ATTR_ASPNETCORE_ROUTING_IS_FALLBACK:"aspnetcore.routing.is_fallback",ATTR_ASPNETCORE_ROUTING_MATCH_STATUS:"aspnetcore.routing.match_status",ATTR_CLIENT_ADDRESS:"client.address",ATTR_CLIENT_PORT:"client.port",ATTR_ERROR_TYPE:"error.type",ATTR_EXCEPTION_ESCAPED:"exception.escaped",ATTR_EXCEPTION_MESSAGE:"exception.message",ATTR_EXCEPTION_STACKTRACE:"exception.stacktrace",ATTR_EXCEPTION_TYPE:"exception.type",ATTR_HTTP_REQUEST_HEADER:function(e){return"http.request.header."+e},ATTR_HTTP_REQUEST_METHOD:"http.request.method",ATTR_HTTP_REQUEST_METHOD_ORIGINAL:"http.request.method_original",ATTR_HTTP_REQUEST_RESEND_COUNT:"http.request.resend_count",ATTR_HTTP_RESPONSE_HEADER:function(e){return"http.response.header."+e},ATTR_HTTP_RESPONSE_STATUS_CODE:"http.response.status_code",ATTR_HTTP_ROUTE:"http.route",ATTR_JVM_GC_ACTION:"jvm.gc.action",ATTR_JVM_GC_NAME:"jvm.gc.name",ATTR_JVM_MEMORY_POOL_NAME:"jvm.memory.pool.name",ATTR_JVM_MEMORY_TYPE:"jvm.memory.type",ATTR_JVM_THREAD_DAEMON:"jvm.thread.daemon",ATTR_JVM_THREAD_STATE:"jvm.thread.state",ATTR_NETWORK_LOCAL_ADDRESS:"network.local.address",ATTR_NETWORK_LOCAL_PORT:"network.local.port",ATTR_NETWORK_PEER_ADDRESS:"network.peer.address",ATTR_NETWORK_PEER_PORT:"network.peer.port",ATTR_NETWORK_PROTOCOL_NAME:"network.protocol.name",ATTR_NETWORK_PROTOCOL_VERSION:"network.protocol.version",ATTR_NETWORK_TRANSPORT:"network.transport",ATTR_NETWORK_TYPE:"network.type",ATTR_OTEL_SCOPE_NAME:"otel.scope.name",ATTR_OTEL_SCOPE_VERSION:"otel.scope.version",ATTR_OTEL_STATUS_CODE:"otel.status_code",ATTR_OTEL_STATUS_DESCRIPTION:"otel.status_description",ATTR_SERVER_ADDRESS:"server.address",ATTR_SERVER_PORT:"server.port",ATTR_SERVICE_NAME:"service.name",ATTR_SERVICE_VERSION:"service.version",ATTR_SIGNALR_CONNECTION_STATUS:"signalr.connection.status",ATTR_SIGNALR_TRANSPORT:"signalr.transport",ATTR_TELEMETRY_SDK_LANGUAGE:"telemetry.sdk.language",ATTR_TELEMETRY_SDK_NAME:"telemetry.sdk.name",ATTR_TELEMETRY_SDK_VERSION:"telemetry.sdk.version",ATTR_URL_FRAGMENT:"url.fragment",ATTR_URL_FULL:"url.full",ATTR_URL_PATH:"url.path",ATTR_URL_QUERY:"url.query",ATTR_URL_SCHEME:"url.scheme",ATTR_USER_AGENT_ORIGINAL:"user_agent.original",AWSECSLAUNCHTYPEVALUES_EC2:"ec2",AWSECSLAUNCHTYPEVALUES_FARGATE:Fm,AwsEcsLaunchtypeValues:Hm,CLOUDPLATFORMVALUES_ALIBABA_CLOUD_ECS:bm,CLOUDPLATFORMVALUES_ALIBABA_CLOUD_FC:_m,CLOUDPLATFORMVALUES_AWS_EC2:Am,CLOUDPLATFORMVALUES_AWS_ECS:Rm,CLOUDPLATFORMVALUES_AWS_EKS:wm,CLOUDPLATFORMVALUES_AWS_ELASTIC_BEANSTALK:Om,CLOUDPLATFORMVALUES_AWS_LAMBDA:Pm,CLOUDPLATFORMVALUES_AZURE_AKS:Im,CLOUDPLATFORMVALUES_AZURE_APP_SERVICE:Mm,CLOUDPLATFORMVALUES_AZURE_CONTAINER_INSTANCES:Lm,CLOUDPLATFORMVALUES_AZURE_FUNCTIONS:xm,CLOUDPLATFORMVALUES_AZURE_VM:Cm,CLOUDPLATFORMVALUES_GCP_APP_ENGINE:Vm,CLOUDPLATFORMVALUES_GCP_CLOUD_FUNCTIONS:$m,CLOUDPLATFORMVALUES_GCP_CLOUD_RUN:Dm,CLOUDPLATFORMVALUES_GCP_COMPUTE_ENGINE:Nm,CLOUDPLATFORMVALUES_GCP_KUBERNETES_ENGINE:km,CLOUDPROVIDERVALUES_ALIBABA_CLOUD:im,CLOUDPROVIDERVALUES_AWS:"aws",CLOUDPROVIDERVALUES_AZURE:rm,CLOUDPROVIDERVALUES_GCP:"gcp",CloudPlatformValues:Um,CloudProviderValues:nm,DBCASSANDRACONSISTENCYLEVELVALUES_ALL:"all",DBCASSANDRACONSISTENCYLEVELVALUES_ANY:"any",DBCASSANDRACONSISTENCYLEVELVALUES_EACH_QUORUM:Wu,DBCASSANDRACONSISTENCYLEVELVALUES_LOCAL_ONE:Xu,DBCASSANDRACONSISTENCYLEVELVALUES_LOCAL_QUORUM:Yu,DBCASSANDRACONSISTENCYLEVELVALUES_LOCAL_SERIAL:Zu,DBCASSANDRACONSISTENCYLEVELVALUES_ONE:"one",DBCASSANDRACONSISTENCYLEVELVALUES_QUORUM:Qu,DBCASSANDRACONSISTENCYLEVELVALUES_SERIAL:Ju,DBCASSANDRACONSISTENCYLEVELVALUES_THREE:Ku,DBCASSANDRACONSISTENCYLEVELVALUES_TWO:"two",DBSYSTEMVALUES_ADABAS:du,DBSYSTEMVALUES_CACHE:uu,DBSYSTEMVALUES_CASSANDRA:wu,DBSYSTEMVALUES_CLOUDSCAPE:iu,DBSYSTEMVALUES_COCKROACHDB:Vu,DBSYSTEMVALUES_COLDFUSION:Ru,DBSYSTEMVALUES_COSMOSDB:xu,DBSYSTEMVALUES_COUCHBASE:Lu,DBSYSTEMVALUES_COUCHDB:Iu,DBSYSTEMVALUES_DB2:"db2",DBSYSTEMVALUES_DERBY:hu,DBSYSTEMVALUES_DYNAMODB:Mu,DBSYSTEMVALUES_EDB:"edb",DBSYSTEMVALUES_ELASTICSEARCH:ku,DBSYSTEMVALUES_FILEMAKER:pu,DBSYSTEMVALUES_FIREBIRD:cu,DBSYSTEMVALUES_FIRSTSQL:lu,DBSYSTEMVALUES_GEODE:Du,DBSYSTEMVALUES_H2:"h2",DBSYSTEMVALUES_HANADB:su,DBSYSTEMVALUES_HBASE:Pu,DBSYSTEMVALUES_HIVE:tu,DBSYSTEMVALUES_HSQLDB:ru,DBSYSTEMVALUES_INFORMIX:fu,DBSYSTEMVALUES_INGRES:ou,DBSYSTEMVALUES_INSTANTDB:mu,DBSYSTEMVALUES_INTERBASE:gu,DBSYSTEMVALUES_MARIADB:vu,DBSYSTEMVALUES_MAXDB:au,DBSYSTEMVALUES_MEMCACHED:$u,DBSYSTEMVALUES_MONGODB:Ou,DBSYSTEMVALUES_MSSQL:Kl,DBSYSTEMVALUES_MYSQL:Xl,DBSYSTEMVALUES_NEO4J:Nu,DBSYSTEMVALUES_NETEZZA:Su,DBSYSTEMVALUES_ORACLE:Jl,DBSYSTEMVALUES_OTHER_SQL:Yl,DBSYSTEMVALUES_PERVASIVE:yu,DBSYSTEMVALUES_POINTBASE:Tu,DBSYSTEMVALUES_POSTGRESQL:Zl,DBSYSTEMVALUES_PROGRESS:nu,DBSYSTEMVALUES_REDIS:Cu,DBSYSTEMVALUES_REDSHIFT:eu,DBSYSTEMVALUES_SQLITE:Eu,DBSYSTEMVALUES_SYBASE:bu,DBSYSTEMVALUES_TERADATA:_u,DBSYSTEMVALUES_VERTICA:Au,DbCassandraConsistencyLevelValues:ed,DbSystemValues:Uu,ERROR_TYPE_VALUE_OTHER:"_OTHER",FAASDOCUMENTOPERATIONVALUES_DELETE:vd,FAASDOCUMENTOPERATIONVALUES_EDIT:gd,FAASDOCUMENTOPERATIONVALUES_INSERT:md,FAASINVOKEDPROVIDERVALUES_ALIBABA_CLOUD:Ed,FAASINVOKEDPROVIDERVALUES_AWS:"aws",FAASINVOKEDPROVIDERVALUES_AZURE:bd,FAASINVOKEDPROVIDERVALUES_GCP:"gcp",FAASTRIGGERVALUES_DATASOURCE:sd,FAASTRIGGERVALUES_HTTP:od,FAASTRIGGERVALUES_OTHER:dd,FAASTRIGGERVALUES_PUBSUB:ld,FAASTRIGGERVALUES_TIMER:ud,FaasDocumentOperationValues:Sd,FaasInvokedProviderValues:_d,FaasTriggerValues:cd,HOSTARCHVALUES_AMD64:Ym,HOSTARCHVALUES_ARM32:Km,HOSTARCHVALUES_ARM64:Xm,HOSTARCHVALUES_IA64:Jm,HOSTARCHVALUES_PPC32:Zm,HOSTARCHVALUES_PPC64:eg,HOSTARCHVALUES_X86:"x86",HTTPFLAVORVALUES_HTTP_1_0:"1.0",HTTPFLAVORVALUES_HTTP_1_1:"1.1",HTTPFLAVORVALUES_HTTP_2_0:"2.0",HTTPFLAVORVALUES_QUIC:Nc,HTTPFLAVORVALUES_SPDY:Mc,HTTP_REQUEST_METHOD_VALUE_CONNECT:"CONNECT",HTTP_REQUEST_METHOD_VALUE_DELETE:"DELETE",HTTP_REQUEST_METHOD_VALUE_GET:"GET",HTTP_REQUEST_METHOD_VALUE_HEAD:"HEAD",HTTP_REQUEST_METHOD_VALUE_OPTIONS:"OPTIONS",HTTP_REQUEST_METHOD_VALUE_OTHER:"_OTHER",HTTP_REQUEST_METHOD_VALUE_PATCH:"PATCH",HTTP_REQUEST_METHOD_VALUE_POST:"POST",HTTP_REQUEST_METHOD_VALUE_PUT:"PUT",HTTP_REQUEST_METHOD_VALUE_TRACE:"TRACE",HostArchValues:tg,HttpFlavorValues:Dc,JVM_MEMORY_TYPE_VALUE_HEAP:"heap",JVM_MEMORY_TYPE_VALUE_NON_HEAP:"non_heap",JVM_THREAD_STATE_VALUE_BLOCKED:"blocked",JVM_THREAD_STATE_VALUE_NEW:"new",JVM_THREAD_STATE_VALUE_RUNNABLE:"runnable",JVM_THREAD_STATE_VALUE_TERMINATED:"terminated",JVM_THREAD_STATE_VALUE_TIMED_WAITING:"timed_waiting",JVM_THREAD_STATE_VALUE_WAITING:"waiting",MESSAGETYPEVALUES_RECEIVED:Kc,MESSAGETYPEVALUES_SENT:Yc,MESSAGINGDESTINATIONKINDVALUES_QUEUE:Vc,MESSAGINGDESTINATIONKINDVALUES_TOPIC:Uc,MESSAGINGOPERATIONVALUES_PROCESS:Gc,MESSAGINGOPERATIONVALUES_RECEIVE:jc,METRIC_ASPNETCORE_DIAGNOSTICS_EXCEPTIONS:"aspnetcore.diagnostics.exceptions",METRIC_ASPNETCORE_RATE_LIMITING_ACTIVE_REQUEST_LEASES:"aspnetcore.rate_limiting.active_request_leases",METRIC_ASPNETCORE_RATE_LIMITING_QUEUED_REQUESTS:"aspnetcore.rate_limiting.queued_requests",METRIC_ASPNETCORE_RATE_LIMITING_REQUESTS:"aspnetcore.rate_limiting.requests",METRIC_ASPNETCORE_RATE_LIMITING_REQUEST_LEASE_DURATION:"aspnetcore.rate_limiting.request_lease.duration",METRIC_ASPNETCORE_RATE_LIMITING_REQUEST_TIME_IN_QUEUE:"aspnetcore.rate_limiting.request.time_in_queue",METRIC_ASPNETCORE_ROUTING_MATCH_ATTEMPTS:"aspnetcore.routing.match_attempts",METRIC_HTTP_CLIENT_REQUEST_DURATION:"http.client.request.duration",METRIC_HTTP_SERVER_REQUEST_DURATION:"http.server.request.duration",METRIC_JVM_CLASS_COUNT:"jvm.class.count",METRIC_JVM_CLASS_LOADED:"jvm.class.loaded",METRIC_JVM_CLASS_UNLOADED:"jvm.class.unloaded",METRIC_JVM_CPU_COUNT:"jvm.cpu.count",METRIC_JVM_CPU_RECENT_UTILIZATION:"jvm.cpu.recent_utilization",METRIC_JVM_CPU_TIME:"jvm.cpu.time",METRIC_JVM_GC_DURATION:"jvm.gc.duration",METRIC_JVM_MEMORY_COMMITTED:"jvm.memory.committed",METRIC_JVM_MEMORY_LIMIT:"jvm.memory.limit",METRIC_JVM_MEMORY_USED:"jvm.memory.used",METRIC_JVM_MEMORY_USED_AFTER_LAST_GC:"jvm.memory.used_after_last_gc",METRIC_JVM_THREAD_COUNT:"jvm.thread.count",METRIC_KESTREL_ACTIVE_CONNECTIONS:"kestrel.active_connections",METRIC_KESTREL_ACTIVE_TLS_HANDSHAKES:"kestrel.active_tls_handshakes",METRIC_KESTREL_CONNECTION_DURATION:"kestrel.connection.duration",METRIC_KESTREL_QUEUED_CONNECTIONS:"kestrel.queued_connections",METRIC_KESTREL_QUEUED_REQUESTS:"kestrel.queued_requests",METRIC_KESTREL_REJECTED_CONNECTIONS:"kestrel.rejected_connections",METRIC_KESTREL_TLS_HANDSHAKE_DURATION:"kestrel.tls_handshake.duration",METRIC_KESTREL_UPGRADED_CONNECTIONS:"kestrel.upgraded_connections",METRIC_SIGNALR_SERVER_ACTIVE_CONNECTIONS:"signalr.server.active_connections",METRIC_SIGNALR_SERVER_CONNECTION_DURATION:"signalr.server.connection.duration",MessageTypeValues:Xc,MessagingDestinationKindValues:Bc,MessagingOperationValues:qc,NETHOSTCONNECTIONSUBTYPEVALUES_CDMA:mc,NETHOSTCONNECTIONSUBTYPEVALUES_CDMA2000_1XRTT:Sc,NETHOSTCONNECTIONSUBTYPEVALUES_EDGE:pc,NETHOSTCONNECTIONSUBTYPEVALUES_EHRPD:Ac,NETHOSTCONNECTIONSUBTYPEVALUES_EVDO_0:gc,NETHOSTCONNECTIONSUBTYPEVALUES_EVDO_A:vc,NETHOSTCONNECTIONSUBTYPEVALUES_EVDO_B:_c,NETHOSTCONNECTIONSUBTYPEVALUES_GPRS:hc,NETHOSTCONNECTIONSUBTYPEVALUES_GSM:"gsm",NETHOSTCONNECTIONSUBTYPEVALUES_HSDPA:yc,NETHOSTCONNECTIONSUBTYPEVALUES_HSPA:Ec,NETHOSTCONNECTIONSUBTYPEVALUES_HSPAP:Rc,NETHOSTCONNECTIONSUBTYPEVALUES_HSUPA:Tc,NETHOSTCONNECTIONSUBTYPEVALUES_IDEN:bc,NETHOSTCONNECTIONSUBTYPEVALUES_IWLAN:Pc,NETHOSTCONNECTIONSUBTYPEVALUES_LTE:"lte",NETHOSTCONNECTIONSUBTYPEVALUES_LTE_CA:Cc,NETHOSTCONNECTIONSUBTYPEVALUES_NR:"nr",NETHOSTCONNECTIONSUBTYPEVALUES_NRNSA:Oc,NETHOSTCONNECTIONSUBTYPEVALUES_TD_SCDMA:wc,NETHOSTCONNECTIONSUBTYPEVALUES_UMTS:fc,NETHOSTCONNECTIONTYPEVALUES_CELL:Gd,NETHOSTCONNECTIONTYPEVALUES_UNAVAILABLE:qd,NETHOSTCONNECTIONTYPEVALUES_UNKNOWN:zd,NETHOSTCONNECTIONTYPEVALUES_WIFI:Hd,NETHOSTCONNECTIONTYPEVALUES_WIRED:jd,NETTRANSPORTVALUES_INPROC:Nd,NETTRANSPORTVALUES_IP:"ip",NETTRANSPORTVALUES_IP_TCP:Ld,NETTRANSPORTVALUES_IP_UDP:Id,NETTRANSPORTVALUES_OTHER:Dd,NETTRANSPORTVALUES_PIPE:Md,NETTRANSPORTVALUES_UNIX:xd,NETWORK_TRANSPORT_VALUE_PIPE:"pipe",NETWORK_TRANSPORT_VALUE_QUIC:"quic",NETWORK_TRANSPORT_VALUE_TCP:"tcp",NETWORK_TRANSPORT_VALUE_UDP:"udp",NETWORK_TRANSPORT_VALUE_UNIX:"unix",NETWORK_TYPE_VALUE_IPV4:"ipv4",NETWORK_TYPE_VALUE_IPV6:"ipv6",NetHostConnectionSubtypeValues:Lc,NetHostConnectionTypeValues:Wd,NetTransportValues:kd,OSTYPEVALUES_AIX:"aix",OSTYPEVALUES_DARWIN:fg,OSTYPEVALUES_DRAGONFLYBSD:Sg,OSTYPEVALUES_FREEBSD:mg,OSTYPEVALUES_HPUX:yg,OSTYPEVALUES_LINUX:pg,OSTYPEVALUES_NETBSD:gg,OSTYPEVALUES_OPENBSD:vg,OSTYPEVALUES_SOLARIS:Tg,OSTYPEVALUES_WINDOWS:hg,OSTYPEVALUES_Z_OS:Eg,OTEL_STATUS_CODE_VALUE_ERROR:"ERROR",OTEL_STATUS_CODE_VALUE_OK:"OK",OsTypeValues:bg,RPCGRPCSTATUSCODEVALUES_ABORTED:10,RPCGRPCSTATUSCODEVALUES_ALREADY_EXISTS:6,RPCGRPCSTATUSCODEVALUES_CANCELLED:1,RPCGRPCSTATUSCODEVALUES_DATA_LOSS:15,RPCGRPCSTATUSCODEVALUES_DEADLINE_EXCEEDED:4,RPCGRPCSTATUSCODEVALUES_FAILED_PRECONDITION:9,RPCGRPCSTATUSCODEVALUES_INTERNAL:13,RPCGRPCSTATUSCODEVALUES_INVALID_ARGUMENT:3,RPCGRPCSTATUSCODEVALUES_NOT_FOUND:5,RPCGRPCSTATUSCODEVALUES_OK:0,RPCGRPCSTATUSCODEVALUES_OUT_OF_RANGE:11,RPCGRPCSTATUSCODEVALUES_PERMISSION_DENIED:7,RPCGRPCSTATUSCODEVALUES_RESOURCE_EXHAUSTED:8,RPCGRPCSTATUSCODEVALUES_UNAUTHENTICATED:16,RPCGRPCSTATUSCODEVALUES_UNAVAILABLE:14,RPCGRPCSTATUSCODEVALUES_UNIMPLEMENTED:12,RPCGRPCSTATUSCODEVALUES_UNKNOWN:2,RpcGrpcStatusCodeValues:zc,SEMATTRS_AWS_DYNAMODB_ATTRIBUTES_TO_GET:po,SEMATTRS_AWS_DYNAMODB_ATTRIBUTE_DEFINITIONS:Ro,SEMATTRS_AWS_DYNAMODB_CONSISTENT_READ:uo,SEMATTRS_AWS_DYNAMODB_CONSUMED_CAPACITY:ao,SEMATTRS_AWS_DYNAMODB_COUNT:_o,SEMATTRS_AWS_DYNAMODB_EXCLUSIVE_START_TABLE:So,SEMATTRS_AWS_DYNAMODB_GLOBAL_SECONDARY_INDEXES:go,SEMATTRS_AWS_DYNAMODB_GLOBAL_SECONDARY_INDEX_UPDATES:wo,SEMATTRS_AWS_DYNAMODB_INDEX_NAME:fo,SEMATTRS_AWS_DYNAMODB_ITEM_COLLECTION_METRICS:so,SEMATTRS_AWS_DYNAMODB_LIMIT:ho,SEMATTRS_AWS_DYNAMODB_LOCAL_SECONDARY_INDEXES:vo,SEMATTRS_AWS_DYNAMODB_PROJECTION:co,SEMATTRS_AWS_DYNAMODB_PROVISIONED_READ_CAPACITY:oo,SEMATTRS_AWS_DYNAMODB_PROVISIONED_WRITE_CAPACITY:lo,SEMATTRS_AWS_DYNAMODB_SCANNED_COUNT:Ao,SEMATTRS_AWS_DYNAMODB_SCAN_FORWARD:To,SEMATTRS_AWS_DYNAMODB_SEGMENT:Eo,SEMATTRS_AWS_DYNAMODB_SELECT:mo,SEMATTRS_AWS_DYNAMODB_TABLE_COUNT:yo,SEMATTRS_AWS_DYNAMODB_TABLE_NAMES:no,SEMATTRS_AWS_DYNAMODB_TOTAL_SEGMENTS:bo,SEMATTRS_AWS_LAMBDA_INVOKED_ARN:$a,SEMATTRS_CODE_FILEPATH:Fs,SEMATTRS_CODE_FUNCTION:Us,SEMATTRS_CODE_LINENO:Hs,SEMATTRS_CODE_NAMESPACE:Bs,SEMATTRS_DB_CASSANDRA_CONSISTENCY_LEVEL:Qa,SEMATTRS_DB_CASSANDRA_COORDINATOR_DC:Za,SEMATTRS_DB_CASSANDRA_COORDINATOR_ID:Ja,SEMATTRS_DB_CASSANDRA_IDEMPOTENCE:Ka,SEMATTRS_DB_CASSANDRA_KEYSPACE:za,SEMATTRS_DB_CASSANDRA_PAGE_SIZE:Wa,SEMATTRS_DB_CASSANDRA_SPECULATIVE_EXECUTION_COUNT:Xa,SEMATTRS_DB_CASSANDRA_TABLE:Ya,SEMATTRS_DB_CONNECTION_STRING:Ua,SEMATTRS_DB_HBASE_NAMESPACE:es,SEMATTRS_DB_JDBC_DRIVER_CLASSNAME:Fa,SEMATTRS_DB_MONGODB_COLLECTION:is,SEMATTRS_DB_MSSQL_INSTANCE_NAME:qa,SEMATTRS_DB_NAME:Ha,SEMATTRS_DB_OPERATION:Ga,SEMATTRS_DB_REDIS_DATABASE_INDEX:ts,SEMATTRS_DB_SQL_TABLE:rs,SEMATTRS_DB_STATEMENT:ja,SEMATTRS_DB_SYSTEM:Va,SEMATTRS_DB_USER:Ba,SEMATTRS_ENDUSER_ID:Ns,SEMATTRS_ENDUSER_ROLE:Ds,SEMATTRS_ENDUSER_SCOPE:ks,SEMATTRS_EXCEPTION_ESCAPED:os,SEMATTRS_EXCEPTION_MESSAGE:as,SEMATTRS_EXCEPTION_STACKTRACE:ss,SEMATTRS_EXCEPTION_TYPE:ns,SEMATTRS_FAAS_COLDSTART:gs,SEMATTRS_FAAS_CRON:ms,SEMATTRS_FAAS_DOCUMENT_COLLECTION:ds,SEMATTRS_FAAS_DOCUMENT_NAME:ps,SEMATTRS_FAAS_DOCUMENT_OPERATION:cs,SEMATTRS_FAAS_DOCUMENT_TIME:hs,SEMATTRS_FAAS_EXECUTION:us,SEMATTRS_FAAS_INVOKED_NAME:vs,SEMATTRS_FAAS_INVOKED_PROVIDER:Ss,SEMATTRS_FAAS_INVOKED_REGION:ys,SEMATTRS_FAAS_TIME:fs,SEMATTRS_FAAS_TRIGGER:ls,SEMATTRS_HTTP_CLIENT_IP:ro,SEMATTRS_HTTP_FLAVOR:Ys,SEMATTRS_HTTP_HOST:zs,SEMATTRS_HTTP_METHOD:js,SEMATTRS_HTTP_REQUEST_CONTENT_LENGTH:Xs,SEMATTRS_HTTP_REQUEST_CONTENT_LENGTH_UNCOMPRESSED:Js,SEMATTRS_HTTP_RESPONSE_CONTENT_LENGTH:Zs,SEMATTRS_HTTP_RESPONSE_CONTENT_LENGTH_UNCOMPRESSED:eo,SEMATTRS_HTTP_ROUTE:io,SEMATTRS_HTTP_SCHEME:Ws,SEMATTRS_HTTP_SERVER_NAME:to,SEMATTRS_HTTP_STATUS_CODE:Qs,SEMATTRS_HTTP_TARGET:qs,SEMATTRS_HTTP_URL:Gs,SEMATTRS_HTTP_USER_AGENT:Ks,SEMATTRS_MESSAGE_COMPRESSED_SIZE:il,SEMATTRS_MESSAGE_ID:tl,SEMATTRS_MESSAGE_TYPE:el,SEMATTRS_MESSAGE_UNCOMPRESSED_SIZE:rl,SEMATTRS_MESSAGING_CONSUMER_ID:Uo,SEMATTRS_MESSAGING_CONVERSATION_ID:Do,SEMATTRS_MESSAGING_DESTINATION:Oo,SEMATTRS_MESSAGING_DESTINATION_KIND:Co,SEMATTRS_MESSAGING_KAFKA_CLIENT_ID:jo,SEMATTRS_MESSAGING_KAFKA_CONSUMER_GROUP:Ho,SEMATTRS_MESSAGING_KAFKA_MESSAGE_KEY:Fo,SEMATTRS_MESSAGING_KAFKA_PARTITION:Go,SEMATTRS_MESSAGING_KAFKA_TOMBSTONE:qo,SEMATTRS_MESSAGING_MESSAGE_ID:No,SEMATTRS_MESSAGING_MESSAGE_PAYLOAD_COMPRESSED_SIZE_BYTES:$o,SEMATTRS_MESSAGING_MESSAGE_PAYLOAD_SIZE_BYTES:ko,SEMATTRS_MESSAGING_OPERATION:Vo,SEMATTRS_MESSAGING_PROTOCOL:Io,SEMATTRS_MESSAGING_PROTOCOL_VERSION:xo,SEMATTRS_MESSAGING_RABBITMQ_ROUTING_KEY:Bo,SEMATTRS_MESSAGING_SYSTEM:Po,SEMATTRS_MESSAGING_TEMP_DESTINATION:Lo,SEMATTRS_MESSAGING_URL:Mo,SEMATTRS_NET_HOST_CARRIER_ICC:xs,SEMATTRS_NET_HOST_CARRIER_MCC:Ls,SEMATTRS_NET_HOST_CARRIER_MNC:Is,SEMATTRS_NET_HOST_CARRIER_NAME:Cs,SEMATTRS_NET_HOST_CONNECTION_SUBTYPE:Os,SEMATTRS_NET_HOST_CONNECTION_TYPE:Ps,SEMATTRS_NET_HOST_IP:As,SEMATTRS_NET_HOST_NAME:ws,SEMATTRS_NET_HOST_PORT:Rs,SEMATTRS_NET_PEER_IP:Es,SEMATTRS_NET_PEER_NAME:_s,SEMATTRS_NET_PEER_PORT:bs,SEMATTRS_NET_TRANSPORT:Ts,SEMATTRS_PEER_SERVICE:Ms,SEMATTRS_RPC_GRPC_STATUS_CODE:Yo,SEMATTRS_RPC_JSONRPC_ERROR_CODE:Jo,SEMATTRS_RPC_JSONRPC_ERROR_MESSAGE:Zo,SEMATTRS_RPC_JSONRPC_REQUEST_ID:Xo,SEMATTRS_RPC_JSONRPC_VERSION:Ko,SEMATTRS_RPC_METHOD:Qo,SEMATTRS_RPC_SERVICE:Wo,SEMATTRS_RPC_SYSTEM:zo,SEMATTRS_THREAD_ID:$s,SEMATTRS_THREAD_NAME:Vs,SEMRESATTRS_AWS_ECS_CLUSTER_ARN:Ip,SEMRESATTRS_AWS_ECS_CONTAINER_ARN:Lp,SEMRESATTRS_AWS_ECS_LAUNCHTYPE:xp,SEMRESATTRS_AWS_ECS_TASK_ARN:Mp,SEMRESATTRS_AWS_ECS_TASK_FAMILY:Np,SEMRESATTRS_AWS_ECS_TASK_REVISION:Dp,SEMRESATTRS_AWS_EKS_CLUSTER_ARN:kp,SEMRESATTRS_AWS_LOG_GROUP_ARNS:Vp,SEMRESATTRS_AWS_LOG_GROUP_NAMES:$p,SEMRESATTRS_AWS_LOG_STREAM_ARNS:Bp,SEMRESATTRS_AWS_LOG_STREAM_NAMES:Up,SEMRESATTRS_CLOUD_ACCOUNT_ID:wp,SEMRESATTRS_CLOUD_AVAILABILITY_ZONE:Op,SEMRESATTRS_CLOUD_PLATFORM:Cp,SEMRESATTRS_CLOUD_PROVIDER:Rp,SEMRESATTRS_CLOUD_REGION:Pp,SEMRESATTRS_CONTAINER_ID:Hp,SEMRESATTRS_CONTAINER_IMAGE_NAME:Gp,SEMRESATTRS_CONTAINER_IMAGE_TAG:qp,SEMRESATTRS_CONTAINER_NAME:Fp,SEMRESATTRS_CONTAINER_RUNTIME:jp,SEMRESATTRS_DEPLOYMENT_ENVIRONMENT:zp,SEMRESATTRS_DEVICE_ID:Wp,SEMRESATTRS_DEVICE_MODEL_IDENTIFIER:Qp,SEMRESATTRS_DEVICE_MODEL_NAME:Yp,SEMRESATTRS_FAAS_ID:Xp,SEMRESATTRS_FAAS_INSTANCE:Zp,SEMRESATTRS_FAAS_MAX_MEMORY:ef,SEMRESATTRS_FAAS_NAME:Kp,SEMRESATTRS_FAAS_VERSION:Jp,SEMRESATTRS_HOST_ARCH:af,SEMRESATTRS_HOST_ID:tf,SEMRESATTRS_HOST_IMAGE_ID:of,SEMRESATTRS_HOST_IMAGE_NAME:sf,SEMRESATTRS_HOST_IMAGE_VERSION:lf,SEMRESATTRS_HOST_NAME:rf,SEMRESATTRS_HOST_TYPE:nf,SEMRESATTRS_K8S_CLUSTER_NAME:uf,SEMRESATTRS_K8S_CONTAINER_NAME:mf,SEMRESATTRS_K8S_CRONJOB_NAME:Pf,SEMRESATTRS_K8S_CRONJOB_UID:wf,SEMRESATTRS_K8S_DAEMONSET_NAME:_f,SEMRESATTRS_K8S_DAEMONSET_UID:bf,SEMRESATTRS_K8S_DEPLOYMENT_NAME:yf,SEMRESATTRS_K8S_DEPLOYMENT_UID:Sf,SEMRESATTRS_K8S_JOB_NAME:Rf,SEMRESATTRS_K8S_JOB_UID:Af,SEMRESATTRS_K8S_NAMESPACE_NAME:hf,SEMRESATTRS_K8S_NODE_NAME:df,SEMRESATTRS_K8S_NODE_UID:cf,SEMRESATTRS_K8S_POD_NAME:ff,SEMRESATTRS_K8S_POD_UID:pf,SEMRESATTRS_K8S_REPLICASET_NAME:vf,SEMRESATTRS_K8S_REPLICASET_UID:gf,SEMRESATTRS_K8S_STATEFULSET_NAME:Ef,SEMRESATTRS_K8S_STATEFULSET_UID:Tf,SEMRESATTRS_OS_DESCRIPTION:Cf,SEMRESATTRS_OS_NAME:Lf,SEMRESATTRS_OS_TYPE:Of,SEMRESATTRS_OS_VERSION:If,SEMRESATTRS_PROCESS_COMMAND:Df,SEMRESATTRS_PROCESS_COMMAND_ARGS:$f,SEMRESATTRS_PROCESS_COMMAND_LINE:kf,SEMRESATTRS_PROCESS_EXECUTABLE_NAME:Mf,SEMRESATTRS_PROCESS_EXECUTABLE_PATH:Nf,SEMRESATTRS_PROCESS_OWNER:Vf,SEMRESATTRS_PROCESS_PID:xf,SEMRESATTRS_PROCESS_RUNTIME_DESCRIPTION:Ff,SEMRESATTRS_PROCESS_RUNTIME_NAME:Uf,SEMRESATTRS_PROCESS_RUNTIME_VERSION:Bf,SEMRESATTRS_SERVICE_INSTANCE_ID:Gf,SEMRESATTRS_SERVICE_NAME:Hf,SEMRESATTRS_SERVICE_NAMESPACE:jf,SEMRESATTRS_SERVICE_VERSION:qf,SEMRESATTRS_TELEMETRY_AUTO_VERSION:Yf,SEMRESATTRS_TELEMETRY_SDK_LANGUAGE:Wf,SEMRESATTRS_TELEMETRY_SDK_NAME:zf,SEMRESATTRS_TELEMETRY_SDK_VERSION:Qf,SEMRESATTRS_WEBENGINE_DESCRIPTION:Jf,SEMRESATTRS_WEBENGINE_NAME:Kf,SEMRESATTRS_WEBENGINE_VERSION:Xf,SIGNALR_CONNECTION_STATUS_VALUE_APP_SHUTDOWN:"app_shutdown",SIGNALR_CONNECTION_STATUS_VALUE_NORMAL_CLOSURE:"normal_closure",SIGNALR_CONNECTION_STATUS_VALUE_TIMEOUT:"timeout",SIGNALR_TRANSPORT_VALUE_LONG_POLLING:"long_polling",SIGNALR_TRANSPORT_VALUE_SERVER_SENT_EVENTS:"server_sent_events",SIGNALR_TRANSPORT_VALUE_WEB_SOCKETS:"web_sockets",SemanticAttributes:nl,SemanticResourceAttributes:Zf,TELEMETRYSDKLANGUAGEVALUES_CPP:"cpp",TELEMETRYSDKLANGUAGEVALUES_DOTNET:Lg,TELEMETRYSDKLANGUAGEVALUES_ERLANG:Ig,TELEMETRYSDKLANGUAGEVALUES_GO:"go",TELEMETRYSDKLANGUAGEVALUES_JAVA:xg,TELEMETRYSDKLANGUAGEVALUES_NODEJS:Mg,TELEMETRYSDKLANGUAGEVALUES_PHP:"php",TELEMETRYSDKLANGUAGEVALUES_PYTHON:Ng,TELEMETRYSDKLANGUAGEVALUES_RUBY:Dg,TELEMETRYSDKLANGUAGEVALUES_WEBJS:kg,TELEMETRY_SDK_LANGUAGE_VALUE_CPP:"cpp",TELEMETRY_SDK_LANGUAGE_VALUE_DOTNET:"dotnet",TELEMETRY_SDK_LANGUAGE_VALUE_ERLANG:"erlang",TELEMETRY_SDK_LANGUAGE_VALUE_GO:"go",TELEMETRY_SDK_LANGUAGE_VALUE_JAVA:"java",TELEMETRY_SDK_LANGUAGE_VALUE_NODEJS:"nodejs",TELEMETRY_SDK_LANGUAGE_VALUE_PHP:"php",TELEMETRY_SDK_LANGUAGE_VALUE_PYTHON:"python",TELEMETRY_SDK_LANGUAGE_VALUE_RUBY:"ruby",TELEMETRY_SDK_LANGUAGE_VALUE_RUST:"rust",TELEMETRY_SDK_LANGUAGE_VALUE_SWIFT:"swift",TELEMETRY_SDK_LANGUAGE_VALUE_WEBJS:"webjs",TelemetrySdkLanguageValues:$g}),Ug=((mr={})[zf]="opentelemetry",mr[Uf]="browser",mr[Wf]=kg,mr[Qf]=pr,mr);var Bg,Fg=Math.pow(10,6),Hg=Math.pow(10,9);function jg(e){var t=e/1e3;return[Math.trunc(t),Math.round(e%1e3*Fg)]}function Gg(){var e=hr.timeOrigin;if("number"!=typeof e){var t=hr;e=t.timing&&t.timing.fetchStart}return e}function qg(e){return Yg(jg(Gg()),jg("number"==typeof e?e:hr.now()))}function zg(e,t){var i=t[0]-e[0],r=t[1]-e[1];return r<0&&(i-=1,r+=Hg),[i,r]}function Wg(e){return Array.isArray(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]}function Qg(e){return Wg(e)||"number"==typeof e||e instanceof Date}function Yg(e,t){var i=[e[0]+t[0],e[1]+t[1]];return i[1]>=Hg&&(i[1]-=Hg,i[0]+=1),i}!function(e){e[e.SUCCESS=0]="SUCCESS",e[e.FAILED=1]="FAILED"}(Bg||(Bg={}));var Kg=function(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Xg=function(){function e(e){var t;void 0===e&&(e={}),this._propagators=null!==(t=e.propagators)&&void 0!==t?t:[],this._fields=Array.from(new Set(this._propagators.map((function(e){return"function"==typeof e.fields?e.fields():[]})).reduce((function(e,t){return e.concat(t)}),[])))}return e.prototype.inject=function(e,t,i){var r,n;try{for(var a=Kg(this._propagators),s=a.next();!s.done;s=a.next()){var o=s.value;try{o.inject(e,t,i)}catch(e){ei.warn("Failed to inject with "+o.constructor.name+". Err: "+e.message)}}}catch(e){r={error:e}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}},e.prototype.extract=function(e,t,i){return this._propagators.reduce((function(e,r){try{return r.extract(e,t,i)}catch(e){ei.warn("Failed to inject with "+r.constructor.name+". Err: "+e.message)}return e}),e)},e.prototype.fields=function(){return this._fields.slice()},e}(),Jg="[_0-9a-z-*/]",Zg=new RegExp("^(?:"+("[a-z]"+Jg+"{0,255}")+"|"+("[a-z0-9]"+Jg+"{0,240}@[a-z]"+Jg+"{0,13}")+")$"),ev=/^[ -~]{0,255}[!-~]$/,tv=/,|=/;var iv=function(){function e(e){this._internalState=new Map,e&&this._parse(e)}return e.prototype.set=function(e,t){var i=this._clone();return i._internalState.has(e)&&i._internalState.delete(e),i._internalState.set(e,t),i},e.prototype.unset=function(e){var t=this._clone();return t._internalState.delete(e),t},e.prototype.get=function(e){return this._internalState.get(e)},e.prototype.serialize=function(){var e=this;return this._keys().reduce((function(t,i){return t.push(i+"="+e.get(i)),t}),[]).join(",")},e.prototype._parse=function(e){e.length>512||(this._internalState=e.split(",").reverse().reduce((function(e,t){var i=t.trim(),r=i.indexOf("=");if(-1!==r){var n=i.slice(0,r),a=i.slice(r+1,t.length);(function(e){return Zg.test(e)})(n)&&function(e){return ev.test(e)&&!tv.test(e)}(a)&&e.set(n,a)}return e}),new Map),this._internalState.size>32&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,32))))},e.prototype._keys=function(){return Array.from(this._internalState.keys()).reverse()},e.prototype._clone=function(){var t=new e;return t._internalState=new Map(this._internalState),t},e}(),rv="traceparent",nv="tracestate",av=new RegExp("^\\s?((?!ff)[\\da-f]{2})-((?![0]{32})[\\da-f]{32})-((?![0]{16})[\\da-f]{16})-([\\da-f]{2})(-.*)?\\s?$");function sv(e){var t=av.exec(e);return t?"00"===t[1]&&t[5]?null:{traceId:t[2],spanId:t[3],traceFlags:parseInt(t[4],16)}:null}var ov,lv=function(){function e(){}return e.prototype.inject=function(e,t,i){var r=vi.getSpanContext(e);if(r&&!bi(e)&&kt(r)){var n="00-"+r.traceId+"-"+r.spanId+"-0"+Number(r.traceFlags||dt.NONE).toString(16);i.set(t,rv,n),r.traceState&&i.set(t,nv,r.traceState.serialize())}},e.prototype.extract=function(e,t,i){var r=i.get(t,rv);if(!r)return e;var n=Array.isArray(r)?r[0]:r;if("string"!=typeof n)return e;var a=sv(n);if(!a)return e;a.isRemote=!0;var s=i.get(t,nv);if(s){var o=Array.isArray(s)?s.join(","):s;a.traceState=new iv("string"==typeof o?o:void 0)}return vi.setSpanContext(e,a)},e.prototype.fields=function(){return[rv,nv]},e}(),uv=Ve("OpenTelemetry SDK Context Key RPC_METADATA");!function(e){e.HTTP="http"}(ov||(ov={}));var dv,cv,hv=function(){function e(){}return e.prototype.shouldSample=function(){return{decision:Bt.NOT_RECORD}},e.prototype.toString=function(){return"AlwaysOffSampler"},e}(),pv=function(){function e(){}return e.prototype.shouldSample=function(){return{decision:Bt.RECORD_AND_SAMPLED}},e.prototype.toString=function(){return"AlwaysOnSampler"},e}(),fv=function(){function e(e){var t,i,r,n;this._root=e.root,this._root||(Bi(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new pv),this._remoteParentSampled=null!==(t=e.remoteParentSampled)&&void 0!==t?t:new pv,this._remoteParentNotSampled=null!==(i=e.remoteParentNotSampled)&&void 0!==i?i:new hv,this._localParentSampled=null!==(r=e.localParentSampled)&&void 0!==r?r:new pv,this._localParentNotSampled=null!==(n=e.localParentNotSampled)&&void 0!==n?n:new hv}return e.prototype.shouldSample=function(e,t,i,r,n,a){var s=vi.getSpanContext(e);return s&&kt(s)?s.isRemote?s.traceFlags&dt.SAMPLED?this._remoteParentSampled.shouldSample(e,t,i,r,n,a):this._remoteParentNotSampled.shouldSample(e,t,i,r,n,a):s.traceFlags&dt.SAMPLED?this._localParentSampled.shouldSample(e,t,i,r,n,a):this._localParentNotSampled.shouldSample(e,t,i,r,n,a):this._root.shouldSample(e,t,i,r,n,a)},e.prototype.toString=function(){return"ParentBased{root="+this._root.toString()+", remoteParentSampled="+this._remoteParentSampled.toString()+", remoteParentNotSampled="+this._remoteParentNotSampled.toString()+", localParentSampled="+this._localParentSampled.toString()+", localParentNotSampled="+this._localParentNotSampled.toString()+"}"},e}(),mv=function(){function e(e){void 0===e&&(e=0),this._ratio=e,this._ratio=this._normalize(e),this._upperBound=Math.floor(4294967295*this._ratio)}return e.prototype.shouldSample=function(e,t){return{decision:Nt(t)&&this._accumulate(t)<this._upperBound?Bt.RECORD_AND_SAMPLED:Bt.NOT_RECORD}},e.prototype.toString=function(){return"TraceIdRatioBased{"+this._ratio+"}"},e.prototype._normalize=function(e){return"number"!=typeof e||isNaN(e)?0:e>=1?1:e<=0?0:e},e.prototype._accumulate=function(e){for(var t=0,i=0;i<e.length/8;i++){var r=8*i;t=(t^parseInt(e.slice(r,r+8),16))>>>0}return t},e}(),gv="[object Null]",vv="[object Undefined]",Sv=Function.prototype.toString,yv=Sv.call(Object),Tv=(dv=Object.getPrototypeOf,cv=Object,function(e){return dv(cv(e))}),Ev=Object.prototype,bv=Ev.hasOwnProperty,_v=Symbol?Symbol.toStringTag:void 0,Av=Ev.toString;function Rv(e){if(!function(e){return null!=e&&"object"==typeof e}(e)||"[object Object]"!==function(e){if(null==e)return void 0===e?vv:gv;return _v&&_v in Object(e)?function(e){var t=bv.call(e,_v),i=e[_v],r=!1;try{e[_v]=void 0,r=!0}catch(e){}var n=Av.call(e);r&&(t?e[_v]=i:delete e[_v]);return n}(e):function(e){return Av.call(e)}(e)}(e))return!1;var t=Tv(e);if(null===t)return!0;var i=bv.call(t,"constructor")&&t.constructor;return"function"==typeof i&&i instanceof i&&Sv.call(i)===yv}function wv(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var i=e.shift(),r=new WeakMap;e.length>0;)i=Ov(i,e.shift(),0,r);return i}function Pv(e){return Lv(e)?e.slice():e}function Ov(e,t,i,r){var n;if(void 0===i&&(i=0),!(i>20)){if(i++,Mv(e)||Mv(t)||Iv(t))n=Pv(t);else if(Lv(e)){if(n=e.slice(),Lv(t))for(var a=0,s=t.length;a<s;a++)n.push(Pv(t[a]));else if(xv(t))for(a=0,s=(o=Object.keys(t)).length;a<s;a++){n[l=o[a]]=Pv(t[l])}}else if(xv(e))if(xv(t)){if(!function(e,t){if(!Rv(e)||!Rv(t))return!1;return!0}(e,t))return t;n=Object.assign({},e);var o;for(a=0,s=(o=Object.keys(t)).length;a<s;a++){var l,u=t[l=o[a]];if(Mv(u))void 0===u?delete n[l]:n[l]=u;else{var d=n[l],c=u;if(Cv(e,l,r)||Cv(t,l,r))delete n[l];else{if(xv(d)&&xv(c)){var h=r.get(d)||[],p=r.get(c)||[];h.push({obj:e,key:l}),p.push({obj:t,key:l}),r.set(d,h),r.set(c,p)}n[l]=Ov(n[l],u,i,r)}}}}else n=t;return n}}function Cv(e,t,i){for(var r=i.get(e[t])||[],n=0,a=r.length;n<a;n++){var s=r[n];if(s.key===t&&s.obj===e)return!0}return!1}function Lv(e){return Array.isArray(e)}function Iv(e){return"function"==typeof e}function xv(e){return!Mv(e)&&!Lv(e)&&!Iv(e)&&"object"==typeof e}function Mv(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e||void 0===e||e instanceof Date||e instanceof RegExp||null===e}var Nv=function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},e(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Dv=function(e){function t(i){var r=e.call(this,i)||this;return Object.setPrototypeOf(r,t.prototype),r}return Nv(t,e),t}(Error);var kv=function(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};function $v(e,t){return"string"==typeof t?e===t:!!e.match(t)}var Vv=function(){function e(){var e=this;this._promise=new Promise((function(t,i){e._resolve=t,e._reject=i}))}return Object.defineProperty(e.prototype,"promise",{get:function(){return this._promise},enumerable:!1,configurable:!0}),e.prototype.resolve=function(e){this._resolve(e)},e.prototype.reject=function(e){this._reject(e)},e}(),Uv=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,n,a=i.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)s.push(r.value)}catch(e){n={error:e}}finally{try{r&&!r.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return s},Bv=function(e,t,i){if(i||2===arguments.length)for(var r,n=0,a=t.length;n<a;n++)!r&&n in t||(r||(r=Array.prototype.slice.call(t,0,n)),r[n]=t[n]);return e.concat(r||Array.prototype.slice.call(t))},Fv=function(){function e(e,t){this._callback=e,this._that=t,this._isCalled=!1,this._deferred=new Vv}return Object.defineProperty(e.prototype,"isCalled",{get:function(){return this._isCalled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"promise",{get:function(){return this._deferred.promise},enumerable:!1,configurable:!0}),e.prototype.call=function(){for(var e,t=this,i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];if(!this._isCalled){this._isCalled=!0;try{Promise.resolve((e=this._callback).call.apply(e,Bv([this._that],Uv(i),!1))).then((function(e){return t._deferred.resolve(e)}),(function(e){return t._deferred.reject(e)}))}catch(e){this._deferred.reject(e)}}return this._deferred.promise},e}();var Hv,jv={getKeyPairs:Pi,serializeKeyPairs:wi,parseKeyPairsIntoRecord:function(e){return"string"!=typeof e||0===e.length?{}:e.split(_i).map((function(e){return Oi(e)})).filter((function(e){return void 0!==e&&e.value.length>0})).reduce((function(e,t){return e[t.key]=t.value,e}),{})},parsePairKeyValue:Oi},Gv={_export:function(e,t){return new Promise((function(i){Zt.with(Ei(Zt.active()),(function(){e.export(t,(function(e){i(e)}))}))}))}},qv=Object.freeze({__proto__:null,AlwaysOffSampler:hv,AlwaysOnSampler:pv,AnchoredClock:Li,BindOnceFuture:Fv,CompositePropagator:Xg,DEFAULT_ATTRIBUTE_COUNT_LIMIT:Qi,DEFAULT_ATTRIBUTE_VALUE_LENGTH_LIMIT:Wi,DEFAULT_ENVIRONMENT:Yi,DEFAULT_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT:128,DEFAULT_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT:128,get ExportResultCode(){return Bg},ParentBasedSampler:fv,get RPCType(){return ov},RandomIdGenerator:ur,SDK_INFO:Ug,TRACE_PARENT_HEADER:rv,TRACE_STATE_HEADER:nv,TimeoutError:Dv,TraceIdRatioBasedSampler:mv,TraceState:iv,get TracesSamplerValues(){return Vi},VERSION:pr,W3CBaggagePropagator:Ci,W3CTraceContextPropagator:lv,_globalThis:ir,addHrTimes:Yg,baggageUtils:jv,callWithTimeout:function(e,t){var i,r=new Promise((function(e,r){i=setTimeout((function(){r(new Dv("Operation timed out."))}),t)}));return Promise.race([e,r]).then((function(e){return clearTimeout(i),e}),(function(e){throw clearTimeout(i),e}))},deleteRPCMetadata:function(e){return e.deleteValue(uv)},getEnv:rr,getEnvWithoutDefaults:nr,getRPCMetadata:function(e){return e.getValue(uv)},getTimeOrigin:Gg,globalErrorHandler:Bi,hexToBase64:function(e){return btoa(String.fromCharCode.apply(String,lr([],or(sr(e)),!1)))},hexToBinary:sr,hrTime:qg,hrTimeDuration:zg,hrTimeToMicroseconds:function(e){return 1e6*e[0]+e[1]/1e3},hrTimeToMilliseconds:function(e){return 1e3*e[0]+e[1]/1e6},hrTimeToNanoseconds:function(e){return e[0]*Hg+e[1]},hrTimeToTimeStamp:function(e){var t=""+"0".repeat(9)+e[1]+"Z",i=t.substr(t.length-9-1);return new Date(1e3*e[0]).toISOString().replace("000Z",i)},internal:Gv,isAttributeKey:Ni,isAttributeValue:Di,isTimeInput:Qg,isTimeInputHrTime:Wg,isTracingSuppressed:bi,isUrlIgnored:function(e,t){var i,r;if(!t)return!1;try{for(var n=kv(t),a=n.next();!a.done;a=n.next()){if($v(e,a.value))return!0}}catch(e){i={error:e}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}return!1},isWrapped:function(e){return"function"==typeof e&&"function"==typeof e.__original&&"function"==typeof e.__unwrap&&!0===e.__wrapped},loggingErrorHandler:$i,merge:wv,millisToHrTime:jg,otperformance:hr,parseEnvironment:tr,parseTraceParent:sv,sanitizeAttributes:Mi,setGlobalErrorHandler:function(e){Ui=e},setRPCMetadata:function(e,t){return e.setValue(uv,t)},suppressTracing:Ei,timeInputToHrTime:function(e){if(Wg(e))return e;if("number"==typeof e)return e<Gg()?qg(e):jg(e);if(e instanceof Date)return jg(e.getTime());throw TypeError("Invalid input type")},unrefTimer:function(e){},unsuppressTracing:function(e){return e.deleteValue(Ti)},urlMatches:$v}),zv=function(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Wv=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,n,a=i.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)s.push(r.value)}catch(e){n={error:e}}finally{try{r&&!r.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return s},Qv=function(e,t,i){if(i||2===arguments.length)for(var r,n=0,a=t.length;n<a;n++)!r&&n in t||(r||(r=Array.prototype.slice.call(t,0,n)),r[n]=t[n]);return e.concat(r||Array.prototype.slice.call(t))},Yv=function(){function e(e,t,i,r,n,a,s,o,l,u){void 0===s&&(s=[]),this.attributes={},this.links=[],this.events=[],this._droppedAttributesCount=0,this._droppedEventsCount=0,this._droppedLinksCount=0,this.status={code:Ht.UNSET},this.endTime=[0,0],this._ended=!1,this._duration=[-1,-1],this.name=i,this._spanContext=r,this.parentSpanId=a,this.kind=n,this.links=s;var d=Date.now();this._performanceStartTime=hr.now(),this._performanceOffset=d-(this._performanceStartTime+Gg()),this._startTimeProvided=null!=o,this.startTime=this._getTime(null!=o?o:d),this.resource=e.resource,this.instrumentationLibrary=e.instrumentationLibrary,this._spanLimits=e.getSpanLimits(),this._attributeValueLengthLimit=this._spanLimits.attributeValueLengthLimit||0,null!=u&&this.setAttributes(u),this._spanProcessor=e.getActiveSpanProcessor(),this._spanProcessor.onStart(this,t)}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(e,t){return null==t||this._isSpanEnded()?this:0===e.length?(ei.warn("Invalid attribute key: "+e),this):Di(t)?Object.keys(this.attributes).length>=this._spanLimits.attributeCountLimit&&!Object.prototype.hasOwnProperty.call(this.attributes,e)?(this._droppedAttributesCount++,this):(this.attributes[e]=this._truncateToSize(t),this):(ei.warn("Invalid attribute value set for key: "+e),this)},e.prototype.setAttributes=function(e){var t,i;try{for(var r=zv(Object.entries(e)),n=r.next();!n.done;n=r.next()){var a=Wv(n.value,2),s=a[0],o=a[1];this.setAttribute(s,o)}}catch(e){t={error:e}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}return this},e.prototype.addEvent=function(e,t,i){if(this._isSpanEnded())return this;if(0===this._spanLimits.eventCountLimit)return ei.warn("No events allowed."),this._droppedEventsCount++,this;this.events.length>=this._spanLimits.eventCountLimit&&(0===this._droppedEventsCount&&ei.debug("Dropping extra events."),this.events.shift(),this._droppedEventsCount++),Qg(t)&&(Qg(i)||(i=t),t=void 0);var r=Mi(t);return this.events.push({name:e,attributes:r,time:this._getTime(i),droppedAttributesCount:0}),this},e.prototype.addLink=function(e){return this.links.push(e),this},e.prototype.addLinks=function(e){var t;return(t=this.links).push.apply(t,Qv([],Wv(e),!1)),this},e.prototype.setStatus=function(e){return this._isSpanEnded()||(this.status=e),this},e.prototype.updateName=function(e){return this._isSpanEnded()||(this.name=e),this},e.prototype.end=function(e){this._isSpanEnded()?ei.error(this.name+" "+this._spanContext.traceId+"-"+this._spanContext.spanId+" - You can only call end() on a span once."):(this._ended=!0,this.endTime=this._getTime(e),this._duration=zg(this.startTime,this.endTime),this._duration[0]<0&&(ei.warn("Inconsistent start and end time, startTime > endTime. Setting span duration to 0ms.",this.startTime,this.endTime),this.endTime=this.startTime.slice(),this._duration=[0,0]),this._droppedEventsCount>0&&ei.warn("Dropped "+this._droppedEventsCount+" events because eventCountLimit reached"),this._spanProcessor.onEnd(this))},e.prototype._getTime=function(e){if("number"==typeof e&&e<hr.now())return qg(e+this._performanceOffset);if("number"==typeof e)return jg(e);if(e instanceof Date)return jg(e.getTime());if(Wg(e))return e;if(this._startTimeProvided)return jg(Date.now());var t=hr.now()-this._performanceStartTime;return Yg(this.startTime,jg(t))},e.prototype.isRecording=function(){return!1===this._ended},e.prototype.recordException=function(e,t){var i={};"string"==typeof e?i[as]=e:e&&(e.code?i[ns]=e.code.toString():e.name&&(i[ns]=e.name),e.message&&(i[as]=e.message),e.stack&&(i[ss]=e.stack)),i[ns]||i[as]?this.addEvent("exception",i,t):ei.warn("Failed to record an exception "+e)},Object.defineProperty(e.prototype,"duration",{get:function(){return this._duration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ended",{get:function(){return this._ended},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"droppedAttributesCount",{get:function(){return this._droppedAttributesCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"droppedEventsCount",{get:function(){return this._droppedEventsCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"droppedLinksCount",{get:function(){return this._droppedLinksCount},enumerable:!1,configurable:!0}),e.prototype._isSpanEnded=function(){return this._ended&&ei.warn("Can not execute the operation on ended Span {traceId: "+this._spanContext.traceId+", spanId: "+this._spanContext.spanId+"}"),this._ended},e.prototype._truncateToLimitUtil=function(e,t){return e.length<=t?e:e.substr(0,t)},e.prototype._truncateToSize=function(e){var t=this,i=this._attributeValueLengthLimit;return i<=0?(ei.warn("Attribute value limit must be positive, got "+i),e):"string"==typeof e?this._truncateToLimitUtil(e,i):Array.isArray(e)?e.map((function(e){return"string"==typeof e?t._truncateToLimitUtil(e,i):e})):e},e}();!function(e){e[e.NOT_RECORD=0]="NOT_RECORD",e[e.RECORD=1]="RECORD",e[e.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(Hv||(Hv={}));var Kv=function(){function e(){}return e.prototype.shouldSample=function(){return{decision:Hv.NOT_RECORD}},e.prototype.toString=function(){return"AlwaysOffSampler"},e}(),Xv=function(){function e(){}return e.prototype.shouldSample=function(){return{decision:Hv.RECORD_AND_SAMPLED}},e.prototype.toString=function(){return"AlwaysOnSampler"},e}(),Jv=function(){function e(e){var t,i,r,n;this._root=e.root,this._root||(Bi(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new Xv),this._remoteParentSampled=null!==(t=e.remoteParentSampled)&&void 0!==t?t:new Xv,this._remoteParentNotSampled=null!==(i=e.remoteParentNotSampled)&&void 0!==i?i:new Kv,this._localParentSampled=null!==(r=e.localParentSampled)&&void 0!==r?r:new Xv,this._localParentNotSampled=null!==(n=e.localParentNotSampled)&&void 0!==n?n:new Kv}return e.prototype.shouldSample=function(e,t,i,r,n,a){var s=vi.getSpanContext(e);return s&&kt(s)?s.isRemote?s.traceFlags&dt.SAMPLED?this._remoteParentSampled.shouldSample(e,t,i,r,n,a):this._remoteParentNotSampled.shouldSample(e,t,i,r,n,a):s.traceFlags&dt.SAMPLED?this._localParentSampled.shouldSample(e,t,i,r,n,a):this._localParentNotSampled.shouldSample(e,t,i,r,n,a):this._root.shouldSample(e,t,i,r,n,a)},e.prototype.toString=function(){return"ParentBased{root="+this._root.toString()+", remoteParentSampled="+this._remoteParentSampled.toString()+", remoteParentNotSampled="+this._remoteParentNotSampled.toString()+", localParentSampled="+this._localParentSampled.toString()+", localParentNotSampled="+this._localParentNotSampled.toString()+"}"},e}(),Zv=function(){function e(e){void 0===e&&(e=0),this._ratio=e,this._ratio=this._normalize(e),this._upperBound=Math.floor(4294967295*this._ratio)}return e.prototype.shouldSample=function(e,t){return{decision:Nt(t)&&this._accumulate(t)<this._upperBound?Hv.RECORD_AND_SAMPLED:Hv.NOT_RECORD}},e.prototype.toString=function(){return"TraceIdRatioBased{"+this._ratio+"}"},e.prototype._normalize=function(e){return"number"!=typeof e||isNaN(e)?0:e>=1?1:e<=0?0:e},e.prototype._accumulate=function(e){for(var t=0,i=0;i<e.length/8;i++){var r=8*i;t=(t^parseInt(e.slice(r,r+8),16))>>>0}return t},e}(),eS=rr(),tS=Vi.AlwaysOn;function iS(){var e=rr();return{sampler:rS(eS),forceFlushTimeoutMillis:3e4,generalLimits:{attributeValueLengthLimit:e.OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:e.OTEL_ATTRIBUTE_COUNT_LIMIT},spanLimits:{attributeValueLengthLimit:e.OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:e.OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT,linkCountLimit:e.OTEL_SPAN_LINK_COUNT_LIMIT,eventCountLimit:e.OTEL_SPAN_EVENT_COUNT_LIMIT,attributePerEventCountLimit:e.OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT,attributePerLinkCountLimit:e.OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT}}}function rS(e){switch(void 0===e&&(e=rr()),e.OTEL_TRACES_SAMPLER){case Vi.AlwaysOn:return new Xv;case Vi.AlwaysOff:return new Kv;case Vi.ParentBasedAlwaysOn:return new Jv({root:new Xv});case Vi.ParentBasedAlwaysOff:return new Jv({root:new Kv});case Vi.TraceIdRatio:return new Zv(nS(e));case Vi.ParentBasedTraceIdRatio:return new Jv({root:new Zv(nS(e))});default:return ei.error('OTEL_TRACES_SAMPLER value "'+e.OTEL_TRACES_SAMPLER+" invalid, defaulting to "+tS+'".'),new Xv}}function nS(e){if(void 0===e.OTEL_TRACES_SAMPLER_ARG||""===e.OTEL_TRACES_SAMPLER_ARG)return ei.error("OTEL_TRACES_SAMPLER_ARG is blank, defaulting to 1."),1;var t=Number(e.OTEL_TRACES_SAMPLER_ARG);return isNaN(t)?(ei.error("OTEL_TRACES_SAMPLER_ARG="+e.OTEL_TRACES_SAMPLER_ARG+" was given, but it is invalid, defaulting to 1."),1):t<0||t>1?(ei.error("OTEL_TRACES_SAMPLER_ARG="+e.OTEL_TRACES_SAMPLER_ARG+" was given, but it is out of range ([0..1]), defaulting to 1."),1):t}var aS=function(){function e(e,t){this._exporter=e,this._isExporting=!1,this._finishedSpans=[],this._droppedSpansCount=0;var i=rr();this._maxExportBatchSize="number"==typeof(null==t?void 0:t.maxExportBatchSize)?t.maxExportBatchSize:i.OTEL_BSP_MAX_EXPORT_BATCH_SIZE,this._maxQueueSize="number"==typeof(null==t?void 0:t.maxQueueSize)?t.maxQueueSize:i.OTEL_BSP_MAX_QUEUE_SIZE,this._scheduledDelayMillis="number"==typeof(null==t?void 0:t.scheduledDelayMillis)?t.scheduledDelayMillis:i.OTEL_BSP_SCHEDULE_DELAY,this._exportTimeoutMillis="number"==typeof(null==t?void 0:t.exportTimeoutMillis)?t.exportTimeoutMillis:i.OTEL_BSP_EXPORT_TIMEOUT,this._shutdownOnce=new Fv(this._shutdown,this),this._maxExportBatchSize>this._maxQueueSize&&(ei.warn("BatchSpanProcessor: maxExportBatchSize must be smaller or equal to maxQueueSize, setting maxExportBatchSize to match maxQueueSize"),this._maxExportBatchSize=this._maxQueueSize)}return e.prototype.forceFlush=function(){return this._shutdownOnce.isCalled?this._shutdownOnce.promise:this._flushAll()},e.prototype.onStart=function(e,t){},e.prototype.onEnd=function(e){this._shutdownOnce.isCalled||e.spanContext().traceFlags&dt.SAMPLED&&this._addToBuffer(e)},e.prototype.shutdown=function(){return this._shutdownOnce.call()},e.prototype._shutdown=function(){var e=this;return Promise.resolve().then((function(){return e.onShutdown()})).then((function(){return e._flushAll()})).then((function(){return e._exporter.shutdown()}))},e.prototype._addToBuffer=function(e){if(this._finishedSpans.length>=this._maxQueueSize)return 0===this._droppedSpansCount&&ei.debug("maxQueueSize reached, dropping spans"),void this._droppedSpansCount++;this._droppedSpansCount>0&&(ei.warn("Dropped "+this._droppedSpansCount+" spans because maxQueueSize reached"),this._droppedSpansCount=0),this._finishedSpans.push(e),this._maybeStartTimer()},e.prototype._flushAll=function(){var e=this;return new Promise((function(t,i){for(var r=[],n=0,a=Math.ceil(e._finishedSpans.length/e._maxExportBatchSize);n<a;n++)r.push(e._flushOneBatch());Promise.all(r).then((function(){t()})).catch(i)}))},e.prototype._flushOneBatch=function(){var e=this;return this._clearTimer(),0===this._finishedSpans.length?Promise.resolve():new Promise((function(t,i){var r=setTimeout((function(){i(new Error("Timeout"))}),e._exportTimeoutMillis);Zt.with(Ei(Zt.active()),(function(){var n;e._finishedSpans.length<=e._maxExportBatchSize?(n=e._finishedSpans,e._finishedSpans=[]):n=e._finishedSpans.splice(0,e._maxExportBatchSize);for(var a=function(){return e._exporter.export(n,(function(e){var n;clearTimeout(r),e.code===Bg.SUCCESS?t():i(null!==(n=e.error)&&void 0!==n?n:new Error("BatchSpanProcessor: span export failed"))}))},s=null,o=0,l=n.length;o<l;o++){var u=n[o];u.resource.asyncAttributesPending&&u.resource.waitForAsyncAttributes&&(null!=s||(s=[]),s.push(u.resource.waitForAsyncAttributes()))}null===s?a():Promise.all(s).then(a,(function(e){Bi(e),i(e)}))}))}))},e.prototype._maybeStartTimer=function(){var e=this;if(!this._isExporting){var t=function(){e._isExporting=!0,e._flushOneBatch().finally((function(){e._isExporting=!1,e._finishedSpans.length>0&&(e._clearTimer(),e._maybeStartTimer())})).catch((function(t){e._isExporting=!1,Bi(t)}))};if(this._finishedSpans.length>=this._maxExportBatchSize)return t();void 0===this._timer&&(this._timer=setTimeout((function(){return t()}),this._scheduledDelayMillis))}},e.prototype._clearTimer=function(){void 0!==this._timer&&(clearTimeout(this._timer),this._timer=void 0)},e}(),sS=function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},e(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),oS=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.onInit(i),r}return sS(t,e),t.prototype.onInit=function(e){var t=this;!0!==(null==e?void 0:e.disableAutoFlushOnDocumentHide)&&"undefined"!=typeof document&&(this._visibilityChangeListener=function(){"hidden"===document.visibilityState&&t.forceFlush()},this._pageHideListener=function(){t.forceFlush()},document.addEventListener("visibilitychange",this._visibilityChangeListener),document.addEventListener("pagehide",this._pageHideListener))},t.prototype.onShutdown=function(){"undefined"!=typeof document&&(this._visibilityChangeListener&&document.removeEventListener("visibilitychange",this._visibilityChangeListener),this._pageHideListener&&document.removeEventListener("pagehide",this._pageHideListener))},t}(aS),lS=function(){this.generateTraceId=dS(16),this.generateSpanId=dS(8)},uS=Array(32);function dS(e){return function(){for(var t=0;t<2*e;t++)uS[t]=Math.floor(16*Math.random())+48,uS[t]>=58&&(uS[t]+=39);return String.fromCharCode.apply(null,uS.slice(0,2*e))}}var cS=function(){function e(e,t,i){this._tracerProvider=i;var r,n,a,s,o=(r=t,n={sampler:rS()},a=iS(),(s=Object.assign({},a,n,r)).generalLimits=Object.assign({},a.generalLimits,r.generalLimits||{}),s.spanLimits=Object.assign({},a.spanLimits,r.spanLimits||{}),s);this._sampler=o.sampler,this._generalLimits=o.generalLimits,this._spanLimits=o.spanLimits,this._idGenerator=t.idGenerator||new lS,this.resource=i.resource,this.instrumentationLibrary=e}return e.prototype.startSpan=function(e,t,i){var r,n,a;void 0===t&&(t={}),void 0===i&&(i=Zt.active()),t.root&&(i=vi.deleteSpan(i));var s=vi.getSpan(i);if(bi(i))return ei.debug("Instrumentation suppressed, returning Noop Span"),vi.wrapSpanContext(_t);var o,l,u,d=null==s?void 0:s.spanContext(),c=this._idGenerator.generateSpanId();d&&vi.isSpanContextValid(d)?(o=d.traceId,l=d.traceState,u=d.spanId):o=this._idGenerator.generateTraceId();var h=null!==(r=t.kind)&&void 0!==r?r:Ft.INTERNAL,p=(null!==(n=t.links)&&void 0!==n?n:[]).map((function(e){return{context:e.context,attributes:Mi(e.attributes)}})),f=Mi(t.attributes),m=this._sampler.shouldSample(i,o,e,h,f,p);l=null!==(a=m.traceState)&&void 0!==a?a:l;var g={traceId:o,spanId:c,traceFlags:m.decision===Bt.RECORD_AND_SAMPLED?dt.SAMPLED:dt.NONE,traceState:l};if(m.decision===Bt.NOT_RECORD)return ei.debug("Recording is off, propagating context in a non-recording span"),vi.wrapSpanContext(g);var v=Mi(Object.assign(f,m.attributes));return new Yv(this,i,e,g,h,u,p,t.startTime,void 0,v)},e.prototype.startActiveSpan=function(e,t,i,r){var n,a,s;if(!(arguments.length<2)){2===arguments.length?s=t:3===arguments.length?(n=t,s=i):(n=t,a=i,s=r);var o=null!=a?a:Zt.active(),l=this.startSpan(e,n,o),u=vi.setSpan(o,l);return Zt.with(u,s,void 0,l)}},e.prototype.getGeneralLimits=function(){return this._generalLimits},e.prototype.getSpanLimits=function(){return this._spanLimits},e.prototype.getActiveSpanProcessor=function(){return this._tracerProvider.getActiveSpanProcessor()},e}();var hS,pS=function(){return pS=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},pS.apply(this,arguments)},fS=function(e,t,i,r){return new(i||(i=Promise))((function(n,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,o)}l((r=r.apply(e,t||[])).next())}))},mS=function(e,t){var i,r,n,a,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(n=2&a[0]?r.return:a[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,a[1])).done)return n;switch(r=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(n=s.trys,(n=n.length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){s.label=a[1];break}if(6===a[0]&&s.label<n[1]){s.label=n[1],n=a;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(a);break}n[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{i=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}},gS=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,n,a=i.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)s.push(r.value)}catch(e){n={error:e}}finally{try{r&&!r.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return s},vS=function(){function e(e,t){var i,r=this;this._attributes=e,this.asyncAttributesPending=null!=t,this._syncAttributes=null!==(i=this._attributes)&&void 0!==i?i:{},this._asyncAttributesPromise=null==t?void 0:t.then((function(e){return r._attributes=Object.assign({},r._attributes,e),r.asyncAttributesPending=!1,e}),(function(e){return ei.debug("a resource's async attributes promise rejected: %s",e),r.asyncAttributesPending=!1,{}}))}return e.empty=function(){return e.EMPTY},e.default=function(){var t;return new e(((t={})[Hf]="unknown_service",t[Wf]=Ug[Wf],t[zf]=Ug[zf],t[Qf]=Ug[Qf],t))},Object.defineProperty(e.prototype,"attributes",{get:function(){var e;return this.asyncAttributesPending&&ei.error("Accessing resource attributes before async attributes settled"),null!==(e=this._attributes)&&void 0!==e?e:{}},enumerable:!1,configurable:!0}),e.prototype.waitForAsyncAttributes=function(){return fS(this,void 0,void 0,(function(){return mS(this,(function(e){switch(e.label){case 0:return this.asyncAttributesPending?[4,this._asyncAttributesPromise]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},e.prototype.merge=function(t){var i,r=this;if(!t)return this;var n=pS(pS({},this._syncAttributes),null!==(i=t._syncAttributes)&&void 0!==i?i:t.attributes);if(!this._asyncAttributesPromise&&!t._asyncAttributesPromise)return new e(n);var a=Promise.all([this._asyncAttributesPromise,t._asyncAttributesPromise]).then((function(e){var i,n=gS(e,2),a=n[0],s=n[1];return pS(pS(pS(pS({},r._syncAttributes),a),null!==(i=t._syncAttributes)&&void 0!==i?i:t.attributes),s)}));return new e(n,a)},e.EMPTY=new e({}),e}(),SS=function(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},yS=function(){function e(e){this._spanProcessors=e}return e.prototype.forceFlush=function(){var e,t,i=[];try{for(var r=SS(this._spanProcessors),n=r.next();!n.done;n=r.next()){var a=n.value;i.push(a.forceFlush())}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return new Promise((function(e){Promise.all(i).then((function(){e()})).catch((function(t){Bi(t||new Error("MultiSpanProcessor: forceFlush failed")),e()}))}))},e.prototype.onStart=function(e,t){var i,r;try{for(var n=SS(this._spanProcessors),a=n.next();!a.done;a=n.next()){a.value.onStart(e,t)}}catch(e){i={error:e}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}},e.prototype.onEnd=function(e){var t,i;try{for(var r=SS(this._spanProcessors),n=r.next();!n.done;n=r.next()){n.value.onEnd(e)}}catch(e){t={error:e}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}},e.prototype.shutdown=function(){var e,t,i=[];try{for(var r=SS(this._spanProcessors),n=r.next();!n.done;n=r.next()){var a=n.value;i.push(a.shutdown())}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return new Promise((function(e,t){Promise.all(i).then((function(){e()}),t)}))},e}(),TS=function(){function e(){}return e.prototype.onStart=function(e,t){},e.prototype.onEnd=function(e){},e.prototype.shutdown=function(){return Promise.resolve()},e.prototype.forceFlush=function(){return Promise.resolve()},e}();!function(e){e[e.resolved=0]="resolved",e[e.timeout=1]="timeout",e[e.error=2]="error",e[e.unresolved=3]="unresolved"}(hS||(hS={}));var ES=function(){function e(e){var t;void 0===e&&(e={}),this._registeredSpanProcessors=[],this._tracers=new Map;var i=wv({},iS(),function(e){var t,i,r,n,a,s,o,l,u,d,c,h,p=Object.assign({},e.spanLimits),f=nr();return p.attributeCountLimit=null!==(s=null!==(a=null!==(n=null!==(i=null===(t=e.spanLimits)||void 0===t?void 0:t.attributeCountLimit)&&void 0!==i?i:null===(r=e.generalLimits)||void 0===r?void 0:r.attributeCountLimit)&&void 0!==n?n:f.OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT)&&void 0!==a?a:f.OTEL_ATTRIBUTE_COUNT_LIMIT)&&void 0!==s?s:Qi,p.attributeValueLengthLimit=null!==(h=null!==(c=null!==(d=null!==(l=null===(o=e.spanLimits)||void 0===o?void 0:o.attributeValueLengthLimit)&&void 0!==l?l:null===(u=e.generalLimits)||void 0===u?void 0:u.attributeValueLengthLimit)&&void 0!==d?d:f.OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT)&&void 0!==c?c:f.OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT)&&void 0!==h?h:Wi,Object.assign({},e,{spanLimits:p})}(e));this.resource=null!==(t=i.resource)&&void 0!==t?t:vS.empty(),this.resource=vS.default().merge(this.resource),this._config=Object.assign({},i,{resource:this.resource});var r=this._buildExporterFromEnv();if(void 0!==r){var n=new oS(r);this.activeSpanProcessor=n}else this.activeSpanProcessor=new TS}return e.prototype.getTracer=function(e,t,i){var r=e+"@"+(t||"")+":"+((null==i?void 0:i.schemaUrl)||"");return this._tracers.has(r)||this._tracers.set(r,new cS({name:e,version:t,schemaUrl:null==i?void 0:i.schemaUrl},this._config,this)),this._tracers.get(r)},e.prototype.addSpanProcessor=function(e){0===this._registeredSpanProcessors.length&&this.activeSpanProcessor.shutdown().catch((function(e){return ei.error("Error while trying to shutdown current span processor",e)})),this._registeredSpanProcessors.push(e),this.activeSpanProcessor=new yS(this._registeredSpanProcessors)},e.prototype.getActiveSpanProcessor=function(){return this.activeSpanProcessor},e.prototype.register=function(e){void 0===e&&(e={}),vi.setGlobalTracerProvider(this),void 0===e.propagator&&(e.propagator=this._buildPropagatorFromEnv()),e.contextManager&&Zt.setGlobalContextManager(e.contextManager),e.propagator&&fi.setGlobalPropagator(e.propagator)},e.prototype.forceFlush=function(){var e=this._config.forceFlushTimeoutMillis,t=this._registeredSpanProcessors.map((function(t){return new Promise((function(i){var r,n=setTimeout((function(){i(new Error("Span processor did not completed within timeout period of "+e+" ms")),r=hS.timeout}),e);t.forceFlush().then((function(){clearTimeout(n),r!==hS.timeout&&(r=hS.resolved,i(r))})).catch((function(e){clearTimeout(n),r=hS.error,i(e)}))}))}));return new Promise((function(e,i){Promise.all(t).then((function(t){var r=t.filter((function(e){return e!==hS.resolved}));r.length>0?i(r):e()})).catch((function(e){return i([e])}))}))},e.prototype.shutdown=function(){return this.activeSpanProcessor.shutdown()},e.prototype._getPropagator=function(e){var t;return null===(t=this.constructor._registeredPropagators.get(e))||void 0===t?void 0:t()},e.prototype._getSpanExporter=function(e){var t;return null===(t=this.constructor._registeredExporters.get(e))||void 0===t?void 0:t()},e.prototype._buildPropagatorFromEnv=function(){var e=this,t=Array.from(new Set(rr().OTEL_PROPAGATORS)),i=t.map((function(t){var i=e._getPropagator(t);return i||ei.warn('Propagator "'+t+'" requested through environment variable is unavailable.'),i})).reduce((function(e,t){return t&&e.push(t),e}),[]);return 0===i.length?void 0:1===t.length?i[0]:new Xg({propagators:i})},e.prototype._buildExporterFromEnv=function(){var e=rr().OTEL_TRACES_EXPORTER;if("none"!==e&&""!==e){var t=this._getSpanExporter(e);return t||ei.error('Exporter "'+e+'" requested through environment variable is unavailable.'),t}},e._registeredPropagators=new Map([["tracecontext",function(){return new lv}],["baggage",function(){return new Ci}]]),e._registeredExporters=new Map,e}(),bS=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,n,a=i.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)s.push(r.value)}catch(e){n={error:e}}finally{try{r&&!r.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return s},_S=function(e,t,i){if(i||2===arguments.length)for(var r,n=0,a=t.length;n<a;n++)!r&&n in t||(r||(r=Array.prototype.slice.call(t,0,n)),r[n]=t[n]);return e.concat(r||Array.prototype.slice.call(t))},AS=function(){function e(){this._enabled=!1,this._currentContext=He}return e.prototype._bindFunction=function(e,t){void 0===e&&(e=He);var i=this,r=function(){for(var r=this,n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];return i.with(e,(function(){return t.apply(r,n)}))};return Object.defineProperty(r,"length",{enumerable:!1,configurable:!0,writable:!1,value:t.length}),r},e.prototype.active=function(){return this._currentContext},e.prototype.bind=function(e,t){return void 0===e&&(e=this.active()),"function"==typeof t?this._bindFunction(e,t):t},e.prototype.disable=function(){return this._currentContext=He,this._enabled=!1,this},e.prototype.enable=function(){return this._enabled||(this._enabled=!0,this._currentContext=He),this},e.prototype.with=function(e,t,i){for(var r=[],n=3;n<arguments.length;n++)r[n-3]=arguments[n];var a=this._currentContext;this._currentContext=e||He;try{return t.call.apply(t,_S([i],bS(r),!1))}finally{this._currentContext=a}},e}(),RS=function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},e(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),wS=function(e){function t(t){void 0===t&&(t={});var i=e.call(this,t)||this;if(t.contextManager)throw"contextManager should be defined in register method not in constructor";if(t.propagator)throw"propagator should be defined in register method not in constructor";return i}return RS(t,e),t.prototype.register=function(t){void 0===t&&(t={}),void 0===t.contextManager&&(t.contextManager=new AS),t.contextManager&&t.contextManager.enable(),e.prototype.register.call(this,t)},t}(ES),PS=function(){function e(){}return e.prototype.emit=function(e){},e}(),OS=new(function(){function e(){}return e.prototype.getLogger=function(e,t,i){return new PS},e}()),CS="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof global?global:{},LS=Symbol.for("io.opentelemetry.js.api.logs"),IS=CS;var xS=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalLoggerProvider=function(e){return IS[LS]?this.getLoggerProvider():(IS[LS]=(t=1,i=e,r=OS,function(e){return e===t?i:r}),e);var t,i,r},e.prototype.getLoggerProvider=function(){var e,t;return null!==(t=null===(e=IS[LS])||void 0===e?void 0:e.call(IS,1))&&void 0!==t?t:OS},e.prototype.getLogger=function(e,t,i){return this.getLoggerProvider().getLogger(e,t,i)},e.prototype.disable=function(){delete IS[LS]},e}(),MS=xS.getInstance();var NS="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function DS(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var i=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};i.prototype=t.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(i,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})})),i}var kS={},$S=DS(yi),VS=DS(Vg),US=DS(qv),BS={},FS={};Object.defineProperty(FS,"__esModule",{value:!0}),FS.defaultServiceName=void 0,FS.defaultServiceName=function(){return"unknown_service"},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.defaultServiceName=void 0;var t=FS;Object.defineProperty(e,"defaultServiceName",{enumerable:!0,get:function(){return t.defaultServiceName}})}(BS),Object.defineProperty(kS,"__esModule",{value:!0});var HS=kS.Resource=void 0;const jS=$S,GS=VS,qS=US,zS=BS;class WS{constructor(e,t){var i;this._attributes=e,this.asyncAttributesPending=null!=t,this._syncAttributes=null!==(i=this._attributes)&&void 0!==i?i:{},this._asyncAttributesPromise=null==t?void 0:t.then((e=>(this._attributes=Object.assign({},this._attributes,e),this.asyncAttributesPending=!1,e)),(e=>(jS.diag.debug("a resource's async attributes promise rejected: %s",e),this.asyncAttributesPending=!1,{})))}static empty(){return WS.EMPTY}static default(){return new WS({[GS.SEMRESATTRS_SERVICE_NAME]:(0,zS.defaultServiceName)(),[GS.SEMRESATTRS_TELEMETRY_SDK_LANGUAGE]:qS.SDK_INFO[GS.SEMRESATTRS_TELEMETRY_SDK_LANGUAGE],[GS.SEMRESATTRS_TELEMETRY_SDK_NAME]:qS.SDK_INFO[GS.SEMRESATTRS_TELEMETRY_SDK_NAME],[GS.SEMRESATTRS_TELEMETRY_SDK_VERSION]:qS.SDK_INFO[GS.SEMRESATTRS_TELEMETRY_SDK_VERSION]})}get attributes(){var e;return this.asyncAttributesPending&&jS.diag.error("Accessing resource attributes before async attributes settled"),null!==(e=this._attributes)&&void 0!==e?e:{}}async waitForAsyncAttributes(){this.asyncAttributesPending&&await this._asyncAttributesPromise}merge(e){var t;if(!e)return this;const i=Object.assign(Object.assign({},this._syncAttributes),null!==(t=e._syncAttributes)&&void 0!==t?t:e.attributes);if(!this._asyncAttributesPromise&&!e._asyncAttributesPromise)return new WS(i);const r=Promise.all([this._asyncAttributesPromise,e._asyncAttributesPromise]).then((([t,i])=>{var r;return Object.assign(Object.assign(Object.assign(Object.assign({},this._syncAttributes),t),null!==(r=e._syncAttributes)&&void 0!==r?r:e.attributes),i)}));return new WS(i,r)}}HS=kS.Resource=WS,WS.EMPTY=new WS({});const QS="undefined"!=typeof performance;function YS(){return function(e){return Math.round(1e6*e)}(function(){let e;return e=QS&&performance.now?performance.timeOrigin?performance.timeOrigin+performance.now():performance.timing&&performance.timing.navigationStart?performance.timing.navigationStart+performance.now():Date.now()+performance.now():Date.now(),e}())}function KS(e){return"https://"+(e.apiHost||"sdk-api.apptracer.ru")+e.apiUrl+function(e){const t=e.queryParams||{},i=[];e.sdkVersion&&(t.sdkVersion=e.sdkVersion);for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&t[e]&&i.push(e+"="+t[e]);return i.length?"?"+i.join("&"):""}(e)}class XS{constructor(){this.data={}}getItem(e){return this.data[e]||null}removeItem(e){this.data[e]=void 0}setItem(e,t){this.data[e]=t}}let JS;function ZS(){return JS||(JS=function(){let e;try{if("undefined"==typeof window)return new XS;e=window.localStorage;const t="__ls_tracer_test";return e.setItem(t,t),e.getItem(t)!==t?new XS:(e.removeItem(t),e)}catch(e){return new XS}}()),JS}const ey={};function ty(e){return"tracer-mute-"+e}function iy(e){const t=ZS().getItem(ty(e));return t?parseInt(t):null}function ry(e,t){if(ey[e])return;const i=ty(e),r=iy(e);if(r)ey[e]=r;else{const r=ey[e]=Date.now()+t;ZS().setItem(i,String(r))}}function ny(e){let t;const i=KS(e),r=function(e){if("form"===e.dataType){const t=new FormData;for(const i in e.data)if(Object.prototype.hasOwnProperty.call(e.data,i)){let r=e.data[i];"object"!=typeof r||r instanceof Blob||(r=JSON.stringify(r)),t.append(i,r)}return t}return"blob"===e.dataType?e.data:JSON.stringify(e.data)}(e),n=e.onRequestEnd,a={};let s=1e4,o=e.retryCount||1/0;const l="Content-Type";function u(){const e=new XMLHttpRequest;e.open("POST",i);for(const t in a)Object.prototype.hasOwnProperty.call(a,t)&&a[t]&&e.setRequestHeader(t,a[t]);return e.responseType="json",e.onload=c,e.onerror=c,e.onabort=c,e.ontimeout=c,e.send(r),e}function d(){s=Math.min(2*s,3e5),o--,t=u()}function c(i){if(!t)return;if(("timeout"===i.type||"error"===i.type&&t.readyState===XMLHttpRequest.DONE&&0===t.status)&&o>0)setTimeout(d,s);else{"undefined"!=typeof window&&window.removeEventListener("beforeunload",h);try{const i=t.response;if(i.commands){const t=i.commands.globalShutdownMs;t&&ry("all",t);const r=i.commands.featureShutdownMs;r&&e.onMute(r)}}catch(e){}n&&n()}}function h(){if(navigator.sendBeacon)if(t&&t.abort(),"string"==typeof r||r instanceof Blob){const e=a[l];navigator.sendBeacon(i,new Blob([r],e?{type:e}:void 0))}else navigator.sendBeacon(i,r);else t||(t=u())}"json"===e.dataType?a[l]="application/json;charset=utf-8":"blob"===e.dataType&&(a[l]="application/octet-stream"),e.beforeUnload?h():("undefined"!=typeof window&&window.addEventListener("beforeunload",h),t=u())}var ay,sy={},oy={},ly={},uy={},dy={};ay=dy,Object.defineProperty(ay,"__esModule",{value:!0}),ay.TracesSamplerValues=void 0,function(e){e.AlwaysOff="always_off",e.AlwaysOn="always_on",e.ParentBasedAlwaysOff="parentbased_always_off",e.ParentBasedAlwaysOn="parentbased_always_on",e.ParentBasedTraceIdRatio="parentbased_traceidratio",e.TraceIdRatio="traceidratio"}(ay.TracesSamplerValues||(ay.TracesSamplerValues={})),function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.parseEnvironment=e.DEFAULT_ENVIRONMENT=e.DEFAULT_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT=e.DEFAULT_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT=e.DEFAULT_ATTRIBUTE_COUNT_LIMIT=e.DEFAULT_ATTRIBUTE_VALUE_LENGTH_LIMIT=void 0;const t=$S,i=dy,r=["OTEL_SDK_DISABLED"];function n(e){return r.indexOf(e)>-1}const a=["OTEL_BSP_EXPORT_TIMEOUT","OTEL_BSP_MAX_EXPORT_BATCH_SIZE","OTEL_BSP_MAX_QUEUE_SIZE","OTEL_BSP_SCHEDULE_DELAY","OTEL_BLRP_EXPORT_TIMEOUT","OTEL_BLRP_MAX_EXPORT_BATCH_SIZE","OTEL_BLRP_MAX_QUEUE_SIZE","OTEL_BLRP_SCHEDULE_DELAY","OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT","OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_EVENT_COUNT_LIMIT","OTEL_SPAN_LINK_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT","OTEL_EXPORTER_OTLP_TIMEOUT","OTEL_EXPORTER_OTLP_TRACES_TIMEOUT","OTEL_EXPORTER_OTLP_METRICS_TIMEOUT","OTEL_EXPORTER_OTLP_LOGS_TIMEOUT","OTEL_EXPORTER_JAEGER_AGENT_PORT"];function s(e){return a.indexOf(e)>-1}const o=["OTEL_NO_PATCH_MODULES","OTEL_PROPAGATORS"];function l(e){return o.indexOf(e)>-1}function u(e,t,i){if(void 0===i[e])return;const r=String(i[e]);t[e]="true"===r.toLowerCase()}function d(e,t,i,r=-1/0,n=1/0){if(void 0!==i[e]){const a=Number(i[e]);isNaN(a)||(t[e]=a<r?r:a>n?n:a)}}function c(e,t,i,r=","){const n=i[e];"string"==typeof n&&(t[e]=n.split(r).map((e=>e.trim())))}e.DEFAULT_ATTRIBUTE_VALUE_LENGTH_LIMIT=1/0,e.DEFAULT_ATTRIBUTE_COUNT_LIMIT=128,e.DEFAULT_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT=128,e.DEFAULT_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT=128,e.DEFAULT_ENVIRONMENT={OTEL_SDK_DISABLED:!1,CONTAINER_NAME:"",ECS_CONTAINER_METADATA_URI_V4:"",ECS_CONTAINER_METADATA_URI:"",HOSTNAME:"",KUBERNETES_SERVICE_HOST:"",NAMESPACE:"",OTEL_BSP_EXPORT_TIMEOUT:3e4,OTEL_BSP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BSP_MAX_QUEUE_SIZE:2048,OTEL_BSP_SCHEDULE_DELAY:5e3,OTEL_BLRP_EXPORT_TIMEOUT:3e4,OTEL_BLRP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BLRP_MAX_QUEUE_SIZE:2048,OTEL_BLRP_SCHEDULE_DELAY:5e3,OTEL_EXPORTER_JAEGER_AGENT_HOST:"",OTEL_EXPORTER_JAEGER_AGENT_PORT:6832,OTEL_EXPORTER_JAEGER_ENDPOINT:"",OTEL_EXPORTER_JAEGER_PASSWORD:"",OTEL_EXPORTER_JAEGER_USER:"",OTEL_EXPORTER_OTLP_ENDPOINT:"",OTEL_EXPORTER_OTLP_TRACES_ENDPOINT:"",OTEL_EXPORTER_OTLP_METRICS_ENDPOINT:"",OTEL_EXPORTER_OTLP_LOGS_ENDPOINT:"",OTEL_EXPORTER_OTLP_HEADERS:"",OTEL_EXPORTER_OTLP_TRACES_HEADERS:"",OTEL_EXPORTER_OTLP_METRICS_HEADERS:"",OTEL_EXPORTER_OTLP_LOGS_HEADERS:"",OTEL_EXPORTER_OTLP_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_TRACES_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_METRICS_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_LOGS_TIMEOUT:1e4,OTEL_EXPORTER_ZIPKIN_ENDPOINT:"http://localhost:9411/api/v2/spans",OTEL_LOG_LEVEL:t.DiagLogLevel.INFO,OTEL_NO_PATCH_MODULES:[],OTEL_PROPAGATORS:["tracecontext","baggage"],OTEL_RESOURCE_ATTRIBUTES:"",OTEL_SERVICE_NAME:"",OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT:e.DEFAULT_ATTRIBUTE_VALUE_LENGTH_LIMIT,OTEL_ATTRIBUTE_COUNT_LIMIT:e.DEFAULT_ATTRIBUTE_COUNT_LIMIT,OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT:e.DEFAULT_ATTRIBUTE_VALUE_LENGTH_LIMIT,OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT:e.DEFAULT_ATTRIBUTE_COUNT_LIMIT,OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT:e.DEFAULT_ATTRIBUTE_VALUE_LENGTH_LIMIT,OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT:e.DEFAULT_ATTRIBUTE_COUNT_LIMIT,OTEL_SPAN_EVENT_COUNT_LIMIT:128,OTEL_SPAN_LINK_COUNT_LIMIT:128,OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT:e.DEFAULT_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT,OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT:e.DEFAULT_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT,OTEL_TRACES_EXPORTER:"",OTEL_TRACES_SAMPLER:i.TracesSamplerValues.ParentBasedAlwaysOn,OTEL_TRACES_SAMPLER_ARG:"",OTEL_LOGS_EXPORTER:"",OTEL_EXPORTER_OTLP_INSECURE:"",OTEL_EXPORTER_OTLP_TRACES_INSECURE:"",OTEL_EXPORTER_OTLP_METRICS_INSECURE:"",OTEL_EXPORTER_OTLP_LOGS_INSECURE:"",OTEL_EXPORTER_OTLP_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_LOGS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_COMPRESSION:"",OTEL_EXPORTER_OTLP_TRACES_COMPRESSION:"",OTEL_EXPORTER_OTLP_METRICS_COMPRESSION:"",OTEL_EXPORTER_OTLP_LOGS_COMPRESSION:"",OTEL_EXPORTER_OTLP_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_LOGS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_LOGS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_TRACES_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_LOGS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_TEMPORALITY_PREFERENCE:"cumulative"};const h={ALL:t.DiagLogLevel.ALL,VERBOSE:t.DiagLogLevel.VERBOSE,DEBUG:t.DiagLogLevel.DEBUG,INFO:t.DiagLogLevel.INFO,WARN:t.DiagLogLevel.WARN,ERROR:t.DiagLogLevel.ERROR,NONE:t.DiagLogLevel.NONE};function p(e,t,i){const r=i[e];if("string"==typeof r){const i=h[r.toUpperCase()];null!=i&&(t[e]=i)}}e.parseEnvironment=function(t){const i={};for(const r in e.DEFAULT_ENVIRONMENT){const e=r;if("OTEL_LOG_LEVEL"===e)p(e,i,t);else if(n(e))u(e,i,t);else if(s(e))d(e,i,t);else if(l(e))c(e,i,t);else{const r=t[e];null!=r&&(i[e]=String(r))}}return i}}(uy);var cy={};Object.defineProperty(cy,"__esModule",{value:!0}),cy._globalThis=void 0,cy._globalThis="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof NS?NS:{},Object.defineProperty(ly,"__esModule",{value:!0}),ly.getEnvWithoutDefaults=ly.getEnv=void 0;const hy=uy,py=cy;ly.getEnv=function(){const e=(0,hy.parseEnvironment)(py._globalThis);return Object.assign({},hy.DEFAULT_ENVIRONMENT,e)},ly.getEnvWithoutDefaults=function(){return(0,hy.parseEnvironment)(py._globalThis)};var fy={},my={};function gy(e){return e>=48&&e<=57?e-48:e>=97&&e<=102?e-87:e-55}Object.defineProperty(my,"__esModule",{value:!0}),my.hexToBinary=void 0,my.hexToBinary=function(e){const t=new Uint8Array(e.length/2);let i=0;for(let r=0;r<e.length;r+=2){const n=gy(e.charCodeAt(r)),a=gy(e.charCodeAt(r+1));t[i++]=n<<4|a}return t},Object.defineProperty(fy,"__esModule",{value:!0}),fy.hexToBase64=void 0;const vy=my;fy.hexToBase64=function(e){return btoa(String.fromCharCode(...(0,vy.hexToBinary)(e)))};var Sy={};Object.defineProperty(Sy,"__esModule",{value:!0}),Sy.RandomIdGenerator=void 0;Sy.RandomIdGenerator=class{constructor(){this.generateTraceId=Ty(16),this.generateSpanId=Ty(8)}};const yy=Array(32);function Ty(e){return function(){for(let t=0;t<2*e;t++)yy[t]=Math.floor(16*Math.random())+48,yy[t]>=58&&(yy[t]+=39);return String.fromCharCode.apply(null,yy.slice(0,2*e))}}var Ey={};Object.defineProperty(Ey,"__esModule",{value:!0}),Ey.otperformance=void 0,Ey.otperformance=performance;var by={},_y={};Object.defineProperty(_y,"__esModule",{value:!0}),_y.VERSION=void 0,_y.VERSION="1.26.0",Object.defineProperty(by,"__esModule",{value:!0}),by.SDK_INFO=void 0;const Ay=_y,Ry=VS;by.SDK_INFO={[Ry.SEMRESATTRS_TELEMETRY_SDK_NAME]:"opentelemetry",[Ry.SEMRESATTRS_PROCESS_RUNTIME_NAME]:"browser",[Ry.SEMRESATTRS_TELEMETRY_SDK_LANGUAGE]:Ry.TELEMETRYSDKLANGUAGEVALUES_WEBJS,[Ry.SEMRESATTRS_TELEMETRY_SDK_VERSION]:Ay.VERSION};var wy={};Object.defineProperty(wy,"__esModule",{value:!0}),wy.unrefTimer=void 0,wy.unrefTimer=function(e){},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.unrefTimer=e.SDK_INFO=e.otperformance=e.RandomIdGenerator=e.hexToBase64=e._globalThis=e.getEnv=e.getEnvWithoutDefaults=void 0;var t=ly;Object.defineProperty(e,"getEnvWithoutDefaults",{enumerable:!0,get:function(){return t.getEnvWithoutDefaults}}),Object.defineProperty(e,"getEnv",{enumerable:!0,get:function(){return t.getEnv}});var i=cy;Object.defineProperty(e,"_globalThis",{enumerable:!0,get:function(){return i._globalThis}});var r=fy;Object.defineProperty(e,"hexToBase64",{enumerable:!0,get:function(){return r.hexToBase64}});var n=Sy;Object.defineProperty(e,"RandomIdGenerator",{enumerable:!0,get:function(){return n.RandomIdGenerator}});var a=Ey;Object.defineProperty(e,"otperformance",{enumerable:!0,get:function(){return a.otperformance}});var s=by;Object.defineProperty(e,"SDK_INFO",{enumerable:!0,get:function(){return s.SDK_INFO}});var o=wy;Object.defineProperty(e,"unrefTimer",{enumerable:!0,get:function(){return o.unrefTimer}})}(oy),Object.defineProperty(sy,"__esModule",{value:!0}),sy.addHrTimes=sy.isTimeInput=sy.isTimeInputHrTime=sy.hrTimeToMicroseconds=sy.hrTimeToMilliseconds=My=sy.hrTimeToNanoseconds=sy.hrTimeToTimeStamp=sy.hrTimeDuration=sy.timeInputToHrTime=sy.hrTime=sy.getTimeOrigin=sy.millisToHrTime=void 0;const Py=oy,Oy=Math.pow(10,6),Cy=Math.pow(10,9);function Ly(e){const t=e/1e3;return[Math.trunc(t),Math.round(e%1e3*Oy)]}function Iy(){let e=Py.otperformance.timeOrigin;if("number"!=typeof e){const t=Py.otperformance;e=t.timing&&t.timing.fetchStart}return e}function xy(e){return Dy(Ly(Iy()),Ly("number"==typeof e?e:Py.otperformance.now()))}sy.millisToHrTime=Ly,sy.getTimeOrigin=Iy,sy.hrTime=xy,sy.timeInputToHrTime=function(e){if(Ny(e))return e;if("number"==typeof e)return e<Iy()?xy(e):Ly(e);if(e instanceof Date)return Ly(e.getTime());throw TypeError("Invalid input type")},sy.hrTimeDuration=function(e,t){let i=t[0]-e[0],r=t[1]-e[1];return r<0&&(i-=1,r+=Cy),[i,r]},sy.hrTimeToTimeStamp=function(e){const t=`${"0".repeat(9)}${e[1]}Z`,i=t.substr(t.length-9-1);return new Date(1e3*e[0]).toISOString().replace("000Z",i)};var My=sy.hrTimeToNanoseconds=function(e){return e[0]*Cy+e[1]};function Ny(e){return Array.isArray(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]}function Dy(e,t){const i=[e[0]+t[0],e[1]+t[1]];return i[1]>=Cy&&(i[1]-=Cy,i[0]+=1),i}sy.hrTimeToMilliseconds=function(e){return 1e3*e[0]+e[1]/1e6},sy.hrTimeToMicroseconds=function(e){return 1e6*e[0]+e[1]/1e3},sy.isTimeInputHrTime=Ny,sy.isTimeInput=function(e){return Ny(e)||"number"==typeof e||e instanceof Date},sy.addHrTimes=Dy;class ky{constructor(e){this.data={resourceSpans:[]},this.scopeSpansByResource=new Map,this.spansByResourceAndInstrumentation=new Map,e&&this.addSpans(e)}clear(){this.data={resourceSpans:[]},this.scopeSpansByResource.clear(),this.spansByResourceAndInstrumentation.forEach((function(e){e.clear()})),this.spansByResourceAndInstrumentation.clear()}getData(){return this.data}addSpan(e){this.getSpansFromMap(e).push(function(e){const t={traceId:e.spanContext().traceId,spanId:e.spanContext().spanId,parentSpanId:e.parentSpanId,name:e.name,startTimeUnixNano:String(My(e.startTime)),endTimeUnixNano:e.ended?String(My(e.endTime)):void 0,ended:e.ended,kind:e.kind,events:e.events.map(Uy),links:e.links,status:e.status,droppedEventsCount:e.droppedEventsCount,droppedLinksCount:e.droppedLinksCount,attributes:$y(e.attributes)};return t}(e))}addSpans(e){for(let t=0,i=e.length;t<i;t++)this.addSpan(e[t])}getSpansFromMap(e){let t=this.spansByResourceAndInstrumentation.get(e.resource);t||(t=new Map,this.spansByResourceAndInstrumentation.set(e.resource,t));let i=t.get(e.instrumentationLibrary);return i||(i=[],t.set(e.instrumentationLibrary,i),this.getScopeSpansFormMap(e).push({scope:Object.assign({},e.instrumentationLibrary),spans:i})),i}getScopeSpansFormMap(e){let t=this.scopeSpansByResource.get(e.resource);if(!t){const i=$y(e.resource.attributes),r={};i&&i.length&&(r.attributes=i),t=[],this.scopeSpansByResource.set(e.resource,t),this.data.resourceSpans.push({resource:r,scopeSpans:t})}return t}}function $y(e){if(!e)return;const t=[];for(const i in e){const r=e[i];t.push({key:i,value:Vy(r)})}return t}function Vy(e){return null==e?{anyValue:e}:"string"==typeof e?{stringValue:e}:"number"==typeof e?{doubleValue:e}:"boolean"==typeof e?{booleanValue:e}:{arrayValue:{values:e.map(Vy)}}}function Uy(e){return{timeUnixNano:My(e.time),name:e.name,attributes:$y(e.attributes),droppedAttributesCount:e.droppedAttributesCount}}function By(e){const t=new ky(e),i=t.getData();return t.clear(),i}function Fy(e){let t=ey[e];return void 0===t&&(ey[e]=t=iy(e)),!!t&&(Date.now()<t||(function(e){ey[e]=null,ZS().removeItem(ty(e))}(e),!1))}class Hy{constructor(e){this.apiHost=e.apiHost,this.appToken=e.appToken}export(e,t){var i,r;(i="otelTrace",Fy("all")||Fy(i))?t({code:Bg.FAILED}):(r={apiHost:this.apiHost,apiUrl:"/api/otel/trace",queryParams:{crashToken:this.appToken,clientTimeUnixNano:YS()},dataType:"json",data:By(e),onMute:ry.bind(null,"otelTrace")},"undefined"!=typeof window&&ny(r),t({code:Bg.SUCCESS}))}shutdown(){return this.forceFlush()}forceFlush(){return Promise.resolve()}}var jy={};Object.defineProperty(jy,"__esModule",{value:!0});var Gy=jy.BatchSpanProcessorBase=void 0;const qy=$S,zy=US;Gy=jy.BatchSpanProcessorBase=class{constructor(e,t){this._exporter=e,this._isExporting=!1,this._finishedSpans=[],this._droppedSpansCount=0;const i=(0,zy.getEnv)();this._maxExportBatchSize="number"==typeof(null==t?void 0:t.maxExportBatchSize)?t.maxExportBatchSize:i.OTEL_BSP_MAX_EXPORT_BATCH_SIZE,this._maxQueueSize="number"==typeof(null==t?void 0:t.maxQueueSize)?t.maxQueueSize:i.OTEL_BSP_MAX_QUEUE_SIZE,this._scheduledDelayMillis="number"==typeof(null==t?void 0:t.scheduledDelayMillis)?t.scheduledDelayMillis:i.OTEL_BSP_SCHEDULE_DELAY,this._exportTimeoutMillis="number"==typeof(null==t?void 0:t.exportTimeoutMillis)?t.exportTimeoutMillis:i.OTEL_BSP_EXPORT_TIMEOUT,this._shutdownOnce=new zy.BindOnceFuture(this._shutdown,this),this._maxExportBatchSize>this._maxQueueSize&&(qy.diag.warn("BatchSpanProcessor: maxExportBatchSize must be smaller or equal to maxQueueSize, setting maxExportBatchSize to match maxQueueSize"),this._maxExportBatchSize=this._maxQueueSize)}forceFlush(){return this._shutdownOnce.isCalled?this._shutdownOnce.promise:this._flushAll()}onStart(e,t){}onEnd(e){this._shutdownOnce.isCalled||e.spanContext().traceFlags&qy.TraceFlags.SAMPLED&&this._addToBuffer(e)}shutdown(){return this._shutdownOnce.call()}_shutdown(){return Promise.resolve().then((()=>this.onShutdown())).then((()=>this._flushAll())).then((()=>this._exporter.shutdown()))}_addToBuffer(e){if(this._finishedSpans.length>=this._maxQueueSize)return 0===this._droppedSpansCount&&qy.diag.debug("maxQueueSize reached, dropping spans"),void this._droppedSpansCount++;this._droppedSpansCount>0&&(qy.diag.warn(`Dropped ${this._droppedSpansCount} spans because maxQueueSize reached`),this._droppedSpansCount=0),this._finishedSpans.push(e),this._maybeStartTimer()}_flushAll(){return new Promise(((e,t)=>{const i=[];for(let e=0,t=Math.ceil(this._finishedSpans.length/this._maxExportBatchSize);e<t;e++)i.push(this._flushOneBatch());Promise.all(i).then((()=>{e()})).catch(t)}))}_flushOneBatch(){return this._clearTimer(),0===this._finishedSpans.length?Promise.resolve():new Promise(((e,t)=>{const i=setTimeout((()=>{t(new Error("Timeout"))}),this._exportTimeoutMillis);qy.context.with((0,zy.suppressTracing)(qy.context.active()),(()=>{let r;this._finishedSpans.length<=this._maxExportBatchSize?(r=this._finishedSpans,this._finishedSpans=[]):r=this._finishedSpans.splice(0,this._maxExportBatchSize);const n=()=>this._exporter.export(r,(r=>{var n;clearTimeout(i),r.code===zy.ExportResultCode.SUCCESS?e():t(null!==(n=r.error)&&void 0!==n?n:new Error("BatchSpanProcessor: span export failed"))}));let a=null;for(let e=0,t=r.length;e<t;e++){const t=r[e];t.resource.asyncAttributesPending&&t.resource.waitForAsyncAttributes&&(null!=a||(a=[]),a.push(t.resource.waitForAsyncAttributes()))}null===a?n():Promise.all(a).then(n,(e=>{(0,zy.globalErrorHandler)(e),t(e)}))}))}))}_maybeStartTimer(){if(this._isExporting)return;const e=()=>{this._isExporting=!0,this._flushOneBatch().finally((()=>{this._isExporting=!1,this._finishedSpans.length>0&&(this._clearTimer(),this._maybeStartTimer())})).catch((e=>{this._isExporting=!1,(0,zy.globalErrorHandler)(e)}))};if(this._finishedSpans.length>=this._maxExportBatchSize)return e();void 0===this._timer&&(this._timer=setTimeout((()=>e()),this._scheduledDelayMillis),(0,zy.unrefTimer)(this._timer))}_clearTimer(){void 0!==this._timer&&(clearTimeout(this._timer),this._timer=void 0)}};class Wy extends Gy{onShutdown(){}}class Qy{constructor(e){this.serviceName=e.serviceName||"tracer-js-sdk";const t=new wS({resource:new HS({[Hf]:this.serviceName}),spanLimits:e.spanLimits});t.addSpanProcessor(new Wy(new Hy(e),Object.assign({scheduledDelayMillis:5e3,exportTimeoutMillis:3e4,maxQueueSize:2048,maxExportBatchSize:512},e.batchProcessorBufferConfig||{}))),t.register({}),function(e){var t,i,r=e.tracerProvider||vi.getTracerProvider(),n=e.meterProvider||ni.getMeterProvider(),a=e.loggerProvider||MS.getLoggerProvider(),s=null!==(i=null===(t=e.instrumentations)||void 0===t?void 0:t.flat())&&void 0!==i?i:[];(function(e,t,i,r){for(var n=0,a=e.length;n<a;n++){var s=e[n];t&&s.setTracerProvider(t),i&&s.setMeterProvider(i),r&&s.setLoggerProvider&&s.setLoggerProvider(r),s.getConfig().enabled||s.enable()}})(s,r,n,a)}({instrumentations:e.instrumentations}),this.provider=t}getProvider(){return this.provider}getTracer(){return this.provider.getTracer(this.serviceName)}destroy(){this.provider.forceFlush(),this.provider.shutdown()}}function Yy(e){const t=function(){if("undefined"==typeof window)return{data:{},modules:{},version:"1.1.7"};const e="TracerSDK";return window[e]||(window[e]={data:{},modules:{},version:"1.1.7"}),window[e]}().data;return t[e]||(t[e]={}),t[e]}function Ky(e){return function(e,t,i){const r=Yy(e);return r[t]||(r[t]=i()),r[t]}(e.appToken,9,(function(){return new Qy(e)}))}class Xy{constructor(){this.spans=[]}getJsonData(){return By(this.spans)}clear(){this.spans=[]}export(e,t){this.spans=this.spans.concat(e),t({code:Bg.SUCCESS})}shutdown(){return this.forceFlush()}forceFlush(){return Promise.resolve()}}class Jy{constructor(e={}){this.disabled=!1,this.endedSpansExporter=e.endedSpansExporter,this.startedSpansExporter=e.startedSpansExporter}onStart(e,t){!this.disabled&&this.startedSpansExporter&&this.startedSpansExporter.export([e],this.onExport)}onEnd(e){!this.disabled&&this.endedSpansExporter&&this.endedSpansExporter.export([e],this.onExport)}onExport(e){}forceFlush(){return Promise.resolve()}shutdown(){return this.disabled=!0,Promise.resolve()}}var Zy=Object.create,eT=Object.defineProperty,tT=Object.getOwnPropertyDescriptor,iT=Object.getOwnPropertyNames,rT=Object.getPrototypeOf,nT=Object.prototype.hasOwnProperty,aT=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),sT=(e,t)=>{for(var i in t)eT(e,i,{get:t[i],enumerable:!0})},oT=(e,t,i)=>(i=null!=e?Zy(rT(e)):{},((e,t,i,r)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let n of iT(t))!nT.call(e,n)&&n!==i&&eT(e,n,{get:()=>t[n],enumerable:!(r=tT(t,n))||r.enumerable});return e})(!t&&e&&e.__esModule?i:eT(i,"default",{value:e,enumerable:!0}),e)),lT=aT(((e,t)=>{var i=function(e){return e&&e.Math===Math&&e};t.exports=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof global&&global)||i("object"==typeof e&&e)||function(){return this}()||Function("return this")()})),uT=aT(((e,t)=>{t.exports=function(e){try{return!!e()}catch(e){return!0}}})),dT=aT(((e,t)=>{var i=uT();t.exports=!i((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))})),cT=aT(((e,t)=>{var i=dT(),r=Function.prototype,n=r.apply,a=r.call;t.exports="object"==typeof Reflect&&Reflect.apply||(i?a.bind(n):function(){return a.apply(n,arguments)})})),hT=aT(((e,t)=>{var i=dT(),r=Function.prototype,n=r.call,a=i&&r.bind.bind(n,n);t.exports=i?a:function(e){return function(){return n.apply(e,arguments)}}})),pT=aT(((e,t)=>{var i=hT(),r=i({}.toString),n=i("".slice);t.exports=function(e){return n(r(e),8,-1)}})),fT=aT(((e,t)=>{var i=pT(),r=hT();t.exports=function(e){if("Function"===i(e))return r(e)}})),mT=aT(((e,t)=>{var i="object"==typeof document&&document.all;t.exports=void 0===i&&void 0!==i?function(e){return"function"==typeof e||e===i}:function(e){return"function"==typeof e}})),gT=aT(((e,t)=>{var i=uT();t.exports=!i((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))})),vT=aT(((e,t)=>{var i=dT(),r=Function.prototype.call;t.exports=i?r.bind(r):function(){return r.apply(r,arguments)}})),ST=aT((e=>{var t={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,r=i&&!t.call({1:2},1);e.f=r?function(e){var t=i(this,e);return!!t&&t.enumerable}:t})),yT=aT(((e,t)=>{t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}})),TT=aT(((e,t)=>{var i=hT(),r=uT(),n=pT(),a=Object,s=i("".split);t.exports=r((function(){return!a("z").propertyIsEnumerable(0)}))?function(e){return"String"===n(e)?s(e,""):a(e)}:a})),ET=aT(((e,t)=>{t.exports=function(e){return null==e}})),bT=aT(((e,t)=>{var i=ET(),r=TypeError;t.exports=function(e){if(i(e))throw new r("Can't call method on "+e);return e}})),_T=aT(((e,t)=>{var i=TT(),r=bT();t.exports=function(e){return i(r(e))}})),AT=aT(((e,t)=>{var i=mT();t.exports=function(e){return"object"==typeof e?null!==e:i(e)}})),RT=aT(((e,t)=>{t.exports={}})),wT=aT(((e,t)=>{var i=RT(),r=lT(),n=mT(),a=function(e){return n(e)?e:void 0};t.exports=function(e,t){return arguments.length<2?a(i[e])||a(r[e]):i[e]&&i[e][t]||r[e]&&r[e][t]}})),PT=aT(((e,t)=>{var i=hT();t.exports=i({}.isPrototypeOf)})),OT=aT(((e,t)=>{var i=lT().navigator,r=i&&i.userAgent;t.exports=r?String(r):""})),CT=aT(((e,t)=>{var i,r,n=lT(),a=OT(),s=n.process,o=n.Deno,l=s&&s.versions||o&&o.version,u=l&&l.v8;u&&(r=(i=u.split("."))[0]>0&&i[0]<4?1:+(i[0]+i[1])),!r&&a&&((!(i=a.match(/Edge\/(\d+)/))||i[1]>=74)&&((i=a.match(/Chrome\/(\d+)/))&&(r=+i[1]))),t.exports=r})),LT=aT(((e,t)=>{var i=CT(),r=uT(),n=lT().String;t.exports=!!Object.getOwnPropertySymbols&&!r((function(){var e=Symbol("symbol detection");return!n(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&i&&i<41}))})),IT=aT(((e,t)=>{var i=LT();t.exports=i&&!Symbol.sham&&"symbol"==typeof Symbol.iterator})),xT=aT(((e,t)=>{var i=wT(),r=mT(),n=PT(),a=IT(),s=Object;t.exports=a?function(e){return"symbol"==typeof e}:function(e){var t=i("Symbol");return r(t)&&n(t.prototype,s(e))}})),MT=aT(((e,t)=>{var i=String;t.exports=function(e){try{return i(e)}catch(e){return"Object"}}})),NT=aT(((e,t)=>{var i=mT(),r=MT(),n=TypeError;t.exports=function(e){if(i(e))return e;throw new n(r(e)+" is not a function")}})),DT=aT(((e,t)=>{var i=NT(),r=ET();t.exports=function(e,t){var n=e[t];return r(n)?void 0:i(n)}})),kT=aT(((e,t)=>{var i=vT(),r=mT(),n=AT(),a=TypeError;t.exports=function(e,t){var s,o;if("string"===t&&r(s=e.toString)&&!n(o=i(s,e))||r(s=e.valueOf)&&!n(o=i(s,e))||"string"!==t&&r(s=e.toString)&&!n(o=i(s,e)))return o;throw new a("Can't convert object to primitive value")}})),$T=aT(((e,t)=>{t.exports=!0})),VT=aT(((e,t)=>{var i=lT(),r=Object.defineProperty;t.exports=function(e,t){try{r(i,e,{value:t,configurable:!0,writable:!0})}catch(r){i[e]=t}return t}})),UT=aT(((e,t)=>{var i=$T(),r=lT(),n=VT(),a="__core-js_shared__",s=t.exports=r[a]||n(a,{});(s.versions||(s.versions=[])).push({version:"3.38.0",mode:i?"pure":"global",copyright:"© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.38.0/LICENSE",source:"https://github.com/zloirock/core-js"})})),BT=aT(((e,t)=>{var i=UT();t.exports=function(e,t){return i[e]||(i[e]=t||{})}})),FT=aT(((e,t)=>{var i=bT(),r=Object;t.exports=function(e){return r(i(e))}})),HT=aT(((e,t)=>{var i=hT(),r=FT(),n=i({}.hasOwnProperty);t.exports=Object.hasOwn||function(e,t){return n(r(e),t)}})),jT=aT(((e,t)=>{var i=hT(),r=0,n=Math.random(),a=i(1..toString);t.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+a(++r+n,36)}})),GT=aT(((e,t)=>{var i=lT(),r=BT(),n=HT(),a=jT(),s=LT(),o=IT(),l=i.Symbol,u=r("wks"),d=o?l.for||l:l&&l.withoutSetter||a;t.exports=function(e){return n(u,e)||(u[e]=s&&n(l,e)?l[e]:d("Symbol."+e)),u[e]}})),qT=aT(((e,t)=>{var i=vT(),r=AT(),n=xT(),a=DT(),s=kT(),o=GT(),l=TypeError,u=o("toPrimitive");t.exports=function(e,t){if(!r(e)||n(e))return e;var o,d=a(e,u);if(d){if(void 0===t&&(t="default"),o=i(d,e,t),!r(o)||n(o))return o;throw new l("Can't convert object to primitive value")}return void 0===t&&(t="number"),s(e,t)}})),zT=aT(((e,t)=>{var i=qT(),r=xT();t.exports=function(e){var t=i(e,"string");return r(t)?t:t+""}})),WT=aT(((e,t)=>{var i=lT(),r=AT(),n=i.document,a=r(n)&&r(n.createElement);t.exports=function(e){return a?n.createElement(e):{}}})),QT=aT(((e,t)=>{var i=gT(),r=uT(),n=WT();t.exports=!i&&!r((function(){return 7!==Object.defineProperty(n("div"),"a",{get:function(){return 7}}).a}))})),YT=aT((e=>{var t=gT(),i=vT(),r=ST(),n=yT(),a=_T(),s=zT(),o=HT(),l=QT(),u=Object.getOwnPropertyDescriptor;e.f=t?u:function(e,t){if(e=a(e),t=s(t),l)try{return u(e,t)}catch(e){}if(o(e,t))return n(!i(r.f,e,t),e[t])}})),KT=aT(((e,t)=>{var i=uT(),r=mT(),n=/#|\.prototype\./,a=function(e,t){var n=o[s(e)];return n===u||n!==l&&(r(t)?i(t):!!t)},s=a.normalize=function(e){return String(e).replace(n,".").toLowerCase()},o=a.data={},l=a.NATIVE="N",u=a.POLYFILL="P";t.exports=a})),XT=aT(((e,t)=>{var i=fT(),r=NT(),n=dT(),a=i(i.bind);t.exports=function(e,t){return r(e),void 0===t?e:n?a(e,t):function(){return e.apply(t,arguments)}}})),JT=aT(((e,t)=>{var i=gT(),r=uT();t.exports=i&&r((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))})),ZT=aT(((e,t)=>{var i=AT(),r=String,n=TypeError;t.exports=function(e){if(i(e))return e;throw new n(r(e)+" is not an object")}})),eE=aT((e=>{var t=gT(),i=QT(),r=JT(),n=ZT(),a=zT(),s=TypeError,o=Object.defineProperty,l=Object.getOwnPropertyDescriptor,u="enumerable",d="configurable",c="writable";e.f=t?r?function(e,t,i){if(n(e),t=a(t),n(i),"function"==typeof e&&"prototype"===t&&"value"in i&&c in i&&!i[c]){var r=l(e,t);r&&r[c]&&(e[t]=i.value,i={configurable:d in i?i[d]:r[d],enumerable:u in i?i[u]:r[u],writable:!1})}return o(e,t,i)}:o:function(e,t,r){if(n(e),t=a(t),n(r),i)try{return o(e,t,r)}catch(e){}if("get"in r||"set"in r)throw new s("Accessors not supported");return"value"in r&&(e[t]=r.value),e}})),tE=aT(((e,t)=>{var i=gT(),r=eE(),n=yT();t.exports=i?function(e,t,i){return r.f(e,t,n(1,i))}:function(e,t,i){return e[t]=i,e}})),iE=aT(((e,t)=>{var i=lT(),r=cT(),n=fT(),a=mT(),s=YT().f,o=KT(),l=RT(),u=XT(),d=tE(),c=HT();UT();var h=function(e){var t=function(i,n,a){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(i);case 2:return new e(i,n)}return new e(i,n,a)}return r(e,this,arguments)};return t.prototype=e.prototype,t};t.exports=function(e,t){var r,p,f,m,g,v,S,y,T,E=e.target,b=e.global,_=e.stat,A=e.proto,R=b?i:_?i[E]:i[E]&&i[E].prototype,w=b?l:l[E]||d(l,E,{})[E],P=w.prototype;for(m in t)p=!(r=o(b?m:E+(_?".":"#")+m,e.forced))&&R&&c(R,m),v=w[m],p&&(e.dontCallGetSet?S=(T=s(R,m))&&T.value:S=R[m]),g=p&&S?S:t[m],(r||A||typeof v!=typeof g)&&(y=e.bind&&p?u(g,i):e.wrap&&p?h(g):A&&a(g)?n(g):g,(e.sham||g&&g.sham||v&&v.sham)&&d(y,"sham",!0),d(w,m,y),A&&(c(l,f=E+"Prototype")||d(l,f,{}),d(l[f],m,g),e.real&&P&&(r||!P[m])&&d(P,m,g)))}})),rE=aT(((e,t)=>{var i=Math.ceil,r=Math.floor;t.exports=Math.trunc||function(e){var t=+e;return(t>0?r:i)(t)}})),nE=aT(((e,t)=>{var i=rE();t.exports=function(e){var t=+e;return t!=t||0===t?0:i(t)}})),aE=aT(((e,t)=>{var i=nE(),r=Math.min;t.exports=function(e){var t=i(e);return t>0?r(t,9007199254740991):0}})),sE=aT(((e,t)=>{var i=aE();t.exports=function(e){return i(e.length)}})),oE=aT(((e,t)=>{t.exports=function(){}})),lE=aT((()=>{var e=iE(),t=FT(),i=sE(),r=nE(),n=oE();e({target:"Array",proto:!0},{at:function(e){var n=t(this),a=i(n),s=r(e),o=s>=0?s:a+s;return o<0||o>=a?void 0:n[o]}}),n("at")})),uE=aT(((e,t)=>{var i=wT();t.exports=i})),dE=aT(((e,t)=>{lE();var i=uE();t.exports=i("Array","at")})),cE=aT(((e,t)=>{var i=dE();t.exports=i})),hE=aT(((e,t)=>{var i=cE();t.exports=i})),pE=aT(((e,t)=>{var i=BT(),r=jT(),n=i("keys");t.exports=function(e){return n[e]||(n[e]=r(e))}})),fE=aT(((e,t)=>{var i=uT();t.exports=!i((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))})),mE=aT(((e,t)=>{var i=HT(),r=mT(),n=FT(),a=pE(),s=fE(),o=a("IE_PROTO"),l=Object,u=l.prototype;t.exports=s?l.getPrototypeOf:function(e){var t=n(e);if(i(t,o))return t[o];var a=t.constructor;return r(a)&&t instanceof a?a.prototype:t instanceof l?u:null}})),gE=aT(((e,t)=>{var i=nE(),r=Math.max,n=Math.min;t.exports=function(e,t){var a=i(e);return a<0?r(a+t,0):n(a,t)}})),vE=aT(((e,t)=>{var i=_T(),r=gE(),n=sE(),a=function(e){return function(t,a,s){var o=i(t),l=n(o);if(0===l)return!e&&-1;var u,d=r(s,l);if(e&&a!=a){for(;l>d;)if((u=o[d++])!=u)return!0}else for(;l>d;d++)if((e||d in o)&&o[d]===a)return e||d||0;return!e&&-1}};t.exports={includes:a(!0),indexOf:a(!1)}})),SE=aT(((e,t)=>{t.exports={}})),yE=aT(((e,t)=>{var i=hT(),r=HT(),n=_T(),a=vE().indexOf,s=SE(),o=i([].push);t.exports=function(e,t){var i,l=n(e),u=0,d=[];for(i in l)!r(s,i)&&r(l,i)&&o(d,i);for(;t.length>u;)r(l,i=t[u++])&&(~a(d,i)||o(d,i));return d}})),TE=aT(((e,t)=>{t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]})),EE=aT(((e,t)=>{var i=yE(),r=TE();t.exports=Object.keys||function(e){return i(e,r)}})),bE=aT(((e,t)=>{var i=gT(),r=uT(),n=hT(),a=mE(),s=EE(),o=_T(),l=n(ST().f),u=n([].push),d=i&&r((function(){var e=Object.create(null);return e[2]=2,!l(e,2)})),c=function(e){return function(t){for(var r,n=o(t),c=s(n),h=d&&null===a(n),p=c.length,f=0,m=[];p>f;)r=c[f++],(!i||(h?r in n:l(n,r)))&&u(m,e?[r,n[r]]:n[r]);return m}};t.exports={entries:c(!0),values:c(!1)}})),_E=aT((()=>{var e=iE(),t=bE().entries;e({target:"Object",stat:!0},{entries:function(e){return t(e)}})})),AE=aT(((e,t)=>{_E();var i=RT();t.exports=i.Object.entries})),RE=aT(((e,t)=>{var i=AE();t.exports=i})),wE=aT(((e,t)=>{var i=RE();t.exports=i})),PE=aT((()=>{var e=iE(),t=vE().includes,i=uT(),r=oE();e({target:"Array",proto:!0,forced:i((function(){return!Array(1).includes()}))},{includes:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}}),r("includes")})),OE=aT(((e,t)=>{PE();var i=uE();t.exports=i("Array","includes")})),CE=aT(((e,t)=>{var i=OE();t.exports=i})),LE=aT(((e,t)=>{var i=CE();t.exports=i})),IE=aT(((e,t)=>{t.exports={}})),xE=aT(((e,t)=>{var i=lT(),r=mT(),n=i.WeakMap;t.exports=r(n)&&/native code/.test(String(n))})),ME=aT(((e,t)=>{var i,r,n,a,s,o=xE(),l=lT(),u=AT(),d=tE(),c=HT(),h=UT(),p=pE(),f=SE(),m="Object already initialized",g=l.TypeError,v=l.WeakMap;o||h.state?((a=h.state||(h.state=new v)).get=a.get,a.has=a.has,a.set=a.set,i=function(e,t){if(a.has(e))throw new g(m);return t.facade=e,a.set(e,t),t},r=function(e){return a.get(e)||{}},n=function(e){return a.has(e)}):(f[s=p("state")]=!0,i=function(e,t){if(c(e,s))throw new g(m);return t.facade=e,d(e,s,t),t},r=function(e){return c(e,s)?e[s]:{}},n=function(e){return c(e,s)}),t.exports={set:i,get:r,has:n,enforce:function(e){return n(e)?r(e):i(e,{})},getterFor:function(e){return function(t){var i;if(!u(t)||(i=r(t)).type!==e)throw new g("Incompatible receiver, "+e+" required");return i}}}})),NE=aT(((e,t)=>{var i=gT(),r=HT(),n=Function.prototype,a=i&&Object.getOwnPropertyDescriptor,s=r(n,"name"),o=s&&"something"===function(){}.name,l=s&&(!i||i&&a(n,"name").configurable);t.exports={EXISTS:s,PROPER:o,CONFIGURABLE:l}})),DE=aT((e=>{var t=gT(),i=JT(),r=eE(),n=ZT(),a=_T(),s=EE();e.f=t&&!i?Object.defineProperties:function(e,t){n(e);for(var i,o=a(t),l=s(t),u=l.length,d=0;u>d;)r.f(e,i=l[d++],o[i]);return e}})),kE=aT(((e,t)=>{var i=wT();t.exports=i("document","documentElement")})),$E=aT(((e,t)=>{var i,r=ZT(),n=DE(),a=TE(),s=SE(),o=kE(),l=WT(),u=pE(),d="prototype",c="script",h=u("IE_PROTO"),p=function(){},f=function(e){return"<"+c+">"+e+"</"+c+">"},m=function(e){e.write(f("")),e.close();var t=e.parentWindow.Object;return e=null,t},g=function(){try{i=new ActiveXObject("htmlfile")}catch(e){}g="undefined"!=typeof document?document.domain&&i?m(i):function(){var e,t=l("iframe"),i="java"+c+":";return t.style.display="none",o.appendChild(t),t.src=String(i),(e=t.contentWindow.document).open(),e.write(f("document.F=Object")),e.close(),e.F}():m(i);for(var e=a.length;e--;)delete g[d][a[e]];return g()};s[h]=!0,t.exports=Object.create||function(e,t){var i;return null!==e?(p[d]=r(e),i=new p,p[d]=null,i[h]=e):i=g(),void 0===t?i:n.f(i,t)}})),VE=aT(((e,t)=>{var i=tE();t.exports=function(e,t,r,n){return n&&n.enumerable?e[t]=r:i(e,t,r),e}})),UE=aT(((e,t)=>{var i,r,n,a=uT(),s=mT(),o=AT(),l=$E(),u=mE(),d=VE(),c=GT(),h=$T(),p=c("iterator"),f=!1;[].keys&&("next"in(n=[].keys())?(r=u(u(n)))!==Object.prototype&&(i=r):f=!0),!o(i)||a((function(){var e={};return i[p].call(e)!==e}))?i={}:h&&(i=l(i)),s(i[p])||d(i,p,(function(){return this})),t.exports={IteratorPrototype:i,BUGGY_SAFARI_ITERATORS:f}})),BE=aT(((e,t)=>{var i={};i[GT()("toStringTag")]="z",t.exports="[object z]"===String(i)})),FE=aT(((e,t)=>{var i=BE(),r=mT(),n=pT(),a=GT()("toStringTag"),s=Object,o="Arguments"===n(function(){return arguments}());t.exports=i?n:function(e){var t,i,l;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t]}catch(e){}}(t=s(e),a))?i:o?n(t):"Object"===(l=n(t))&&r(t.callee)?"Arguments":l}})),HE=aT(((e,t)=>{var i=BE(),r=FE();t.exports=i?{}.toString:function(){return"[object "+r(this)+"]"}})),jE=aT(((e,t)=>{var i=BE(),r=eE().f,n=tE(),a=HT(),s=HE(),o=GT()("toStringTag");t.exports=function(e,t,l,u){var d=l?e:e&&e.prototype;d&&(a(d,o)||r(d,o,{configurable:!0,value:t}),u&&!i&&n(d,"toString",s))}})),GE=aT(((e,t)=>{var i=UE().IteratorPrototype,r=$E(),n=yT(),a=jE(),s=IE(),o=function(){return this};t.exports=function(e,t,l,u){var d=t+" Iterator";return e.prototype=r(i,{next:n(+!u,l)}),a(e,d,!1,!0),s[d]=o,e}})),qE=aT(((e,t)=>{var i=hT(),r=NT();t.exports=function(e,t,n){try{return i(r(Object.getOwnPropertyDescriptor(e,t)[n]))}catch(e){}}})),zE=aT(((e,t)=>{var i=AT();t.exports=function(e){return i(e)||null===e}})),WE=aT(((e,t)=>{var i=zE(),r=String,n=TypeError;t.exports=function(e){if(i(e))return e;throw new n("Can't set "+r(e)+" as a prototype")}})),QE=aT(((e,t)=>{var i=qE(),r=AT(),n=bT(),a=WE();t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,s={};try{(e=i(Object.prototype,"__proto__","set"))(s,[]),t=s instanceof Array}catch(e){}return function(i,s){return n(i),a(s),r(i)&&(t?e(i,s):i.__proto__=s),i}}():void 0)})),YE=aT(((e,t)=>{var i=iE(),r=vT(),n=$T(),a=NE(),s=mT(),o=GE(),l=mE(),u=QE(),d=jE(),c=tE(),h=VE(),p=GT(),f=IE(),m=UE(),g=a.PROPER,v=a.CONFIGURABLE,S=m.IteratorPrototype,y=m.BUGGY_SAFARI_ITERATORS,T=p("iterator"),E="keys",b="values",_="entries",A=function(){return this};t.exports=function(e,t,a,p,m,R,w){o(a,t,p);var P,O,C,L=function(e){if(e===m&&D)return D;if(!y&&e&&e in M)return M[e];switch(e){case E:case b:case _:return function(){return new a(this,e)}}return function(){return new a(this)}},I=t+" Iterator",x=!1,M=e.prototype,N=M[T]||M["@@iterator"]||m&&M[m],D=!y&&N||L(m),k="Array"===t&&M.entries||N;if(k&&((P=l(k.call(new e)))!==Object.prototype&&P.next&&(!n&&l(P)!==S&&(u?u(P,S):s(P[T])||h(P,T,A)),d(P,I,!0,!0),n&&(f[I]=A))),g&&m===b&&N&&N.name!==b&&(!n&&v?c(M,"name",b):(x=!0,D=function(){return r(N,this)})),m)if(O={values:L(b),keys:R?D:L(E),entries:L(_)},w)for(C in O)(y||x||!(C in M))&&h(M,C,O[C]);else i({target:t,proto:!0,forced:y||x},O);return(!n||w)&&M[T]!==D&&h(M,T,D,{name:m}),f[t]=D,O}})),KE=aT(((e,t)=>{t.exports=function(e,t){return{value:e,done:t}}})),XE=aT(((e,t)=>{var i=_T(),r=oE(),n=IE(),a=ME(),s=eE().f,o=YE(),l=KE(),u=$T(),d=gT(),c="Array Iterator",h=a.set,p=a.getterFor(c);t.exports=o(Array,"Array",(function(e,t){h(this,{type:c,target:i(e),index:0,kind:t})}),(function(){var e=p(this),t=e.target,i=e.index++;if(!t||i>=t.length)return e.target=void 0,l(void 0,!0);switch(e.kind){case"keys":return l(i,!1);case"values":return l(t[i],!1)}return l([i,t[i]],!1)}),"values");var f=n.Arguments=n.Array;if(r("keys"),r("values"),r("entries"),!u&&d&&"values"!==f.name)try{s(f,"name",{value:"values"})}catch(e){}})),JE=aT(((e,t)=>{var i=GT(),r=IE(),n=i("iterator"),a=Array.prototype;t.exports=function(e){return void 0!==e&&(r.Array===e||a[n]===e)}})),ZE=aT(((e,t)=>{var i=FE(),r=DT(),n=ET(),a=IE(),s=GT()("iterator");t.exports=function(e){if(!n(e))return r(e,s)||r(e,"@@iterator")||a[i(e)]}})),eb=aT(((e,t)=>{var i=vT(),r=NT(),n=ZT(),a=MT(),s=ZE(),o=TypeError;t.exports=function(e,t){var l=arguments.length<2?s(e):t;if(r(l))return n(i(l,e));throw new o(a(e)+" is not iterable")}})),tb=aT(((e,t)=>{var i=vT(),r=ZT(),n=DT();t.exports=function(e,t,a){var s,o;r(e);try{if(!(s=n(e,"return"))){if("throw"===t)throw a;return a}s=i(s,e)}catch(e){o=!0,s=e}if("throw"===t)throw a;if(o)throw s;return r(s),a}})),ib=aT(((e,t)=>{var i=XT(),r=vT(),n=ZT(),a=MT(),s=JE(),o=sE(),l=PT(),u=eb(),d=ZE(),c=tb(),h=TypeError,p=function(e,t){this.stopped=e,this.result=t},f=p.prototype;t.exports=function(e,t,m){var g,v,S,y,T,E,b,_=m&&m.that,A=!(!m||!m.AS_ENTRIES),R=!(!m||!m.IS_RECORD),w=!(!m||!m.IS_ITERATOR),P=!(!m||!m.INTERRUPTED),O=i(t,_),C=function(e){return g&&c(g,"normal",e),new p(!0,e)},L=function(e){return A?(n(e),P?O(e[0],e[1],C):O(e[0],e[1])):P?O(e,C):O(e)};if(R)g=e.iterator;else if(w)g=e;else{if(!(v=d(e)))throw new h(a(e)+" is not iterable");if(s(v)){for(S=0,y=o(e);y>S;S++)if((T=L(e[S]))&&l(f,T))return T;return new p(!1)}g=u(e,v)}for(E=R?e.next:g.next;!(b=r(E,g)).done;){try{T=L(b.value)}catch(e){c(g,"throw",e)}if("object"==typeof T&&T&&l(f,T))return T}return new p(!1)}})),rb=aT(((e,t)=>{var i=gT(),r=eE(),n=yT();t.exports=function(e,t,a){i?r.f(e,t,n(0,a)):e[t]=a}})),nb=aT((()=>{var e=iE(),t=ib(),i=rb();e({target:"Object",stat:!0},{fromEntries:function(e){var r={};return t(e,(function(e,t){i(r,e,t)}),{AS_ENTRIES:!0}),r}})})),ab=aT(((e,t)=>{XE(),nb();var i=RT();t.exports=i.Object.fromEntries})),sb=aT(((e,t)=>{t.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}})),ob=aT((()=>{XE();var e,t=sb(),i=lT(),r=jE(),n=IE();for(e in t)r(i[e],e),n[e]=n.Array})),lb=aT(((e,t)=>{var i=ab();ob(),t.exports=i})),ub=aT(((e,t)=>{var i=lb();t.exports=i})),db="1.0.58",cb=class{constructor(){this.subscriptions=[]}unsubscribe(){let e=this.subscriptions;this.subscriptions=[],e.forEach((e=>{"function"==typeof e?e():e.unsubscribe()}))}add(e){return this.subscriptions.push(e),this}},hb=e=>{throw new Error(`${e} is value of unexpected type`)},pb=()=>{},fb=class{constructor(e){e&&(this._subscribe=e)}subscribe(e,t){var i;let r;r=t?"function"==typeof t?{next:t,error:pb}:{next:e=>t.next(e),error:e=>{var i;return null==(i=t.error)?void 0:i.call(t,e)}}:{next:pb,error:pb};let n,a="function"==typeof e?{next:t=>{try{let i=e(t);i instanceof Promise&&i.catch((e=>r.next(e)))}catch(e){r.next(e)}},error:e=>r.next(e)}:{next:t=>e.next(t),error:t=>e.error?e.error(t):r.next(t)};try{n=this._subscribe(a)}catch(e){null==(i=a.error)||i.call(a,e)}return(new cb).add((()=>{switch(a.next=pb,a.error=pb,typeof n){case"function":return void n();case"object":return void n.unsubscribe();case"undefined":return;default:return hb(n)}}))}pipe(...e){return e.reduce(((e,t)=>t(e)),this)}_subscribe(e){}},mb=class extends fb{constructor(){super(),this.keyCounter=0,this.subscribers=new Map}next(e){this.subscribers.forEach((t=>t.next(e)))}error(e){this.subscribers.forEach((t=>{var i;return null==(i=t.error)?void 0:i.call(t,e)}))}_subscribe(e){let t=this.keyCounter++;return this.subscribers.set(t,e),(new cb).add((()=>this.subscribers.delete(t)))}},gb=class{constructor(){this.log$=new mb,this.logs=[],this.log=e=>{let t={...e,timestamp:Date.now()};this.logs.push(t),this.log$.next(t)},this.getAllLogs=()=>this.logs}createCustomLog(e){return(...t)=>{let i;try{i=e(...t)}catch(e){i={message:"error in `createCustomLog`",component:"Logger"}}this.log(i)}}createComponentLog(e){return this.createCustomLog((t=>({component:e,...t})))}},vb=class e{constructor({name:e}){}log(e,t){}error(e,t){}critical(e,t){}createComponentTracer(t){return new e({name:t})}end(){}getFinishedSpans(){}getTraceId(){return this.fakeTraceId}},Sb=class e{constructor({name:e,parentContext:t,tracer:i}){this.childTracers=[];let r=!i;if(r){let e=Ky({serviceName:"videoplayer-sdk-web",appToken:"L9SBoka6ZWk4xPjaK7tmfSfYvMhcge7nvGDjpdMmscb",spanLimits:{attributeCountLimit:1/0,eventCountLimit:1/0,attributePerEventCountLimit:1/0}}).getProvider(),t=new Xy,i=new Xy;this.spanExporter=t,e.addSpanProcessor(new Jy({startedSpansExporter:t,endedSpansExporter:i})),this.tracer=e.getTracer("sdk-videoplayer-tracer")}else this.tracer=i;this.span=this.tracer.startSpan(e,{root:r},t),this.context=ce.setSpan(he.active(),this.span)}log(e,t){this.span.addEvent(e,{...t,type:"log"})}error(e,t){this.span.addEvent(e,{...t,type:"error"})}critical(e,t){this.span.addEvent(e,{...t,type:"critical"})}static createRootTracer(t=!1){return t?new e({name:"Root"}):new vb({name:"Root"})}createComponentTracer(t){let i=new e({name:t,parentContext:this.context,tracer:this.tracer});return this.childTracers.push(i),i}end(){this.childTracers.forEach((e=>e.end())),this.span.end()}getFinishedSpans(){var e;return null==(e=this.spanExporter)?void 0:e.getJsonData()}getTraceId(){return this.span.spanContext().traceId}};function yb(e,t='Assertion "value is not nullable" failed'){if(null==e)throw new Error(t)}function Tb(e){return null!=e}function Eb(e){return null==e}function bb(e,t){if(null==e||!e.length)throw new Error(t)}var _b,Ab="function"==typeof(null==(_b=window.performance)?void 0:_b.now)?()=>window.performance.now():()=>Date.now(),Rb=(e,t)=>async(...i)=>{var r;let n,a=t(...i),s=e.aborted;for(;!s&&!e.aborted;)try{let e=await a.next(n);s=null!=(r=e.done)&&r,n=e.value}catch(e){await a.throw(e)}return n},wb=(e,{start:t=0,factor:i=2,max:r=1/0,min:n=t,random:a=0}={})=>{let s=t;return s*=i**e,s*=Math.random()*a*2-a+1,s=Math.round(s),s=Math.min(s,r),s=Math.max(s,n),s},Pb={};sT(Pb,{clear:()=>Vb,get:()=>Nb,has:()=>kb,isPersistent:()=>Mb,remove:()=>$b,set:()=>Db});var Ob,Cb,Lb,Ib=`vk-videoplayer-dummy-key-${Math.random()}`,xb=()=>{if(void 0!==Cb)return Cb;try{localStorage.setItem(Ib,"test"),localStorage.removeItem(Ib),Cb=0}catch(e){if(!(e instanceof DOMException||e instanceof TypeError))throw e;try{sessionStorage.getItem(Ib),Cb=1}catch(e){if(!(e instanceof DOMException||e instanceof TypeError))throw e;Cb=2}}return 2===Cb&&(Ob=new Map),Cb},Mb=()=>0===xb(),Nb=e=>{var t,i;let r=xb();switch(r){case 0:return null!=(t=localStorage.getItem(e))?t:void 0;case 1:return null!=(i=sessionStorage.getItem(e))?i:void 0;case 2:return null==Ob?void 0:Ob.get(e);default:hb(r)}},Db=(e,t)=>{let i=xb();switch(i){case 0:try{localStorage.setItem(e,t)}catch(e){if(!(e instanceof DOMException))throw e;console.error(e)}break;case 1:try{sessionStorage.setItem(e,t)}catch(e){if(!(e instanceof DOMException))throw e;console.error(e)}break;case 2:return void(null==Ob||Ob.set(e,t));default:hb(i)}},kb=e=>{var t;let i=xb();switch(i){case 0:return e in localStorage;case 1:return e in sessionStorage;case 2:return null!=(t=null==Ob?void 0:Ob.has(e))&&t;default:return hb(i),!1}},$b=e=>{let t=xb();switch(t){case 0:return localStorage.removeItem(e);case 1:return sessionStorage.removeItem(e);case 2:return void(null==Ob||Ob.delete(e));default:hb(t)}},Vb=()=>{let e=xb();switch(e){case 0:return localStorage.clear();case 1:return sessionStorage.clear();case 2:return null==Ob?void 0:Ob.clear();default:hb(e)}},Ub=oT(hE(),1),Bb=((Lb=Bb||{}).INVARIANT="Invariant quality",Lb.Q_144P="144p",Lb.Q_240P="240p",Lb.Q_360P="360p",Lb.Q_480P="480p",Lb.Q_576P="576p",Lb.Q_720P="720p",Lb.Q_1080P="1080p",Lb.Q_1440P="1440p",Lb.Q_2160P="2160p",Lb.Q_4320P="4320p",Lb),Fb={"144p":{width:256,height:144},"240p":{width:428,height:240},"360p":{width:640,height:360},"480p":{width:856,height:480},"576p":{width:1024,height:576},"720p":{width:1280,height:720},"1080p":{width:1920,height:1080},"1440p":{width:2560,height:1440},"2160p":{width:3840,height:2160},"4320p":{width:7680,height:4320}},Hb=(e,t)=>Fb[e].height>Fb[t].height,jb=(e,t)=>Fb[e].height>=Fb[t].height,Gb=(e,t)=>Fb[e].height<Fb[t].height,qb=(e,t)=>Fb[e].height<=Fb[t].height,zb=Object.keys(Fb).sort(((e,t)=>Gb(e,t)?-1:1)),Wb=(e,t=.02)=>[...zb].find((i=>Fb[i].height*(1+t)>=e)),Qb=({width:e,height:t})=>{let i=Math.min(e,t),r=Math.max(e,t);return zb.find((e=>{let t=Fb[e];return t.width>=r&&t.height>=i}))},Yb=e=>Fb[e].height,Kb=e=>"Invariant quality"===e;var Xb=(e,t)=>{let i={};for(let r of Object.keys(t)){let n=t[r],a=e[r];Array.isArray(n)&&Array.isArray(a)?i[r]=a:i[r]="object"==typeof n&&"object"==typeof a?Xb(a,n):r in e?a:n}return i};function Jb(e,t=0,i){let r,n,a,s,o,l,u=0,d=!1,c=!1,h=!0,p=!t&&0!==t&&"function"==typeof window.requestAnimationFrame;function f(t){let i=r,a=n;return r=n=void 0,u=t,s=e.apply(a,i),s}function m(e,t){return p?(o&&window.cancelAnimationFrame(o),window.requestAnimationFrame(e)):setTimeout(e,t)}function g(e){let i=e-l;return void 0===l||i>=t||i<0||c&&e-u>=a}function v(){let e=Date.now();if(g(e))return S(e);o=m(v,function(e){let i=e-u,r=t-(e-l);return c?Math.min(r,a-i):r}(e))}function S(e){return o=void 0,h&&r?f(e):(r=n=void 0,s)}function y(...e){let i=Date.now(),a=g(i);if(r=e,n=this,l=i,a){if(void 0===o)return function(e){return u=e,o=m(v,t),d?f(e):s}(l);if(c)return o=m(v,t),f(l)}return void 0===o&&(o=m(v,t)),s}return i&&(d=!!i.leading,c="maxWait"in i,a=null!=i&&i.maxWait?Math.max(+(null==i?void 0:i.maxWait)||0,t):a,h="trailing"in i?!!i.trailing:h),y.cancel=function(){void 0!==o&&function(e){p?window.cancelAnimationFrame(e):clearTimeout(e)}(o),u=0,r=l=n=o=void 0},y.flush=function(){return void 0===o?s:S(Date.now())},y.pending=function(){return void 0!==o},y}var Zb=(e,t=300)=>new fb((i=>{let{width:r,height:n}=e.getBoundingClientRect();if(i.next({width:r,height:n}),!window.ResizeObserver)return;let a=new ResizeObserver(((e,t=0,i)=>Jb(e,t,{leading:!0,trailing:!0,...i,maxWait:t}))((e=>{let t,r,n=e[0];n&&(n.contentBoxSize&&n.contentBoxSize[0]?(r=n.contentBoxSize[0].blockSize,t=n.contentBoxSize[0].inlineSize):n.contentRect&&(t=n.contentRect.width,r=n.contentRect.height),Tb(t)&&Tb(r)&&i.next({width:t,height:r}))}),t));return a.observe(e),()=>a.disconnect()})),e_=(e,t=6,i=".")=>{let r={};for(let n in e)if(e.hasOwnProperty(n)&&!(e[n]instanceof HTMLElement)&&t)if("object"==typeof e[n]&&null!==e[n]){let a=e_(e[n],t-1);for(let e in a)a.hasOwnProperty(e)&&(r[n+i+e]=a[e])}else r[n]=e[n];return r},t_=e=>{e.removeAttribute("src"),e.load()},i_=e=>{try{return new URL(e)}catch(e){return null}},r_=e=>t=>i=>{let r="object"==typeof i;null==i||r&&!Object.keys(i).length||e(t,r?e_(i):{value:i})},n_=class extends mb{constructor(e){super(),this.value=e}next(e){super.next(this.value=e)}error(e){super.error(this.value=e)}getValue(){return this.value}_subscribe(e){let t=super._subscribe(e);return e.next(this.value),t}},a_=oT(wE(),1);function s_(e){return new fb((t=>{let i={},r=Object.keys(e).length;return(0,a_.default)(e).reduce(((e,[n,a])=>e.add(a.subscribe((e=>n=>{e in i||r--,i[e]=n,0===r&&t.next(i)})(n)))),new cb)}))}function o_(...e){return new fb((t=>e.reduce(((e,i)=>e.add(i.subscribe(t))),new cb)))}var l_=e=>new fb((t=>{let i=window.setInterval((()=>t.next()),e);return()=>{i&&(window.clearInterval(i),i=void 0)}})),u_=e=>new fb((t=>{e.forEach((e=>t.next(e)))})),d_=(e,t)=>new fb((i=>{let r=e=>i.next(e);return e.addEventListener(t,r),()=>e.removeEventListener(t,r)}));var c_={leading:!1,trailing:!0};function h_(e,t=c_){return i=>new fb((r=>i.subscribe(new p_(r,e,t))))}var p_=class{constructor(e,t,i){this.destination=e,this.time=t,this.config=i}next(e){this.lastValue=e,Tb(this.timeout)?window.clearTimeout(this.timeout):this.config.leading&&this.destination.next(e),this.timeout=window.setTimeout((()=>{if(this.config.trailing)try{this.destination.next(this.lastValue)}catch(e){if(!this.destination.error)throw e;this.destination.error(e)}this.timeout=void 0}),this.time)}error(e){var t,i;null==(i=(t=this.destination).error)||i.call(t,e)}},f_={leading:!0,trailing:!1};function m_(e,t=f_){return i=>new fb((r=>i.subscribe(new g_(r,e,t))))}var g_=class{constructor(e,t,i){this.destination=e,this.time=t,this.config=i}next(e){this.lastValue=e,Eb(this.timeout)&&(this.config.leading&&this.destination.next(e),this.timeout=window.setTimeout((()=>{this.config.trailing&&this.destination.next(this.lastValue),this.timeout=void 0}),this.time))}error(e){var t,i;null==(i=(t=this.destination).error)||i.call(t,e)}};function v_(e){return t=>new fb((i=>t.subscribe(new S_(i,e))))}var S_=class{constructor(e,t){this.destination=e,this.predicate=t}next(e){let t;try{t=this.predicate(e)}catch(e){throw this.error(e),e}t&&this.destination.next(e)}error(e){var t,i;null==(i=(t=this.destination).error)||i.call(t,e)}},y_=oT(LE(),1),T_=(e,t)=>e instanceof Object&&t instanceof Object?((e,t)=>{let i=(e,t)=>{let i=Object.keys(e);for(let r in t)if(!(0,y_.default)(i,r)||t[r]!==e[r])return!1;return!0};return i(e,t)&&i(t,e)})(e,t):e===t;function E_(e=T_){return t=>new fb((i=>t.subscribe(new __(i,e))))}var b_={},__=class{constructor(e,t){this.destination=e,this.predicate=t,this.lastValue=b_}next(e){let t;try{t=this.lastValue===b_||!this.predicate(this.lastValue,e),this.lastValue=e instanceof Object?{...e}:e}catch(e){throw this.error(e),e}t&&this.destination.next(e)}error(e){var t,i;null==(i=(t=this.destination).error)||i.call(t,e)}};function A_(e){return t=>new fb((i=>t.subscribe(new R_(i,e))))}var R_=class{constructor(e,t){this.destination=e,this.mapper=t}next(e){let t;try{t=this.mapper(e)}catch(e){throw this.error(e),e}this.destination.next(t)}error(e){var t,i;null==(i=(t=this.destination).error)||i.call(t,e)}};function w_(e){return A_((()=>e))}function P_(){return e=>new fb((t=>{let i=!1,r=!1,n=e.subscribe((e=>{i||(i=!0,t.next(e)),r&&n.unsubscribe()}),(e=>{var a;i=!0,null==(a=t.error)||a.call(t,e),r&&n.unsubscribe()}));return r=!0,i&&n.unsubscribe(),n}))}function O_(){return e=>new fb((t=>e.subscribe(new C_(t))))}var C_=class{constructor(e){this.destination=e,this.hasLast=!1}next(e){let t=this.last;this.last=e,this.hasLast?this.destination.next([t,e]):this.hasLast=!0}error(e){var t,i;null==(i=(t=this.destination).error)||i.call(t,e)}};function L_(e){return t=>new fb((i=>t.subscribe(new I_(i,e))))}var I_=class{constructor(e,t){this.destination=e,this.effect=t}next(e){try{this.effect(e)}catch(e){throw this.error(e),e}this.destination.next(e)}error(e){var t,i;null==(i=(t=this.destination).error)||i.call(t,e)}};var x_,M_=((x_=M_||{}).NETWORK="network",x_.VIDEO_PIPELINE="video_pipeline",x_.EXTERNAL_API="external_api",x_.PARSER="parser",x_.DOM="dom",x_.WTF="wtf",x_.FATAL="fatal",x_),N_=class{constructor(){Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}addEventListener(e,t,i){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push({callback:t,options:i})}removeEventListener(e,t){if(!(e in this.listeners))return;let i=this.listeners[e];for(let e=0,r=i.length;e<r;e++)if(i[e].callback===t)return void i.splice(e,1)}dispatchEvent(e){if(!(e.type in this.listeners))return;let t=this.listeners[e.type].slice();for(let i=0,r=t.length;i<r;i++){let r=t[i];try{r.callback.call(this,e)}catch(e){Promise.resolve().then((()=>{throw e}))}r.options&&r.options.once&&this.removeEventListener(e.type,r.callback)}return!e.defaultPrevented}},D_=class extends N_{constructor(){super(),this.listeners||N_.call(this),Object.defineProperty(this,"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(this,"onabort",{value:null,writable:!0,configurable:!0}),Object.defineProperty(this,"reason",{value:void 0,writable:!0,configurable:!0})}toString(){return"[object AbortSignal]"}dispatchEvent(e){"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),super.dispatchEvent(e)}},k_=class{constructor(){Object.defineProperty(this,"signal",{value:new D_,writable:!0,configurable:!0})}abort(e){let t;try{t=new Event("abort")}catch(e){"undefined"!=typeof document?document.createEvent?(t=document.createEvent("Event"),t.initEvent("abort",!1,!1)):(t=document.createEventObject(),t.type="abort"):t={type:"abort",bubbles:!1,cancelable:!1}}let i=e;if(void 0===i)if("undefined"==typeof document)i=new Error("This operation was aborted"),i.name="AbortError";else try{i=new DOMException("signal is aborted without reason")}catch(e){i=new Error("This operation was aborted"),i.name="AbortError"}this.signal.reason=i,this.signal.dispatchEvent(t)}toString(){return"[object AbortController]"}};function $_(e){return e.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL?(console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill"),!0):"function"==typeof e.Request&&!e.Request.prototype.hasOwnProperty("signal")||!e.AbortController}"undefined"!=typeof Symbol&&Symbol.toStringTag&&(k_.prototype[Symbol.toStringTag]="AbortController",D_.prototype[Symbol.toStringTag]="AbortSignal");var V_,U_=$_({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}),B_=U_?function(e){"function"==typeof e&&(e={fetch:e});let{fetch:t,Request:i=t.Request,AbortController:r,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:n=!1}=e;if(!$_({fetch:t,Request:i,AbortController:r,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:n}))return{fetch:t,Request:a};let a=i;(a&&!a.prototype.hasOwnProperty("signal")||n)&&(a=function(e,t){let r;t&&t.signal&&(r=t.signal,delete t.signal);let n=new i(e,t);return r&&Object.defineProperty(n,"signal",{writable:!1,enumerable:!1,configurable:!0,value:r}),n},a.prototype=i.prototype);let s=t;return{fetch:(e,t)=>{let i=a&&a.prototype.isPrototypeOf(e)?e.signal:t?t.signal:void 0;if(i){let r;try{r=new DOMException("Aborted","AbortError")}catch(e){r=new Error("Aborted"),r.name="AbortError"}if(i.aborted)return Promise.reject(r);let n=new Promise(((e,t)=>{i.addEventListener("abort",(()=>t(r)),{once:!0})}));return t&&t.signal&&delete t.signal,Promise.race([n,s(e,t)])}return s(e,t)},Request:a}}({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}):void 0,F_=(U_?B_.fetch:window.fetch,U_?B_.Request:window.Request,U_||window.AbortController,U_||window.AbortSignal,oT(wE(),1),oT(ub(),1),(e=>(e.Armenian="58",e.Azerbaijani="57",e.Belarusian="114",e.English="3",e.Kazakh="97",e.Portuguese="73",e.Russian="0",e.Spanish="4",e.Ukrainian="1",e.Uzbek="65",e.Vietnamese="75",e))(F_||{})),H_=((V_=H_||{}).RU="ru",V_.EN="en",V_),j_={UI:"__vkVideoPlayer",CORE:"__vkVideoCore"},G_=(()=>{let e=0;return()=>{let t=e;return e=(e+1)%Number.MAX_SAFE_INTEGER,t}})(),q_=class{constructor(e){this.id=G_(),this.type=e,this.initWindowObjects()}getWindowObject(){var e,t;let i=this.key();return null!=(t=null==(e=window[i])?void 0:e[this.id])?t:{}}initWindowObjects(){let e=this.key();window[e]||(window[e]={}),window[e][this.id]={}}expose(e){Object.assign(this.getWindowObject(),e)}destroy(){let e=this.key();window&&window[e]&&window[e][this.id]&&(delete window[e][this.id],Object.keys(window[e]).length||delete window[e])}key(){let{type:e}=this;return j_[e]}};sT({},{create:()=>X_,destroy:()=>J_,push:()=>Z_,subscribe:()=>eA});var z_,W_,Q_,Y_,K_=new Map,X_=(e,t)=>K_.set(e,null!=t?t:[]),J_=e=>K_.delete(e),Z_=(e,t)=>{let i=K_.get(e);i&&("function"==typeof i?i(t):i.push(t))},eA=(e,t)=>{let i=K_.get(e);if(i){if(i&&Array.isArray(i))for(let e of i)t(e);K_.set(e,t)}},tA=Object.create,iA=Object.defineProperty,rA=Object.getOwnPropertyDescriptor,nA=Object.getOwnPropertyNames,aA=Object.getPrototypeOf,sA=Object.prototype.hasOwnProperty,oA=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),lA=(e,t,i)=>(i=null!=e?tA(aA(e)):{},((e,t,i,r)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let n of nA(t))!sA.call(e,n)&&n!==i&&iA(e,n,{get:()=>t[n],enumerable:!(r=rA(t,n))||r.enumerable});return e})(!t&&e&&e.__esModule?i:iA(i,"default",{value:e,enumerable:!0}),e)),uA=oA(((e,t)=>{var i=function(e){return e&&e.Math===Math&&e};t.exports=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof global&&global)||i("object"==typeof e&&e)||function(){return this}()||Function("return this")()})),dA=oA(((e,t)=>{t.exports=function(e){try{return!!e()}catch(e){return!0}}})),cA=oA(((e,t)=>{var i=dA();t.exports=!i((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))})),hA=oA(((e,t)=>{var i=cA(),r=Function.prototype,n=r.apply,a=r.call;t.exports="object"==typeof Reflect&&Reflect.apply||(i?a.bind(n):function(){return a.apply(n,arguments)})})),pA=oA(((e,t)=>{var i=cA(),r=Function.prototype,n=r.call,a=i&&r.bind.bind(n,n);t.exports=i?a:function(e){return function(){return n.apply(e,arguments)}}})),fA=oA(((e,t)=>{var i=pA(),r=i({}.toString),n=i("".slice);t.exports=function(e){return n(r(e),8,-1)}})),mA=oA(((e,t)=>{var i=fA(),r=pA();t.exports=function(e){if("Function"===i(e))return r(e)}})),gA=oA(((e,t)=>{var i="object"==typeof document&&document.all;t.exports=void 0===i&&void 0!==i?function(e){return"function"==typeof e||e===i}:function(e){return"function"==typeof e}})),vA=oA(((e,t)=>{var i=dA();t.exports=!i((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))})),SA=oA(((e,t)=>{var i=cA(),r=Function.prototype.call;t.exports=i?r.bind(r):function(){return r.apply(r,arguments)}})),yA=oA((e=>{var t={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,r=i&&!t.call({1:2},1);e.f=r?function(e){var t=i(this,e);return!!t&&t.enumerable}:t})),TA=oA(((e,t)=>{t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}})),EA=oA(((e,t)=>{var i=pA(),r=dA(),n=fA(),a=Object,s=i("".split);t.exports=r((function(){return!a("z").propertyIsEnumerable(0)}))?function(e){return"String"===n(e)?s(e,""):a(e)}:a})),bA=oA(((e,t)=>{t.exports=function(e){return null==e}})),_A=oA(((e,t)=>{var i=bA(),r=TypeError;t.exports=function(e){if(i(e))throw new r("Can't call method on "+e);return e}})),AA=oA(((e,t)=>{var i=EA(),r=_A();t.exports=function(e){return i(r(e))}})),RA=oA(((e,t)=>{var i=gA();t.exports=function(e){return"object"==typeof e?null!==e:i(e)}})),wA=oA(((e,t)=>{t.exports={}})),PA=oA(((e,t)=>{var i=wA(),r=uA(),n=gA(),a=function(e){return n(e)?e:void 0};t.exports=function(e,t){return arguments.length<2?a(i[e])||a(r[e]):i[e]&&i[e][t]||r[e]&&r[e][t]}})),OA=oA(((e,t)=>{var i=pA();t.exports=i({}.isPrototypeOf)})),CA=oA(((e,t)=>{var i=uA().navigator,r=i&&i.userAgent;t.exports=r?String(r):""})),LA=oA(((e,t)=>{var i,r,n=uA(),a=CA(),s=n.process,o=n.Deno,l=s&&s.versions||o&&o.version,u=l&&l.v8;u&&(r=(i=u.split("."))[0]>0&&i[0]<4?1:+(i[0]+i[1])),!r&&a&&((!(i=a.match(/Edge\/(\d+)/))||i[1]>=74)&&((i=a.match(/Chrome\/(\d+)/))&&(r=+i[1]))),t.exports=r})),IA=oA(((e,t)=>{var i=LA(),r=dA(),n=uA().String;t.exports=!!Object.getOwnPropertySymbols&&!r((function(){var e=Symbol("symbol detection");return!n(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&i&&i<41}))})),xA=oA(((e,t)=>{var i=IA();t.exports=i&&!Symbol.sham&&"symbol"==typeof Symbol.iterator})),MA=oA(((e,t)=>{var i=PA(),r=gA(),n=OA(),a=xA(),s=Object;t.exports=a?function(e){return"symbol"==typeof e}:function(e){var t=i("Symbol");return r(t)&&n(t.prototype,s(e))}})),NA=oA(((e,t)=>{var i=String;t.exports=function(e){try{return i(e)}catch(e){return"Object"}}})),DA=oA(((e,t)=>{var i=gA(),r=NA(),n=TypeError;t.exports=function(e){if(i(e))return e;throw new n(r(e)+" is not a function")}})),kA=oA(((e,t)=>{var i=DA(),r=bA();t.exports=function(e,t){var n=e[t];return r(n)?void 0:i(n)}})),$A=oA(((e,t)=>{var i=SA(),r=gA(),n=RA(),a=TypeError;t.exports=function(e,t){var s,o;if("string"===t&&r(s=e.toString)&&!n(o=i(s,e))||r(s=e.valueOf)&&!n(o=i(s,e))||"string"!==t&&r(s=e.toString)&&!n(o=i(s,e)))return o;throw new a("Can't convert object to primitive value")}})),VA=oA(((e,t)=>{t.exports=!0})),UA=oA(((e,t)=>{var i=uA(),r=Object.defineProperty;t.exports=function(e,t){try{r(i,e,{value:t,configurable:!0,writable:!0})}catch(r){i[e]=t}return t}})),BA=oA(((e,t)=>{var i=VA(),r=uA(),n=UA(),a="__core-js_shared__",s=t.exports=r[a]||n(a,{});(s.versions||(s.versions=[])).push({version:"3.38.0",mode:i?"pure":"global",copyright:"© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.38.0/LICENSE",source:"https://github.com/zloirock/core-js"})})),FA=oA(((e,t)=>{var i=BA();t.exports=function(e,t){return i[e]||(i[e]=t||{})}})),HA=oA(((e,t)=>{var i=_A(),r=Object;t.exports=function(e){return r(i(e))}})),jA=oA(((e,t)=>{var i=pA(),r=HA(),n=i({}.hasOwnProperty);t.exports=Object.hasOwn||function(e,t){return n(r(e),t)}})),GA=oA(((e,t)=>{var i=pA(),r=0,n=Math.random(),a=i(1..toString);t.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+a(++r+n,36)}})),qA=oA(((e,t)=>{var i=uA(),r=FA(),n=jA(),a=GA(),s=IA(),o=xA(),l=i.Symbol,u=r("wks"),d=o?l.for||l:l&&l.withoutSetter||a;t.exports=function(e){return n(u,e)||(u[e]=s&&n(l,e)?l[e]:d("Symbol."+e)),u[e]}})),zA=oA(((e,t)=>{var i=SA(),r=RA(),n=MA(),a=kA(),s=$A(),o=qA(),l=TypeError,u=o("toPrimitive");t.exports=function(e,t){if(!r(e)||n(e))return e;var o,d=a(e,u);if(d){if(void 0===t&&(t="default"),o=i(d,e,t),!r(o)||n(o))return o;throw new l("Can't convert object to primitive value")}return void 0===t&&(t="number"),s(e,t)}})),WA=oA(((e,t)=>{var i=zA(),r=MA();t.exports=function(e){var t=i(e,"string");return r(t)?t:t+""}})),QA=oA(((e,t)=>{var i=uA(),r=RA(),n=i.document,a=r(n)&&r(n.createElement);t.exports=function(e){return a?n.createElement(e):{}}})),YA=oA(((e,t)=>{var i=vA(),r=dA(),n=QA();t.exports=!i&&!r((function(){return 7!==Object.defineProperty(n("div"),"a",{get:function(){return 7}}).a}))})),KA=oA((e=>{var t=vA(),i=SA(),r=yA(),n=TA(),a=AA(),s=WA(),o=jA(),l=YA(),u=Object.getOwnPropertyDescriptor;e.f=t?u:function(e,t){if(e=a(e),t=s(t),l)try{return u(e,t)}catch(e){}if(o(e,t))return n(!i(r.f,e,t),e[t])}})),XA=oA(((e,t)=>{var i=dA(),r=gA(),n=/#|\.prototype\./,a=function(e,t){var n=o[s(e)];return n===u||n!==l&&(r(t)?i(t):!!t)},s=a.normalize=function(e){return String(e).replace(n,".").toLowerCase()},o=a.data={},l=a.NATIVE="N",u=a.POLYFILL="P";t.exports=a})),JA=oA(((e,t)=>{var i=mA(),r=DA(),n=cA(),a=i(i.bind);t.exports=function(e,t){return r(e),void 0===t?e:n?a(e,t):function(){return e.apply(t,arguments)}}})),ZA=oA(((e,t)=>{var i=vA(),r=dA();t.exports=i&&r((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))})),eR=oA(((e,t)=>{var i=RA(),r=String,n=TypeError;t.exports=function(e){if(i(e))return e;throw new n(r(e)+" is not an object")}})),tR=oA((e=>{var t=vA(),i=YA(),r=ZA(),n=eR(),a=WA(),s=TypeError,o=Object.defineProperty,l=Object.getOwnPropertyDescriptor,u="enumerable",d="configurable",c="writable";e.f=t?r?function(e,t,i){if(n(e),t=a(t),n(i),"function"==typeof e&&"prototype"===t&&"value"in i&&c in i&&!i[c]){var r=l(e,t);r&&r[c]&&(e[t]=i.value,i={configurable:d in i?i[d]:r[d],enumerable:u in i?i[u]:r[u],writable:!1})}return o(e,t,i)}:o:function(e,t,r){if(n(e),t=a(t),n(r),i)try{return o(e,t,r)}catch(e){}if("get"in r||"set"in r)throw new s("Accessors not supported");return"value"in r&&(e[t]=r.value),e}})),iR=oA(((e,t)=>{var i=vA(),r=tR(),n=TA();t.exports=i?function(e,t,i){return r.f(e,t,n(1,i))}:function(e,t,i){return e[t]=i,e}})),rR=oA(((e,t)=>{var i=uA(),r=hA(),n=mA(),a=gA(),s=KA().f,o=XA(),l=wA(),u=JA(),d=iR(),c=jA();BA();var h=function(e){var t=function(i,n,a){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(i);case 2:return new e(i,n)}return new e(i,n,a)}return r(e,this,arguments)};return t.prototype=e.prototype,t};t.exports=function(e,t){var r,p,f,m,g,v,S,y,T,E=e.target,b=e.global,_=e.stat,A=e.proto,R=b?i:_?i[E]:i[E]&&i[E].prototype,w=b?l:l[E]||d(l,E,{})[E],P=w.prototype;for(m in t)p=!(r=o(b?m:E+(_?".":"#")+m,e.forced))&&R&&c(R,m),v=w[m],p&&(e.dontCallGetSet?S=(T=s(R,m))&&T.value:S=R[m]),g=p&&S?S:t[m],(r||A||typeof v!=typeof g)&&(y=e.bind&&p?u(g,i):e.wrap&&p?h(g):A&&a(g)?n(g):g,(e.sham||g&&g.sham||v&&v.sham)&&d(y,"sham",!0),d(w,m,y),A&&(c(l,f=E+"Prototype")||d(l,f,{}),d(l[f],m,g),e.real&&P&&(r||!P[m])&&d(P,m,g)))}})),nR=oA(((e,t)=>{var i=Math.ceil,r=Math.floor;t.exports=Math.trunc||function(e){var t=+e;return(t>0?r:i)(t)}})),aR=oA(((e,t)=>{var i=nR();t.exports=function(e){var t=+e;return t!=t||0===t?0:i(t)}})),sR=oA(((e,t)=>{var i=aR(),r=Math.max,n=Math.min;t.exports=function(e,t){var a=i(e);return a<0?r(a+t,0):n(a,t)}})),oR=oA(((e,t)=>{var i=aR(),r=Math.min;t.exports=function(e){var t=i(e);return t>0?r(t,9007199254740991):0}})),lR=oA(((e,t)=>{var i=oR();t.exports=function(e){return i(e.length)}})),uR=oA(((e,t)=>{var i=AA(),r=sR(),n=lR(),a=function(e){return function(t,a,s){var o=i(t),l=n(o);if(0===l)return!e&&-1;var u,d=r(s,l);if(e&&a!=a){for(;l>d;)if((u=o[d++])!=u)return!0}else for(;l>d;d++)if((e||d in o)&&o[d]===a)return e||d||0;return!e&&-1}};t.exports={includes:a(!0),indexOf:a(!1)}})),dR=oA(((e,t)=>{t.exports=function(){}})),cR=oA((()=>{var e=rR(),t=uR().includes,i=dA(),r=dR();e({target:"Array",proto:!0,forced:i((function(){return!Array(1).includes()}))},{includes:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}}),r("includes")})),hR=oA(((e,t)=>{var i=PA();t.exports=i})),pR=oA(((e,t)=>{cR();var i=hR();t.exports=i("Array","includes")})),fR=oA(((e,t)=>{var i=pR();t.exports=i})),mR=oA(((e,t)=>{var i=fR();t.exports=i})),gR=oA(((e,t)=>{var i=FA(),r=GA(),n=i("keys");t.exports=function(e){return n[e]||(n[e]=r(e))}})),vR=oA(((e,t)=>{var i=dA();t.exports=!i((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))})),SR=oA(((e,t)=>{var i=jA(),r=gA(),n=HA(),a=gR(),s=vR(),o=a("IE_PROTO"),l=Object,u=l.prototype;t.exports=s?l.getPrototypeOf:function(e){var t=n(e);if(i(t,o))return t[o];var a=t.constructor;return r(a)&&t instanceof a?a.prototype:t instanceof l?u:null}})),yR=oA(((e,t)=>{t.exports={}})),TR=oA(((e,t)=>{var i=pA(),r=jA(),n=AA(),a=uR().indexOf,s=yR(),o=i([].push);t.exports=function(e,t){var i,l=n(e),u=0,d=[];for(i in l)!r(s,i)&&r(l,i)&&o(d,i);for(;t.length>u;)r(l,i=t[u++])&&(~a(d,i)||o(d,i));return d}})),ER=oA(((e,t)=>{t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]})),bR=oA(((e,t)=>{var i=TR(),r=ER();t.exports=Object.keys||function(e){return i(e,r)}})),_R=oA(((e,t)=>{var i=vA(),r=dA(),n=pA(),a=SR(),s=bR(),o=AA(),l=n(yA().f),u=n([].push),d=i&&r((function(){var e=Object.create(null);return e[2]=2,!l(e,2)})),c=function(e){return function(t){for(var r,n=o(t),c=s(n),h=d&&null===a(n),p=c.length,f=0,m=[];p>f;)r=c[f++],(!i||(h?r in n:l(n,r)))&&u(m,e?[r,n[r]]:n[r]);return m}};t.exports={entries:c(!0),values:c(!1)}})),AR=oA((()=>{var e=rR(),t=_R().entries;e({target:"Object",stat:!0},{entries:function(e){return t(e)}})})),RR=oA(((e,t)=>{AR();var i=wA();t.exports=i.Object.entries})),wR=oA(((e,t)=>{var i=RR();t.exports=i})),PR=oA(((e,t)=>{var i=wR();t.exports=i})),OR=oA(((e,t)=>{t.exports={}})),CR=oA(((e,t)=>{var i=uA(),r=gA(),n=i.WeakMap;t.exports=r(n)&&/native code/.test(String(n))})),LR=oA(((e,t)=>{var i,r,n,a,s,o=CR(),l=uA(),u=RA(),d=iR(),c=jA(),h=BA(),p=gR(),f=yR(),m="Object already initialized",g=l.TypeError,v=l.WeakMap;o||h.state?((a=h.state||(h.state=new v)).get=a.get,a.has=a.has,a.set=a.set,i=function(e,t){if(a.has(e))throw new g(m);return t.facade=e,a.set(e,t),t},r=function(e){return a.get(e)||{}},n=function(e){return a.has(e)}):(f[s=p("state")]=!0,i=function(e,t){if(c(e,s))throw new g(m);return t.facade=e,d(e,s,t),t},r=function(e){return c(e,s)?e[s]:{}},n=function(e){return c(e,s)}),t.exports={set:i,get:r,has:n,enforce:function(e){return n(e)?r(e):i(e,{})},getterFor:function(e){return function(t){var i;if(!u(t)||(i=r(t)).type!==e)throw new g("Incompatible receiver, "+e+" required");return i}}}})),IR=oA(((e,t)=>{var i=vA(),r=jA(),n=Function.prototype,a=i&&Object.getOwnPropertyDescriptor,s=r(n,"name"),o=s&&"something"===function(){}.name,l=s&&(!i||i&&a(n,"name").configurable);t.exports={EXISTS:s,PROPER:o,CONFIGURABLE:l}})),xR=oA((e=>{var t=vA(),i=ZA(),r=tR(),n=eR(),a=AA(),s=bR();e.f=t&&!i?Object.defineProperties:function(e,t){n(e);for(var i,o=a(t),l=s(t),u=l.length,d=0;u>d;)r.f(e,i=l[d++],o[i]);return e}})),MR=oA(((e,t)=>{var i=PA();t.exports=i("document","documentElement")})),NR=oA(((e,t)=>{var i,r=eR(),n=xR(),a=ER(),s=yR(),o=MR(),l=QA(),u=gR(),d="prototype",c="script",h=u("IE_PROTO"),p=function(){},f=function(e){return"<"+c+">"+e+"</"+c+">"},m=function(e){e.write(f("")),e.close();var t=e.parentWindow.Object;return e=null,t},g=function(){try{i=new ActiveXObject("htmlfile")}catch(e){}g="undefined"!=typeof document?document.domain&&i?m(i):function(){var e,t=l("iframe"),i="java"+c+":";return t.style.display="none",o.appendChild(t),t.src=String(i),(e=t.contentWindow.document).open(),e.write(f("document.F=Object")),e.close(),e.F}():m(i);for(var e=a.length;e--;)delete g[d][a[e]];return g()};s[h]=!0,t.exports=Object.create||function(e,t){var i;return null!==e?(p[d]=r(e),i=new p,p[d]=null,i[h]=e):i=g(),void 0===t?i:n.f(i,t)}})),DR=oA(((e,t)=>{var i=iR();t.exports=function(e,t,r,n){return n&&n.enumerable?e[t]=r:i(e,t,r),e}})),kR=oA(((e,t)=>{var i,r,n,a=dA(),s=gA(),o=RA(),l=NR(),u=SR(),d=DR(),c=qA(),h=VA(),p=c("iterator"),f=!1;[].keys&&("next"in(n=[].keys())?(r=u(u(n)))!==Object.prototype&&(i=r):f=!0),!o(i)||a((function(){var e={};return i[p].call(e)!==e}))?i={}:h&&(i=l(i)),s(i[p])||d(i,p,(function(){return this})),t.exports={IteratorPrototype:i,BUGGY_SAFARI_ITERATORS:f}})),$R=oA(((e,t)=>{var i={};i[qA()("toStringTag")]="z",t.exports="[object z]"===String(i)})),VR=oA(((e,t)=>{var i=$R(),r=gA(),n=fA(),a=qA()("toStringTag"),s=Object,o="Arguments"===n(function(){return arguments}());t.exports=i?n:function(e){var t,i,l;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t]}catch(e){}}(t=s(e),a))?i:o?n(t):"Object"===(l=n(t))&&r(t.callee)?"Arguments":l}})),UR=oA(((e,t)=>{var i=$R(),r=VR();t.exports=i?{}.toString:function(){return"[object "+r(this)+"]"}})),BR=oA(((e,t)=>{var i=$R(),r=tR().f,n=iR(),a=jA(),s=UR(),o=qA()("toStringTag");t.exports=function(e,t,l,u){var d=l?e:e&&e.prototype;d&&(a(d,o)||r(d,o,{configurable:!0,value:t}),u&&!i&&n(d,"toString",s))}})),FR=oA(((e,t)=>{var i=kR().IteratorPrototype,r=NR(),n=TA(),a=BR(),s=OR(),o=function(){return this};t.exports=function(e,t,l,u){var d=t+" Iterator";return e.prototype=r(i,{next:n(+!u,l)}),a(e,d,!1,!0),s[d]=o,e}})),HR=oA(((e,t)=>{var i=pA(),r=DA();t.exports=function(e,t,n){try{return i(r(Object.getOwnPropertyDescriptor(e,t)[n]))}catch(e){}}})),jR=oA(((e,t)=>{var i=RA();t.exports=function(e){return i(e)||null===e}})),GR=oA(((e,t)=>{var i=jR(),r=String,n=TypeError;t.exports=function(e){if(i(e))return e;throw new n("Can't set "+r(e)+" as a prototype")}})),qR=oA(((e,t)=>{var i=HR(),r=RA(),n=_A(),a=GR();t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,s={};try{(e=i(Object.prototype,"__proto__","set"))(s,[]),t=s instanceof Array}catch(e){}return function(i,s){return n(i),a(s),r(i)&&(t?e(i,s):i.__proto__=s),i}}():void 0)})),zR=oA(((e,t)=>{var i=rR(),r=SA(),n=VA(),a=IR(),s=gA(),o=FR(),l=SR(),u=qR(),d=BR(),c=iR(),h=DR(),p=qA(),f=OR(),m=kR(),g=a.PROPER,v=a.CONFIGURABLE,S=m.IteratorPrototype,y=m.BUGGY_SAFARI_ITERATORS,T=p("iterator"),E="keys",b="values",_="entries",A=function(){return this};t.exports=function(e,t,a,p,m,R,w){o(a,t,p);var P,O,C,L=function(e){if(e===m&&D)return D;if(!y&&e&&e in M)return M[e];switch(e){case E:case b:case _:return function(){return new a(this,e)}}return function(){return new a(this)}},I=t+" Iterator",x=!1,M=e.prototype,N=M[T]||M["@@iterator"]||m&&M[m],D=!y&&N||L(m),k="Array"===t&&M.entries||N;if(k&&((P=l(k.call(new e)))!==Object.prototype&&P.next&&(!n&&l(P)!==S&&(u?u(P,S):s(P[T])||h(P,T,A)),d(P,I,!0,!0),n&&(f[I]=A))),g&&m===b&&N&&N.name!==b&&(!n&&v?c(M,"name",b):(x=!0,D=function(){return r(N,this)})),m)if(O={values:L(b),keys:R?D:L(E),entries:L(_)},w)for(C in O)(y||x||!(C in M))&&h(M,C,O[C]);else i({target:t,proto:!0,forced:y||x},O);return(!n||w)&&M[T]!==D&&h(M,T,D,{name:m}),f[t]=D,O}})),WR=oA(((e,t)=>{t.exports=function(e,t){return{value:e,done:t}}})),QR=oA(((e,t)=>{var i=AA(),r=dR(),n=OR(),a=LR(),s=tR().f,o=zR(),l=WR(),u=VA(),d=vA(),c="Array Iterator",h=a.set,p=a.getterFor(c);t.exports=o(Array,"Array",(function(e,t){h(this,{type:c,target:i(e),index:0,kind:t})}),(function(){var e=p(this),t=e.target,i=e.index++;if(!t||i>=t.length)return e.target=void 0,l(void 0,!0);switch(e.kind){case"keys":return l(i,!1);case"values":return l(t[i],!1)}return l([i,t[i]],!1)}),"values");var f=n.Arguments=n.Array;if(r("keys"),r("values"),r("entries"),!u&&d&&"values"!==f.name)try{s(f,"name",{value:"values"})}catch(e){}})),YR=oA(((e,t)=>{var i=qA(),r=OR(),n=i("iterator"),a=Array.prototype;t.exports=function(e){return void 0!==e&&(r.Array===e||a[n]===e)}})),KR=oA(((e,t)=>{var i=VR(),r=kA(),n=bA(),a=OR(),s=qA()("iterator");t.exports=function(e){if(!n(e))return r(e,s)||r(e,"@@iterator")||a[i(e)]}})),XR=oA(((e,t)=>{var i=SA(),r=DA(),n=eR(),a=NA(),s=KR(),o=TypeError;t.exports=function(e,t){var l=arguments.length<2?s(e):t;if(r(l))return n(i(l,e));throw new o(a(e)+" is not iterable")}})),JR=oA(((e,t)=>{var i=SA(),r=eR(),n=kA();t.exports=function(e,t,a){var s,o;r(e);try{if(!(s=n(e,"return"))){if("throw"===t)throw a;return a}s=i(s,e)}catch(e){o=!0,s=e}if("throw"===t)throw a;if(o)throw s;return r(s),a}})),ZR=oA(((e,t)=>{var i=JA(),r=SA(),n=eR(),a=NA(),s=YR(),o=lR(),l=OA(),u=XR(),d=KR(),c=JR(),h=TypeError,p=function(e,t){this.stopped=e,this.result=t},f=p.prototype;t.exports=function(e,t,m){var g,v,S,y,T,E,b,_=m&&m.that,A=!(!m||!m.AS_ENTRIES),R=!(!m||!m.IS_RECORD),w=!(!m||!m.IS_ITERATOR),P=!(!m||!m.INTERRUPTED),O=i(t,_),C=function(e){return g&&c(g,"normal",e),new p(!0,e)},L=function(e){return A?(n(e),P?O(e[0],e[1],C):O(e[0],e[1])):P?O(e,C):O(e)};if(R)g=e.iterator;else if(w)g=e;else{if(!(v=d(e)))throw new h(a(e)+" is not iterable");if(s(v)){for(S=0,y=o(e);y>S;S++)if((T=L(e[S]))&&l(f,T))return T;return new p(!1)}g=u(e,v)}for(E=R?e.next:g.next;!(b=r(E,g)).done;){try{T=L(b.value)}catch(e){c(g,"throw",e)}if("object"==typeof T&&T&&l(f,T))return T}return new p(!1)}})),ew=oA(((e,t)=>{var i=vA(),r=tR(),n=TA();t.exports=function(e,t,a){i?r.f(e,t,n(0,a)):e[t]=a}})),tw=oA((()=>{var e=rR(),t=ZR(),i=ew();e({target:"Object",stat:!0},{fromEntries:function(e){var r={};return t(e,(function(e,t){i(r,e,t)}),{AS_ENTRIES:!0}),r}})})),iw=oA(((e,t)=>{QR(),tw();var i=wA();t.exports=i.Object.fromEntries})),rw=oA(((e,t)=>{t.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}})),nw=oA((()=>{QR();var e,t=rw(),i=uA(),r=BR(),n=OR();for(e in t)r(i[e],e),n[e]=n.Array})),aw=oA(((e,t)=>{var i=iw();nw(),t.exports=i})),sw=oA(((e,t)=>{var i=aw();t.exports=i})),ow=oA((()=>{})),lw=oA(((e,t)=>{var i=uA(),r=CA(),n=fA(),a=function(e){return r.slice(0,e.length)===e};t.exports=a("Bun/")?"BUN":a("Cloudflare-Workers")?"CLOUDFLARE":a("Deno/")?"DENO":a("Node.js/")?"NODE":i.Bun&&"string"==typeof Bun.version?"BUN":i.Deno&&"object"==typeof Deno.version?"DENO":"process"===n(i.process)?"NODE":i.window&&i.document?"BROWSER":"REST"})),uw=oA(((e,t)=>{var i=lw();t.exports="NODE"===i})),dw=oA(((e,t)=>{var i=tR();t.exports=function(e,t,r){return i.f(e,t,r)}})),cw=oA(((e,t)=>{var i=PA(),r=dw(),n=qA(),a=vA(),s=n("species");t.exports=function(e){var t=i(e);a&&t&&!t[s]&&r(t,s,{configurable:!0,get:function(){return this}})}})),hw=oA(((e,t)=>{var i=OA(),r=TypeError;t.exports=function(e,t){if(i(t,e))return e;throw new r("Incorrect invocation")}})),pw=oA(((e,t)=>{var i=pA(),r=gA(),n=BA(),a=i(Function.toString);r(n.inspectSource)||(n.inspectSource=function(e){return a(e)}),t.exports=n.inspectSource})),fw=oA(((e,t)=>{var i=pA(),r=dA(),n=gA(),a=VR(),s=PA(),o=pw(),l=function(){},u=s("Reflect","construct"),d=/^\s*(?:class|function)\b/,c=i(d.exec),h=!d.test(l),p=function(e){if(!n(e))return!1;try{return u(l,[],e),!0}catch(e){return!1}},f=function(e){if(!n(e))return!1;switch(a(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return h||!!c(d,o(e))}catch(e){return!0}};f.sham=!0,t.exports=!u||r((function(){var e;return p(p.call)||!p(Object)||!p((function(){e=!0}))||e}))?f:p})),mw=oA(((e,t)=>{var i=fw(),r=NA(),n=TypeError;t.exports=function(e){if(i(e))return e;throw new n(r(e)+" is not a constructor")}})),gw=oA(((e,t)=>{var i=eR(),r=mw(),n=bA(),a=qA()("species");t.exports=function(e,t){var s,o=i(e).constructor;return void 0===o||n(s=i(o)[a])?t:r(s)}})),vw=oA(((e,t)=>{var i=pA();t.exports=i([].slice)})),Sw=oA(((e,t)=>{var i=TypeError;t.exports=function(e,t){if(e<t)throw new i("Not enough arguments");return e}})),yw=oA(((e,t)=>{var i=CA();t.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(i)})),Tw=oA(((e,t)=>{var i,r,n,a,s=uA(),o=hA(),l=JA(),u=gA(),d=jA(),c=dA(),h=MR(),p=vw(),f=QA(),m=Sw(),g=yw(),v=uw(),S=s.setImmediate,y=s.clearImmediate,T=s.process,E=s.Dispatch,b=s.Function,_=s.MessageChannel,A=s.String,R=0,w={},P="onreadystatechange";c((function(){i=s.location}));var O=function(e){if(d(w,e)){var t=w[e];delete w[e],t()}},C=function(e){return function(){O(e)}},L=function(e){O(e.data)},I=function(e){s.postMessage(A(e),i.protocol+"//"+i.host)};(!S||!y)&&(S=function(e){m(arguments.length,1);var t=u(e)?e:b(e),i=p(arguments,1);return w[++R]=function(){o(t,void 0,i)},r(R),R},y=function(e){delete w[e]},v?r=function(e){T.nextTick(C(e))}:E&&E.now?r=function(e){E.now(C(e))}:_&&!g?(a=(n=new _).port2,n.port1.onmessage=L,r=l(a.postMessage,a)):s.addEventListener&&u(s.postMessage)&&!s.importScripts&&i&&"file:"!==i.protocol&&!c(I)?(r=I,s.addEventListener("message",L,!1)):r=P in f("script")?function(e){h.appendChild(f("script"))[P]=function(){h.removeChild(this),O(e)}}:function(e){setTimeout(C(e),0)}),t.exports={set:S,clear:y}})),Ew=oA(((e,t)=>{var i=uA(),r=vA(),n=Object.getOwnPropertyDescriptor;t.exports=function(e){if(!r)return i[e];var t=n(i,e);return t&&t.value}})),bw=oA(((e,t)=>{var i=function(){this.head=null,this.tail=null};i.prototype={add:function(e){var t={item:e,next:null},i=this.tail;i?i.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}},t.exports=i})),_w=oA(((e,t)=>{var i=CA();t.exports=/ipad|iphone|ipod/i.test(i)&&"undefined"!=typeof Pebble})),Aw=oA(((e,t)=>{var i=CA();t.exports=/web0s(?!.*chrome)/i.test(i)})),Rw=oA(((e,t)=>{var i,r,n,a,s,o,l,u=uA(),d=Ew(),c=JA(),h=Tw().set,p=bw(),f=yw(),m=_w(),g=Aw(),v=uw(),S=u.MutationObserver||u.WebKitMutationObserver,y=u.document,T=u.process,E=u.Promise,b=d("queueMicrotask");b||(o=new p,l=function(){var e,t;for(v&&(e=T.domain)&&e.exit();t=o.get();)try{t()}catch(e){throw o.head&&i(),e}e&&e.enter()},f||v||g||!S||!y?!m&&E&&E.resolve?((a=E.resolve(void 0)).constructor=E,s=c(a.then,a),i=function(){s(l)}):v?i=function(){T.nextTick(l)}:(h=c(h,u),i=function(){h(l)}):(r=!0,n=y.createTextNode(""),new S(l).observe(n,{characterData:!0}),i=function(){n.data=r=!r}),b=function(e){o.head||i(),o.add(e)}),t.exports=b})),ww=oA(((e,t)=>{t.exports=function(e,t){try{1===arguments.length?console.error(e):console.error(e,t)}catch(e){}}})),Pw=oA(((e,t)=>{t.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}})),Ow=oA(((e,t)=>{var i=uA();t.exports=i.Promise})),Cw=oA(((e,t)=>{var i=uA(),r=Ow(),n=gA(),a=XA(),s=pw(),o=qA(),l=lw(),u=VA(),d=LA(),c=r&&r.prototype,h=o("species"),p=!1,f=n(i.PromiseRejectionEvent),m=a("Promise",(function(){var e=s(r),t=e!==String(r);if(!t&&66===d||u&&(!c.catch||!c.finally))return!0;if(!d||d<51||!/native code/.test(e)){var i=new r((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};if((i.constructor={})[h]=n,!(p=i.then((function(){}))instanceof n))return!0}return!(t||"BROWSER"!==l&&"DENO"!==l||f)}));t.exports={CONSTRUCTOR:m,REJECTION_EVENT:f,SUBCLASSING:p}})),Lw=oA(((e,t)=>{var i=DA(),r=TypeError,n=function(e){var t,n;this.promise=new e((function(e,i){if(void 0!==t||void 0!==n)throw new r("Bad Promise constructor");t=e,n=i})),this.resolve=i(t),this.reject=i(n)};t.exports.f=function(e){return new n(e)}})),Iw=oA((()=>{var e,t,i,r=rR(),n=VA(),a=uw(),s=uA(),o=SA(),l=DR(),u=qR(),d=BR(),c=cw(),h=DA(),p=gA(),f=RA(),m=hw(),g=gw(),v=Tw().set,S=Rw(),y=ww(),T=Pw(),E=bw(),b=LR(),_=Ow(),A=Cw(),R=Lw(),w="Promise",P=A.CONSTRUCTOR,O=A.REJECTION_EVENT,C=A.SUBCLASSING,L=b.getterFor(w),I=b.set,x=_&&_.prototype,M=_,N=x,D=s.TypeError,k=s.document,$=s.process,V=R.f,U=V,B=!!(k&&k.createEvent&&s.dispatchEvent),F="unhandledrejection",H=function(e){var t;return!(!f(e)||!p(t=e.then))&&t},j=function(e,t){var i,r,n,a=t.value,s=1===t.state,l=s?e.ok:e.fail,u=e.resolve,d=e.reject,c=e.domain;try{l?(s||(2===t.rejection&&Q(t),t.rejection=1),!0===l?i=a:(c&&c.enter(),i=l(a),c&&(c.exit(),n=!0)),i===e.promise?d(new D("Promise-chain cycle")):(r=H(i))?o(r,i,u,d):u(i)):d(a)}catch(e){c&&!n&&c.exit(),d(e)}},G=function(e,t){e.notified||(e.notified=!0,S((function(){for(var i,r=e.reactions;i=r.get();)j(i,e);e.notified=!1,t&&!e.rejection&&z(e)})))},q=function(e,t,i){var r,n;B?((r=k.createEvent("Event")).promise=t,r.reason=i,r.initEvent(e,!1,!0),s.dispatchEvent(r)):r={promise:t,reason:i},!O&&(n=s["on"+e])?n(r):e===F&&y("Unhandled promise rejection",i)},z=function(e){o(v,s,(function(){var t,i=e.facade,r=e.value;if(W(e)&&(t=T((function(){a?$.emit("unhandledRejection",r,i):q(F,i,r)})),e.rejection=a||W(e)?2:1,t.error))throw t.value}))},W=function(e){return 1!==e.rejection&&!e.parent},Q=function(e){o(v,s,(function(){var t=e.facade;a?$.emit("rejectionHandled",t):q("rejectionhandled",t,e.value)}))},Y=function(e,t,i){return function(r){e(t,r,i)}},K=function(e,t,i){e.done||(e.done=!0,i&&(e=i),e.value=t,e.state=2,G(e,!0))},X=function(e,t,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===t)throw new D("Promise can't be resolved itself");var r=H(t);r?S((function(){var i={done:!1};try{o(r,t,Y(X,i,e),Y(K,i,e))}catch(t){K(i,t,e)}})):(e.value=t,e.state=1,G(e,!1))}catch(t){K({done:!1},t,e)}}};if(P&&(M=function(t){m(this,N),h(t),o(e,this);var i=L(this);try{t(Y(X,i),Y(K,i))}catch(e){K(i,e)}},N=M.prototype,(e=function(e){I(this,{type:w,done:!1,notified:!1,parent:!1,reactions:new E,rejection:!1,state:0,value:void 0})}).prototype=l(N,"then",(function(e,t){var i=L(this),r=V(g(this,M));return i.parent=!0,r.ok=!p(e)||e,r.fail=p(t)&&t,r.domain=a?$.domain:void 0,0===i.state?i.reactions.add(r):S((function(){j(r,i)})),r.promise})),t=function(){var t=new e,i=L(t);this.promise=t,this.resolve=Y(X,i),this.reject=Y(K,i)},R.f=V=function(e){return e===M||undefined===e?new t(e):U(e)},!n&&p(_)&&x!==Object.prototype)){i=x.then,C||l(x,"then",(function(e,t){var r=this;return new M((function(e,t){o(i,r,e,t)})).then(e,t)}),{unsafe:!0});try{delete x.constructor}catch(e){}u&&u(x,N)}r({global:!0,constructor:!0,wrap:!0,forced:P},{Promise:M}),d(M,w,!1,!0),c(w)})),xw=oA(((e,t)=>{var i,r,n=qA()("iterator"),a=!1;try{i=0,(r={next:function(){return{done:!!i++}},return:function(){a=!0}})[n]=function(){return this},Array.from(r,(function(){throw 2}))}catch(e){}t.exports=function(e,t){try{if(!t&&!a)return!1}catch(e){return!1}var i=!1;try{var r={};r[n]=function(){return{next:function(){return{done:i=!0}}}},e(r)}catch(e){}return i}})),Mw=oA(((e,t)=>{var i=Ow(),r=xw(),n=Cw().CONSTRUCTOR;t.exports=n||!r((function(e){i.all(e).then(void 0,(function(){}))}))})),Nw=oA((()=>{var e=rR(),t=SA(),i=DA(),r=Lw(),n=Pw(),a=ZR();e({target:"Promise",stat:!0,forced:Mw()},{all:function(e){var s=this,o=r.f(s),l=o.resolve,u=o.reject,d=n((function(){var r=i(s.resolve),n=[],o=0,d=1;a(e,(function(e){var i=o++,a=!1;d++,t(r,s,e).then((function(e){a||(a=!0,n[i]=e,--d||l(n))}),u)})),--d||l(n)}));return d.error&&u(d.value),o.promise}})})),Dw=oA((()=>{var e,t=rR(),i=VA(),r=Cw().CONSTRUCTOR,n=Ow(),a=PA(),s=gA(),o=DR(),l=n&&n.prototype;t({target:"Promise",proto:!0,forced:r,real:!0},{catch:function(e){return this.then(void 0,e)}}),!i&&s(n)&&(e=a("Promise").prototype.catch,l.catch!==e&&o(l,"catch",e,{unsafe:!0}))})),kw=oA((()=>{var e=rR(),t=SA(),i=DA(),r=Lw(),n=Pw(),a=ZR();e({target:"Promise",stat:!0,forced:Mw()},{race:function(e){var s=this,o=r.f(s),l=o.reject,u=n((function(){var r=i(s.resolve);a(e,(function(e){t(r,s,e).then(o.resolve,l)}))}));return u.error&&l(u.value),o.promise}})})),$w=oA((()=>{var e=rR(),t=Lw();e({target:"Promise",stat:!0,forced:Cw().CONSTRUCTOR},{reject:function(e){var i=t.f(this);return(0,i.reject)(e),i.promise}})})),Vw=oA(((e,t)=>{var i=eR(),r=RA(),n=Lw();t.exports=function(e,t){if(i(e),r(t)&&t.constructor===e)return t;var a=n.f(e);return(0,a.resolve)(t),a.promise}})),Uw=oA((()=>{var e=rR(),t=PA(),i=VA(),r=Ow(),n=Cw().CONSTRUCTOR,a=Vw(),s=t("Promise"),o=i&&!n;e({target:"Promise",stat:!0,forced:i||n},{resolve:function(e){return a(o&&this===s?r:this,e)}})})),Bw=oA((()=>{Iw(),Nw(),Dw(),kw(),$w(),Uw()})),Fw=oA((()=>{var e,t=rR(),i=VA(),r=Ow(),n=dA(),a=PA(),s=gA(),o=gw(),l=Vw(),u=DR(),d=r&&r.prototype;t({target:"Promise",proto:!0,real:!0,forced:!!r&&n((function(){d.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=o(this,a("Promise")),i=s(e);return this.then(i?function(i){return l(t,e()).then((function(){return i}))}:e,i?function(i){return l(t,e()).then((function(){throw i}))}:e)}}),!i&&s(r)&&(e=a("Promise").prototype.finally,d.finally!==e&&u(d,"finally",e,{unsafe:!0}))})),Hw=oA(((e,t)=>{ow(),Bw(),Fw();var i=hR();t.exports=i("Promise","finally")})),jw=oA(((e,t)=>{var i=Hw();t.exports=i})),Gw=oA(((e,t)=>{var i=jw();t.exports=i})),qw=oA((()=>{var e=rR(),t=_R().values;e({target:"Object",stat:!0},{values:function(e){return t(e)}})})),zw=oA(((e,t)=>{qw();var i=wA();t.exports=i.Object.values})),Ww=oA(((e,t)=>{var i=zw();t.exports=i})),Qw=oA(((e,t)=>{var i=Ww();t.exports=i})),Yw=oA((()=>{var e=rR(),t=HA(),i=lR(),r=aR(),n=dR();e({target:"Array",proto:!0},{at:function(e){var n=t(this),a=i(n),s=r(e),o=s>=0?s:a+s;return o<0||o>=a?void 0:n[o]}}),n("at")})),Kw=oA(((e,t)=>{Yw();var i=hR();t.exports=i("Array","at")})),Xw=oA(((e,t)=>{var i=Kw();t.exports=i})),Jw=oA(((e,t)=>{var i=Xw();t.exports=i})),Zw=oA(((e,t)=>{var i=fA();t.exports=Array.isArray||function(e){return"Array"===i(e)}})),eP=oA(((e,t)=>{var i=TypeError;t.exports=function(e){if(e>9007199254740991)throw i("Maximum allowed index exceeded");return e}})),tP=oA(((e,t)=>{var i=Zw(),r=lR(),n=eP(),a=JA(),s=function(e,t,o,l,u,d,c,h){for(var p,f,m=u,g=0,v=!!c&&a(c,h);g<l;)g in o&&(p=v?v(o[g],g,t):o[g],d>0&&i(p)?(f=r(p),m=s(e,t,p,f,m,d-1)-1):(n(m+1),e[m]=p),m++),g++;return m};t.exports=s})),iP=oA(((e,t)=>{var i=Zw(),r=fw(),n=RA(),a=qA()("species"),s=Array;t.exports=function(e){var t;return i(e)&&(t=e.constructor,r(t)&&(t===s||i(t.prototype))?t=void 0:n(t)&&(null===(t=t[a])&&(t=void 0))),void 0===t?s:t}})),rP=oA(((e,t)=>{var i=iP();t.exports=function(e,t){return new(i(e))(0===t?0:t)}})),nP=oA((()=>{var e=rR(),t=tP(),i=DA(),r=HA(),n=lR(),a=rP();e({target:"Array",proto:!0},{flatMap:function(e){var s,o=r(this),l=n(o);return i(e),(s=a(o,0)).length=t(s,o,o,l,0,1,e,arguments.length>1?arguments[1]:void 0),s}})})),aP=oA((()=>{dR()("flatMap")})),sP=oA(((e,t)=>{nP(),aP();var i=hR();t.exports=i("Array","flatMap")})),oP=oA(((e,t)=>{var i=sP();t.exports=i})),lP=oA(((e,t)=>{var i=oP();t.exports=i})),uP=oA(((e,t)=>{var i=VR(),r=String;t.exports=function(e){if("Symbol"===i(e))throw new TypeError("Cannot convert a Symbol value to a string");return r(e)}})),dP=oA(((e,t)=>{t.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"})),cP=oA(((e,t)=>{var i=pA(),r=_A(),n=uP(),a=dP(),s=i("".replace),o=RegExp("^["+a+"]+"),l=RegExp("(^|[^"+a+"])["+a+"]+$"),u=function(e){return function(t){var i=n(r(t));return 1&e&&(i=s(i,o,"")),2&e&&(i=s(i,l,"$1")),i}};t.exports={start:u(1),end:u(2),trim:u(3)}})),hP=oA(((e,t)=>{var i=IR().PROPER,r=dA(),n=dP();t.exports=function(e){return r((function(){return!!n[e]()||"​᠎"!=="​᠎"[e]()||i&&n[e].name!==e}))}})),pP=oA(((e,t)=>{var i=cP().start,r=hP();t.exports=r("trimStart")?function(){return i(this)}:"".trimStart})),fP=oA((()=>{var e=rR(),t=pP();e({target:"String",proto:!0,name:"trimStart",forced:"".trimLeft!==t},{trimLeft:t})})),mP=oA((()=>{fP();var e=rR(),t=pP();e({target:"String",proto:!0,name:"trimStart",forced:"".trimStart!==t},{trimStart:t})})),gP=oA(((e,t)=>{mP();var i=hR();t.exports=i("String","trimLeft")})),vP=oA(((e,t)=>{var i=gP();t.exports=i})),SP=oA(((e,t)=>{var i=vP();t.exports=i})),yP=oA((()=>{})),TP=oA((()=>{})),EP=oA(((e,t)=>{var i=RA(),r=fA(),n=qA()("match");t.exports=function(e){var t;return i(e)&&(void 0!==(t=e[n])?!!t:"RegExp"===r(e))}})),bP=oA(((e,t)=>{var i=eR();t.exports=function(){var e=i(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}})),_P=oA(((e,t)=>{var i=SA(),r=jA(),n=OA(),a=bP(),s=RegExp.prototype;t.exports=function(e){var t=e.flags;return void 0!==t||"flags"in s||r(e,"flags")||!n(s,e)?t:i(a,e)}})),AP=oA(((e,t)=>{var i=pA(),r=HA(),n=Math.floor,a=i("".charAt),s=i("".replace),o=i("".slice),l=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,u=/\$([$&'`]|\d{1,2})/g;t.exports=function(e,t,i,d,c,h){var p=i+e.length,f=d.length,m=u;return void 0!==c&&(c=r(c),m=l),s(h,m,(function(r,s){var l;switch(a(s,0)){case"$":return"$";case"&":return e;case"`":return o(t,0,i);case"'":return o(t,p);case"<":l=c[o(s,1,-1)];break;default:var u=+s;if(0===u)return r;if(u>f){var h=n(u/10);return 0===h?r:h<=f?void 0===d[h-1]?a(s,1):d[h-1]+a(s,1):r}l=d[u-1]}return void 0===l?"":l}))}})),RP=oA((()=>{var e=rR(),t=SA(),i=pA(),r=_A(),n=gA(),a=bA(),s=EP(),o=uP(),l=kA(),u=_P(),d=AP(),c=qA(),h=VA(),p=c("replace"),f=TypeError,m=i("".indexOf),g=i("".replace),v=i("".slice),S=Math.max;e({target:"String",proto:!0},{replaceAll:function(e,i){var c,y,T,E,b,_,A,R,w,P,O=r(this),C=0,L="";if(!a(e)){if((c=s(e))&&(y=o(r(u(e))),!~m(y,"g")))throw new f("`.replaceAll` does not allow non-global regexes");if(T=l(e,p))return t(T,e,O,i);if(h&&c)return g(o(O),e,i)}for(E=o(O),b=o(e),(_=n(i))||(i=o(i)),A=b.length,R=S(1,A),w=m(E,b);-1!==w;)P=_?o(i(b,w,E)):d(b,E,w,[],void 0,i),L+=v(E,C,w)+P,C=w+A,w=w+R>E.length?-1:m(E,b,w+R);return C<E.length&&(L+=v(E,C)),L}})})),wP=oA(((e,t)=>{yP(),TP(),RP();var i=hR();t.exports=i("String","replaceAll")})),PP=oA(((e,t)=>{var i=wP();t.exports=i})),OP=oA(((e,t)=>{var i=PP();t.exports=i})),CP=oA(((e,t)=>{var i=aR(),r=uP(),n=_A(),a=RangeError;t.exports=function(e){var t=r(n(this)),s="",o=i(e);if(o<0||o===1/0)throw new a("Wrong number of repetitions");for(;o>0;(o>>>=1)&&(t+=t))1&o&&(s+=t);return s}})),LP=oA(((e,t)=>{var i=pA(),r=oR(),n=uP(),a=CP(),s=_A(),o=i(a),l=i("".slice),u=Math.ceil,d=function(e){return function(t,i,a){var d,c,h=n(s(t)),p=r(i),f=h.length,m=void 0===a?" ":n(a);return p<=f||""===m?h:((c=o(m,u((d=p-f)/m.length))).length>d&&(c=l(c,0,d)),e?h+c:c+h)}};t.exports={start:d(!1),end:d(!0)}})),IP=oA(((e,t)=>{var i=CA();t.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(i)})),xP=oA((()=>{var e=rR(),t=LP().start;e({target:"String",proto:!0,forced:IP()},{padStart:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}})})),MP=oA(((e,t)=>{xP();var i=hR();t.exports=i("String","padStart")})),NP=oA(((e,t)=>{var i=MP();t.exports=i})),DP=oA(((e,t)=>{var i=NP();t.exports=i})),kP="2.0.130",$P=((W_=$P||{}).STOPPED="stopped",W_.READY="ready",W_.PLAYING="playing",W_.PAUSED="paused",W_),VP=((z_=VP||{}).MPEG="MPEG",z_.DASH="DASH",z_.DASH_SEP="DASH_SEP",z_.DASH_SEP_VK="DASH_SEP",z_.DASH_WEBM="DASH_WEBM",z_.DASH_WEBM_AV1="DASH_WEBM_AV1",z_.DASH_STREAMS="DASH_STREAMS",z_.DASH_WEBM_VK="DASH_WEBM",z_.DASH_ONDEMAND="DASH_ONDEMAND",z_.DASH_ONDEMAND_VK="DASH_ONDEMAND",z_.DASH_LIVE="DASH_LIVE",z_.DASH_LIVE_CMAF="DASH_LIVE_CMAF",z_.DASH_LIVE_WEBM="DASH_LIVE_WEBM",z_.HLS="HLS",z_.HLS_ONDEMAND="HLS_ONDEMAND",z_.HLS_JS="HLS",z_.HLS_LIVE="HLS_LIVE",z_.HLS_LIVE_CMAF="HLS_LIVE_CMAF",z_.WEB_RTC_LIVE="WEB_RTC_LIVE",z_),UP=(e=>(e.NOT_AVAILABLE="NOT_AVAILABLE",e.AVAILABLE="AVAILABLE",e.CONNECTING="CONNECTING",e.CONNECTED="CONNECTED",e))(UP||{}),BP=((Q_=BP||{}).HTTP1="http1",Q_.HTTP2="http2",Q_.QUIC="quic",Q_),FP=(e=>(e.NONE="none",e.INLINE="inline",e.FULLSCREEN="fullscreen",e.SECOND_SCREEN="second_screen",e.PIP="pip",e.INVISIBLE="invisible",e))(FP||{}),HP=(e=>(e.TRAFFIC_SAVING="traffic_saving",e.HIGH_QUALITY="high_quality",e.UNKNOWN="unknown",e))(HP||{}),jP=lA(mR(),1),GP=class{constructor(e){var t;this.connection$=new n_(void 0),this.castState$=new n_("NOT_AVAILABLE"),this.errorEvent$=new mb,this.realCastState$=new n_("NOT_AVAILABLE"),this.subscription=new cb,this.isDestroyed=!1,this.params=e,this.log=this.params.dependencies.logger.createComponentLog("ChromecastInitializer");let i="chrome"in window;if(this.log({message:`[constructor] receiverApplicationId: ${this.params.receiverApplicationId}, isDisabled: ${this.params.isDisabled}, isSupported: ${i}`}),e.isDisabled||!i)return;let r=Tb(null==(t=window.chrome)?void 0:t.cast),n=!!window.__onGCastApiAvailable;var a;r?this.initializeCastApi():(window.__onGCastApiAvailable=e=>{delete window.__onGCastApiAvailable,e&&!this.isDestroyed&&this.initializeCastApi()},n||(a="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1",new Promise(((e,t)=>{let i=document.createElement("script");i.setAttribute("src",a),i.onload=()=>e(),i.onerror=e=>t(e),document.body.appendChild(i)}))).catch((()=>this.errorEvent$.next({id:"ChromecastLoading",category:M_.NETWORK,message:"Script loading failed!"}))))}connect(){var e;null==(e=cast.framework.CastContext.getInstance())||e.requestSession()}disconnect(){var e,t;null==(t=null==(e=cast.framework.CastContext.getInstance())?void 0:e.getCurrentSession())||t.endSession(!0)}stopMedia(){return new Promise(((e,t)=>{var i,r,n;null==(n=null==(r=null==(i=cast.framework.CastContext.getInstance())?void 0:i.getCurrentSession())?void 0:r.getMediaSession())||n.stop(new chrome.cast.media.StopRequest,e,t)}))}toggleConnection(){Tb(this.connection$.getValue())?this.disconnect():this.connect()}setVolume(e){let t=this.connection$.getValue();Eb(t)||(t.remotePlayer.volumeLevel=e,t.remotePlayerController.setVolumeLevel())}setMuted(e){let t=this.connection$.getValue();Eb(t)||e!==t.remotePlayer.isMuted&&t.remotePlayerController.muteOrUnmute()}destroy(){this.isDestroyed=!0,this.subscription.unsubscribe()}initListeners(){let e=new cast.framework.RemotePlayer,t=new cast.framework.RemotePlayerController(e),i=cast.framework.CastContext.getInstance();this.subscription.add(d_(i,cast.framework.CastContextEventType.SESSION_STATE_CHANGED).subscribe((e=>{var t,r,n;switch(e.sessionState){case cast.framework.SessionState.SESSION_STARTED:case cast.framework.SessionState.SESSION_STARTING:case cast.framework.SessionState.SESSION_RESUMED:this.contentId=null==(n=null==(r=null==(t=i.getCurrentSession())?void 0:t.getMediaSession())?void 0:r.media)?void 0:n.contentId;break;case cast.framework.SessionState.NO_SESSION:case cast.framework.SessionState.SESSION_ENDING:case cast.framework.SessionState.SESSION_ENDED:case cast.framework.SessionState.SESSION_START_FAILED:this.contentId=void 0;break;default:return hb(e.sessionState)}}))).add(o_(d_(i,cast.framework.CastContextEventType.CAST_STATE_CHANGED).pipe(L_((e=>{this.log({message:`[cast.framework.RemotePlayerEventType.CAST_STATE_CHANGED]: ${JSON.stringify(e)}`})})),A_((e=>e.castState))),u_([i.getCastState()])).pipe(E_(),A_(qP),L_((e=>{this.log({message:`realCastState$: ${e}`})}))).subscribe(this.realCastState$)).add(this.realCastState$.subscribe((r=>{var n,a;let s="CONNECTED"===r,o=Tb(this.connection$.getValue());if(s&&!o){let r=i.getCurrentSession();yb(r);let s=r.getCastDevice(),o=null==(a=null==(n=r.getMediaSession())?void 0:n.media)?void 0:a.contentId;(Eb(o)||o===this.contentId)&&(this.log({message:"connection created"}),this.connection$.next({remotePlayer:e,remotePlayerController:t,session:r,castDevice:s}))}else!s&&o&&(this.log({message:"connection destroyed"}),this.connection$.next(void 0));this.castState$.next("CONNECTED"===r?Tb(this.connection$.getValue())?"CONNECTED":"AVAILABLE":r)})))}initializeCastApi(){var e;let t,i,r;try{t=cast.framework.CastContext.getInstance(),i=chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,r=chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED}catch(e){return}try{t.setOptions({receiverApplicationId:null!=(e=this.params.receiverApplicationId)?e:i,autoJoinPolicy:r}),this.initListeners()}catch(e){this.errorEvent$.next({id:"ChromecastInitializer",category:M_.EXTERNAL_API,message:"[initializeCastApi] failed",thrown:e})}}},qP=e=>{switch(e){case cast.framework.CastState.NO_DEVICES_AVAILABLE:return"NOT_AVAILABLE";case cast.framework.CastState.NOT_CONNECTED:return"AVAILABLE";case cast.framework.CastState.CONNECTING:return"CONNECTING";case cast.framework.CastState.CONNECTED:return"CONNECTED";default:return hb(e)}},zP=lA(mR(),1),WP=lA(PR(),1),QP=lA(sw(),1),YP=lA(Gw(),1),KP=(e,t=0,i=0)=>{switch(i){case 0:return e.replace("_offset_p",0===t?"":"_"+t.toFixed(0));case 1:{if(0===t)return e;let i=new URL(e);return i.searchParams.append("playback_shift",t.toFixed(0)),i.toString()}case 2:{let i=new URL(e);return i.searchParams.get("offset_p")||0!==t?(i.searchParams.set("offset_p",t.toFixed(0)),i.toString()):e}default:hb(i)}return e},XP=(e,t)=>{var i;switch(t){case 0:return NaN;case 1:{let t=new URL(e);return Number(t.searchParams.get("playback_shift"))}case 2:{let t=new URL(e);return Number(null!=(i=t.searchParams.get("offset_p"))?i:0)}default:hb(t)}},JP=(e,t,i=!1)=>{let r=e.getTransition();(i||!r||r.to===t)&&e.setState(t)},ZP=class{constructor(e){this.transitionStarted$=new mb,this.transitionEnded$=new mb,this.transitionUpdated$=new mb,this.forceChanged$=new mb,this.stateChangeStarted$=o_(this.transitionStarted$,this.transitionUpdated$),this.stateChangeEnded$=o_(this.transitionEnded$,this.forceChanged$),this.state=e,this.prevState=void 0}setState(e){let t=this.transition,i=this.state;this.transition=void 0,this.prevState=i,this.state=e,t?t.to===e?this.transitionEnded$.next(t):this.forceChanged$.next({from:t.from,to:e,canceledTransition:t}):this.forceChanged$.next({from:i,to:e,canceledTransition:t})}startTransitionTo(e){let t=this.transition,i=this.state;i===e||Tb(t)&&t.to===e||(this.prevState=i,this.state=e,t?(this.transition={from:t.from,to:e,canceledTransition:t},this.transitionUpdated$.next(this.transition)):(this.transition={from:i,to:e},this.transitionStarted$.next(this.transition)))}getTransition(){return this.transition}getState(){return this.state}getPrevState(){return this.prevState}},eO=class{constructor(e){this.subscription=new cb,this.loadMediaTimeoutSubscription=new cb,this.videoState=new ZP("stopped"),this.syncPlayback=()=>{let e=this.videoState.getState(),t=this.videoState.getTransition(),i=this.params.desiredState.playbackState.getState(),r=this.params.desiredState.playbackState.getTransition(),n=this.params.desiredState.seekState.getState();if(this.log({message:`[syncPlayback] videoState: ${e}; videoTransition: ${JSON.stringify(t)}; desiredPlaybackState: ${i}; desiredPlaybackStateTransition: ${this.params.desiredState.playbackState.getTransition()}; seekState: ${JSON.stringify(n)};`}),"stopped"!==i){if(!t){if("paused"!==(null==r?void 0:r.to)&&"requested"===n.state&&"stopped"!==e)return void this.seek(n.position/1e3);switch(i){case"ready":switch(e){case"playing":case"paused":case"ready":break;case"stopped":this.videoState.startTransitionTo("ready"),this.prepare();break;default:hb(e)}break;case"playing":switch(e){case"playing":break;case"paused":case"ready":this.videoState.startTransitionTo("playing"),this.params.connection.remotePlayerController.playOrPause();break;case"stopped":this.videoState.startTransitionTo("ready"),this.prepare();break;default:hb(e)}break;case"paused":switch(e){case"playing":this.videoState.startTransitionTo("paused"),this.params.connection.remotePlayerController.playOrPause();break;case"paused":break;case"ready":this.videoState.startTransitionTo("paused"),this.videoState.setState("paused");break;case"stopped":this.videoState.startTransitionTo("ready"),this.prepare();break;default:hb(e)}break;default:hb(i)}}}else"stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.stop())},this.params=e,this.log=this.params.dependencies.logger.createComponentLog("ChromecastProvider"),this.log({message:`constructor, format: ${e.format}`}),this.params.output.isLive$.next((e=>{switch(e){case"MPEG":case"DASH":case"DASH_SEP":case"DASH_ONDEMAND":case"DASH_WEBM":case"DASH_WEBM_AV1":case"DASH_STREAMS":case"HLS":case"HLS_ONDEMAND":return!1;case"DASH_LIVE":case"DASH_LIVE_CMAF":case"HLS_LIVE":case"HLS_LIVE_CMAF":case"DASH_LIVE_WEBM":case"WEB_RTC_LIVE":return!0;default:return hb(e)}})(e.format)),this.params.output.isAudioAvailable$.next(!0),this.handleRemoteVolumeChange({volume:this.params.connection.remotePlayer.volumeLevel,muted:this.params.connection.remotePlayer.isMuted});let t=this.params.connection.session.getMediaSession();t&&this.restoreSession(t),this.subscribe()}destroy(){this.log({message:"[destroy]"}),this.subscription.unsubscribe()}subscribe(){this.subscription.add(this.loadMediaTimeoutSubscription);let e=new cb;this.subscription.add(e),this.subscription.add(o_(this.videoState.stateChangeStarted$.pipe(A_((e=>`stateChangeStarted$ ${JSON.stringify(e)}`))),this.videoState.stateChangeEnded$.pipe(A_((e=>`stateChangeEnded$ ${JSON.stringify(e)}`)))).subscribe((e=>this.log({message:`[videoState] ${e}`}))));let t=(e,t)=>this.subscription.add(e.subscribe(t));if(this.params.output.isLive$.getValue())this.params.output.position$.next(0),this.params.output.duration$.next(0);else{let t=new mb;e.add(t.pipe(h_(500)).subscribe((()=>{this.params.output.seekedEvent$.next()})));let i=NaN;e.add(d_(this.params.connection.remotePlayerController,cast.framework.RemotePlayerEventType.CURRENT_TIME_CHANGED).subscribe((e=>{this.logRemoteEvent(e);let r=e.value;this.params.output.position$.next(r),("applying"===this.params.desiredState.seekState.getState().state||Math.abs(r-i)>5)&&t.next(r),i=r}))),e.add(d_(this.params.connection.remotePlayerController,cast.framework.RemotePlayerEventType.DURATION_CHANGED).subscribe((e=>{this.logRemoteEvent(e),this.params.output.duration$.next(e.value)})))}t(d_(this.params.connection.remotePlayerController,cast.framework.RemotePlayerEventType.IS_MEDIA_LOADED_CHANGED),(t=>{this.logRemoteEvent(t),t.value?this.handleRemoteReady():(this.handleRemoteStop(),e.unsubscribe())})),t(d_(this.params.connection.remotePlayerController,cast.framework.RemotePlayerEventType.IS_PAUSED_CHANGED),(e=>{this.logRemoteEvent(e),e.value?this.handleRemotePause():this.handleRemotePlay()})),t(d_(this.params.connection.remotePlayerController,cast.framework.RemotePlayerEventType.PLAYER_STATE_CHANGED),(e=>{this.logRemoteEvent(e);let{remotePlayer:t}=this.params.connection,i=e.value,r=this.params.output.isBuffering$.getValue(),n=i===chrome.cast.media.PlayerState.BUFFERING;switch(r!==n&&this.params.output.isBuffering$.next(n),i){case chrome.cast.media.PlayerState.IDLE:!this.params.output.isLive$.getValue()&&t.duration-t.currentTime<5&&this.params.output.endedEvent$.next(),this.handleRemoteStop(),JP(this.params.desiredState.playbackState,"stopped");break;case chrome.cast.media.PlayerState.PAUSED:this.handleRemotePause();break;case chrome.cast.media.PlayerState.PLAYING:this.handleRemotePlay();break;case chrome.cast.media.PlayerState.BUFFERING:break;default:hb(i)}})),t(d_(this.params.connection.remotePlayerController,cast.framework.RemotePlayerEventType.VOLUME_LEVEL_CHANGED),(e=>{this.logRemoteEvent(e),this.handleRemoteVolumeChange({volume:e.value})})),t(d_(this.params.connection.remotePlayerController,cast.framework.RemotePlayerEventType.IS_MUTED_CHANGED),(e=>{this.logRemoteEvent(e),this.handleRemoteVolumeChange({muted:e.value})})),t(o_(this.params.desiredState.playbackState.stateChangeStarted$,this.params.desiredState.seekState.stateChangeEnded$,this.videoState.stateChangeEnded$,u_(["init"])).pipe(h_(0)),this.syncPlayback)}restoreSession(e){this.log({message:"restoreSession"});let{remotePlayer:t}=this.params.connection;if(e.playerState!==chrome.cast.media.PlayerState.IDLE){t.isPaused?(this.videoState.setState("paused"),JP(this.params.desiredState.playbackState,"paused")):(this.videoState.setState("playing"),JP(this.params.desiredState.playbackState,"playing"));let e=this.params.output.isLive$.getValue();this.params.output.duration$.next(e?0:t.duration),this.params.output.position$.next(e?0:t.currentTime),this.params.desiredState.seekState.setState({state:"none"})}}prepare(){let e=this.params.format;this.log({message:`[prepare] format: ${e}`});let t=this.createMediaInfo(e),i=this.createLoadRequest(t);this.loadMedia(i)}handleRemotePause(){let e=this.videoState.getState(),t=this.videoState.getTransition();("paused"===(null==t?void 0:t.to)||"playing"===e)&&(this.videoState.setState("paused"),JP(this.params.desiredState.playbackState,"paused"))}handleRemotePlay(){let e=this.videoState.getState(),t=this.videoState.getTransition();("playing"===(null==t?void 0:t.to)||"paused"===e)&&(this.videoState.setState("playing"),JP(this.params.desiredState.playbackState,"playing"))}handleRemoteReady(){var e;let t=this.videoState.getTransition();"ready"===(null==t?void 0:t.to)&&this.videoState.setState("ready"),"ready"===(null==(e=this.params.desiredState.playbackState.getTransition())?void 0:e.to)&&JP(this.params.desiredState.playbackState,"ready")}handleRemoteStop(){"stopped"!==this.videoState.getState()&&this.videoState.setState("stopped")}handleRemoteVolumeChange(e){var t,i;let r=this.params.output.volume$.getValue(),n={volume:null!=(t=e.volume)?t:r.volume,muted:null!=(i=e.muted)?i:r.muted};(n.volume!==r.volume||n.muted!=n.muted)&&this.params.output.volume$.next(n)}seek(e){this.params.output.willSeekEvent$.next();let{remotePlayer:t,remotePlayerController:i}=this.params.connection;t.currentTime=e,i.seek()}stop(){let{remotePlayerController:e}=this.params.connection;e.stop()}createMediaInfo(e){var t;let i,r,n,a=this.params.source;switch(e){case"MPEG":{let t=a[e];yb(t);let s=(e=>e.sort(((e,t)=>e===t?0:"Invariant quality"===e?1:"Invariant quality"===t?-1:Gb(e,t)?1:-1))[0])(Object.keys(t));yb(s);let o=t[s];yb(o),i=o,r="video/mp4",n=chrome.cast.media.StreamType.BUFFERED;break}case"HLS":case"HLS_ONDEMAND":{let t=a[e];yb(t),i=t.url,r="application/x-mpegurl",n=chrome.cast.media.StreamType.BUFFERED;break}case"DASH_SEP":case"DASH_ONDEMAND":case"DASH_WEBM":case"DASH_WEBM_AV1":case"DASH_STREAMS":{let t=a[e];yb(t),i=t.url,r="application/dash+xml",n=chrome.cast.media.StreamType.BUFFERED;break}case"DASH_LIVE_CMAF":{let t=a[e];yb(t),i=t.url,r="application/dash+xml",n=chrome.cast.media.StreamType.LIVE;break}case"HLS_LIVE":case"HLS_LIVE_CMAF":{let t=a[e];yb(t),i=KP(t.url),r="application/x-mpegurl",n=chrome.cast.media.StreamType.LIVE;break}case"DASH_LIVE":case"WEB_RTC_LIVE":{let e="Unsupported format for Chromecast",t=new Error(e);throw this.params.output.error$.next({id:"ChromecastProvider.createMediaInfo()",category:M_.VIDEO_PIPELINE,message:e,thrown:t}),t}case"DASH":case"DASH_LIVE_WEBM":throw new Error(`${e} is no longer supported`);default:return hb(e)}let s=new chrome.cast.media.MediaInfo(null!=(t=this.params.meta.videoId)?t:i,r);s.contentUrl=i,s.streamType=n,s.metadata=new chrome.cast.media.GenericMediaMetadata;let{title:o,subtitle:l}=this.params.meta;return Tb(o)&&(s.metadata.title=o),Tb(l)&&(s.metadata.subtitle=l),s}createLoadRequest(e){let t=new chrome.cast.media.LoadRequest(e);t.autoplay=!1;let i=this.params.desiredState.seekState.getState();return"applying"===i.state||"requested"===i.state?t.currentTime=this.params.output.isLive$.getValue()?0:i.position/1e3:t.currentTime=0,t}loadMedia(e){let t=this.params.connection.session.loadMedia(e),i=new Promise(((e,t)=>{this.loadMediaTimeoutSubscription.add((e=>new fb((t=>{let i=window.setTimeout((()=>{try{t.next()}catch(e){if(!t.error)throw e;t.error(e)}}),e);return()=>window.clearTimeout(i)})))(7e3).subscribe((()=>t("timeout(7000)"))))}));(0,YP.default)(Promise.race([t,i]).then((()=>{this.log({message:`[loadMedia] completed, format: ${this.params.format}`}),"applying"===this.params.desiredState.seekState.getState().state&&this.params.output.seekedEvent$.next(),this.handleRemoteReady()}),(e=>{let t=`[prepare] loadMedia failed, format: ${this.params.format}, reason: ${e}`;this.log({message:t}),this.params.output.error$.next({id:"ChromecastProvider.loadMedia",category:M_.VIDEO_PIPELINE,message:t,thrown:e})})),(()=>{this.loadMediaTimeoutSubscription.unsubscribe()}))}logRemoteEvent(e){this.log({message:`[remoteEvent] ${JSON.stringify(e)}`})}},tO=lA(mR(),1),iO=window.WeakMap?new WeakMap:new class{constructor(){this.attribute="data-pool-reused"}get(e){return e.hasAttribute(this.attribute)}set(e,t){e.toggleAttribute(this.attribute,t)}delete(e){e.removeAttribute(this.attribute)}},rO=window.WeakMap?new WeakMap:new Map,nO=(e,{audioVideoSyncRate:t,disableYandexPiP:i})=>{let r=e.querySelector("video"),n=!!r;r?t_(r):(r=document.createElement("video"),e.appendChild(r)),iO.set(r,n);let a=new cb;return a.add(((e,t=20)=>{let i=0;return d_(e,"ratechange").subscribe((r=>{i++,i>=t&&(e.currentTime=e.currentTime,i=0)}))})(r,t)),rO.set(r,a),r.setAttribute("crossorigin","anonymous"),r.setAttribute("playsinline","playsinline"),i&&r.setAttribute("x-yandex-pip","false"),r.controls=!1,r.setAttribute("poster","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="),r},aO=e=>{let t=rO.get(e);null==t||t.unsubscribe(),rO.delete(e);let i=iO.get(e);iO.delete(e),i?t_(e):(e=>{try{e.pause(),e.playbackRate=0,t_(e),e.remove()}catch(e){console.error(e)}})(e)},sO=lA(Qw(),1),oO=(e,t,i,{equal:r=(e,t)=>e===t,changed$:n,onError:a}={})=>{let s=e.getState(),o=t(),l=Eb(n),u=new cb;return n&&u.add(n.subscribe((t=>{let i=e.getState();r(t,i)&&e.setState(t)}),a)),r(o,s)||(i(s),l&&e.setState(s)),u.add(e.stateChangeStarted$.subscribe((t=>{i(t.to),l&&e.setState(t.to)}),a)),u},lO=(e,t,i)=>oO(t,(()=>e.loop),(t=>{Tb(t)&&(e.loop=t)}),{onError:i}),uO=(e,t,i,r)=>oO(t,(()=>({muted:e.muted,volume:e.volume})),(t=>{Tb(t)&&(e.muted=t.muted,e.volume=t.volume)}),{equal:(e,t)=>e===t||(null==e?void 0:e.muted)===(null==t?void 0:t.muted)&&(null==e?void 0:e.volume)===(null==t?void 0:t.volume),changed$:i,onError:r}),dO=(e,t,i,r)=>oO(t,(()=>e.playbackRate),(t=>{Tb(t)&&(e.playbackRate=t)}),{changed$:i,onError:r}),cO=oO,hO=(e,t)=>{if(e.id===t)return!0;let[i,r,n]=t.split("|");return e.language===r&&e.label===n},pO=class e{constructor(e){this.available$=new mb,this.current$=new n_(void 0),this.error$=new mb,this.subscription=new cb,this.externalTracks=new Map,this.internalTracks=new Map,this.baseURL=e}connect(e,t,i){this.video=e,this.cueSettings=t.textTrackCuesSettings,this.subscribe();let r=e=>{this.error$.next({id:"TextTracksManager",category:M_.WTF,message:"Generic HtmlVideoTextTrackManager error",thrown:e})};this.subscription.add(this.available$.subscribe(i.availableTextTracks$)),this.subscription.add(this.current$.subscribe(i.currentTextTrack$)),this.subscription.add(this.error$.subscribe(i.error$)),this.subscription.add(cO(t.internalTextTracks,(()=>(0,sO.default)(this.internalTracks)),(e=>{Tb(e)&&this.setInternal(e)}),{equal:(e,t)=>Tb(e)&&Tb(t)&&e.length===t.length&&e.every((({id:e},i)=>e===t[i].id)),changed$:this.available$.pipe(A_((e=>e.filter((({type:e})=>"internal"===e))))),onError:r})),this.subscription.add(cO(t.externalTextTracks,(()=>(0,sO.default)(this.externalTracks)),(e=>{Tb(e)&&this.setExternal(e)}),{equal:(e,t)=>Tb(e)&&Tb(t)&&e.length===t.length&&e.every((({id:e},i)=>e===t[i].id)),changed$:this.available$.pipe(A_((e=>e.filter((({type:e})=>"external"===e))))),onError:r})),this.subscription.add(cO(t.currentTextTrack,(()=>{if(this.video)return;let e=this.htmlTextTracksAsArray().find((({mode:e})=>"showing"===e));return e&&this.htmlTextTrackToITextTrack(e).id}),(e=>this.select(e)),{changed$:this.current$,onError:r})),this.subscription.add(cO(t.textTrackCuesSettings,(()=>({})),(()=>{if(this.video)for(let e of this.htmlTextTracksAsArray())this.applyCueSettings(e.cues),this.applyCueSettings(e.activeCues)})))}subscribe(){yb(this.video);let{textTracks:e}=this.video;this.subscription.add(d_(e,"addtrack").subscribe((()=>{let e=this.current$.getValue();e&&this.select(e)}))),this.subscription.add(o_(d_(e,"addtrack"),d_(e,"removetrack"),u_(["init"])).pipe(A_((()=>this.htmlTextTracksAsArray().map((e=>this.htmlTextTrackToITextTrack(e))))),E_(((e,t)=>e.length===t.length&&e.every((({id:e},i)=>e===t[i].id))))).subscribe(this.available$)),this.subscription.add(o_(d_(e,"change"),u_(["init"])).pipe(A_((()=>this.htmlTextTracksAsArray().find((({mode:e})=>"showing"===e)))),A_((e=>e&&this.htmlTextTrackToITextTrack(e).id)),E_()).subscribe(this.current$));let t=e=>{var t,i;return this.applyCueSettings(null!=(i=null==(t=e.target)?void 0:t.activeCues)?i:null)};this.subscription.add(d_(e,"addtrack").subscribe((e=>{var i,r;null==(i=e.track)||i.addEventListener("cuechange",t);let n=e=>{var t,i,r,a,s;let o=null!=(i=null==(t=e.target)?void 0:t.cues)?i:null;o&&o.length&&(this.applyCueSettings(null!=(a=null==(r=e.target)?void 0:r.cues)?a:null),null==(s=e.target)||s.removeEventListener("cuechange",n))};null==(r=e.track)||r.addEventListener("cuechange",n)}))),this.subscription.add(d_(e,"removetrack").subscribe((e=>{var i;null==(i=e.track)||i.removeEventListener("cuechange",t)})))}applyCueSettings(e){if(!e||!e.length)return;let t=this.cueSettings.getState();for(let i of Array.from(e)){let e=i;Tb(t.align)&&(e.align=t.align),Tb(t.position)&&(e.position=t.position),Tb(t.size)&&(e.size=t.size),Tb(t.line)&&(e.line=t.line)}}htmlTextTracksAsArray(t=!1){yb(this.video);let i=[...this.video.textTracks];return t?i:i.filter(e.isHealthyTrack)}htmlTextTrackToITextTrack(e){var t,i,r,n,a;let{language:s,label:o}=e,l=e.id?e.id:(e=>["__",e.language,e.label].join("|"))(e),u=this.externalTracks.has(l),d=null!=(r=u?null==(t=this.externalTracks.get(l))?void 0:t.isAuto:null==(i=this.internalTracks.get(l))?void 0:i.isAuto)?r:l.includes("auto");return u?{id:l,type:"external",isAuto:d,language:s,label:o,url:null==(n=this.externalTracks.get(l))?void 0:n.url}:{id:l,type:"internal",isAuto:d,language:s,label:o,url:null==(a=this.internalTracks.get(l))?void 0:a.url}}static isHealthyTrack(e){return!("metadata"===e.kind||e.groupId||""===e.id&&""===e.label&&""===e.language)}setExternal(e){this.internalTracks.size>0&&Array.from(this.internalTracks).forEach((([,e])=>this.detach(e))),e.filter((({id:e})=>!this.externalTracks.has(e))).forEach((e=>this.attach(e))),Array.from(this.externalTracks).filter((([t])=>!e.find((e=>e.id===t)))).forEach((([,e])=>this.detach(e)))}setInternal(e){let t=[...this.externalTracks];e.filter((({id:e,language:i,isAuto:r})=>!this.internalTracks.has(e)&&!t.some((([,e])=>e.language===i&&e.isAuto===r)))).forEach((e=>this.attach(e))),Array.from(this.internalTracks).filter((([t])=>!e.find((e=>e.id===t)))).forEach((([,e])=>this.detach(e)))}select(e){yb(this.video);for(let e of this.htmlTextTracksAsArray(!0))e.mode="showing";for(let t of this.htmlTextTracksAsArray(!0))(Eb(e)||!hO(t,e))&&(t.mode="disabled")}destroy(){if(this.subscription.unsubscribe(),this.video)for(let e of Array.from(this.video.getElementsByTagName("track"))){let t=e.getAttribute("id");t&&this.externalTracks.has(t)&&this.video.removeChild(e)}this.externalTracks.clear()}attach(e){yb(this.video);let t=document.createElement("track");this.baseURL?t.setAttribute("src",new URL(e.url,this.baseURL).toString()):t.setAttribute("src",e.url),t.setAttribute("id",e.id),e.label&&t.setAttribute("label",e.label),e.language&&t.setAttribute("srclang",e.language),"external"===e.type?this.externalTracks.set(e.id,e):"internal"===e.type&&this.internalTracks.set(e.id,e),this.video.appendChild(t)}detach(e){yb(this.video);let t=Array.prototype.find.call(this.video.getElementsByTagName("track"),(t=>t.getAttribute("id")===e.id));t&&this.video.removeChild(t),"external"===e.type?this.externalTracks.delete(e.id):"internal"===e.type&&this.internalTracks.delete(e.id)}},fO=class{constructor(){this.pausedTime=0,this.streamOffset=0,this.pauseTimestamp=0}getTotalPausedTime(){return this.pausedTime+this.getCurrentPausedTime()}getCurrentPausedTime(){return this.pauseTimestamp>0?Date.now()-this.pauseTimestamp:0}getStreamOffset(){return this.streamOffset}getTotalOffset(){return this.getTotalPausedTime()+this.streamOffset}pause(){0===this.pauseTimestamp&&(this.pauseTimestamp=Date.now())}resume(){this.pauseTimestamp>0&&(this.pausedTime+=this.getCurrentPausedTime(),this.pauseTimestamp=0)}resetTo(e,t=!1){this.streamOffset=e,this.pauseTimestamp=0,this.pausedTime=0,t&&this.pause()}},mO=e=>{let t=e;for(;!(t instanceof Document||t instanceof ShadowRoot||null===t);)t=null==t?void 0:t.parentNode;return null!=t?t:void 0},gO=e=>{let t=mO(e);return!(!t||!t.fullscreenElement||t.fullscreenElement!==e)},vO=class{get current(){return this._current}get isYandex(){return"Yandex"===this.current}get isSafari(){return"Safari"===this.current}get isSamsungBrowser(){return"SamsungBrowser"===this.current}get safariVersion(){return this._safariVersion}detect(){let{userAgent:e}=navigator;try{let t=/yabrowser/i.test(e)?"Yandex":void 0,i=/samsungbrowser/i.test(e)?"SamsungBrowser":void 0,r=/chrome|crios/i.test(e)?"Chrome":void 0,n=/chromium/i.test(e)?"Chromium":void 0,a=/firefox|fxios/i.test(e)?"Firefox":void 0,s=/webkit|safari|khtml/i.test(e)?"Safari":void 0,o=/opr\//i.test(e)?"Opera":void 0,l=/edg/i.test(e)?"Edge":void 0;this._current=t||i||a||o||l||r||n||s||"Rest"}catch(e){console.error(e)}this.isSafari&&this.detectSafariVersion()}detectSafariVersion(){try{let{userAgent:e}=window.navigator,t=e.match(/Version\/(\d+)/);if(!t)return;let i=t[1],r=parseInt(i,10);if(isNaN(r))return;this._safariVersion=r}catch(e){console.error(e)}}},SO=lA(mR(),1),yO=class{constructor(e){this._highEntropyValues={},this._displayChecker=e}get current(){return this._current}get isIOS(){return"iOS"===this._highEntropyValues.platform||(0,SO.default)(["iPhone","iPad","iPod"],this.current)}get isMac(){return"macOS"===this._highEntropyValues.platform||"Mac"===this.current}get isApple(){return this.isIOS||this.isMac}get isIphoneOrOldIpad(){if(!this.isApple||!this._displayChecker.isTouch)return!1;let e="iPad"===this.current||this._displayChecker.width>700,t=this._iosVersion;return!e||e&&!!t&&t<16}get isAndroid(){return"Android"===this._highEntropyValues.platform||"Android"===this.current}get isMobile(){return this._highEntropyValues.mobile||this._isMobile}get iOSVersion(){return this._iosVersion}detect(){let{userAgent:e}=navigator;try{this._isMobile=(()=>{var e,t;return/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(null!=(e=navigator.appVersion)?e:navigator.userAgent)||(null==(t=null==navigator?void 0:navigator.userAgentData)?void 0:t.mobile)})()}catch(e){console.error(e)}this.detectDevice(e),this.detectHighEntropyValues(),this.isIOS&&this.detectIOSVersion()}async detectHighEntropyValues(){let{userAgentData:e}=navigator;if(e){let t=await e.getHighEntropyValues(["architecture","bitness","brands","mobile","platform","formFactor","model","platformVersion","wow64"]);this._highEntropyValues=t}}detectDevice(e){try{let t=/android/i.test(e)?"Android":void 0,i=/iphone/i.test(e)?"iPhone":void 0,r=/ipad/i.test(e)?"iPad":void 0,n=/ipod/i.test(e)?"iPod":void 0,a=/mac/i.test(e)?"Mac":void 0,s=/webOS|BlackBerry|IEMobile|Opera Mini/i.test(e)?"RestMobile":void 0;this._current=t||i||r||n||s||a||"Desktop"}catch(e){console.error(e)}}detectIOSVersion(){try{if(this._highEntropyValues.platformVersion){let e=this._highEntropyValues.platformVersion.split(".").slice(0,2).join("."),t=parseFloat(e);return void(this._iosVersion=t)}let{userAgent:e}=window.navigator,t=e.match(/OS (\d+(_\d+)?)/i);if(!t)return;let i=t[1].replace(/_/g,".");if(!i)return;let r=parseFloat(i);if(isNaN(r))return;this._iosVersion=r}catch(e){console.error(e)}}},TO=class{get isTouch(){return"number"==typeof this._maxTouchPoints?this._maxTouchPoints>1:"ontouchstart"in window}get maxTouchPoints(){return this._maxTouchPoints}get height(){return this._height}get width(){return this._width}get screenHeight(){return this._screenHeight}get screenWidth(){return this._screenWidth}get pixelRatio(){return this._pixelRatio}get isHDR(){return this._isHdr}get colorDepth(){return this._colorDepth}detect(){var e;let{maxTouchPoints:t}=navigator;try{this._maxTouchPoints=null!=t?t:0,this._isHdr=!(null==(e=matchMedia("(dynamic-range: high)"))||!e.matches),this._colorDepth=screen.colorDepth}catch(e){console.error(e)}try{this._pixelRatio=window.devicePixelRatio||1,this._height=screen.height,this._width=screen.width,this._height=screen.height,this._screenHeight=this._height*this._pixelRatio,this._screenWidth=this._width*this._pixelRatio}catch(e){console.error(e)}}},EO=()=>window.ManagedMediaSource||window.MediaSource,bO=()=>{var e,t;return!(!window.ManagedMediaSource||null==(t=null==(e=window.ManagedSourceBuffer)?void 0:e.prototype)||!t.appendBuffer)},_O=()=>{var e,t;return!(!window.MediaSource||null==(t=null==(e=window.SourceBuffer)?void 0:e.prototype)||!t.appendBuffer)},AO=document.createElement("video"),RO='video/webm; codecs="vp09.00.10.08"',wO='video/webm; codecs="av01.0.00M.08"';(async()=>{if(!window.navigator.mediaCapabilities)return;let e={type:"media-source",video:{contentType:"video/webm",width:1280,height:720,bitrate:1e6,framerate:30}},[t,i]=await Promise.all([window.navigator.mediaCapabilities.decodingInfo({...e,video:{...e.video,contentType:wO}}),window.navigator.mediaCapabilities.decodingInfo({...e,video:{...e.video,contentType:RO}})]);Y_={DASH_WEBM_AV1:t,DASH_WEBM:i}})().catch((e=>{console.log(AO),console.error(e)}));var PO=class{constructor(e,t){this._deviceChecker=e,this._browserChecker=t}get protocols(){return this._protocols}get containers(){return this._containers}get codecs(){return this._codecs}get webmDecodingInfo(){return Y_}get supportedCodecs(){return Object.keys(this._codecs).filter((e=>this._codecs[e]))}get nativeHlsSupported(){return this._nativeHlsSupported}detect(){var e,t,i,r,n,a,s,o,l,u,d,c,h,p,f,m,g,v,S,y;this._video=document.createElement("video");try{this._protocols={mms:bO(),mse:_O(),hls:!!(null!=(t=(e=this._video).canPlayType)&&t.call(e,"application/x-mpegurl")||null!=(r=(i=this._video).canPlayType)&&r.call(i,"vnd.apple.mpegURL")),webrtc:!!window.RTCPeerConnection,ws:!!window.WebSocket},this._containers={mp4:!(null==(a=(n=this._video).canPlayType)||!a.call(n,"video/mp4")),webm:!(null==(o=(s=this._video).canPlayType)||!o.call(s,"video/webm")),cmaf:!0};let T=!(null==(u=null==(l=EO())?void 0:l.isTypeSupported)||!u.call(l,'video/mp4; codecs="avc1.42000a,mp4a.40.2"')),E=!(null==(c=null==(d=EO())?void 0:d.isTypeSupported)||!c.call(d,'video/mp4; codecs="hev1.1.6.L93.B0"')),b=!(null==(p=null==(h=EO())?void 0:h.isTypeSupported)||!p.call(h,'audio/mp4; codecs="mp4a.40.2"'));this._codecs={h264:T,h265:E,vp9:!(null==(m=null==(f=EO())?void 0:f.isTypeSupported)||!m.call(f,RO)),av1:!(null==(v=null==(g=EO())?void 0:g.isTypeSupported)||!v.call(g,wO)),aac:b,opus:!(null==(y=null==(S=EO())?void 0:S.isTypeSupported)||!y.call(S,'audio/webm; codecs="opus"')),mpeg:(T||E)&&b},this._nativeHlsSupported=this._protocols.hls&&this._containers.mp4}catch(e){console.error(e)}this.destroyVideoElement()}destroyVideoElement(){var e;if(!this._video)return;if(this._video.pause(),this._video.currentTime=0,this._video.removeAttribute("src"),this._video.src="",this._video.load(),this._video.remove)return this._video.remove(),void(this._video=null);this._video.parentNode&&this._video.parentNode.removeChild(this._video);let t=this._video.cloneNode(!1);null==(e=this._video.parentNode)||e.replaceChild(t,this._video),this._video=null}},OO="audio/mpeg",CO=class{supportMp3(){return this._codecs.mp3&&this._containers.mpeg}detect(){var e,t,i,r;this._audio=document.createElement("audio");try{this._containers={mpeg:!(null==(t=(e=this._audio).canPlayType)||!t.call(e,OO))},this._codecs={mp3:!(null==(r=null==(i=EO())?void 0:i.isTypeSupported)||!r.call(i,OO))}}catch(e){console.error(e)}this.destroyAudioElement()}destroyAudioElement(){var e;if(!this._audio)return;if(this._audio.pause(),this._audio.currentTime=0,this._audio.removeAttribute("src"),this._audio.src="",this._audio.load(),this._audio.remove)return this._audio.remove(),void(this._audio=null);this._audio.parentNode&&this._audio.parentNode.removeChild(this._audio);let t=this._audio.cloneNode(!1);null==(e=this._audio.parentNode)||e.replaceChild(t,this._audio),this._audio=null}},LO=new class{constructor(){this.isInited$=new n_(!1),this._displayChecker=new TO,this._deviceChecker=new yO(this._displayChecker),this._browserChecker=new vO,this._videoChecker=new PO(this._deviceChecker,this._browserChecker),this._audioChecker=new CO,this.detect()}get display(){return this._displayChecker}get device(){return this._deviceChecker}get browser(){return this._browserChecker}get video(){return this._videoChecker}get audio(){return this._audioChecker}async detect(){this._displayChecker.detect(),this._deviceChecker.detect(),this._browserChecker.detect(),this._videoChecker.detect(),this._audioChecker.detect(),this.isInited$.next(!0)}},IO=e=>{let t,i=t=>d_(e,t).pipe(w_(void 0)),r=new cb,n=o_(...["waiting","pause","canplay","play","canplaythrough","playing","seeking","seeked","ended"].map((t=>d_(e,t)))).pipe(A_((t=>"ended"===t.type?e.readyState<2:e.readyState<3)),E_()),a=o_(d_(e,"progress"),d_(e,"timeupdate")).pipe(A_((()=>((e,t,i=3)=>{let r=0,n=0;for(let a=0;a<e.length;a++){let s=e.start(a),o=e.end(a);if(s<=t&&t<=o){if(r=s,n=o,!i)return{from:r,to:n};for(let t=a-1;t>=0;t--)e.end(t)+i>=r&&(r=e.start(t));for(let t=a+1;t<e.length;t++)e.start(t)-i<=n&&(n=e.end(t))}}return{from:r,to:n}})(e.buffered,e.currentTime)))),s=LO.browser.isSafari?s_({play:i("play").pipe(P_()),playing:i("playing")}).pipe(w_(void 0)):i("playing"),o=d_(e,"volumechange").pipe(A_((()=>({muted:e.muted,volume:e.volume})))),l=d_(e,"ratechange").pipe(A_((()=>e.playbackRate))),u=d_(e,"error").pipe(v_((()=>!(!e.error&&!e.played.length))),A_((()=>{var t;let i=e.error;return{id:i?`MediaError#${i.code}`:"HtmlVideoError",category:M_.VIDEO_PIPELINE,message:i?i.message:"Error event from HTML video element",thrown:null!=(t=e.error)?t:void 0}}))),d=d_(e,"timeupdate").pipe(A_((()=>e.currentTime))),c=new mb;r.add(d.subscribe((i=>{e.loop&&Tb(t)&&Tb(i)&&t>=e.duration-.3&&i<=.3&&c.next(t),t=i})));let h=i("pause").pipe(v_((()=>!e.error&&t!==e.duration))),p=d_(e,"enterpictureinpicture"),f=d_(e,"leavepictureinpicture"),m=new n_((e=>{let t=mO(e);return!(!t||!t.pictureInPictureElement||t.pictureInPictureElement!==e)})(e));r.add(p.subscribe((()=>m.next(!0)))),r.add(f.subscribe((()=>m.next(!1))));let g=new n_(gO(e)),v=d_(e,"fullscreenchange");r.add(v.pipe(A_((()=>gO(e)))).subscribe(g));let S=d_(e,"timeupdate").pipe(v_((t=>e.duration-e.currentTime<.1))),y=o_(S.pipe(v_((t=>!e.loop))),d_(e,"ended")).pipe(m_(1e3),w_(void 0)),T=S.pipe(v_((t=>e.loop)));return{playing$:s,pause$:h,canplay$:i("canplay"),ended$:y,looped$:c,loopExpected$:T,error$:u,seeked$:i("seeked"),seeking$:i("seeking"),progress$:i("progress"),loadStart$:i("loadstart"),loadedMetadata$:i("loadedmetadata"),loadedData$:i("loadeddata"),timeUpdate$:d,durationChange$:d_(e,"durationchange").pipe(A_((()=>e.duration))),isBuffering$:n,currentBuffer$:a,volumeState$:o,playbackRateState$:l,inPiP$:m,inFullscreen$:g,enterPip$:p,leavePip$:f,destroy:()=>r.unsubscribe()}},xO=e=>{switch(e){case"mobile":return Bb.Q_144P;case"lowest":return Bb.Q_240P;case"low":return Bb.Q_360P;case"sd":case"medium":return Bb.Q_480P;case"hd":case"high":return Bb.Q_720P;case"fullhd":case"full":return Bb.Q_1080P;case"quadhd":case"quad":return Bb.Q_1440P;case"ultrahd":case"ultra":return Bb.Q_2160P}},MO=lA(Jw(),1),NO=lA(mR(),1),DO=lA(PR(),1),kO=!1,$O={},VO=e=>{e($O)},UO=(e,t)=>{var i;kO&&($O.meta=null!=(i=$O.meta)?i:{},$O.meta[e]=t)},BO=class{constructor(e){this.name=e}next(e){var t,i;if(!kO)return;$O.series=null!=(t=$O.series)?t:{};let r=null!=(i=$O.series[this.name])?i:[];r.push([Date.now(),e]),$O.series[this.name]=r}};function FO({limits:e,highQualityLimit:t,trafficSavingLimit:i}){return e.max||e.min!==t?e.min||e.max!==i?"unknown":"traffic_saving":"high_quality"}function HO({limits:e,highQualityLimit:t,trafficSavingLimit:i}){return!!e&&"high_quality"===FO({limits:e,highQualityLimit:t,trafficSavingLimit:i})}function jO({limits:e,highestAvailableQuality:t,lowestAvailableQuality:i}){return Eb(e)||Tb(e.min)&&Tb(e.max)&&Gb(e.max,e.min)||Tb(e.min)&&t&&Hb(e.min,t)||Tb(e.max)&&i&&Gb(e.max,i)}function GO({limits:e,highestAvailableHeight:t,lowestAvailableHeight:i}){return jO({limits:{max:null!=e&&e.max?Wb(e.max):void 0,min:null!=e&&e.min?Wb(e.min):void 0},highestAvailableQuality:t?Wb(t):void 0,lowestAvailableQuality:i?Wb(i):void 0})}var qO=new BO("best_bitrate"),zO=(e,t,i)=>(t-i)*Math.pow(2,-10*e)+i,WO=e=>(t,i)=>e*(Number(t.bitrate)-Number(i.bitrate)),QO=class{constructor(){this.history={}}recordSelection(e){this.history[e.id]=Ab()}recordSwitch(e){this.last=e}clear(){this.last=void 0,this.history={}}},YO='Assertion "ABR Tracks is empty array" failed',KO=(e,t,i,r)=>{var n;let a=[...t].sort(WO(1)),s=[...i].sort(WO(1)),o=s.filter((t=>!Tb(t.bitrate)||!Tb(e.bitrate)||e.bitrate/t.bitrate>r)),l=null!=(n=(0,MO.default)(s,Math.round(s.length*a.indexOf(e)/(a.length+1))))?n:(0,MO.default)(s,-1);return l&&(0,NO.default)(o,l)?l:o.length?(0,MO.default)(o,-1):(0,MO.default)(s,0)},XO=e=>"quality"in e,JO=(e,t,i,r)=>{var n;let a=Tb(null==(n=null==r?void 0:r.last)?void 0:n.bitrate)&&Tb(null==i?void 0:i.bitrate)&&r.last.bitrate<i.bitrate?e.trackCooldownIncreaseQuality:e.trackCooldownDecreaseQuality,s=i&&r&&r.history[i.id]&&Ab()-r.history[i.id]<=a&&(!r.last||i.id!==r.last.id);if(null!=i&&i.id&&r&&!s&&r.recordSelection(i),s&&null!=r&&r.last){let e=r.last;return null==r||r.recordSwitch(e),t({message:`\n    [last ${XO(e)?"video":"audio"} selected] ${XO(e)?e.quality:e.bitrate}\n    `}),e}return null==r||r.recordSwitch(i),i},ZO=({tuning:e,container:t,limits:i,panelSize:r})=>{let n=e.containerSizeFactor;if(r)return{containerSizeLimit:r,containerSizeFactor:n};if(e.usePixelRatio&&LO.display.pixelRatio){let t=LO.display.pixelRatio;if(e.pixelRatioMultiplier)n*=e.pixelRatioMultiplier*(t-1)+1;else{let i=e.pixelRatioLogBase,[r=0,a=0,s=0]=e.pixelRatioLogCoefficients,o=((e,t)=>Math.log(t)/Math.log(e))(i,r*t+a)+s;Number.isFinite(o)&&(n*=o)}}return HO({highQualityLimit:e.highQualityLimit,trafficSavingLimit:e.trafficSavingLimit,limits:i})&&(n*=2),{containerSizeLimit:e.limitByContainer&&t&&t.width>0&&t.height>0?{width:t.width*n,height:t.height*n}:void 0,containerSizeFactor:n}},eC=(e,{container:t,estimatedThroughput:i,tuning:r,limits:n,reserve:a=0,forwardBufferHealth:s,playbackRate:o,current:l,history:u,visible:d,droppedVideoMaxQualityLimit:c,stallsVideoMaxQualityLimit:h,stallsPredictedThroughput:p,abrLogger:f,panelSize:m})=>{var g,v,S,y,T;bb(e,YO);let{containerSizeFactor:E,containerSizeLimit:b}=ZO({container:t,tuning:r,limits:n,panelSize:m}),_=r.considerPlaybackRate&&Tb(o)?o:1,A=e.filter((e=>!Kb(e.quality))).sort(((e,t)=>Hb(e.quality,t.quality)?-1:1)),R=null==(g=(0,MO.default)(A,-1))?void 0:g.quality,w=null==(v=(0,MO.default)(A,0))?void 0:v.quality,P=jO({limits:n,lowestAvailableQuality:R,highestAvailableQuality:w}),O=_*zO(null!=s?s:.5,r.bitrateFactorAtEmptyBuffer,r.bitrateFactorAtFullBuffer),C={},L=A.filter((e=>{let t=!0;if(b)if(e.size)t=e.size.width<=b.width&&e.size.height<=b.height;else{let i=b&&Qb(b);t=!i||qb(e.quality,i)}if(!t)return C[e.quality]="FitsContainer",!1;let o=p||i,u=!(Tb(o)&&isFinite(o)&&Tb(e.bitrate))||o-a>=e.bitrate*O,f=HO({highQualityLimit:r.highQualityLimit,trafficSavingLimit:r.trafficSavingLimit,limits:n})&&(null==n?void 0:n.min)===e.quality;if(!u&&!f)return C[e.quality]="FitsThroughput",!1;if(r.lazyQualitySwitch&&Tb(r.minBufferToSwitchUp)&&l&&!Kb(l.quality)&&(null!=s?s:0)<r.minBufferToSwitchUp&&Hb(e.quality,l.quality))return C[e.quality]="Buffer",!1;if(c&&jb(e.quality,c)&&!f)return C[e.quality]="DroppedFramesLimit",!1;if(h&&jb(e.quality,h)&&!f)return C[e.quality]="StallsLimit",!1;let m=P||(Eb(null==n?void 0:n.max)||qb(e.quality,n.max))&&(Eb(null==n?void 0:n.min)||jb(e.quality,n.min)),g=!(Tb(d)&&!d)||qb(e.quality,r.backgroundVideoQualityLimit);return!(!m||!g)||(C[e.quality]="FitsQualityLimits",!1)}))[0];L&&L.bitrate&&qO.next(L.bitrate);let I=null!=(S=null!=L?L:(0,MO.default)(A,-1))?S:e[0],x=null==u?void 0:u.last,M=JO(r,f,I,u);return Tb(u)&&M.quality!==(null==x?void 0:x.quality)&&f({message:`\n    [VIDEO TRACKS ABR]\n    [available video tracks]\n\t${e.map((e=>{var t,i;return`{ id: ${e.id}, quality: ${e.quality}, bitrate: ${e.bitrate}, size: ${null==(t=e.size)?void 0:t.width}:${null==(i=e.size)?void 0:i.height} }`})).join("\n\t")}\n\n    [tuning]\n\t${(0,DO.default)(null!=r?r:{}).map((([e,t])=>`${e}: ${t}`)).join("\n\t")}\n\n    [limit params]\n    containerSizeFactor: ${E},\n    containerSizeLimit: ${null!=(y=null==b?void 0:b.width)?y:0} x ${null!=(T=null==b?void 0:b.height)?T:0},\n    estimatedThroughput: ${i},\n    stallsPredictedThroughput: ${p},\n    reserve: ${a},\n    playbackRate: ${o},\n    playbackRateFactor: ${_},\n    forwardBufferHealth: ${s},\n    bitrateFactor: ${O},\n    minBufferToSwitchUp: ${r.minBufferToSwitchUp},\n    droppedVideoMaxQualityLimit: ${c},\n    stallsVideoMaxQualityLimit: ${h},\n    limitsAreInvalid: ${P},\n    maxQualityLimit: ${null==n?void 0:n.max},\n    minQualityLimit: ${null==n?void 0:n.min},\n\n    [limited video tracks]\n    ${(0,DO.default)(C).map((([e,t])=>`${e}: ${t}`)).join("\n\t")||"All tracks are available"}\n\n    [best video track] ${null==L?void 0:L.quality}\n    [selected video track] ${null==M?void 0:M.quality}\n    `}),M},tC=e=>new URL(e).hostname,iC=lA(Jw(),1),rC=lA(mR(),1),nC=e=>{if(e instanceof DOMException&&(0,rC.default)(["Failed to load because no supported source was found.","The element has no supported sources."],e.message))throw e;return!(e instanceof DOMException&&(20===e.code||"AbortError"===e.name))},aC=async(e,t)=>{let i=e.muted;try{await e.play()}catch(r){if(!nC(r))return!1;if(t&&t(),i)return console.warn(r),!1;e.muted=!0;try{await e.play()}catch(t){return nC(t)&&(e.muted=!1,console.warn(t)),!1}}return!0},sC=lA(Qw(),1);function oC(){return Ab()}function lC(e){return oC()-e}function uC(e){let t=e.split("/"),i=t.slice(0,t.length-1).join("/"),r=/^([a-z]+:)?\/\//i;return{resolve:(e,t,n=!1)=>{(e=>r.test(e))(e)||(e.startsWith("/")||(e="/"+e),e=i+e);let a=e.indexOf("?")>-1?"&":"?";return n&&(e+=a+"lowLat=1",a="&"),t&&(e+=a+"_rnd="+Math.floor(999999999*Math.random())),e}}}function dC(e,t,i,r){let n,a,s,o,l,u=window.XMLHttpRequest,d=!1,c=0,h=!1,p="arraybuffer",f=7e3,m=2e3,g=()=>{if(d)return;yb(o);let e,t=lC(o);if(t<m)return e=m-t,void setTimeout(g,e);m*=2,m>f&&(m=f),a&&a.abort(),a=new u,S()},v=()=>{if(!d){if(--c>=0)return g(),void(r&&r());d=!0,l&&l(),i&&i()}},S=()=>{o=oC(),a=new u,a.open("get",e);let i,r=0,c=0,f=()=>(yb(o),Math.max(o,Math.max(i||0,c||0)));if(n&&a.addEventListener("progress",(e=>{let t=oC();n.updateChunk&&e.loaded>r&&(n.updateChunk(f(),e.loaded-r),r=e.loaded,i=t)})),s&&(a.timeout=s,a.addEventListener("timeout",(()=>v()))),a.addEventListener("load",(()=>{if(d)return;yb(a);let e=a.status;if(e>=200&&e<300){let{response:e,responseType:i}=a,s=null==e?void 0:e.byteLength;if("number"==typeof s&&n){let e=s-r;e&&n.updateChunk&&n.updateChunk(f(),e)}"json"!==i||e&&(0,sC.default)(e).length?(l&&l(),t(e)):v()}else v()})),a.addEventListener("error",(()=>{v()})),h){let e=()=>{yb(a),a.readyState===XMLHttpRequest.HEADERS_RECEIVED&&(c=oC(),a.removeEventListener("readystatechange",e))};a.addEventListener("readystatechange",e)}return a.responseType=p,a.send(),y},y={withBitrateReporting:e=>(n=e,y),withParallel:e=>(h=e,y),withJSONResponse:()=>(p="json",y),withRetryCount:e=>(c=e,y),withRetryInterval:(e,t)=>(Tb(e)&&(m=e),Tb(t)&&(f=t),y),withTimeout:e=>(s=e,y),withFinally:e=>(l=e,y),send:S,abort:()=>{a&&(a.abort(),a=void 0),d=!0,l&&l()}};return y}var cC=class{constructor(e){this.intervals=[],this.currentRate=0,this.logger=e}_updateRate(e){let t=.2;this.currentRate&&(e<.1*this.currentRate?t=.8:e<.5*this.currentRate?t=.5:e<.7*this.currentRate&&(t=.3)),e=Math.max(1,Math.min(e,104857600)),this.currentRate=this.currentRate?this.currentRate*(1-t)+e*t:e}_createInterval(e,t,i){return{start:e,end:t,bytes:i}}_doMergeIntervals(e,t){e.start=Math.min(t.start,e.start),e.end=Math.max(t.end,e.end),e.bytes+=t.bytes}_mergeIntervals(e,t){return e.start<=t.end&&t.start<=e.end&&(this._doMergeIntervals(e,t),!0)}_flushIntervals(){if(!this.intervals.length)return!1;let e=this.intervals[0].start,t=this.intervals[this.intervals.length-1].end-500;if(t-e>2e3){let i=0,r=0;for(;this.intervals.length>0;){let e=this.intervals[0];if(e.end<=t)i+=e.end-e.start,r+=e.bytes,this.intervals.splice(0,1);else{if(e.start>=t)break;{let n=t-e.start,a=e.end-e.start;i+=n;let s=e.bytes*n/a;r+=s,e.start=t,e.bytes-=s}}}if(r>0&&i>0){let n=8*r/(i/1e3);return this._updateRate(n),this.logger(`rate updated, new=${Math.round(n/1024)}K; average=${Math.round(this.currentRate/1024)}K bytes/ms=${Math.round(r)}/${Math.round(i)} interval=${Math.round(t-e)}`),!0}}return!1}_joinIntervals(){let e;do{e=!1;for(let t=0;t<this.intervals.length-1;++t)this._mergeIntervals(this.intervals[t],this.intervals[t+1])&&(this.intervals.splice(t+1,1),e=!0)}while(e)}addInterval(e,t,i){return this.intervals.push(this._createInterval(e,t,i)),this._joinIntervals(),this.intervals.length>100&&(this.logger(`too many intervals (${this.intervals.length}); will merge`,{type:"warn"}),this._doMergeIntervals(this.intervals[1],this.intervals[0]),this.intervals.splice(0,1)),this._flushIntervals()}getBitRate(){return this.currentRate}},hC=lA(Qw(),1),pC=class{constructor(e,t,i,r,n){this.pendingQueue=[],this.activeRequests={},this.completeRequests={},this.averageSegmentDuration=2e3,this.lastPrefetchStart=0,this.throttleTimeout=null,this.RETRY_COUNT=e,this.TIMEOUT=t,this.BITRATE_ESTIMATOR=i,this.MAX_PARALLEL_REQUESTS=r,this.logger=n}limitCompleteCount(){let e;for(;(e=Object.keys(this.completeRequests)).length>this._getParallelRequestCount()+2;){let t=e[Math.floor(Math.random()*e.length)];this.logger(`Dropping completed request for url ${t}`,{type:"warn"}),delete this.completeRequests[t]}}_sendRequest(e,t){let i=oC(),r=i=>{delete this.activeRequests[t],this.limitCompleteCount(),this.completeRequests[t]=e,this._sendPending(),e._error=1,e._errorMsg=i,e._errorCB?e._errorCB(i):(this.limitCompleteCount(),this.completeRequests[t]=e)};e._request=dC(t,(r=>{e._complete=1,e._responseData=r,e._downloadTime=oC()-i,delete this.activeRequests[t],this._sendPending(),e._cb?e._cb(r,e._downloadTime):(this.limitCompleteCount(),this.completeRequests[t]=e)}),(()=>r("error")),(()=>{e._retry=1,e._retryCB&&e._retryCB()})),e._request.withRetryCount(this.RETRY_COUNT).withTimeout(this.TIMEOUT).withBitrateReporting(this.BITRATE_ESTIMATOR).withParallel(this._getParallelRequestCount()>1).withFinally((()=>{e._finallyCB&&e._finallyCB()})),this.activeRequests[t]=e,e._request.send(),this.lastPrefetchStart=oC()}_getParallelRequestCount(){return Math.min(this.MAX_PARALLEL_REQUESTS,this.averageSegmentDuration<3e3?3:2)}_getPrefetchDelay(){return Math.max(100,Math.min(5e3,this.averageSegmentDuration/3))}_canSendPending(){let e=this._getParallelRequestCount(),t=oC();if(Object.keys(this.activeRequests).length>=e)return!1;let i=this._getPrefetchDelay()-(t-this.lastPrefetchStart);return this.throttleTimeout&&clearTimeout(this.throttleTimeout),!(i>0)||(this.throttleTimeout=window.setTimeout((()=>this._sendPending()),i),!1)}_sendPending(){for(;this._canSendPending();){let e=this.pendingQueue.pop();if(!e)return;this.activeRequests[e]||this.completeRequests[e]||(this.logger(`Submitting pending request url=${e}`),this._sendRequest({},e))}}_removeFromActive(e){delete this.completeRequests[e],delete this.activeRequests[e]}abortAll(){(0,hC.default)(this.activeRequests).forEach((e=>{e&&e._request&&e._request.abort()})),this.activeRequests={},this.pendingQueue=[],this.completeRequests={}}requestData(e,t,i,r){let n={};return n.send=()=>{let a=this.activeRequests[e]||this.completeRequests[e];if(a)a._cb=t,a._errorCB=i,a._retryCB=r,a._finallyCB=n._finallyCB,a._error||a._complete?(this._removeFromActive(e),setTimeout((()=>{a._complete?(this.logger(`Requested url already prefetched, url=${e}`),t(a._responseData,a._downloadTime)):(this.logger(`Requested url already prefetched with error, url=${e}`),i(a._errorMsg)),n._finallyCB&&n._finallyCB()}),0)):this.logger(`Attached to active request, url=${e}`);else{let t=this.pendingQueue.indexOf(e);-1!==t&&this.pendingQueue.splice(t,1),this.logger(`Request not prefetched, starting new request, url=${e}${-1===t?"":"; removed pending"}`),this._sendRequest(n,e)}},n._cb=t,n._errorCB=i,n._retryCB=r,n.abort=function(){n.request&&n.request.abort()},n.withFinally=e=>(n._finallyCB=e,n),n}prefetch(e){this.activeRequests[e]||this.completeRequests[e]?this.logger(`Request already active for url=${e}`):(this.logger(`Added to pending queue; url=${e}`),this.pendingQueue.unshift(e),this._sendPending())}optimizeForSegDuration(e){this.averageSegmentDuration=e}},fC=1e4,mC=class{constructor(e){this.paused=!1,this.autoQuality=!0,this.autoQualityLimits=void 0,this.buffering=!0,this.destroyed=!1,this.videoPlayStarted=!1,this.lowLatency=!1,this.bitrate=0,this.manifest=[],this.sourceBuffer=0,this.bufferStates=[],this.sourceJitter=-1,this.params=e,this.soundProhibitedEvent$=new mb,this.chunkRateEstimator=new cC(this.params.logger),this._initVideo()}attachSource(e){this.manifestUrl=e,this.urlResolver=uC(e),this.bitrateSwitcher=this._initBitrateSwitcher(),this._initManifest()}setAutoQualityEnabled(e){this.autoQuality=e}setAutoQualityLimits(e){this.autoQualityLimits=e}switchByName(e){let t;for(let i=0;i<this.manifest.length;++i)if(t=this.manifest[i],t.name===e)return void this._switchToQuality(t)}catchUp(){this.rep&&this.rep.stop(),this.currentManifestEntry&&(this.paused=!1,this._initPlayerWith(this.currentManifestEntry),this._notifyBuffering(!0))}stop(){this.params.videoElement.pause(),this.rep&&(this.rep.stop(),this.rep=null)}pause(){this.paused=!0,this.params.videoElement.pause(),this.videoPlayStarted=!1,this._notifyBuffering(!1)}play(){this.paused=!1;let e=this.lowLatency&&this._getBufferSizeSec()>this.sourceJitter+5;this.rep&&!e?(this.bufferStates=[],this.videoPlayStarted=!1,this.shouldPlay()?this._playVideoElement():this._notifyBuffering(!0)):this.catchUp()}startPlay(e,t){this.autoQuality=t,this._initPlayerWith(e)}destroy(){this.destroyed=!0,this.rep&&(this.rep.stop(),this.rep=null),this.manifestRequest&&this.manifestRequest.abort(),this.manifestRefetchTimer&&(clearTimeout(this.manifestRefetchTimer),this.manifestRefetchTimer=void 0)}reinit(e){this.manifestUrl=e,this.urlResolver=uC(e),this.catchUp()}_handleNetworkError(){this.params.logger("Fatal network error"),this.params.playerCallback({name:"error",type:"network"})}_retryCallback(){this.params.playerCallback({name:"retry"})}_getBufferSizeSec(){let e=this.params.videoElement,t=0,i=e.buffered.length;return 0!==i&&(t=e.buffered.end(i-1)-Math.max(e.currentTime,e.buffered.start(0))),t}_notifyBuffering(e){this.destroyed||(this.params.logger(`buffering: ${e}`),this.params.playerCallback({name:"buffering",isBuffering:e}),this.buffering=e)}_initVideo(){let{videoElement:e,logger:t}=this.params;e.addEventListener("error",(()=>{var i;e.error&&!this.destroyed&&(t(`Video element error: ${null==(i=e.error)?void 0:i.code}`),this.params.playerCallback({name:"error",type:"media"}))})),e.addEventListener("timeupdate",(()=>{let e=this._getBufferSizeSec();!this.paused&&e<.3?this.buffering||(this.buffering=!0,window.setTimeout((()=>{!this.paused&&this.buffering&&this._notifyBuffering(!0)}),1e3*(e+.1))):this.buffering&&this.videoPlayStarted&&this._notifyBuffering(!1)})),e.addEventListener("playing",(()=>{t("playing")})),e.addEventListener("stalled",(()=>this._fixupStall())),e.addEventListener("waiting",(()=>this._fixupStall()))}_fixupStall(){let e,{logger:t,videoElement:i}=this.params,r=i.buffered.length;0!==r&&(e=i.buffered.start(r-1),i.currentTime<e&&(t("Fixup stall"),i.currentTime=e))}_selectQuality(e){let t,i,r,{videoElement:n}=this.params,a=n&&1.62*(LO.display.pixelRatio||1)*n.offsetHeight||520;for(let n=0;n<this.manifest.length;++n){r=this.manifest[n];let{max:s,min:o}=this.autoQualityLimits||{};!GO({limits:this.autoQualityLimits,highestAvailableHeight:this.manifest[0].video.height,lowestAvailableHeight:(0,iC.default)(this.manifest,-1).video.height})&&(s&&r.video.height>s||o&&r.video.height<o)||(r.bitrate<e&&a>Math.min(r.video.height,r.video.width)?(!i||r.bitrate>i.bitrate)&&(i=r):(!t||t.bitrate>r.bitrate)&&(t=r))}return i||t}shouldPlay(){if(this.paused)return!1;let e=this._getBufferSizeSec()-Math.max(1,this.sourceJitter);return e>3||Tb(this.downloadRate)&&(this.downloadRate>1.5&&e>2||this.downloadRate>2&&e>1)}_setVideoSrc(e,t){let{logger:i,videoElement:r,playerCallback:n}=this.params;this.mediaSource=new window.MediaSource,i("setting video src"),r.src=URL.createObjectURL(this.mediaSource),this.mediaSource.addEventListener("sourceopen",(()=>{this.mediaSource&&(this.sourceBuffer=this.mediaSource.addSourceBuffer(e.codecs),this.bufferStates=[],t())})),this.videoPlayStarted=!1,r.addEventListener("canplay",(()=>{this.shouldPlay()&&(this.videoPlayStarted=!0,this._playVideoElement())}));let a=()=>{!function(e,t,i){let r=(...n)=>{i.apply(null,n),e.removeEventListener(t,r)};e.addEventListener(t,r)}(r,"progress",(()=>{r.buffered.length?(r.currentTime=r.buffered.start(0),n({name:"playing"})):a()}))};a()}_initPlayerWith(e){this.bitrate=0,this.rep=0,this.sourceBuffer=0,this.bufferStates=[],this.filesFetcher&&this.filesFetcher.abortAll(),this.filesFetcher=new pC(3,fC,this.bitrateSwitcher,this.params.config.maxParallelRequests,this.params.logger),this._setVideoSrc(e,(()=>this._switchToQuality(e)))}_representation(e){let{logger:t,videoElement:i,playerCallback:r}=this.params,n=!1,a=null,s=null,o=null,l=null,u=!1,d=()=>{let e=n&&(!u||u===this.rep);return e||t("Not running!"),e},c=(e,t,i)=>{o&&o.abort(),o=dC(this.urlResolver.resolve(e,!1),t,i,(()=>this._retryCallback())).withTimeout(fC).withBitrateReporting(this.bitrateSwitcher).withRetryCount(3).withFinally((()=>{o=null})).send()},h=(e,t,i)=>{yb(this.filesFetcher),null==s||s.abort(),s=this.filesFetcher.requestData(this.urlResolver.resolve(e,!1),t,i,(()=>this._retryCallback())).withFinally((()=>{s=null})).send()},p=e=>{let r=i.playbackRate;i.playbackRate!==e&&(t(`Playback rate switch: ${r}=>${e}`),i.playbackRate=e)},f=e=>{this.lowLatency=e,t(`lowLatency changed to ${e}`),m()},m=()=>{if(this.lowLatency||this.params.config.isLiveCatchUpMode){let e=this._getBufferSizeSec();if(this.bufferStates.length<5)return void p(1);let i=oC()-1e4,r=0;for(let t=0;t<this.bufferStates.length;t++){let n=this.bufferStates[t];e=Math.min(e,n.buf),n.ts<i&&r++}this.bufferStates.splice(0,r),t(`update playback rate;  minBuffer=${e} drop=${r} jitter=${this.sourceJitter}`);let n=e-1;this.sourceJitter>=0?n-=this.sourceJitter/2:this.sourceJitter-=1,p(n>3?1.15:n>1?1.1:n>.3?1.05:1)}else p(1)},g=e=>{let i,n=()=>i&&i.start?i.start.length:0,a=e=>i.start[e]/1e3,s=e=>i.dur[e]/1e3,o=e=>i.fragIndex+e,u=(e,t)=>({chunkIdx:o(e),startTS:a(e),dur:s(e),discontinuity:t}),c=()=>{let e=0;if(i&&i.dur){let t=this.lowLatency?this.params.config.lowLatencyMinBuffer:this.params.config.minBuffer,r=this.lowLatency?this.params.config.lowLatencyMinBufferSegments:this.params.config.minBufferSegments,n=t;this.sourceJitter>1&&(n+=this.sourceJitter-1);let a=i.dur.length-1;for(;a>=0&&(n-=i.dur[a],!(n<=0));--a);e=Math.min(a,i.dur.length-1-r),e=Math.max(e,0)}return u(e,!0)},h=(e,t,i)=>{l&&l.abort(),l=dC(this.urlResolver.resolve(e,!0,this.lowLatency),t,i,(()=>this._retryCallback())).withTimeout(fC).withRetryCount(3).withFinally((()=>{l=null})).withJSONResponse().send()};return{seek:(t,s)=>{h(e,(e=>{if(!d())return;i=e;let o=!!i.lowLatency;o!==this.lowLatency&&f(o);let l=0;for(let e=0;e<i.dur.length;++e)l+=i.dur[e];l>0&&(yb(this.filesFetcher),this.filesFetcher.optimizeForSegDuration(l/i.dur.length)),r({name:"index",zeroTime:i.zeroTime,shiftDuration:i.shiftDuration}),this.sourceJitter=i.hasOwnProperty("jitter")?Math.min(10,Math.max(.01,i.jitter/1e3)):1,t((e=>{let t=n();if(!(t<=0)){if(Tb(e))for(let i=0;i<t;i++)if(a(i)>e)return u(i);return c()}})(s))}),(()=>this._handleNetworkError()))},nextChunk:e=>{let r=n(),a=e?e.chunkIdx+1:0,s=a-i.fragIndex;if(!(r<=0)){if(!e||s<0||s-r>10)return t(`Resync: offset=${s} bChunks=${r} chunk=`+JSON.stringify(e)),c();if(!(s>=r))return u(a-i.fragIndex,!1)}}}},v=()=>{n=!1,s&&s.abort(),o&&o.abort(),l&&l.abort(),yb(this.filesFetcher),this.filesFetcher.abortAll()};return u={start:t=>{let i,r,s,o,u,p,f,{videoElement:S,logger:y}=this.params,T=g(e.jidxUrl),E=0,b=()=>{u&&(clearTimeout(u),u=void 0);let e=Math.max(500,1e3*(this._getBufferSizeSec()-this.sourceJitter-5)),t=E+e,i=oC(),r=Math.min(1e4,t-i);E=i;let n=()=>{l||d()&&T.seek((()=>{d()&&(E=oC(),_(),b())}))};r>0?u=window.setTimeout((()=>{this.paused?b():n()}),r):n()},_=()=>{let t;for(;t=T.nextChunk(o);)o=t,O(t);let i=T.nextChunk(s);if(i){if(s&&i.discontinuity)return y("Detected discontinuity; restarting playback"),void(this.paused?b():(v(),this._initPlayerWith(e)));P(i)}else b()},A=(e,t)=>{if(!d()||!this.sourceBuffer)return;let i,r,n,a=i=>{window.setTimeout((()=>{d()&&A(e,t)}),i)};if(this.sourceBuffer.updating)y("Source buffer is updating; delaying appendBuffer"),a(100);else{let s=oC(),o=S.currentTime;!this.paused&&S.buffered.length>1&&p===o&&s-f>500&&(y("Stall suspected; trying to fix"),this._fixupStall()),p!==o&&(p=o,f=s);let l=this._getBufferSizeSec();if(l>30)y(`Buffered ${l} seconds; delaying appendBuffer`),a(2e3);else try{this.sourceBuffer.appendBuffer(e),this.videoPlayStarted?(this.bufferStates.push({ts:s,buf:l}),m(),this.bufferStates.length>200&&this.bufferStates.shift()):this.shouldPlay()&&(this.videoPlayStarted=!0,this._playVideoElement()),t&&t()}catch(e){if("QuotaExceededError"!==e.name)throw e;y("QuotaExceededError; delaying appendBuffer"),n=this.sourceBuffer.buffered.length,0!==n&&(i=this.sourceBuffer.buffered.start(0),r=o,r-i>4&&this.sourceBuffer.remove(i,r-3)),a(1e3)}}},R=()=>{r&&i&&(y([`Appending chunk, sz=${r.byteLength}:`,JSON.stringify(s)]),A(r,(function(){r=null,_()})))},w=t=>e.fragUrlTemplate.replace("%%id%%",t.chunkIdx),P=e=>{d()&&h(w(e),((t,i)=>{if(d()){if(i/=1e3,r=t,s=e,a=e.startTS,i){let t=Math.min(10,e.dur/i);this.downloadRate=this.downloadRate?.7*this.downloadRate+.3*t:t}R()}}),(()=>this._handleNetworkError()))},O=e=>{d()&&(yb(this.filesFetcher),this.filesFetcher.prefetch(this.urlResolver.resolve(w(e),!1)))},C=t=>{d()&&(e.cachedHeader=t,A(t,(()=>{i=!0,R()})))};n=!0,T.seek((e=>{if(d()){if(E=oC(),!e)return void b();o=e,!Eb(t)||e.startTS>t?P(e):(s=e,_())}}),t),e.cachedHeader?C(e.cachedHeader):c(e.headerUrl,C,(()=>this._handleNetworkError()))},stop:v,getTimestampSec:()=>a},u}_switchToQuality(e){let t,{logger:i,playerCallback:r}=this.params;e.bitrate!==this.bitrate&&(this.rep&&(t=this.rep.getTimestampSec(),Tb(t)&&(t+=.1),this.rep.stop()),this.currentManifestEntry=e,this.rep=this._representation(e),i(`switch to quality: codecs=${e.codecs}; headerUrl=${e.headerUrl}; bitrate=${e.bitrate}`),this.bitrate=e.bitrate,yb(this.bitrateSwitcher),this.bitrateSwitcher.notifySwitch(this.bitrate),this.rep.start(t),r({name:"qualitySwitch",quality:e}))}_qualityAvailable(e){return Tb(this.manifest.find((t=>t.name===e)))}_initBitrateSwitcher(){let e,{logger:t,playerCallback:i}=this.params,r=e=>{if(!this.autoQuality)return;let i,r,n;this.currentManifestEntry&&this._qualityAvailable(this.currentManifestEntry.name)&&e<this.bitrate&&(r=this._getBufferSizeSec(),n=e/this.bitrate,r>10&&n>.8||r>15&&n>.5||r>20&&n>.3)?t(`Not switching: buffer=${Math.floor(r)}; bitrate=${this.bitrate}; newRate=${Math.floor(e)}`):(i=this._selectQuality(e),i?this._switchToQuality(i):t(`Could not find quality by bitrate ${e}`))},n=(e,t)=>{let r=oC();if(this.chunkRateEstimator.addInterval(e,r,t)){let n=this.chunkRateEstimator.getBitRate();return i({name:"bandwidth",size:t,duration:r-e,speed:n}),!0}},a=()=>{let e=this.chunkRateEstimator.getBitRate();return e?.85*e:0},s=-1/0,o=!0,l=()=>{let t=a();if(t&&e&&this.autoQuality){if(o&&t>e&&lC(s)<3e4)return;r(t)}o=this.autoQuality};return{updateChunk:(e,t)=>{let i=n(e,t);return i&&l(),i},notifySwitch:t=>{let i=oC();t<e&&(s=i),e=t}}}_fetchManifest(e,t,i){this.manifestRequest=dC(this.urlResolver.resolve(e,!0),t,i,(()=>this._retryCallback())).withJSONResponse().withTimeout(fC).withRetryCount(this.params.config.manifestRetryMaxCount).withRetryInterval(this.params.config.manifestRetryInterval,this.params.config.manifestRetryMaxInterval).send().withFinally((()=>{this.manifestRequest=void 0}))}_playVideoElement(){let{videoElement:e}=this.params;aC(e,(()=>{this.soundProhibitedEvent$.next()})).then((e=>{e||(this.params.liveOffset.pause(),this.params.videoState.setState("paused"))}))}_handleManifestUpdate(e){let{logger:t,playerCallback:i,videoElement:r}=this.params;this.manifest=(e=>{let t=[];return null!=e&&e.length?(e.forEach(((e,i)=>{var n,a;e.video&&r.canPlayType(e.codecs).replace(/no/,"")&&null!=(a=null==(n=window.MediaSource)?void 0:n.isTypeSupported)&&a.call(n,e.codecs)&&(e.index=i,t.push(e))})),t.sort((function(e,t){return e.video&&t.video?t.video.height-e.video.height:t.bitrate-e.bitrate})),t):(i({name:"error",type:"empty_manifest"}),[])})(e),t(`Valid manifest entries: ${this.manifest.length}/${e.length}`),i({name:"manifest",manifest:this.manifest})}_refetchManifest(e){this.destroyed||(this.manifestRefetchTimer&&clearTimeout(this.manifestRefetchTimer),this.manifestRefetchTimer=window.setTimeout((()=>{this._fetchManifest(e,(t=>{this.destroyed||(this._handleManifestUpdate(t),this._refetchManifest(e))}),(()=>this._refetchManifest(e)))}),6e4))}_initManifest(){this._fetchManifest(this.manifestUrl,(e=>{this.destroyed||(this._handleManifestUpdate(e),this._refetchManifest(this.manifestUrl))}),(()=>this._handleNetworkError()))}},gC=lA(PR(),1),vC=class{constructor(){this.onDroopedVideoFramesLimit$=new mb,this.subscription=new cb,this.playing=!1,this.tracks=[],this.forceChecker$=new mb,this.isForceCheckCounter=0,this.prevTotalVideoFrames=0,this.prevDroppedVideoFrames=0,this.limitCounts={},this.handleChangeVideoQuality=()=>{let e=this.tracks.find((({size:e})=>(null==e?void 0:e.height)===this.video.videoHeight&&(null==e?void 0:e.width)===this.video.videoWidth));e&&!Kb(e.quality)&&this.onChangeQuality(e.quality)},this.checkDroppedFrames=()=>{var e;let{totalVideoFrames:t,droppedVideoFrames:i}=this.video.getVideoPlaybackQuality(),r=t-this.prevTotalVideoFrames,n=1-(r-(i-this.prevDroppedVideoFrames))/r;!isNaN(n)&&n>0&&this.log({message:`[dropped]. current dropped percent: ${n}, limit: ${this.droppedFramesChecker.percentLimit}`}),!isNaN(n)&&n>=this.droppedFramesChecker.percentLimit&&Hb(this.currentQuality,this.droppedFramesChecker.minQualityBanLimit)&&(this.limitCounts[this.currentQuality]=(null!=(e=this.limitCounts[this.currentQuality])?e:0)+1,this.maxQualityLimit=this.getMaxQualityLimit(this.currentQuality),this.currentTimer&&window.clearTimeout(this.currentTimer),this.currentTimer=window.setTimeout((()=>this.maxQualityLimit=this.getMaxQualityLimit()),this.droppedFramesChecker.qualityUpWaitingTime),this.onDroopedVideoFramesLimitTrigger()),this.savePrevFrameCounts(t,i)}}connect(e){this.log=e.logger.createComponentLog("DroppedFramesManager"),this.video=e.video,this.isAuto=e.isAuto,this.tracks=e.tracks,this.droppedFramesChecker=e.droppedFramesChecker,this.subscription.add(e.playing$.subscribe((()=>this.playing=!0))),this.subscription.add(e.pause$.subscribe((()=>this.playing=!1))),this.isEnabled&&this.subscribe()}destroy(){this.currentTimer&&window.clearTimeout(this.currentTimer),this.subscription.unsubscribe()}get droppedVideoMaxQualityLimit(){return this.maxQualityLimit}subscribe(){this.subscription.add(d_(this.video,"resize").subscribe(this.handleChangeVideoQuality));let e=l_(this.droppedFramesChecker.checkTime).pipe(v_((()=>this.playing)),v_((()=>{let e=!!this.isForceCheckCounter;return e&&(this.isForceCheckCounter-=1),!e}))),t=o_(e,this.forceChecker$.pipe(h_(this.droppedFramesChecker.checkTime)));this.subscription.add(t.subscribe(this.checkDroppedFrames))}onChangeQuality(e){this.currentQuality=e;let{totalVideoFrames:t,droppedVideoFrames:i}=this.video.getVideoPlaybackQuality();this.savePrevFrameCounts(t,i),this.isForceCheckCounter=this.droppedFramesChecker.tickCountAfterQualityChange,this.forceChecker$.next()}onDroopedVideoFramesLimitTrigger(){this.isAuto.getState()&&(this.log({message:`[onDroopedVideoFramesLimit]. maxQualityLimit: ${this.maxQualityLimit}`}),this.onDroopedVideoFramesLimit$.next())}getMaxQualityLimit(e){var t,i;let r=null==(i=null==(t=(0,gC.default)(this.limitCounts).filter((([,e])=>e>=this.droppedFramesChecker.countLimit)).sort((([e],[t])=>Gb(e,t)?-1:1)))?void 0:t[0])?void 0:i[0];return null!=e?e:r}get isEnabled(){return this.droppedFramesChecker.enabled&&this.isDroppedFramesCheckerSupport}get isDroppedFramesCheckerSupport(){return!!this.video&&"function"==typeof this.video.getVideoPlaybackQuality}savePrevFrameCounts(e,t){this.prevTotalVideoFrames=e,this.prevDroppedVideoFrames=t}},SC=()=>{var e;return!(null==(e=window.documentPictureInPicture)||!e.window)||!!document.pictureInPictureElement},yC=(e,t)=>new fb((i=>{if(!window.IntersectionObserver)return;let r=new IntersectionObserver(((e,t)=>{e.forEach((e=>i.next(e.isIntersecting||SC())))}),{root:null,...t});r.observe(e);let n=d_(document,"visibilitychange").pipe(A_((e=>!document.hidden||SC()))).subscribe((e=>i.next(e)));return()=>{r.unobserve(e),n.unsubscribe()}})),TC=["paused","playing","ready"],EC=["paused","playing","ready"],bC=class{constructor(e){this.subscription=new cb,this.videoState=new ZP("stopped"),this.representations$=new n_([]),this.droppedFramesManager=new vC,this.maxSeekBackTime$=new n_(1/0),this.zeroTime$=new n_(void 0),this.liveOffset=new fO,this._dashCb=e=>{var t,i,r,n;switch(e.name){case"buffering":{let t=e.isBuffering;this.params.output.isBuffering$.next(t);break}case"error":this.params.output.error$.next({id:`DashLiveProviderInternal:${e.type}`,category:M_.WTF,message:"LiveDashPlayer reported error"});break;case"manifest":{let n=e.manifest,a=[];for(let e of n){let r=null!=(t=e.name)?t:e.index.toString(10),n=null!=(i=xO(e.name))?i:Qb(e.video),s=e.bitrate/1e3,o={...e.video};if(!n)continue;let l={id:r,quality:n,bitrate:s,size:o};a.push({track:l,representation:e})}this.representations$.next(a),this.params.output.availableVideoTracks$.next(a.map((({track:e})=>e))),"manifest_ready"===(null==(r=this.videoState.getTransition())?void 0:r.to)&&this.videoState.setState("manifest_ready");break}case"qualitySwitch":{let t=e.quality,i=null==(n=this.representations$.getValue().find((({representation:e})=>e===t)))?void 0:n.track;this.params.output.hostname$.next(new URL(t.headerUrl,this.params.source.url).hostname),Tb(i)&&this.params.output.currentVideoTrack$.next(i);break}case"bandwidth":{let{size:t,duration:i}=e;this.params.dependencies.throughputEstimator.addRawSpeed(t,i);break}case"index":this.maxSeekBackTime$.next(e.shiftDuration||0),this.zeroTime$.next(e.zeroTime)}},this.syncPlayback=()=>{let e=this.videoState.getState(),t=this.videoState.getTransition(),i=this.params.desiredState.playbackState.getState(),r=this.params.desiredState.playbackState.getTransition(),n=this.params.desiredState.seekState.getState();if(this.log({message:`[syncPlayback] videoState: ${e}; videoTransition: ${JSON.stringify(t)}; desiredPlaybackState: ${i}; seekState: ${JSON.stringify(n)};`}),"stopped"===i)return void("stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.dash.destroy(),this.video.removeAttribute("src"),this.video.load(),this.videoState.setState("stopped")));if(t)return;let a=this.params.desiredState.videoTrack.getTransition(),s=this.params.desiredState.autoVideoTrackSwitching.getTransition();if((0,tO.default)(EC,e)&&(a||s))this.prepare();else if("paused"!==(null==r?void 0:r.to)&&"requested"===n.state&&(0,tO.default)(TC,e))this.seek(n.position-this.liveOffset.getTotalPausedTime());else switch(e){case"stopped":return this.videoState.startTransitionTo("manifest_ready"),void this.dash.attachSource(KP(this.params.source.url));case"manifest_ready":this.videoState.startTransitionTo("ready"),this.prepare();break;case"ready":if("paused"===i)this.videoState.setState("paused");else if("playing"===i){this.videoState.startTransitionTo("playing");let e=null==r?void 0:r.from;e&&"ready"===e&&this.dash.catchUp(),this.dash.play()}return;case"playing":return void("paused"===i&&(this.videoState.startTransitionTo("paused"),this.liveOffset.pause(),this.dash.pause()));case"paused":if("playing"===i)if(this.videoState.startTransitionTo("playing"),this.liveOffset.getTotalPausedTime()<this.params.config.maxPausedTime&&this.liveOffset.getTotalOffset()<this.maxSeekBackTime$.getValue())this.liveOffset.resume(),this.dash.play(),this.params.output.position$.next(-this.liveOffset.getTotalOffset()/1e3);else{let e=this.liveOffset.getTotalOffset();e>=this.maxSeekBackTime$.getValue()&&(e=0,this.liveOffset.resetTo(e)),this.liveOffset.resume(),this.params.output.position$.next(-e/1e3),this.dash.reinit(KP(this.params.source.url,e))}return;default:return hb(e)}},this.textTracksManager=new pO(e.source.url),this.params=e,this.log=this.params.dependencies.logger.createComponentLog("DashLiveProvider");let t=t=>{e.output.error$.next({id:"DashLiveProvider",category:M_.WTF,message:"DashLiveProvider internal logic error",thrown:t})};this.subscription.add(o_(this.videoState.stateChangeStarted$.pipe(A_((e=>({transition:e,type:"start"})))),this.videoState.stateChangeEnded$.pipe(A_((e=>({transition:e,type:"end"}))))).subscribe((({transition:e,type:t})=>{this.log({message:`[videoState change] ${t}: ${JSON.stringify(e)}`})}))),this.video=nO(e.container,e.tuning),this.params.output.element$.next(this.video),this.dash=this.createLiveDashPlayer(),this.subscription.add(this.dash.soundProhibitedEvent$.subscribe(this.params.output.soundProhibitedEvent$)),this.params.output.duration$.next(1/0),this.params.output.position$.next(0),this.params.output.isLive$.next(!0),this.params.output.canChangePlaybackSpeed$.next(!1),this.params.output.hostname$.next(tC(this.params.source.url)),this.params.output.autoVideoTrackLimitingAvailable$.next(!0),this.params.output.availableVideoTracks$.next([]),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.output.availableTextTracks$.next([]),this.params.desiredState.internalTextTracks.setState([]),this.textTracksManager.connect(this.video,this.params.desiredState,this.params.output);let i=IO(this.video);this.subscription.add((()=>i.destroy())),this.subscription.add(this.representations$.pipe(A_((e=>e.map((({track:e})=>e)))),v_((e=>!!e.length)),P_()).subscribe((e=>this.droppedFramesManager.connect({logger:this.params.dependencies.logger,video:this.video,droppedFramesChecker:this.params.tuning.droppedFramesChecker,isAuto:this.params.desiredState.autoVideoTrackSwitching,playing$:i.playing$,pause$:i.pause$,tracks:e})))),this.subscription.add(i.canplay$.subscribe((()=>{var e;"ready"===(null==(e=this.videoState.getTransition())?void 0:e.to)&&this.videoState.setState("ready")}),t)).add(i.pause$.subscribe((()=>{this.videoState.setState("paused")}),t)).add(i.playing$.subscribe((()=>{"applying"===this.params.desiredState.seekState.getState().state&&this.params.output.seekedEvent$.next(),this.videoState.setState("playing")}),t)).add(i.error$.subscribe(this.params.output.error$)).add(this.maxSeekBackTime$.pipe(E_(),A_((e=>-e/1e3))).subscribe(this.params.output.duration$)).add(s_({zeroTime:this.zeroTime$.pipe(v_(Tb)),position:i.timeUpdate$}).subscribe((({zeroTime:e,position:t})=>this.params.output.liveTime$.next(e+1e3*t)),t)).add(lO(this.video,this.params.desiredState.isLooped,t)).add(uO(this.video,this.params.desiredState.volume,i.volumeState$,t)).add(i.volumeState$.subscribe(this.params.output.volume$,t)).add(dO(this.video,this.params.desiredState.playbackRate,i.playbackRateState$,t)).add(i.loadStart$.subscribe(this.params.output.firstBytesEvent$)).add(i.loadedMetadata$.subscribe(this.params.output.loadedMetadataEvent$)).add(i.playing$.subscribe(this.params.output.firstFrameEvent$)).add(i.canplay$.subscribe(this.params.output.canplay$)).add(i.inPiP$.subscribe(this.params.output.inPiP$)).add(i.inFullscreen$.subscribe(this.params.output.inFullscreen$)).add(yC(this.video).subscribe(this.params.output.elementVisible$)).add(this.params.desiredState.autoVideoTrackLimits.stateChangeStarted$.subscribe((({to:{max:e,min:t}})=>{this.dash.setAutoQualityLimits({max:e&&Yb(e),min:t&&Yb(t)}),this.params.output.autoVideoTrackLimits$.next({max:e,min:t})}))).add(this.videoState.stateChangeEnded$.subscribe((e=>{var t;switch(e.to){case"stopped":this.params.output.position$.next(0),this.params.output.duration$.next(1/0),this.params.desiredState.playbackState.setState("stopped");break;case"manifest_ready":case"ready":"ready"===(null==(t=this.params.desiredState.playbackState.getTransition())?void 0:t.to)&&this.params.desiredState.playbackState.setState("ready");break;case"paused":this.params.desiredState.playbackState.setState("paused");break;case"playing":this.params.desiredState.playbackState.setState("playing");break;default:return hb(e.to)}}),t)).add(o_(e.desiredState.playbackState.stateChangeStarted$,e.desiredState.seekState.stateChangeEnded$,e.desiredState.videoTrack.stateChangeStarted$,e.desiredState.autoVideoTrackSwitching.stateChangeStarted$,this.videoState.stateChangeEnded$,this.droppedFramesManager.onDroopedVideoFramesLimit$,u_(["init"])).pipe(h_(0)).subscribe(this.syncPlayback,t))}destroy(){this.subscription.unsubscribe(),this.textTracksManager.destroy(),this.droppedFramesManager.destroy(),this.dash.destroy(),this.params.output.element$.next(void 0),aO(this.video)}createLiveDashPlayer(){let e=new mC({videoElement:this.video,videoState:this.videoState,liveOffset:this.liveOffset,config:{maxParallelRequests:this.params.config.maxParallelRequests,minBuffer:this.params.tuning.live.minBuffer,minBufferSegments:this.params.tuning.live.minBufferSegments,lowLatencyMinBuffer:this.params.tuning.live.lowLatencyMinBuffer,lowLatencyMinBufferSegments:this.params.tuning.live.lowLatencyMinBufferSegments,isLiveCatchUpMode:this.params.tuning.live.isLiveCatchUpMode,manifestRetryInterval:this.params.tuning.manifestRetryInterval,manifestRetryMaxInterval:this.params.tuning.manifestRetryMaxInterval,manifestRetryMaxCount:this.params.tuning.manifestRetryMaxCount},playerCallback:this._dashCb,logger:e=>{this.params.dependencies.logger.log({message:String(e),component:"LiveDashPlayer"})}});return e.pause(),e}prepare(){var e,t,i,r,n,a;let s=this.representations$.getValue(),o=null!=(t=null==(e=this.params.desiredState.videoTrack.getTransition())?void 0:e.to)?t:this.params.desiredState.videoTrack.getState(),l=null!=(r=null==(i=this.params.desiredState.autoVideoTrackSwitching.getTransition())?void 0:i.to)?r:this.params.desiredState.autoVideoTrackSwitching.getState(),u=!l&&Tb(o)?o:eC(s.map((({track:e})=>e)),{container:this.video.getBoundingClientRect(),panelSize:this.params.panelSize,estimatedThroughput:this.params.dependencies.throughputEstimator.throughput$.getValue(),tuning:this.params.tuning.autoTrackSelection,limits:this.params.desiredState.autoVideoTrackLimits.getState(),droppedVideoMaxQualityLimit:this.droppedFramesManager.droppedVideoMaxQualityLimit,abrLogger:this.params.dependencies.abrLogger}),d=null==u?void 0:u.id,c=this.params.desiredState.videoTrack.getTransition(),h=null==(n=this.params.desiredState.videoTrack.getState())?void 0:n.id,p=this.params.desiredState.autoVideoTrackSwitching.getTransition();if(u&&(c||d!==h)&&this.setVideoTrack(u),p&&this.setAutoQuality(l),c||p||d!==h){let e=null==(a=s.find((({track:e})=>e.id===d)))?void 0:a.representation;yb(e,"Representations missing"),this.dash.startPlay(e,l)}}setVideoTrack(e){var t;let i=null==(t=this.representations$.getValue().find((({track:t})=>t.id===e.id)))?void 0:t.representation;yb(i,`No such representation ${e.id}`),this.dash.switchByName(i.name),this.params.desiredState.videoTrack.setState(e)}setAutoQuality(e){this.dash.setAutoQualityEnabled(e),this.params.desiredState.autoVideoTrackSwitching.setState(e)}seek(e){this.log({message:`[seek] position: ${e}`}),this.params.output.willSeekEvent$.next();let t=this.params.desiredState.playbackState.getState(),i=this.videoState.getState(),r="paused"===t&&"paused"===i,n=-e,a=n<=this.maxSeekBackTime$.getValue()?n:0;this.params.output.position$.next(e/1e3),this.dash.reinit(KP(this.params.source.url,a)),r&&this.dash.pause(),this.liveOffset.resetTo(a,r)}},_C=lA(mR(),1),AC=(e,t)=>{let i=0;for(let r=0;r<e.length;r++){let n=1e3*e.start(r),a=1e3*e.end(r);n<=t&&t<=a&&(i=a)}return Math.max(i-t,0)},RC=class{constructor(){Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}addEventListener(e,t,i){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push({callback:t,options:i})}removeEventListener(e,t){if(!(e in this.listeners))return;let i=this.listeners[e];for(let e=0,r=i.length;e<r;e++)if(i[e].callback===t)return void i.splice(e,1)}dispatchEvent(e){if(!(e.type in this.listeners))return;let t=this.listeners[e.type].slice();for(let i=0,r=t.length;i<r;i++){let r=t[i];try{r.callback.call(this,e)}catch(e){Promise.resolve().then((()=>{throw e}))}r.options&&r.options.once&&this.removeEventListener(e.type,r.callback)}return!e.defaultPrevented}},wC=class extends RC{constructor(){super(),this.listeners||RC.call(this),Object.defineProperty(this,"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(this,"onabort",{value:null,writable:!0,configurable:!0}),Object.defineProperty(this,"reason",{value:void 0,writable:!0,configurable:!0})}toString(){return"[object AbortSignal]"}dispatchEvent(e){"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),super.dispatchEvent(e)}},PC=class{constructor(){Object.defineProperty(this,"signal",{value:new wC,writable:!0,configurable:!0})}abort(e){let t;try{t=new Event("abort")}catch(e){"undefined"!=typeof document?document.createEvent?(t=document.createEvent("Event"),t.initEvent("abort",!1,!1)):(t=document.createEventObject(),t.type="abort"):t={type:"abort",bubbles:!1,cancelable:!1}}let i=e;if(void 0===i)if("undefined"==typeof document)i=new Error("This operation was aborted"),i.name="AbortError";else try{i=new DOMException("signal is aborted without reason")}catch(e){i=new Error("This operation was aborted"),i.name="AbortError"}this.signal.reason=i,this.signal.dispatchEvent(t)}toString(){return"[object AbortController]"}};function OC(e){return e.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL?(console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill"),!0):"function"==typeof e.Request&&!e.Request.prototype.hasOwnProperty("signal")||!e.AbortController}"undefined"!=typeof Symbol&&Symbol.toStringTag&&(PC.prototype[Symbol.toStringTag]="AbortController",wC.prototype[Symbol.toStringTag]="AbortSignal");var CC=OC({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}),LC=CC?function(e){"function"==typeof e&&(e={fetch:e});let{fetch:t,Request:i=t.Request,AbortController:r,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:n=!1}=e;if(!OC({fetch:t,Request:i,AbortController:r,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:n}))return{fetch:t,Request:a};let a=i;(a&&!a.prototype.hasOwnProperty("signal")||n)&&(a=function(e,t){let r;t&&t.signal&&(r=t.signal,delete t.signal);let n=new i(e,t);return r&&Object.defineProperty(n,"signal",{writable:!1,enumerable:!1,configurable:!0,value:r}),n},a.prototype=i.prototype);let s=t;return{fetch:(e,t)=>{let i=a&&a.prototype.isPrototypeOf(e)?e.signal:t?t.signal:void 0;if(i){let r;try{r=new DOMException("Aborted","AbortError")}catch(e){r=new Error("Aborted"),r.name="AbortError"}if(i.aborted)return Promise.reject(r);let n=new Promise(((e,t)=>{i.addEventListener("abort",(()=>t(r)),{once:!0})}));return t&&t.signal&&delete t.signal,Promise.race([n,s(e,t)])}return s(e,t)},Request:a}}({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}):void 0,IC=CC?LC.fetch:window.fetch,xC=(CC?LC.Request:window.Request,CC?PC:window.AbortController),MC=(CC||window.AbortSignal,lA(lP(),1)),NC=lA(SP(),1),DC=(e,t,i=0)=>{for(let r=0;r<e.length;r++)if(1e3*e.start(r)-i<=t&&1e3*e.end(r)+i>t)return!0;return!1},kC=lA(mR(),1),$C=lA(Jw(),1),VC=lA(lP(),1),UC=e=>"function"==typeof e&&(null==e?void 0:e.toString().endsWith("{ [native code] }")),BC=!UC(window.requestIdleCallback)||!UC(window.cancelIdleCallback),FC=BC?(e,t={})=>{let i=t.timeout||1,r=performance.now();return window.setTimeout((()=>{e({get didTimeout(){return!t.timeout&&performance.now()-r-1>i},timeRemaining:()=>Math.max(0,performance.now()-r+1)})}),1)}:window.requestIdleCallback,HC=BC?e=>window.clearTimeout(e):window.cancelIdleCallback,jC=lA(Gw(),1),GC=!1;try{GC=LO.browser.isSafari&&!!LO.browser.safariVersion&&LO.browser.safariVersion<=18}catch(kI){console.error(kI)}var qC=class{constructor(e){this.bufferFull$=new mb,this.error$=new mb,this.queue=[],this.currentTask=null,this.destroyed=!1,this.abortRequested=!1,this.completeTask=()=>{var e;try{if(this.currentTask){let t=null==(e=this.currentTask.signal)?void 0:e.aborted;this.currentTask.callback(!t),this.currentTask=null}this.queue.length&&this.pull()}catch(e){this.error$.next({id:"BufferTaskQueueUnknown",category:M_.VIDEO_PIPELINE,message:"Buffer appending or removal failed",thrown:e})}},this.buffer=e,this.buffer.addEventListener("updateend",this.completeTask)}async append(e,t){return(!t||!t.aborted)&&new Promise((i=>{let r={operation:"append",data:e,signal:t,callback:i};this.queue.push(r),this.pull()}))}async remove(e,t,i){return(!i||!i.aborted)&&new Promise((r=>{let n={operation:"remove",from:e,to:t,signal:i,callback:r};this.queue.unshift(n),this.pull()}))}async abort(e){return new Promise((t=>{let i,r=e=>{this.abortRequested=!1,t(e)};i=GC&&e?{operation:"safariAbort",init:e,callback:r}:{operation:"abort",callback:r};for(let{callback:e}of this.queue)e(!1);this.abortRequested=!0,i&&(this.queue=[i]),this.pull()}))}destroy(){this.destroyed=!0,this.buffer.removeEventListener("updateend",this.completeTask),this.queue=[],this.currentTask=null;try{this.buffer.abort()}catch(e){if(!(e instanceof DOMException&&"InvalidStateError"===e.name))throw e}}pull(){var e;if((this.buffer.updating||this.currentTask||this.destroyed)&&!this.abortRequested)return;let t=this.queue.shift();if(!t)return;if(null!=(e=t.signal)&&e.aborted)return t.callback(!1),void this.pull();this.currentTask=t;let{operation:i}=this.currentTask;try{this.execute(this.currentTask)}catch(e){e instanceof DOMException&&"QuotaExceededError"===e.name&&"append"===i?this.bufferFull$.next(this.currentTask.data.byteLength):e instanceof DOMException&&"InvalidStateError"===e.name||this.error$.next({id:`BufferTaskQueue:${i}`,category:M_.VIDEO_PIPELINE,message:"Buffer operation failed",thrown:e}),this.currentTask.callback(!1),this.currentTask=null}this.currentTask&&"abort"===this.currentTask.operation&&this.completeTask()}execute(e){let{operation:t}=e;switch(t){case"append":this.buffer.appendBuffer(e.data);break;case"remove":this.buffer.remove(e.from/1e3,e.to/1e3);break;case"abort":this.buffer.abort();break;case"safariAbort":this.buffer.abort(),this.buffer.appendBuffer(e.init);break;default:hb(t)}}},zC=e=>{let t=0;for(let i=0;i<e.length;i++)t+=e.end(i)-e.start(i);return 1e3*t},WC=class{constructor(e,t){this.cursor=0,this.source=e,this.boxParser=t,this.children=[];let i=this.readUint32();this.type=this.readString(4),this.size32=i<=e.buffer.byteLength-e.byteOffset?i:NaN;let r=this.size32?this.size32-8:void 0,n=e.byteOffset+this.cursor;this.size64=0,this.usertype=0,this.content=new DataView(e.buffer,n,r)}get id(){return this.type}get size(){return this.size32}scanForBoxes(e){return this.boxParser.parse(e)}readString(e,t="ascii"){let i=new TextDecoder(t).decode(new DataView(this.source.buffer,this.source.byteOffset+this.cursor,e));return this.cursor+=e,i}readUint8(){let e=this.source.getUint8(this.cursor);return this.cursor+=1,e}readUint16(){let e=this.source.getUint16(this.cursor);return this.cursor+=2,e}readUint32(){let e=this.source.getUint32(this.cursor);return this.cursor+=4,e}readUint64(){let e=this.source.getBigInt64(this.cursor);return this.cursor+=8,e}},QC=class extends WC{},YC=class extends WC{constructor(e,t){super(e,t);let i=this.readUint32();this.version=i>>>24,this.flags=16777215&i}},KC=class extends YC{get earliestPresentationTime(){return this.earliestPresentationTime32}get firstOffset(){return this.firstOffset32}constructor(e,t){super(e,t),this.segments=[],this.referenceId=this.readUint32(),this.timescale=this.readUint32(),this.earliestPresentationTime32=this.readUint32(),this.firstOffset32=this.readUint32(),this.earliestPresentationTime64=0,this.firstOffset64=0,this.referenceCount=65535&this.readUint32();for(let e=0;e<this.referenceCount;e++){let e=this.readUint32(),t=e>>>31,i=e<<1>>>1,r=this.readUint32();e=this.readUint32();let n=e>>>28,a=e<<3>>>3;this.segments.push({referenceType:t,referencedSize:i,subsegmentDuration:r,SAPType:n,SAPDeltaTime:a})}}},XC={ftyp:class extends WC{constructor(e,t){super(e,t),this.compatibleBrands=[],this.majorBrand=this.readString(4),this.minorVersion=this.readUint32();let i=this.size-this.cursor;for(;i;){let e=this.readString(4);this.compatibleBrands.push(e),i-=4}}},moov:class extends WC{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},mvhd:class extends YC{constructor(e,t){super(e,t),this.creationTime=this.readUint32(),this.modificationTime=this.readUint32(),this.timescale=this.readUint32(),this.duration=this.readUint32(),this.rate=this.readUint32(),this.volume=this.readUint16()}},moof:class extends WC{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},mdat:class extends WC{constructor(e,t){super(e,t),this.data=this.content}},sidx:KC,trak:class extends WC{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},mdia:class extends WC{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},mfhd:class extends YC{constructor(e,t){super(e,t),this.sequenceNumber=this.readUint32()}},tkhd:class extends YC{constructor(e,t){super(e,t),this.creationTime=this.readUint32(),this.modificationTime=this.readUint32(),this.trackId=this.readUint32(),this.cursor+=4,this.duration=this.readUint32(),this.cursor+=8,this.layer=this.readUint16(),this.alternateGroup=this.readUint16(),this.cursor+=2,this.cursor+=2,this.matrix=[[this.readUint32(),this.readUint32(),this.readUint32()],[this.readUint32(),this.readUint32(),this.readUint32()],[this.readUint32(),this.readUint32(),this.readUint32()]],this.width=this.readUint32(),this.height=this.readUint32()}},traf:class extends WC{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},tfhd:class extends YC{constructor(e,t){super(e,t),this.trackId=this.readUint32(),1&this.flags&&(this.baseDataOffset=this.readUint64()),2&this.flags&&(this.sampleDescriptionIndex=this.readUint32()),8&this.flags&&(this.defaultSampleDuration=this.readUint32()),16&this.flags&&(this.defaultSampleSize=this.readUint32()),32&this.flags&&(this.defaultSampleFlags=this.readUint32())}},tfdt:class extends YC{constructor(e,t){super(e,t),this.baseMediaDecodeTime32=0,this.baseMediaDecodeTime64=BigInt(0),1===this.version?this.baseMediaDecodeTime64=this.readUint64():this.baseMediaDecodeTime32=this.readUint32()}get baseMediaDecodeTime(){return 1===this.version?this.baseMediaDecodeTime64:this.baseMediaDecodeTime32}},trun:class extends YC{constructor(e,t){super(e,t),this.sampleDuration=[],this.sampleSize=[],this.sampleFlags=[],this.sampleCompositionTimeOffset=[],this.optionalFields=0,this.sampleCount=this.readUint32(),1&this.flags&&(this.dataOffset=this.readUint32()),4&this.flags&&(this.firstSampleFlags=this.readUint32());for(let e=0;e<this.sampleCount;e++)256&this.flags&&this.sampleDuration.push(this.readUint32()),512&this.flags&&this.sampleSize.push(this.readUint32()),1024&this.flags&&this.sampleFlags.push(this.readUint32()),2048&this.flags&&this.sampleCompositionTimeOffset.push(this.readUint32())}},minf:class extends WC{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},sv3d:class extends WC{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},st3d:class extends YC{constructor(e,t){switch(super(e,t),this.readUint8()){case 0:this.stereoMode=0;break;case 1:this.stereoMode=1;break;case 2:this.stereoMode=2;break;case 3:this.stereoMode=3;break;case 4:this.stereoMode=4}this.cursor+=1}},prhd:class extends YC{constructor(e,t){super(e,t),this.poseYawDegrees=this.readUint32(),this.posePitchDegrees=this.readUint32(),this.poseRollDegrees=this.readUint32()}},proj:class extends WC{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},equi:class extends YC{constructor(e,t){super(e,t),this.projectionBoundsTop=this.readUint32(),this.projectionBoundsBottom=this.readUint32(),this.projectionBoundsLeft=this.readUint32(),this.projectionBoundsRight=this.readUint32()}},uuid:class extends WC{constructor(e,t){super(e,t),this.ondemandPrefix="ondemandlivejson",this.ondemandDataReceivedKey="t-in",this.ondemandDataPreparedKey="t-out";let i=this.content.byteOffset,r=i+this.content.byteLength,n=new TextDecoder("ascii").decode(this.content.buffer.slice(i,r)).split(this.ondemandPrefix)[1],a=JSON.parse(n);this.serverDataReceivedTimestamp=a[this.ondemandDataReceivedKey],this.serverDataPreparedTime=a[this.ondemandDataPreparedKey]}},stbl:class extends WC{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},stsd:class extends YC{constructor(e,t){super(e,t),this.entryCount=this.readUint32(),this.children=this.scanForBoxes(new DataView(this.content.buffer,this.content.byteOffset+8,this.content.byteLength-8))}},avc1:class extends WC{constructor(e,t){super(e,t),this.children=this.scanForBoxes(new DataView(this.content.buffer,this.content.byteOffset+78,this.content.byteLength-78))}},unknown:QC},JC=class e{constructor(e={}){this.options={offset:0,...e}}parse(e){let t=[],i=this.options.offset;for(;i<e.byteLength;)try{let r=new TextDecoder("ascii").decode(new DataView(e.buffer,e.byteOffset+i+4,4)),n=this.createBox(r,new DataView(e.buffer,e.byteOffset+i));if(!n.size)break;t.push(n),i+=n.size}catch(e){break}return t}createBox(t,i){let r=XC[t];return r?new r(i,new e):new QC(i,new e)}},ZC=class{constructor(e){this.index={},this.indexBoxLevel(e)}indexBoxLevel(e){e.forEach((e=>{var t,i;null!=(t=this.index)[i=e.type]||(t[i]=[]),this.index[e.type].push(e),e.children.length>0&&this.indexBoxLevel(e.children)}))}find(e){return this.index[e]&&this.index[e][0]?this.index[e][0]:null}findAll(e){return this.index[e]||[]}},eL=new TextDecoder("ascii"),tL={validateData:e=>"ftyp"===eL.decode(new DataView(e.buffer,e.byteOffset+4,4)),parseInit:e=>{let t={is3dVideo:!1,stereoMode:0,projectionType:1,projectionData:{pose:{yaw:0,pitch:0,roll:0},bounds:{top:0,bottom:0,left:0,right:0}}},i=(new JC).parse(e),r=new ZC(i);if(r.find("sv3d")){t.is3dVideo=!0;let e=r.find("st3d");e&&(t.stereoMode=e.stereoMode);let i=r.find("prhd");i&&(t.projectionData.pose.yaw=i.poseYawDegrees,t.projectionData.pose.pitch=i.posePitchDegrees,t.projectionData.pose.roll=i.poseRollDegrees);let n=r.find("equi");n&&(t.projectionData.bounds.top=n.projectionBoundsTop,t.projectionData.bounds.right=n.projectionBoundsRight,t.projectionData.bounds.bottom=n.projectionBoundsBottom,t.projectionData.bounds.left=n.projectionBoundsLeft)}return t},getIndexRange:()=>{},parseSegments:e=>{let t=new KC(e,new JC),i=t.earliestPresentationTime/t.timescale*1e3,r=e.byteOffset+e.byteLength+t.firstOffset;return t.segments.map((e=>{if(0!==e.referenceType)throw new Error("Unsupported multilevel sidx");let n=e.subsegmentDuration/t.timescale*1e3,a={status:"none",time:{from:i,to:i+n},byte:{from:r,to:r+e.referencedSize-1}};return i+=n,r+=e.referencedSize,a}))},parseFeedableSegmentChunk:(e,t)=>{let i=(new JC).parse(e),r=new ZC(i),n=r.findAll("moof"),a=t?r.findAll("uuid"):r.findAll("mdat");if(!a.length||!n.length)return null;let s=n[0],o=a[a.length-1],l=s.source.byteOffset,u=o.source.byteOffset-s.source.byteOffset+o.size;return new DataView(e.buffer,l,u)},getChunkEndTime:(e,t)=>{let i=(new JC).parse(e),r=new ZC(i).findAll("traf"),n=r[r.length-1].children.find((e=>"tfhd"===e.type)),a=r[r.length-1].children.find((e=>"tfdt"===e.type)),s=r[r.length-1].children.find((e=>"trun"===e.type)),o=0;return o=s.sampleDuration.length?s.sampleDuration.reduce(((e,t)=>e+t),0):n.defaultSampleDuration*s.sampleCount,(Number(a.baseMediaDecodeTime)+o)/t*1e3},getServerLatencyTimestamps:e=>{let t=(new JC).parse(e),i=new ZC(t).findAll("uuid");return i.length?i[i.length-1]:{}},getTimescaleFromIndex:e=>{var t;let i=(new JC).parse(e);return null==(t=new ZC(i).find("sidx"))?void 0:t.timescale}},iL=lA(mR(),1),rL={440786851:{type:"master"},17030:{type:"uint"},17143:{type:"uint"},17138:{type:"uint"},17139:{type:"uint"},17026:{type:"string"},17031:{type:"uint"},17029:{type:"uint"},236:{type:"binary"},408125543:{type:"master"},290298740:{type:"master"},19899:{type:"master"},21419:{type:"binary"},21420:{type:"uint"},357149030:{type:"master"},2807729:{type:"uint"},17545:{type:"float"},374648427:{type:"master"},174:{type:"master"},224:{type:"master"},30320:{type:"master"},30321:{type:"uint"},30322:{type:"master"},272869232:{type:"master"},524531317:{type:"master"},231:{type:"uint"},22612:{type:"master"},22743:{type:"uint"},167:{type:"uint"},171:{type:"uint"},163:{type:"binary"},160:{type:"master"},175:{type:"binary"},423732329:{type:"master"},307544935:{type:"master"},475249515:{type:"master"},187:{type:"master"},179:{type:"uint"},183:{type:"master"},247:{type:"uint"},241:{type:"uint"},240:{type:"uint"},178:{type:"uint"},21368:{type:"uint"},234:{type:"uint"},219:{type:"master"},150:{type:"uint"}},nL=e=>{let t=e.getUint8(0),i=0;128&t?i=1:64&t?i=2:32&t?i=3:16&t&&(i=4);let r=aL(e,i),n=r in rL,a=n?rL[r].type:"binary",s=e.getUint8(i),o=0;128&s?o=1:64&s?o=2:32&s?o=3:16&s?o=4:8&s?o=5:4&s?o=6:2&s?o=7:1&s&&(o=8);let l,u=new DataView(e.buffer,e.byteOffset+i+1,o-1),d=(s&255>>o)*2**(8*(o-1))+aL(u),c=i+o;return l=c+d>e.byteLength?new DataView(e.buffer,e.byteOffset+c):new DataView(e.buffer,e.byteOffset+c,d),{tag:n?r:"0x"+r.toString(16).toUpperCase(),type:a,tagHeaderSize:c,tagSize:c+d,value:l,valueSize:d}},aL=(e,t=e.byteLength)=>{switch(t){case 1:return e.getUint8(0);case 2:return e.getUint16(0);case 3:return 65536*e.getUint8(0)+e.getUint16(1);case 4:return e.getUint32(0);case 5:return e.getUint8(0)*2**32+e.getUint32(1);case 6:return e.getUint16(0)*2**32+e.getUint32(2);case 7:{let t=281474976710656*e.getUint8(0)+4294967296*e.getUint16(1)+e.getUint32(3);if(Number.isSafeInteger(t))return t}case 8:throw new ReferenceError("Int64 is not supported")}return 0},sL=(e,t)=>{switch(t){case"int":return e.getInt8(0);case"uint":return aL(e);case"float":return 4===e.byteLength?e.getFloat32(0):e.getFloat64(0);case"string":return new TextDecoder("ascii").decode(e);case"utf8":return new TextDecoder("utf-8").decode(e);case"date":return new Date(Date.UTC(2001,0)+e.getInt8(0)).getTime();case"master":case"binary":return e;default:hb(t)}},oL=(e,t)=>{let i=0;for(;i<e.byteLength;){let r=new DataView(e.buffer,e.byteOffset+i),n=nL(r);if(!t(n))return;"master"===n.type&&oL(n.value,t),i=n.value.byteOffset-e.byteOffset+n.valueSize}},lL=[357149030,290298740,374648427,174,224,30320,30321,30322,272869232,524531317,475249515,423732329,307544935],uL=[231,22612,22743,167,171,163,160,175],dL={validateData:e=>{if(440786851!==e.getUint32(0))return!1;let t,i,r,n=nL(e);return oL(n.value,(({tag:e,type:n,value:a})=>(17143===e?t=sL(a,n):17026===e?i=sL(a,n):17029===e&&(r=sL(a,n)),!0))),(void 0===t||t<=1)&&void 0!==i&&"webm"===i&&(void 0===r||r<=2)},parseInit:e=>{let t,i,r,n,a,s,o=!1,l=!1,u=!1,d=!1;return oL(e,(({tag:e,type:c,value:h,valueSize:p})=>{if(21419===e){let e=sL(h,c);s=aL(e)}else 21420!==e&&(s=void 0);return 408125543===e?(t=h.byteOffset,i=h.byteOffset+p):357149030===e?o=!0:290298740===e?l=!0:2807729===e?r=sL(h,c):17545===e?n=sL(h,c):21420===e&&475249515===s?a=sL(h,c):374648427===e?oL(h,(({tag:e,type:t,value:i})=>30321!==e||(d=1===sL(i,t),!1))):o&&l&&(0,iL.default)(lL,e)&&(u=!0),!u})),yb(t,"Failed to parse webm Segment start"),yb(i,"Failed to parse webm Segment end"),yb(n,"Failed to parse webm Segment duration"),r=null!=r?r:1e6,{segmentStart:Math.round(t/1e9*r*1e3),segmentEnd:Math.round(i/1e9*r*1e3),timeScale:r,segmentDuration:Math.round(n/1e9*r*1e3),cuesSeekPosition:a,is3dVideo:d,stereoMode:0,projectionType:1,projectionData:{pose:{yaw:0,pitch:0,roll:0},bounds:{top:0,bottom:0,left:0,right:0}}}},getIndexRange:e=>{if(Eb(e.cuesSeekPosition))return;let t=e.segmentStart+e.cuesSeekPosition;return{from:t,to:t+1048576}},parseSegments:(e,t)=>{let i,r=!1,n=!1,a=e=>Tb(e.time)&&Tb(e.position),s=[];return oL(e,(({tag:e,type:t,value:o})=>{switch(e){case 475249515:r=!0;break;case 187:i&&a(i)&&s.push(i),i={};break;case 179:i&&(i.time=sL(o,t));break;case 183:break;case 241:i&&(i.position=sL(o,t));break;default:r&&(0,iL.default)(lL,e)&&(n=!0)}return!(r&&n)})),i&&a(i)&&s.push(i),s.map(((e,i)=>{let{time:r,position:n}=e,a=s[i+1];return{status:"none",time:{from:r,to:a?a.time:t.segmentDuration},byte:{from:t.segmentStart+n,to:a?t.segmentStart+a.position-1:t.segmentEnd-1}}}))},parseFeedableSegmentChunk:e=>{let t=0,i=!1;try{oL(e,(r=>524531317===r.tag?r.tagSize<=e.byteLength?(t=r.tagSize,!1):(t+=r.tagHeaderSize,!0):!!(0,iL.default)(uL,r.tag)&&(t+r.tagSize<=e.byteLength&&(t+=r.tagSize,i||(i=(0,iL.default)([163,160,175],r.tag))),!0)))}catch(e){}return t>0&&t<=e.byteLength&&i?new DataView(e.buffer,e.byteOffset,t):null}},cL=e=>{let t=/^(.+)\/([^;]+)(?:;.*)?$/.exec(e);if(t){let[,e,i]=t;if("audio"===e||"video"===e)switch(i){case"webm":return dL;case"mp4":return tL}}throw new ReferenceError(`Unsupported mime type ${e}`)},hL=lA(OP(),1),pL=lA(PR(),1),fL=lA(DP(),1),mL=lA(Jw(),1),gL=lA(Qw(),1),vL=lA(mR(),1),SL=e=>{let t=e.split("."),[i,...r]=t;if(!i)return!1;switch(i){case"av01":{let[e,t,i]=r;return!!(i&&parseInt(i,10)>8)}case"vp09":{let[e,t,i]=r;return!!(e&&parseInt(e,10)>=2&&i&&parseInt(i,10)>8)}case"avc1":{let e=r[0];if(!e||6!==e.length)return!1;let[t,i]=e.toUpperCase(),n=t+i;return(0,vL.default)(["6E","7A","F4"],n)}}return!1},yL=e=>{if(e.includes("/")){let t=e.split("/");return parseInt(t[0])/parseInt(t[1])}return parseFloat(e)},TL=e=>{var t;try{let i=function(){let e="(?<extlang>(?:[a-z]{3}(?:-[a-z]{3}){0,2}))",t="x(?:-[a-z0-9]{1,8})+",i=`^(?:(?<langtag>\n    (?<language>(?:[a-z]{2,3}(?:-${e})?|[a-z]{4}|[a-z]{5,8}))\n    (-(?<script>[a-z]{4}))?\n    (-(?<region>(?:[a-z]{2}|[0-9]{3})))?\n    (?<variants>(?:-(?:[a-z0-9]{5,8}|[0-9][a-z0-9]{3}))*)\n    (?<extensions>(?:-[0-9a-wy-z](?:-[a-z0-9]{2,8})+)*)\n    (?:-(?<privateuse>(?:${t})))?\n  )|(?<privateuse2>${t}))$`.replace(/[\s\t\n]/g,"");return new RegExp(i,"i")}(),r=e.match(i),{groups:n}=null!=r?r:{};if(n){let e={};if(n.extensions){let t=n.extensions.toLowerCase().match(/(?:[0-9a-wy-z](?:-[a-z0-9]{2,8})+)/g);Array.from(t||[]).forEach((t=>{e[t[0]]=t.slice(2)}))}let i=null==(t=n.variants)?void 0:t.split(/-/).filter((e=>""!==e)),r={extlang:n.extlang,langtag:n.langtag,language:n.language,privateuse:n.privateuse||n.privateuse2,region:n.region,script:n.script,extensions:e,variants:i};return Object.keys(r).forEach((e=>{let t=r[e];(void 0===t||""===t)&&delete r[e]})),r}return null}catch(e){return null}};var EL=lA(Jw(),1),bL=({id:e,width:t,height:i,bitrate:r,fps:n,quality:a,streamId:s})=>{var o;let l=null!=(o=a?xO(a):void 0)?o:Qb({width:t,height:i});return l&&{id:e,quality:l,bitrate:r,size:{width:t,height:i},fps:n,streamId:s}},_L=({id:e,bitrate:t})=>({id:e,bitrate:t}),AL=({language:e,label:t},{id:i,url:r,isAuto:n})=>({id:i,url:r,isAuto:n,type:"internal",language:e,label:t}),RL=({id:e,language:t,label:i,codecs:r,isDefault:n})=>({id:e,language:t,label:i,codec:(0,EL.default)(r.split("."),0),isDefault:n}),wL=({id:e,language:t,label:i,hdr:r,codecs:n})=>({id:e,language:t,hdr:r,label:i,codec:(0,EL.default)(n.split("."),0)}),PL=e=>"url"in e,OL=e=>"template"===e.type,CL=e=>e instanceof DOMException&&("AbortError"===e.name||20===e.code),LL=e=>{if(null==e||!e.startsWith("P"))return;let t=(e,t)=>{let i=e?parseFloat(e.replace(",",".")):NaN;return(isNaN(i)?0:i)*t},i=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/.exec(e),r="-"===(null==i?void 0:i[1])?-1:1;return 24*t(null==i?void 0:i[5],r)*60*60*1e3+60*t(null==i?void 0:i[6],r)*60*1e3+60*t(null==i?void 0:i[7],r)*1e3+1e3*t(null==i?void 0:i[8],r)},IL=(e,t)=>{let i=e;i=(0,hL.default)(i,"$$","$");let r={RepresentationID:t.representationId,Number:t.segmentNumber,Bandwidth:t.bandwidth,Time:t.segmentTime};for(let[e,t]of(0,pL.default)(r)){let r=new RegExp(`\\$${e}(?:%0(\\d+)d)?\\$`,"g");i=(0,hL.default)(i,r,((e,i)=>Eb(t)?e:Eb(i)?t:(0,fL.default)(t,parseInt(i,10),"0")))}return i},xL=lA(mR(),1),ML=(e,t)=>Tb(e)&&Tb(t)&&"open"===e.readyState&&(0,xL.default)([...e.activeSourceBuffers],t),NL=class{constructor(e,t,i,{fetcher:r,tuning:n,getCurrentPosition:a,isActiveLowLatency:s,compatibilityMode:o=!1,manifest:l}){var u;this.currentLiveSegmentServerLatency$=new n_(0),this.currentLowLatencySegmentLength$=new n_(0),this.currentSegmentLength$=new n_(0),this.onLastSegment$=new n_(!1),this.fullyBuffered$=new n_(!1),this.playingRepresentation$=new n_(void 0),this.playingRepresentationInit$=new n_(void 0),this.error$=new mb,this.gaps=[],this.subscription=new cb,this.allInitsLoaded=!1,this.activeSegments=new Set,this.downloadAbortController=new xC,this.switchAbortController=new xC,this.destroyAbortController=new xC,this.bufferLimit=1/0,this.failedDownloads=0,this.baseUrls=[],this.baseUrlsIndex=0,this.isLive=!1,this.liveUpdateSegmentIndex=0,this.liveInitialAdditionalOffset=0,this.isSeekingLive=!1,this.index=0,this.lastDataObtainedTimestampMs=0,this.loadByteRangeSegmentsTimeoutId=0,this.startWith=Rb(this.destroyAbortController.signal,async function*(e){let t=this.representations.get(e);yb(t,`Cannot find representation ${e}`),this.playingRepresentationId=e,this.downloadingRepresentationId=e,this.sourceBuffer=this.mediaSource.addSourceBuffer(`${t.mime}; codecs="${t.codecs}"`),this.sourceBufferTaskQueue=new qC(this.sourceBuffer),this.subscription.add(d_(this.sourceBuffer,"updateend").subscribe((()=>{this.checkEjectedSegments(),this.maintain()}),(e=>{let t,i=this.mediaSource.readyState;"open"!==i&&(t={id:`SegmentEjection_source_${i}`,category:M_.VIDEO_PIPELINE,message:"Error when trying to clear segments ejected by browser",thrown:e}),null!=t||(t={id:"SegmentEjection",category:M_.VIDEO_PIPELINE,message:"Error when trying to clear segments ejected by browser",thrown:e}),this.error$.next(t)}))),this.subscription.add(d_(this.sourceBuffer,"error").subscribe((()=>this.error$.next({id:"SourceBuffer",category:M_.VIDEO_PIPELINE,message:"SourceBuffer Error event fired"})))),this.subscription.add(this.sourceBufferTaskQueue.bufferFull$.subscribe((e=>{let t=this.getCurrentPosition();if(!this.sourceBuffer||!t||!ML(this.mediaSource,this.sourceBuffer))return;let i=Math.min(this.bufferLimit,.8*zC(this.sourceBuffer.buffered));this.bufferLimit=i;let r=this.getForwardBufferDuration(t),n=Math.min(this.forwardBufferTarget,this.bufferLimit)*this.tuning.dash.minSafeBufferThreshold;this.pruneBuffer(t,2*e,r<n).catch((e=>{this.handleAsyncError(e,"pruneBuffer")}))}))),this.subscription.add(this.sourceBufferTaskQueue.error$.subscribe((e=>this.error$.next(e)))),yield this.loadInit(t,"high",!0);let i=this.initData.get(t.id),r=this.segments.get(t.id),n=this.parsedInitData.get(t.id);yb(i,"No init buffer for starting representation"),yb(r,"No segments for starting representation"),i instanceof ArrayBuffer&&(this.searchGaps(r,t),yield this.sourceBufferTaskQueue.append(i,this.destroyAbortController.signal),this.playingRepresentation$.next(this.playingRepresentationId),this.playingRepresentationInit$.next(n))}.bind(this)),this.switchTo=Rb(this.destroyAbortController.signal,async function*(e,t=!1){if(!ML(this.mediaSource,this.sourceBuffer)||e===this.downloadingRepresentationId||e===this.switchingToRepresentationId)return;this.switchingToRepresentationId=e;let i=this.representations.get(e);yb(i,`No such representation ${e}`);let r=this.segments.get(e),n=this.initData.get(e);if(Eb(n)||Eb(r)?yield this.loadInit(i,"high",!1):n instanceof Promise&&(yield n),r=this.segments.get(e),yb(r,"No segments for starting representation"),n=this.initData.get(e),n&&n instanceof ArrayBuffer&&this.sourceBuffer&&ML(this.mediaSource,this.sourceBuffer)){if(yield this.abort(),yield this.sourceBufferTaskQueue.append(n,this.downloadAbortController.signal),t)this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e,yield this.dropBuffer();else{let t=this.getCurrentPosition();Tb(t)&&!this.isLive&&(this.bufferLimit=1/0,await this.pruneBuffer(t,1/0,!0)),this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e}this.maintain()}}.bind(this)),this.switchToOld=Rb(this.destroyAbortController.signal,async function*(e,t=!1){if(!ML(this.mediaSource,this.sourceBuffer)||e===this.downloadingRepresentationId||e===this.switchingToRepresentationId)return;this.switchingToRepresentationId=e;let i=this.representations.get(e);yb(i,`No such representation ${e}`);let r=this.segments.get(e),n=this.initData.get(e);if(Eb(n)||Eb(r)?yield this.loadInit(i,"high",!1):n instanceof Promise&&(yield n),r=this.segments.get(e),yb(r,"No segments for starting representation"),n=this.initData.get(e),n&&n instanceof ArrayBuffer&&this.sourceBuffer&&ML(this.mediaSource,this.sourceBuffer))if(yield this.abort(),yield this.sourceBufferTaskQueue.append(n,this.downloadAbortController.signal),t)this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e,yield this.dropBuffer(),this.maintain();else{let t=this.getCurrentPosition();Tb(t)&&(this.isLive||(this.bufferLimit=1/0,await this.pruneBuffer(t,1/0,!0)),this.maintain(t)),this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e}}.bind(this)),this.seekLive=Rb(this.destroyAbortController.signal,async function*(e){var t,i;let r=null!=(t=(0,VC.default)(e,(e=>e.representations)))?t:[];if(this.isSeekingLive=!0,!this.downloadingRepresentationId||!r)return;for(let e of this.representations.keys()){let t=r.find((t=>t.id===e));t&&this.representations.set(e,t);let i=this.representations.get(e);if(!i||!OL(i.segmentReference))return;let n=this.getActualLiveStartingSegments(i.segmentReference);this.segments.set(i.id,n)}let n=null!=(i=this.switchingToRepresentationId)?i:this.downloadingRepresentationId,a=this.representations.get(n);yb(a);let s=this.segments.get(n);yb(s,"No segments for starting representation");let o=this.initData.get(n);if(yb(o,"No init buffer for starting representation"),!(o instanceof ArrayBuffer))return;let l=this.getDebugBufferState();this.liveUpdateSegmentIndex=0,yield this.abort(),l&&(yield this.sourceBufferTaskQueue.remove(1e3*l.from,1e3*l.to,this.destroyAbortController.signal)),this.searchGaps(s,a),yield this.sourceBufferTaskQueue.append(o,this.destroyAbortController.signal),this.isSeekingLive=!1}.bind(this)),this.fetcher=r,this.tuning=n,this.compatibilityMode=o,this.forwardBufferTarget=n.dash.forwardBufferTargetAuto,this.getCurrentPosition=a,this.isActiveLowLatency=s,this.isLive=!(null==l||!l.live),this.baseUrls=null!=(u=null==l?void 0:l.baseUrls)?u:[],this.initData=new Map(i.map((e=>[e.id,null]))),this.segments=new Map,this.parsedInitData=new Map,this.representations=new Map(i.map((e=>[e.id,e]))),this.kind=e,this.mediaSource=t,this.sourceBuffer=null}switchToWithPreviousAbort(e,t=!1){!ML(this.mediaSource,this.sourceBuffer)||e===this.downloadingRepresentationId||e===this.switchingToRepresentationId||(this.switchAbortController.abort(),this.switchAbortController=new xC,Rb(this.switchAbortController.signal,async function*(e,t=!1){this.switchingToRepresentationId=e;let i=this.representations.get(e);yb(i,`No such representation ${e}`);let r=this.segments.get(e),n=this.initData.get(e);if(Eb(n)||Eb(r)?yield this.loadInit(i,"high",!1):n instanceof Promise&&(yield n),r=this.segments.get(e),yb(r,"No segments for starting representation"),n=this.initData.get(e),n instanceof ArrayBuffer&&this.sourceBuffer&&ML(this.mediaSource,this.sourceBuffer)){if(yield this.abort(),yield this.sourceBufferTaskQueue.append(n,this.downloadAbortController.signal),t)this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e,yield this.dropBuffer();else{let t=this.getCurrentPosition();Tb(t)&&!this.isLive&&(this.bufferLimit=this.forwardBufferTarget,yield this.pruneBuffer(t,1/0,!0)),this.downloadingRepresentationId=e,this.switchingToRepresentationId=void 0}this.maintain()}}.bind(this))(e,t))}warmUpMediaSource(){!Eb(this.sourceBuffer)&&!this.sourceBuffer.updating&&(this.sourceBuffer.mode="segments")}async abort(){for(let e of this.activeSegments)this.abortSegment(e.segment);return this.activeSegments.clear(),this.downloadAbortController.abort(),this.downloadAbortController=new xC,this.abortBuffer()}maintain(e=this.getCurrentPosition()){if(Eb(e)||Eb(this.downloadingRepresentationId)||Eb(this.playingRepresentationId)||Eb(this.sourceBuffer)||!ML(this.mediaSource,this.sourceBuffer)||Tb(this.switchingToRepresentationId)||this.isSeekingLive)return;let t=this.representations.get(this.downloadingRepresentationId),i=this.segments.get(this.downloadingRepresentationId);if(yb(t,`No such representation ${this.downloadingRepresentationId}`),!i)return;let r=i.find((t=>e>=t.time.from&&e<t.time.to));Tb(r)&&isFinite(r.time.from)&&isFinite(r.time.to)&&this.currentSegmentLength$.next((null==r?void 0:r.time.to)-r.time.from);let n=e;if(this.playingRepresentationId!==this.downloadingRepresentationId){let t=this.getForwardBufferDuration(e),i=r?r.time.to+100:-1/0;r&&r.time.to-e<this.tuning.dash.maxSegmentDurationLeftToSelectNextSegment&&t>=r.time.to-e+100&&(n=i)}if(isFinite(this.bufferLimit)&&zC(this.sourceBuffer.buffered)>=this.bufferLimit){let t=this.getForwardBufferDuration(e),i=Math.min(this.forwardBufferTarget,this.bufferLimit)*this.tuning.dash.minSafeBufferThreshold;return void this.pruneBuffer(e,1/0,t<i).catch((e=>{this.handleAsyncError(e,"pruneBuffer")}))}let a=[];if(!this.activeSegments.size&&(a=this.selectForwardBufferSegments(i,t.segmentReference.type,n),a.length)){let e="auto";if(this.tuning.dash.useFetchPriorityHints&&r)if((0,kC.default)(a,r))e="high";else{let t=(0,$C.default)(a,0);t&&t.time.from-r.time.to>=this.forwardBufferTarget/2&&(e="low")}this.loadSegments(a,t,e).catch((e=>{this.handleAsyncError(e,"loadSegments")}))}(!this.preloadOnly&&!this.allInitsLoaded&&r&&"fed"===r.status&&!a.length&&this.getForwardBufferDuration(e)>3e3||this.isActiveLowLatency())&&this.loadNextInit();let s=(0,$C.default)(i,-1);!this.isLive&&s&&(this.fullyBuffered$.next(s.time.to-e-this.getForwardBufferDuration(e)<100),this.onLastSegment$.next(e-s.time.from>0))}get lastDataObtainedTimestamp(){return this.lastDataObtainedTimestampMs}searchGaps(e,t){this.gaps=[];let i=0,r=this.isLive?this.liveInitialAdditionalOffset:0;for(let n of e)Math.trunc(n.time.from-i)>0&&this.gaps.push({representation:t.id,from:i,to:n.time.from+r}),i=n.time.to;Tb(t.duration)&&t.duration-i>0&&!this.isLive&&this.gaps.push({representation:t.id,from:i,to:t.duration})}getActualLiveStartingSegments(e){let t=e.segments,i=this.isActiveLowLatency()?this.tuning.dashCmafLive.lowLatency.maxTargetOffset:this.tuning.dashCmafLive.maxActiveLiveOffset,r=[],n=0,a=t.length-1;do{r.unshift(t[a]),n+=t[a].time.to-t[a].time.from,a--}while(n<i&&a>=0);return this.liveInitialAdditionalOffset=n-i,this.isActiveLowLatency()?[r[0]]:r}getLiveSegmentsToLoadState(e){let t=(0,VC.default)(null==e?void 0:e.streams[this.kind],(e=>e.representations)).find((e=>e.id===this.downloadingRepresentationId));if(!t)return;let i=this.segments.get(t.id);return null!=i&&i.length?{from:i[0].time.from,to:i[i.length-1].time.to}:void 0}updateLive(e){var t,i,r,n;let a=null!=(t=(0,VC.default)(null==e?void 0:e.streams[this.kind],(e=>e.representations)))?t:[];if(![...this.segments.values()].every((e=>!e.length)))for(let e of a){if(!e||!OL(e.segmentReference))return;let t=e.segmentReference.segments.map((e=>({...e,status:"none",size:void 0}))),a=100,s=null!=(i=this.segments.get(e.id))?i:[],o=null!=(n=null==(r=(0,$C.default)(s,-1))?void 0:r.time.to)?n:0,l=null==t?void 0:t.findIndex((e=>o>=e.time.from+a&&o<=e.time.to+a));if(-1===l){this.liveUpdateSegmentIndex=0;let t=this.getActualLiveStartingSegments(e.segmentReference);this.segments.set(e.id,t)}else{let i=t.slice(l+1);this.segments.set(e.id,[...s,...i])}}}proceedLowLatencyLive(){let e=this.downloadingRepresentationId;yb(e);let t=this.segments.get(e);if(null!=t&&t.length){let e=t[t.length-1];this.updateLowLatencyLiveIfNeeded(e)}}updateLowLatencyLiveIfNeeded(e){var t;let i=0;for(let r of this.representations.values()){let n=r.segmentReference;if(!OL(n))return;let a=null!=(t=this.segments.get(r.id))?t:[],s=a.find((t=>Math.floor(t.time.from)===Math.floor(e.time.from)));if(s&&!isFinite(s.time.to)&&(s.time.to=e.time.to,i=s.time.to-s.time.from),!a.find((t=>Math.floor(t.time.from)===Math.floor(e.time.to)))&&this.isActiveLowLatency()){let t=Math.round(e.time.to*n.timescale/1e3).toString(10),i=IL(n.segmentTemplateUrl,{segmentTime:t});a.push({status:"none",time:{from:e.time.to,to:1/0},url:i})}}this.currentLowLatencySegmentLength$.next(i)}findSegmentStartTime(e){var t,i,r;let n=null!=(i=null!=(t=this.switchingToRepresentationId)?t:this.downloadingRepresentationId)?i:this.playingRepresentationId;if(!n)return;let a=this.segments.get(n);if(!a)return;let s=a.find((t=>t.time.from<=e&&t.time.to>=e));return null!=(r=null==s?void 0:s.time.from)?r:void 0}setTarget(e){this.forwardBufferTarget=e}setPreloadOnly(e){this.preloadOnly=e}destroy(){var e;if(this.initData.clear(),this.segments.clear(),this.parsedInitData.clear(),this.representations.clear(),null==(e=this.sourceBufferTaskQueue)||e.destroy(),this.gapDetectionIdleCallback&&HC&&HC(this.gapDetectionIdleCallback),this.initLoadIdleCallback&&HC&&HC(this.initLoadIdleCallback),this.subscription.unsubscribe(),this.sourceBuffer)try{this.mediaSource.removeSourceBuffer(this.sourceBuffer)}catch(e){if(!(e instanceof DOMException&&"NotFoundError"===e.name))throw e}this.sourceBuffer=null,this.downloadAbortController.abort(),this.switchAbortController.abort(),this.destroyAbortController.abort(),window.clearTimeout(this.loadByteRangeSegmentsTimeoutId)}selectForwardBufferSegments(e,t,i){return this.isLive?this.selectForwardBufferSegmentsLive(e,i):this.selectForwardBufferSegmentsRecord(e,t,i)}selectForwardBufferSegmentsLive(e,t){let i=e.findIndex((e=>t>=e.time.from&&t<e.time.to));return this.playingRepresentationId!==this.downloadingRepresentationId&&(this.liveUpdateSegmentIndex=i),this.liveUpdateSegmentIndex<e.length?e.slice(this.liveUpdateSegmentIndex++):[]}selectForwardBufferSegmentsRecord(e,t,i){let r=e.findIndex((({status:e,time:{from:t,to:r}},n)=>{let a=t>i||t<=i&&r>=i||0===n&&0===i,s=Math.min(this.forwardBufferTarget,this.bufferLimit),o=this.preloadOnly&&t<=i+s||r<=i+s;return("none"===e||"partially_ejected"===e&&a&&o&&this.sourceBuffer&&ML(this.mediaSource,this.sourceBuffer)&&!(DC(this.sourceBuffer.buffered,t)&&DC(this.sourceBuffer.buffered,r)))&&a&&o}));if(-1===r)return[];if("byteRange"!==t)return e.slice(r,r+1);let n=e,a=0,s=0,o=[],l=this.preloadOnly?0:this.tuning.dash.segmentRequestSize,u=this.preloadOnly?this.forwardBufferTarget:0;for(let e=r;e<n.length&&(a<=l||s<=u);e++){let t=n[e];if(a+=t.byte.to+1-t.byte.from,s+=t.time.to+1-t.time.from,"none"!==t.status&&"partially_ejected"!==t.status)break;o.push(t)}return o}async loadSegments(e,t,i="auto"){OL(t.segmentReference)?await this.loadTemplateSegment(e[0],t,i):await this.loadByteRangeSegments(e,t,i)}async loadTemplateSegment(e,t,i="auto"){e.status="downloading";let r={segment:e,loadedBytes:0,feedingBytes:0,fedBytes:0,representationId:t.id};this.activeSegments.add(r);let{range:n,url:a,signal:s,onProgress:o,onProgressTasks:l}=this.prepareTemplateFetchSegmentParams(e,t);this.failedDownloads&&s&&(await Rb(s,async function*(){let e=wb(this.failedDownloads,this.tuning.downloadBackoff);yield new Promise((t=>setTimeout(t,e)))}.bind(this))(),s.aborted&&this.abortActiveSegments([e]));try{let e=await this.fetcher.fetch(a,{range:n,signal:s,onProgress:o,priority:i,isLowLatency:this.isActiveLowLatency()});if(this.lastDataObtainedTimestampMs=Ab(),!e)return;let u=new DataView(e),d=cL(t.mime);if(!isFinite(r.segment.time.to)){let e=t.segmentReference.timescale;r.segment.time.to=d.getChunkEndTime(u,e)}o&&r.feedingBytes&&l?await Promise.all(l):await this.sourceBufferTaskQueue.append(u,s);let{serverDataReceivedTimestamp:c,serverDataPreparedTime:h}=d.getServerLatencyTimestamps(u);c&&h&&this.currentLiveSegmentServerLatency$.next(h-c),r.segment.status="downloaded",this.onSegmentFullyAppended(r,t.id),this.failedDownloads=0}catch(t){this.abortActiveSegments([e]),CL(t)||(this.failedDownloads++,this.updateRepresentationsBaseUrlIfNeeded())}}updateRepresentationsBaseUrlIfNeeded(){if(!this.tuning.dash.enableBaseUrlSupport||!this.baseUrls.length||this.failedDownloads<=this.tuning.dash.maxSegmentRetryCount)return;this.baseUrlsIndex=(this.baseUrlsIndex+1)%this.baseUrls.length;let e=this.baseUrls[this.baseUrlsIndex];for(let t of this.representations.values())OL(t.segmentReference)?t.segmentReference.baseUrl=e:t.segmentReference.url=e}async loadByteRangeSegments(e,t,i="auto"){if(!e.length)return;for(let i of e)i.status="downloading",this.activeSegments.add({segment:i,loadedBytes:0,feedingBytes:0,fedBytes:0,representationId:t.id});let{range:r,url:n,signal:a,onProgress:s}=this.prepareByteRangeFetchSegmentParams(e,t);this.failedDownloads&&a&&(await Rb(a,async function*(){let e=wb(this.failedDownloads,this.tuning.downloadBackoff);yield new Promise((t=>{this.loadByteRangeSegmentsTimeoutId=window.setTimeout(t,e),d_(window,"online").pipe(P_()).subscribe((()=>{t(),window.clearTimeout(this.loadByteRangeSegmentsTimeoutId)}))}))}.bind(this))(),a.aborted&&this.abortActiveSegments(e));try{await this.fetcher.fetch(n,{range:r,onProgress:s,signal:a,priority:i}),this.lastDataObtainedTimestampMs=Ab(),this.failedDownloads=0}catch(t){this.abortActiveSegments(e),CL(t)||(this.failedDownloads++,this.updateRepresentationsBaseUrlIfNeeded())}}prepareByteRangeFetchSegmentParams(e,t){if(OL(t.segmentReference))throw new Error("Representation is not byte range type");let i=t.segmentReference.url,r={from:(0,$C.default)(e,0).byte.from,to:(0,$C.default)(e,-1).byte.to},{signal:n}=this.downloadAbortController;return{url:i,range:r,signal:n,onProgress:async(e,i)=>{if(!n.aborted)try{this.lastDataObtainedTimestampMs=Ab(),await this.onSomeByteRangesDataLoaded({dataView:e,loaded:i,signal:n,onSegmentAppendFailed:()=>this.abort(),globalFrom:r?r.from:0,representationId:t.id})}catch(e){this.error$.next({id:"SegmentFeeding",category:M_.VIDEO_PIPELINE,message:"Error when feeding segments",thrown:e})}}}}prepareTemplateFetchSegmentParams(e,t){if(!OL(t.segmentReference))throw new Error("Representation is not template type");let i=new URL(e.url,t.segmentReference.baseUrl);this.isActiveLowLatency()&&i.searchParams.set("low-latency","yes");let r=i.toString(),{signal:n}=this.downloadAbortController,a=[],s=this.isActiveLowLatency()||this.tuning.dash.enableSubSegmentBufferFeeding&&this.liveUpdateSegmentIndex<3?(e,i)=>{if(!n.aborted)try{this.lastDataObtainedTimestampMs=Ab();let r=this.onSomeTemplateDataLoaded({dataView:e,loaded:i,signal:n,onSegmentAppendFailed:()=>this.abort(),representationId:t.id});a.push(r)}catch(e){this.error$.next({id:"SegmentFeeding",category:M_.VIDEO_PIPELINE,message:"Error when feeding segments",thrown:e})}}:void 0;return{url:r,signal:n,onProgress:s,onProgressTasks:a}}abortActiveSegments(e){for(let t of this.activeSegments)(0,kC.default)(e,t.segment)&&this.abortSegment(t.segment)}async onSomeTemplateDataLoaded({dataView:e,representationId:t,loaded:i,onSegmentAppendFailed:r,signal:n}){if(!this.activeSegments.size||!ML(this.mediaSource,this.sourceBuffer))return;let a=this.representations.get(t);if(a)for(let s of this.activeSegments){let{segment:o}=s;if(s.representationId===t){if(n.aborted){r();continue}if(s.loadedBytes=i,s.loadedBytes>s.feedingBytes){let t=new DataView(e.buffer,e.byteOffset+s.feedingBytes,s.loadedBytes-s.feedingBytes),i=cL(a.mime).parseFeedableSegmentChunk(t,this.isLive);null!=i&&i.byteLength&&(o.status="partially_fed",s.feedingBytes+=i.byteLength,await this.sourceBufferTaskQueue.append(i),s.fedBytes+=i.byteLength)}}}}async onSomeByteRangesDataLoaded({dataView:e,representationId:t,globalFrom:i,loaded:r,signal:n,onSegmentAppendFailed:a}){if(!this.activeSegments.size||!ML(this.mediaSource,this.sourceBuffer))return;let s=this.representations.get(t);if(s)for(let o of this.activeSegments){let{segment:l}=o;if(o.representationId!==t)continue;if(n.aborted){await a();continue}let u=l.byte.from-i,d=l.byte.to-i,c=d-u+1,h=d<=r;if(!(u<r))continue;let p=cL(s.mime);if("downloading"===l.status&&h){l.status="downloaded";let i=new DataView(e.buffer,e.byteOffset+u,c);await this.sourceBufferTaskQueue.append(i,n)&&!n.aborted?this.onSegmentFullyAppended(o,t):await a()}else if(this.tuning.dash.enableSubSegmentBufferFeeding&&("downloading"===l.status||"partially_fed"===l.status)&&(o.loadedBytes=Math.min(c,r-u),o.loadedBytes>o.feedingBytes)){let i=new DataView(e.buffer,e.byteOffset+u+o.feedingBytes,o.loadedBytes-o.feedingBytes),r=o.loadedBytes===c?i:p.parseFeedableSegmentChunk(i);null!=r&&r.byteLength&&(l.status="partially_fed",o.feedingBytes+=r.byteLength,await this.sourceBufferTaskQueue.append(r,n)&&!n.aborted?(o.fedBytes+=r.byteLength,o.fedBytes===c&&this.onSegmentFullyAppended(o,t)):await a())}}}onSegmentFullyAppended(e,t){var i;if(!Eb(this.sourceBuffer)&&ML(this.mediaSource,this.sourceBuffer)){!this.isLive&&LO.browser.isSafari&&this.tuning.useSafariEndlessRequestBugfix&&(DC(this.sourceBuffer.buffered,e.segment.time.from,100)&&DC(this.sourceBuffer.buffered,e.segment.time.to,100)||this.error$.next({id:"EmptyAppendBuffer",category:M_.VIDEO_PIPELINE,message:"Browser stuck on empty result of adding segment to source buffer"})),this.playingRepresentationId=t,this.playingRepresentation$.next(this.playingRepresentationId),this.playingRepresentationInit$.next(this.parsedInitData.get(this.playingRepresentationId)),e.segment.status="fed",PL(e.segment)&&(e.segment.size=e.fedBytes);for(let r of this.representations.values())if(r.id!==t)for(let t of null!=(i=this.segments.get(r.id))?i:[])"fed"===t.status&&Math.round(t.time.from)===Math.round(e.segment.time.from)&&Math.round(t.time.to)===Math.round(e.segment.time.to)&&(t.status="none");this.updateLowLatencyLiveIfNeeded(e.segment),this.activeSegments.delete(e),this.detectGapsWhenIdle(t,[e.segment])}}abortSegment(e){"partially_fed"===e.status?e.status="partially_ejected":"partially_ejected"!==e.status&&(e.status="none");for(let t of this.activeSegments.values())if(t.segment===e){this.activeSegments.delete(t);break}}loadNextInit(){if(this.allInitsLoaded||this.initLoadIdleCallback)return;let e=null,t=!1;for(let[i,r]of this.initData.entries()){t||(t=r instanceof Promise),null===r&&(e=i)}if(!e)return void(this.allInitsLoaded=!0);if(t)return;let i=this.representations.get(e);i&&(this.initLoadIdleCallback=FC((()=>(0,jC.default)(this.loadInit(i,"low",!1),(()=>this.initLoadIdleCallback=null)))))}async loadInit(e,t="auto",i=!1){let r=this.tuning.dash.useFetchPriorityHints?t:"auto",n=(!i&&this.failedDownloads>0?Rb(this.destroyAbortController.signal,async function*(){let e=wb(this.failedDownloads,this.tuning.downloadBackoff);yield new Promise((t=>setTimeout(t,e)))}.bind(this))():Promise.resolve()).then((()=>this.fetcher.fetchRepresentation(e.segmentReference,cL(e.mime),r))).then((async t=>{if(!t)return;let{init:i,dataView:r,segments:n}=t,a=r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength);this.initData.set(e.id,a);let s=n;this.isLive&&OL(e.segmentReference)&&(s=this.getActualLiveStartingSegments(e.segmentReference)),(!this.isLive||!this.segments.has(e.id))&&this.segments.set(e.id,s),i&&this.parsedInitData.set(e.id,i)})).then((()=>this.failedDownloads=0),(t=>{this.initData.set(e.id,null),i&&this.error$.next({id:"LoadInits",category:M_.WTF,message:"loadInit threw",thrown:t})}));return this.initData.set(e.id,n),n}async dropBuffer(){for(let e of this.segments.values())for(let t of e)t.status="none";await this.pruneBuffer(0,1/0,!0)}async pruneBuffer(e,t,i=!1){if(!this.sourceBuffer||!ML(this.mediaSource,this.sourceBuffer)||!this.playingRepresentationId||Eb(e))return!1;let r=[],n=0,a=e=>{var i;if(n>=t)return r;r.push({...e.time}),r=(e=>{e.sort(((e,t)=>e.from-t.from));let t=[e[0]];for(let i=1;i<e.length;i++){let{from:r,to:n}=e[i],a=t[t.length-1];a.to>=r?a.to=Math.max(a.to,n):t.push(e[i])}return t})(r);let a=PL(e)?null!=(i=e.size)?i:0:e.byte.to-e.byte.from;n+=a};for(let t of this.segments.values())for(let i of t){let t=i.time.to<=e-this.tuning.dash.bufferPruningSafeZone,r=i.time.from>=e+Math.min(this.forwardBufferTarget,this.bufferLimit);(t||r)&&"fed"===i.status&&a(i)}for(let e=0;e<this.sourceBuffer.buffered.length;e++){let t=1e3*this.sourceBuffer.buffered.start(e),i=1e3*this.sourceBuffer.buffered.end(e),r=0;for(let e of this.segments.values())for(let n of e)(0,kC.default)(["none","partially_ejected"],n.status)&&Math.round(n.time.from)<=Math.round(t)&&Math.round(n.time.to)>=Math.round(i)&&r++;if(r===this.segments.size){a({time:{from:t,to:i},url:"",status:"none"})}}if(r.length&&i){let t=Math.min(this.forwardBufferTarget,this.bufferLimit)*this.tuning.dash.minSafeBufferThreshold;for(let i of this.segments.values())for(let r of i)r.time.from>=e+t&&"fed"===r.status&&a(r)}return!!r.length&&(await Promise.all(r.map((e=>this.sourceBufferTaskQueue.remove(e.from,e.to))))).reduce(((e,t)=>e||t),!1)}async abortBuffer(){if(!this.sourceBuffer||!ML(this.mediaSource,this.sourceBuffer))return!1;let e=this.playingRepresentationId&&this.initData.get(this.playingRepresentationId),t=e instanceof ArrayBuffer?e:void 0;return this.sourceBufferTaskQueue.abort(t)}getDebugBufferState(){if(this.sourceBuffer&&ML(this.mediaSource,this.sourceBuffer)&&this.sourceBuffer.buffered.length)return{from:this.sourceBuffer.buffered.start(0),to:this.sourceBuffer.buffered.end(this.sourceBuffer.buffered.length-1)}}getForwardBufferDuration(e=this.getCurrentPosition()){return this.sourceBuffer&&ML(this.mediaSource,this.sourceBuffer)&&this.sourceBuffer.buffered.length&&!Eb(e)?AC(this.sourceBuffer.buffered,e):0}detectGaps(e,t){if(this.sourceBuffer&&ML(this.mediaSource,this.sourceBuffer)){if(this.tuning.useRefactoredSearchGap)for(let e=0;e<this.sourceBuffer.buffered.length;e++)this.gaps=this.gaps.filter((t=>this.sourceBuffer&&(Math.round(t.from)<Math.round(1e3*this.sourceBuffer.buffered.start(e))||Math.round(t.to)>Math.round(1e3*this.sourceBuffer.buffered.end(e)))));for(let i of t){let t={representation:e,from:i.time.from,to:i.time.to};for(let e=0;e<this.sourceBuffer.buffered.length;e++){let r=1e3*this.sourceBuffer.buffered.start(e),n=1e3*this.sourceBuffer.buffered.end(e);if(!(n<=i.time.from||r>=i.time.to)){if(r<=i.time.from&&n>=i.time.to){t=void 0;break}n>i.time.from&&n<i.time.to&&(t.from=n),r<i.time.to&&r>i.time.from&&(t.to=r)}}t&&t.to-t.from>1&&!this.gaps.some((e=>t&&e.from===t.from&&e.to===t.to))&&this.gaps.push(t)}}}detectGapsWhenIdle(e,t){if(!this.gapDetectionIdleCallback&&this.sourceBuffer&&ML(this.mediaSource,this.sourceBuffer)){if(!this.tuning.useRefactoredSearchGap)for(let e=0;e<this.sourceBuffer.buffered.length;e++)this.gaps=this.gaps.filter((t=>this.sourceBuffer&&(Math.round(t.from)<Math.round(1e3*this.sourceBuffer.buffered.start(e))||Math.round(t.to)>Math.round(1e3*this.sourceBuffer.buffered.end(e)))));this.gapDetectionIdleCallback=FC((()=>{try{this.detectGaps(e,t)}catch(e){this.error$.next({id:"GapDetection",category:M_.WTF,message:"detectGaps threw",thrown:e})}finally{this.gapDetectionIdleCallback=null}}))}}checkEjectedSegments(){if(Eb(this.sourceBuffer)||!ML(this.mediaSource,this.sourceBuffer)||Eb(this.playingRepresentationId))return;let e=[];for(let t=0;t<this.sourceBuffer.buffered.length;t++){let i=Math.floor(1e3*this.sourceBuffer.buffered.start(t)),r=Math.ceil(1e3*this.sourceBuffer.buffered.end(t));e.push({from:i,to:r})}let t=100;for(let i of this.segments.values())for(let r of i){let{status:i}=r;if("fed"!==i&&"partially_ejected"!==i)continue;let n=Math.floor(r.time.from),a=Math.ceil(r.time.to),s=e.some((e=>e.from-t<=n&&e.to+t>=a)),o=e.filter((e=>n>=e.from&&n<e.to-t||a>e.from+t&&a<=e.to));s||(1===o.length||this.gaps.some((e=>e.from===r.time.from||e.to===r.time.to))?r.status="partially_ejected":r.status="none")}}handleAsyncError(e,t){this.error$.next({id:t,category:M_.VIDEO_PIPELINE,thrown:e,message:"Something went wrong"})}},DL=e=>{let t=new URL(e);return t.searchParams.set("quic","1"),t.toString()},kL=class{constructor({throughputEstimator:e,requestQuic:t,tracer:i,compatibilityMode:r=!1,useEnableSubtitlesParam:n=!1}){this.lastConnectionType$=new n_(void 0),this.lastConnectionReused$=new n_(void 0),this.lastRequestFirstBytes$=new n_(void 0),this.recoverableError$=new mb,this.error$=new mb,this.abortAllController=new xC,this.subscription=new cb,this.fetchManifest=Rb(this.abortAllController.signal,async function*(e){let t=this.tracer.createComponentTracer("FetchManifest"),i=e;this.requestQuic&&(i=DL(i)),!this.compatibilityMode&&this.useEnableSubtitlesParam&&(i=(e=>{let t=new URL(e);return t.searchParams.set("enable-subtitles","yes"),t.toString()})(i));let r=yield this.doFetch(i,{signal:this.abortAllController.signal}).catch($L);return r?(t.log("success",e_({url:i,message:"Request successfully executed"})),t.end(),this.onHeadersReceived(r.headers),r.text()):(t.error("error",e_({url:i,message:"No data in request manifest"})),t.end(),null)}.bind(this)),this.fetch=Rb(this.abortAllController.signal,async function*(e,{rangeMethod:t=(this.compatibilityMode?0:1),range:i,onProgress:r,priority:n="auto",signal:a,measureThroughput:s=!0,isLowLatency:o=!1}={}){var l,u;let d=e,c=new Headers,h=this.tracer.createComponentTracer("Fetch");if(i)switch(t){case 0:c.append("Range",`bytes=${i.from}-${i.to}`);break;case 1:{let e=new URL(d,location.href);e.searchParams.append("bytes",`${i.from}-${i.to}`),d=e.toString();break}default:hb(t)}this.requestQuic&&(d=DL(d));let p,f=this.abortAllController.signal;if(a){let e=new xC;if(p=o_(d_(this.abortAllController.signal,"abort"),d_(a,"abort")).subscribe((()=>{try{e.abort()}catch(e){$L(e)}})),this.subscription.add(p),this.abortAllController.signal.aborted||a.aborted)try{e.abort()}catch(e){$L(e)}f=e.signal}let m=Ab();h.log("startRequest",e_({url:d,priority:n,rangeMethod:t,range:i,isLowLatency:o,requestStartedAt:m}));let g=yield this.doFetch(d,{priority:n,headers:c,signal:f}),v=Ab();if(!g)return h.error("error",{message:"No response in request"}),h.end(),null==p||p.unsubscribe(),null;if(null==(l=this.throughputEstimator)||l.addRawRtt(v-m),!g.ok||!g.body){null==p||p.unsubscribe();let e=`Fetch error ${g.status}: ${g.statusText}`;return h.error("error",{message:e}),h.end(),Promise.reject(new Error(`Fetch error ${g.status}: ${g.statusText}`))}if(this.onHeadersReceived(g.headers),!r&&!s){null==p||p.unsubscribe();let e=Ab(),t={requestStartedAt:m,requestEndedAt:e,duration:e-m};return h.log("endRequest",e_(t)),h.end(),g.arrayBuffer()}let[S,y]=g.body.tee(),T=S.getReader();s&&(null==(u=this.throughputEstimator)||u.trackStream(y,o));let E=0,b=new Uint8Array(0),_=!1,A=e=>{null==p||p.unsubscribe(),_=!0,$L(e)},R=Rb(f,async function*({done:e,value:t}){if(0===E&&this.lastRequestFirstBytes$.next(Ab()-m),f.aborted)null==p||p.unsubscribe();else if(!e&&t){let e=new Uint8Array(b.length+t.length);e.set(b),e.set(t,b.length),b=e,E+=t.byteLength,null==r||r(new DataView(b.buffer),E),yield null==T?void 0:T.read().then(R,A)}}.bind(this));yield null==T?void 0:T.read().then(R,A),null==p||p.unsubscribe();let w=Ab(),P={failed:_,requestStartedAt:m,requestEndedAt:w,duration:w-m};return _?(h.error("endRequest",e_(P)),h.end(),null):(h.log("endRequest",e_(P)),h.end(),b.buffer)}.bind(this)),this.fetchByteRangeRepresentation=Rb(this.abortAllController.signal,async function*(e,t,i){var r;if("byteRange"!==e.type)return null;let n,a,{from:s,to:o}=e.initRange,l=s,u=o,d=!1;e.indexRange&&(n=e.indexRange.from,a=e.indexRange.to,d=o+1===n,d&&(l=Math.min(n,s),u=Math.max(a,o))),l=Math.min(l,0);let c=yield this.fetch(e.url,{range:{from:l,to:u},priority:i,measureThroughput:!1});if(!c)return null;let h=new DataView(c,s-l,o-l+1);if(!t.validateData(h))throw new Error("Invalid media file");let p,f=t.parseInit(h),m=null!=(r=e.indexRange)?r:t.getIndexRange(f);if(!m)throw new ReferenceError("No way to load representation index");if(d)p=new DataView(c,m.from-l,m.to-m.from+1);else{let t=yield this.fetch(e.url,{range:m,priority:i,measureThroughput:!1});if(!t)return null;p=new DataView(t)}let g=t.parseSegments(p,f,m);return{init:f,dataView:new DataView(c),segments:g}}.bind(this)),this.fetchTemplateRepresentation=Rb(this.abortAllController.signal,async function*(e,t){if("template"!==e.type)return null;let i=new URL(e.initUrl,e.baseUrl).toString(),r=yield this.fetch(i,{priority:t,measureThroughput:!1});return r?{init:null,segments:e.segments.map((e=>({...e,status:"none",size:void 0}))),dataView:new DataView(r)}:null}.bind(this)),this.throughputEstimator=e,this.requestQuic=t,this.compatibilityMode=r,this.tracer=i.createComponentTracer("Fetcher"),this.useEnableSubtitlesParam=n}onHeadersReceived(e){let{type:t,reused:i}=(e=>{var t;let i=e.get("X-Delivery-Type"),r=e.get("X-Reused");return{type:null===i?"http1":null!=i?i:void 0,reused:null===r?void 0:null!=(t={1:!0,0:!1}[r])?t:void 0}})(e);this.lastConnectionType$.next(t),this.lastConnectionReused$.next(i)}async fetchRepresentation(e,t,i="auto"){var r,n;let{type:a}=e;switch(a){case"byteRange":return null!=(r=await this.fetchByteRangeRepresentation(e,t,i))?r:null;case"template":return null!=(n=await this.fetchTemplateRepresentation(e,i))?n:null;default:hb(a)}}destroy(){this.abortAllController.abort(),this.subscription.unsubscribe(),this.tracer.end()}async doFetch(e,t){let i=await IC(e,t);if(i.ok)return i;let r=await i.text(),n=parseInt(r);if(!isNaN(n))switch(n){case 1:this.recoverableError$.next({id:"VideoDataLinkExpiredError",message:"Video data links have expired",category:M_.FATAL});break;case 8:this.recoverableError$.next({id:"VideoDataLinkBlockedForFloodError",message:"Url blocked for flood",category:M_.FATAL});break;case 18:this.recoverableError$.next({id:"VideoDataLinkIllegalIpChangeError",message:"Client IP has changed",category:M_.FATAL});break;case 21:this.recoverableError$.next({id:"VideoDataLinkIllegalHostChangeError",message:"Request HOST has changed",category:M_.FATAL});break;default:this.error$.next({id:"GeneralVideoDataFetchError",message:`Generic video data fetch error (${n})`,category:M_.FATAL})}}},$L=e=>{if(!CL(e))throw e},VL=(e,t,i)=>i*t+(1-i)*e,UL=(e,t)=>e.reduce(((e,t)=>e+t),0)/t,BL=class{constructor(e){var t;this.prevReported=void 0,this.pastMeasures=[],this.takenMeasures=0,this.measuresCursor=0,this.params=e,this.pastMeasures=Array(e.deviationDepth),this.smoothed=this.prevReported=e.initial,this.smoothed$=new n_(e.initial),this.debounced$=new n_(e.initial);let i=null!=(t=e.label)?t:"value"+Math.random().toString(16).substring(2,6);this.rawSeries$=new BO(`raw_${i}`),this.smoothedSeries$=new BO(`smoothed_${i}`),this.reportedSeries$=new BO(`reported_${i}`),this.rawSeries$.next(e.initial),this.smoothedSeries$.next(e.initial),this.reportedSeries$.next(e.initial)}next(e){let t=0,i=0;for(let e=0;e<this.pastMeasures.length;e++)void 0!==this.pastMeasures[e]&&(t+=(this.pastMeasures[e]-this.smoothed)**2,i++);this.takenMeasures=i,t/=i;let r=Math.sqrt(t),n=this.smoothed+this.params.deviationFactor*r,a=this.smoothed-this.params.deviationFactor*r;this.pastMeasures[this.measuresCursor]=e,this.measuresCursor=(this.measuresCursor+1)%this.pastMeasures.length,this.rawSeries$.next(e),this.updateSmoothedValue(e),this.smoothed$.next(this.smoothed),this.smoothedSeries$.next(this.smoothed),!(this.smoothed>n||this.smoothed<a)&&(Eb(this.prevReported)||Math.abs(this.smoothed-this.prevReported)/this.prevReported>=this.params.changeThreshold)&&(this.prevReported=this.smoothed,this.debounced$.next(this.smoothed),this.reportedSeries$.next(this.smoothed))}},FL=class extends BL{constructor(e){super(e),this.slow=this.fast=e.initial}updateSmoothedValue(e){this.slow=VL(this.slow,e,this.params.emaAlphaSlow),this.fast=VL(this.fast,e,this.params.emaAlphaFast);let t=this.params.fastDirection>0?Math.max:Math.min;this.smoothed=t(this.slow,this.fast)}},HL=class extends BL{constructor(e){super(e),this.emaSmoothed=e.initial}updateSmoothedValue(e){let t=UL(this.pastMeasures,this.takenMeasures);this.emaSmoothed=VL(this.emaSmoothed,e,this.params.emaAlpha);let i=((e,t,i,r)=>{let n=0,a=i,s=UL(e,t),o=t<r?t:r;for(let t=0;t<o;t++)e[a]>s?n++:n--,a=(e.length+a-1)%e.length;return Math.abs(n)===o})(this.pastMeasures,this.takenMeasures,this.measuresCursor-1,this.params.basisTrendChangeCount);this.smoothed=i?this.emaSmoothed:t}},jL=class extends BL{constructor(e){super(e),this.furtherValues=[],this.currentTopExtremumValue=0,this.extremumInterval=e.extremumInterval}next(e){this.currentTopExtremumValue<=e?(this.currentTopExtremumValue=e,this.furtherValues=[]):this.furtherValues.length===this.extremumInterval?(super.next(this.currentTopExtremumValue),this.currentTopExtremumValue=e,this.furtherValues=[]):this.furtherValues.push(e)}updateSmoothedValue(e){this.smoothed=this.smoothed?VL(this.smoothed,e,this.params.emaAlpha):e}},GL=class{static getSmoothedValue(e,t,i){return"TwoEma"===i.type?new FL({initial:e,emaAlphaSlow:i.emaAlphaSlow,emaAlphaFast:i.emaAlphaFast,changeThreshold:i.changeThreshold,fastDirection:t,deviationDepth:i.deviationDepth,deviationFactor:i.deviationFactor,label:"throughput"}):new HL({initial:e,emaAlpha:i.emaAlpha,basisTrendChangeCount:i.basisTrendChangeCount,changeThreshold:i.changeThreshold,deviationDepth:i.deviationDepth,deviationFactor:i.deviationFactor,label:"throughput"})}static getLiveBufferSmoothedValue(e,t){return new jL({initial:e,label:"liveEdgeDelay",...t})}},qL=(e,t)=>{e&&e.playbackRate!==t&&(e.playbackRate=t)},zL=class e{constructor(e,t){this.currentRepresentation$=new n_(null),this.maxRepresentations=4,this.representationsCursor=0,this.representations=[],this.currentSegment=null,this.getCurrentPosition=t.getCurrentPosition,this.processStreams(e)}updateLive(e){this.processStreams(null==e?void 0:e.streams.text)}seekLive(e){this.processStreams(e)}maintain(e=this.getCurrentPosition()){var t;if(!Eb(e))for(let i of this.representations)for(let r of i){let i=r.segmentReference,n=i.segments.length,a=i.segments[0].time.from,s=i.segments[n-1].time.to;if(e<a||e>s)continue;let o=i.segments.find((t=>t.time.from<=e&&t.time.to>=e));!o||(null==(t=this.currentSegment)?void 0:t.time.from)===o.time.from&&this.currentSegment.time.to===o.time.to||(this.currentSegment=o,this.currentRepresentation$.next({...r,label:"Live Text",language:"ru",isAuto:!0,url:new URL(o.url,i.baseUrl).toString()}))}}destroy(){this.currentRepresentation$.next(null),this.currentSegment=null,this.representations=[]}processStreams(t){for(let i of null!=t?t:[]){let t=e.filterRepresentations(i.representations);if(t){this.representations[this.representationsCursor]=t,this.representationsCursor=(this.representationsCursor+1)%this.maxRepresentations;break}}}static isSupported(t){return!(null==t||!t.some((t=>e.filterRepresentations(t.representations))))}static filterRepresentations(e){return null==e?void 0:e.filter((e=>"text"===e.kind&&"segmentReference"in e&&OL(e.segmentReference)))}},WL=lA(Jw(),1),QL=e=>{let{webmDecodingInfo:t}=LO.video,i="DASH_WEBM",r="DASH_WEBM_AV1";switch(e){case"vp9":return[i,r];case"av1":return[r,i];case"none":return[];case"smooth":return t?t[r].smooth?[r,i]:t[i].smooth?[i,r]:[r,i]:[i,r];case"power_efficient":return t?t[r].powerEfficient?[r,i]:t[i].powerEfficient?[i,r]:[r,i]:[i,r];default:hb(e)}return[i,r]},YL=({webmCodec:e,androidPreferredFormat:t,preferMultiStream:i})=>{let r=[...i?["DASH_STREAMS"]:[],...QL(e),"DASH_SEP","DASH_ONDEMAND",...i?[]:["DASH_STREAMS"]],n=[...i?["DASH_STREAMS"]:[],"DASH_SEP","DASH_ONDEMAND",...i?[]:["DASH_STREAMS"]];if(LO.device.isAndroid)switch(t){case"mpeg":return["MPEG",...r,"HLS","HLS_ONDEMAND"];case"hls":return["HLS","HLS_ONDEMAND",...r,"MPEG"];case"dash":return[...r,"HLS","HLS_ONDEMAND","MPEG"];case"dash_any_mpeg":return[...n,"MPEG",...QL(e),"HLS","HLS_ONDEMAND"];case"dash_any_webm":return[...QL(e),"MPEG",...n,"HLS","HLS_ONDEMAND"];case"dash_sep":return["DASH_SEP","MPEG",...QL(e),...n,"HLS","HLS_ONDEMAND"];default:hb(t)}return LO.video.nativeHlsSupported,[...r,"HLS","HLS_ONDEMAND","MPEG"]},KL=({androidPreferredFormat:e,preferCMAF:t,preferWebRTC:i})=>{let r,n=t?["DASH_LIVE_CMAF","DASH_LIVE"]:["DASH_LIVE","DASH_LIVE_CMAF"],a=t?["HLS_LIVE_CMAF","HLS_LIVE"]:["HLS_LIVE","HLS_LIVE_CMAF"],s=[...n,...a],o=[...a,...n],l=LO.device.isMac&&LO.browser.isSafari;if(LO.device.isAndroid)switch(e){case"dash":case"dash_any_mpeg":case"dash_any_webm":case"dash_sep":r=s;break;case"hls":case"mpeg":r=o;break;default:hb(e)}else r=LO.video.nativeHlsSupported&&!l?o:l?t?["DASH_LIVE_CMAF","HLS_LIVE_CMAF","HLS_LIVE","DASH_LIVE"]:["HLS_LIVE","DASH_LIVE","DASH_LIVE_CMAF","HLS_LIVE_CMAF"]:s;return i?["WEB_RTC_LIVE",...r]:[...r,"WEB_RTC_LIVE"]},XL=e=>e?["HLS_LIVE","HLS_LIVE_CMAF","DASH_LIVE_CMAF"]:["DASH_WEBM","DASH_WEBM_AV1","DASH_SEP","DASH_ONDEMAND","HLS","HLS_ONDEMAND","MPEG"],JL=e=>{if(0===e.size)return;if(1===e.size){let t=e.values().next();return(0,WL.default)(t.value.split("."),0)}for(let t of e){let e=(0,WL.default)(t.split("."),0);if("opus"===e||"vp09"===e||"av01"===e)return e}let t=e.values().next();return(0,WL.default)(t.value.split("."),0)},ZL=["timeupdate","progress","play","seeked","stalled","waiting"],eI=["timeupdate","progress","loadeddata","playing","seeked"],tI=class{constructor(e){this.element=null,this.manifestUrlString="",this.source=null,this.manifest=null,this.subscription=new cb,this.representationSubscription=new cb,this.state$=new ZP("none"),this.currentVideoRepresentation$=new n_(void 0),this.currentVideoRepresentationInit$=new n_(void 0),this.currentAudioRepresentation$=new n_(void 0),this.currentVideoSegmentLength$=new n_(0),this.currentAudioSegmentLength$=new n_(0),this.error$=new mb,this.lastConnectionType$=new n_(void 0),this.lastConnectionReused$=new n_(void 0),this.lastRequestFirstBytes$=new n_(void 0),this.currentLiveTextRepresentation$=new n_(null),this.isLive$=new n_(!1),this.isActiveLive$=new n_(!1),this.isLowLatency$=new n_(!1),this.liveDuration$=new n_(0),this.liveSeekableDuration$=new n_(0),this.liveAvailabilityStartTime$=new n_(0),this.liveStreamStatus$=new n_(void 0),this.bufferLength$=new n_(0),this.liveLatency$=new n_(void 0),this.liveLoadBufferLength$=new n_(0),this.livePositionFromPlayer$=new n_(0),this.currentStallDuration$=new n_(0),this.videoLastDataObtainedTimestamp$=new n_(0),this.fetcherRecoverableError$=new mb,this.fetcherError$=new mb,this.liveStreamEndTimestamp=0,this.isUpdatingLive=!1,this.isJumpGapAfterSeekLive=!1,this.forceEnded$=new mb,this.gapWatchdogActive=!1,this.destroyController=new xC,this.initManifest=Rb(this.destroyController.signal,async function*(e,t,i){var r;this.tracer.log("initManifest"),this.element=e,this.manifestUrlString=KP(t,i,2),this.state$.startTransitionTo("manifest_ready"),this.manifest=yield this.updateManifest(),null!=(r=this.manifest)&&r.streams.video.length?this.state$.setState("manifest_ready"):this.error$.next({id:"NoRepresentations",category:M_.PARSER,message:"No playable video representations"})}.bind(this)),this.updateManifest=Rb(this.destroyController.signal,async function*(){var e,t;this.tracer.log("updateManifestStart",{manifestUrl:this.manifestUrlString});let i=yield this.fetcher.fetchManifest(this.manifestUrlString).catch((e=>{!this.manifest&&!this.bufferLength$.getValue()&&this.error$.next({id:"LoadManifest",category:M_.NETWORK,message:"Failed to load manifest",thrown:e})}));if(!i)return null;let r=null;try{r=((e,t)=>{var i,r,n,a,s,o,l,u,d,c,h,p,f,m,g,v,S,y,T,E,b,_,A,R,w,P,O,C,L,I,x,M,N,D,k,$,V,U,B,F,H,j,G,q,z,W,Q,Y,K,X,J,Z,ee,te,ie,re,ne,ae,se,oe,le;let ue,de={video:[],audio:[],text:[]},ce=(new DOMParser).parseFromString(e,"application/xml").children[0],he=Array.from(ce.querySelectorAll("MPD > BaseURL").values()).map((e=>{var t,i;return null!=(i=null==(t=e.textContent)?void 0:t.trim())?i:""})),pe=null!=(i=(0,mL.default)(he,0))?i:"",fe="dynamic"===ce.getAttribute("type"),me=ce.getAttribute("availabilityStartTime"),ge=ce.getAttribute("publishTime"),ve=ce.getElementsByTagName("vk:Attrs")[0],Se=null==ve?void 0:ve.getElementsByTagName("vk:XLatestSegmentPublishTime")[0].textContent,ye=null==ve?void 0:ve.getElementsByTagName("vk:XStreamIsLive")[0].textContent,Te=null==ve?void 0:ve.getElementsByTagName("vk:XStreamIsUnpublished")[0].textContent,Ee=null==ve?void 0:ve.getElementsByTagName("vk:XPlaybackDuration")[0].textContent;fe&&(ue={availabilityStartTime:me?new Date(me).getTime():0,publishTime:ge?new Date(ge).getTime():0,latestSegmentPublishTime:Se?new Date(Se).getTime():0,streamIsAlive:"yes"===ye,streamIsUnpublished:"yes"===Te});let be,_e=ce.getAttribute("mediaPresentationDuration"),Ae=[...ce.getElementsByTagName("Period")],Re=Ae.reduce(((e,t)=>({...e,[t.id]:t.children})),{}),we=Ae.reduce(((e,t)=>({...e,[t.id]:t.getAttribute("duration")})),{});_e?be=LL(_e):(0,gL.default)(we).filter((e=>e)).length&&!fe?be=(0,gL.default)(we).reduce(((e,t)=>{var i;return e+(null!=(i=LL(t))?i:0)}),0):Ee&&(be=parseInt(Ee,10));let Pe=0,Oe=null!=(n=null==(r=ce.getAttribute("profiles"))?void 0:r.split(","))?n:[];for(let e of Ae.map((e=>e.id)))for(let i of Re[e]){let e=null!=(a=i.getAttribute("id"))?a:"id"+(Pe++).toString(10),r=null!=(s=i.getAttribute("mimeType"))?s:"",n=null!=(o=i.getAttribute("codecs"))?o:"",ue=null!=(l=i.getAttribute("contentType"))?l:null==r?void 0:r.split("/")[0],ce=null!=(d=null==(u=i.getAttribute("profiles"))?void 0:u.split(","))?d:[],he=null!=(h=TL(null!=(c=i.getAttribute("lang"))?c:""))?h:{},fe=null!=(m=null==(f=null==(p=i.querySelector("Label"))?void 0:p.textContent)?void 0:f.trim())?m:void 0,me=i.querySelectorAll("Representation"),ge=i.querySelector("SegmentTemplate"),ve=null!=(v=null==(g=i.querySelector("Role"))?void 0:g.getAttribute("value"))?v:void 0,Se=ue,ye={id:e,language:he.language,isDefault:"main"===ve,label:fe,codecs:n,hdr:"video"===Se&&SL(n),mime:r,representations:[]};for(let e of me){let a,s=null!=(S=e.getAttribute("lang"))?S:void 0,o=null!=(T=null!=(y=null!=fe?fe:i.getAttribute("label"))?y:e.getAttribute("label"))?T:void 0,l=null!=(_=null==(b=null==(E=e.querySelector("BaseURL"))?void 0:E.textContent)?void 0:b.trim())?_:"",u=new URL(l||pe,t).toString(),d=null!=(A=e.getAttribute("mimeType"))?A:r,c=null!=(w=null!=(R=e.getAttribute("codecs"))?R:n)?w:"";if("text"===ue){let t=e.getAttribute("id")||"",i=(null==(P=he.privateuse)?void 0:P.includes("x-auto"))||t.includes("_auto"),r=e.querySelector("SegmentTemplate");if(r){let n={representationId:null!=(O=e.getAttribute("id"))?O:void 0,bandwidth:null!=(C=e.getAttribute("bandwidth"))?C:void 0},s=parseInt(null!=(L=e.getAttribute("bandwidth"))?L:"",10)/1e3,o=null!=(x=parseInt(null!=(I=r.getAttribute("startNumber"))?I:"",10))?x:1,l=parseInt(null!=(M=r.getAttribute("timescale"))?M:"",10),d=null!=(N=r.querySelectorAll("SegmentTimeline S"))?N:[],c=r.getAttribute("media");if(!c)continue;let h=[],p=0,f="",m=0,g=o,v=0;for(let e of d){let t=parseInt(null!=(D=e.getAttribute("d"))?D:"",10),i=parseInt(null!=(k=e.getAttribute("r"))?k:"",10)||0,r=parseInt(null!=($=e.getAttribute("t"))?$:"",10);v=Number.isFinite(r)?r:v;let a=t/l*1e3,s=v/l*1e3;for(let e=0;e<i+1;e++){let i=IL(c,{...n,segmentNumber:g.toString(10),segmentTime:(v+e*t).toString(10)}),r=(null!=s?s:0)+e*a,o=r+a;g++,h.push({time:{from:r,to:o},url:i})}v+=(i+1)*t,p+=(i+1)*a}m=v/l*1e3,f=IL(c,{...n,segmentNumber:g.toString(10),segmentTime:v.toString(10)}),a={id:t,kind:"text",segmentReference:{type:"template",baseUrl:u,segmentTemplateUrl:c,initUrl:"",totalSegmentsDurationMs:p,segments:h,nextSegmentBeyondManifest:{time:{from:m,to:1/0},url:f},timescale:l},profiles:[],duration:be,bitrate:s,mime:"",codecs:"",width:0,height:0,isAuto:i}}else a={id:t,isAuto:i,kind:"text",url:u}}else{let t,r=null!=(U=null!=(V=e.getAttribute("contentType"))?V:null==d?void 0:d.split("/")[0])?U:ue,n=null!=(F=null==(B=i.getAttribute("profiles"))?void 0:B.split(","))?F:[],s=parseInt(null!=(H=e.getAttribute("width"))?H:"",10),o=parseInt(null!=(j=e.getAttribute("height"))?j:"",10),l=parseInt(null!=(G=e.getAttribute("bandwidth"))?G:"",10)/1e3,h=null!=(q=e.getAttribute("frameRate"))?q:"",p=null!=(z=e.getAttribute("quality"))?z:void 0,f=h?yL(h):void 0,m=`${null!=(W=e.getAttribute("id"))?W:"id"+(Pe++).toString(10)}@${"video"===r?`${o}p`:"audio"===r?`${l}Kbps`:c}`,g=[...Oe,...ce,...n],v=e.querySelector("SegmentBase"),S=null!=(Q=e.querySelector("SegmentTemplate"))?Q:ge;if(v){let i=null!=(K=null==(Y=e.querySelector("SegmentBase Initialization"))?void 0:Y.getAttribute("range"))?K:"",[r,n]=i.split("-").map((e=>parseInt(e,10))),a={from:r,to:n},s=null==(X=e.querySelector("SegmentBase"))?void 0:X.getAttribute("indexRange"),[o,l]=s?s.split("-").map((e=>parseInt(e,10))):[];t={type:"byteRange",url:u,initRange:a,indexRange:s?{from:o,to:l}:void 0}}else{if(!S)throw new ReferenceError("Unknown MPD segment referencing type");{let i={representationId:null!=(J=e.getAttribute("id"))?J:void 0,bandwidth:null!=(Z=e.getAttribute("bandwidth"))?Z:void 0},r=parseInt(null!=(ee=S.getAttribute("timescale"))?ee:"",10),n=null!=(te=S.getAttribute("initialization"))?te:"",a=S.getAttribute("media"),s=null!=(re=parseInt(null!=(ie=S.getAttribute("startNumber"))?ie:"",10))?re:1,o=IL(n,i);if(!a)throw new ReferenceError("No media attribute in SegmentTemplate");let l=null!=(ne=S.querySelectorAll("SegmentTimeline S"))?ne:[],d=[],c=0,h="",p=0;if(l.length){let e=s,t=0;for(let n of l){let s=parseInt(null!=(ae=n.getAttribute("d"))?ae:"",10),o=parseInt(null!=(se=n.getAttribute("r"))?se:"",10)||0,l=parseInt(null!=(oe=n.getAttribute("t"))?oe:"",10);t=Number.isFinite(l)?l:t;let u=s/r*1e3,h=t/r*1e3;for(let r=0;r<o+1;r++){let n=IL(a,{...i,segmentNumber:e.toString(10),segmentTime:(t+r*s).toString(10)}),o=(null!=h?h:0)+r*u,l=o+u;e++,d.push({time:{from:o,to:l},url:n})}t+=(o+1)*s,c+=(o+1)*u}p=t/r*1e3,h=IL(a,{...i,segmentNumber:e.toString(10),segmentTime:t.toString(10)})}else if(Tb(be)){let e=parseInt(null!=(le=S.getAttribute("duration"))?le:"",10)/r*1e3,t=Math.ceil(be/e),n=0;for(let r=1;r<t;r++){let t=IL(a,{...i,segmentNumber:r.toString(10),segmentTime:n.toString(10)});d.push({time:{from:n,to:n+e},url:t}),n+=e}p=n,h=IL(a,{...i,segmentNumber:t.toString(10),segmentTime:n.toString(10)})}t={type:"template",baseUrl:u,segmentTemplateUrl:a,initUrl:o,totalSegmentsDurationMs:c,segments:d,nextSegmentBeyondManifest:{time:{from:p,to:1/0},url:h},timescale:r}}}if(!r||!d)continue;let y={video:"video",audio:"audio",text:"text"}[r];if(!y)continue;Se||(Se=y),a={id:m,kind:y,segmentReference:t,profiles:g,duration:be,bitrate:l,mime:d,codecs:c,width:s,height:o,fps:f,quality:p}}ye.language||(ye.language=s),ye.label||(ye.label=o),ye.mime||(ye.mime=d),ye.codecs||(ye.codecs=c),ye.hdr||(ye.hdr="video"===Se&&SL(c)),ye.representations.push(a)}if(Se){let e=de[Se].find((e=>e.id===ye.id));if(e&&ye.representations.every((e=>OL(e.segmentReference))))for(let t of e.representations){let e=ye.representations.find((e=>e.id===t.id)),i=null==e?void 0:e.segmentReference,r=t.segmentReference;r.segments.push(...i.segments),r.nextSegmentBeyondManifest=i.nextSegmentBeyondManifest}else de[Se].push(ye)}}return{duration:be,streams:de,baseUrls:he,live:ue}})(null!=i?i:"",this.manifestUrlString)}catch(t){let r=null!=(e=(e=>{if(!e)return{id:"EmptyResponse",category:M_.PARSER,message:"Empty response"};if(e.length<=2&&e.match(/^\d+$/))return{id:`UVError#${e}`,category:M_.NETWORK,message:`UV Error ${e}`};let t=(0,NC.default)(e).substring(0,100).toLowerCase();return t.startsWith("<!doctype")||t.startsWith("<html>")||t.startsWith("<body>")||t.startsWith("<head>")?{id:"UnexpectedHTML",category:M_.NETWORK,message:"Received unexpected HTML, possibly a ISP block"}:t.startsWith("<?xml")?(new DOMParser).parseFromString(e,"text/xml").querySelector("parsererror")?{id:"InvalidXML",category:M_.PARSER,message:"XML parsing error"}:{id:"XMLParserLogicError",category:M_.PARSER,message:"Response is valid XML, but parser failed"}:void 0})(i))?e:{id:"ManifestParsing",category:M_.PARSER,message:"Failed to parse MPD manifest",thrown:t};this.error$.next(r)}if(!r)return null;let n=(e,t,i)=>{var r,n,a,s;return!!(null!=(n=null==(r=this.element)?void 0:r.canPlayType)&&n.call(r,t)&&null!=(s=null==(a=EO())?void 0:a.isTypeSupported)&&s.call(a,`${t}; codecs="${i}"`)||"text"===e)};if(r.live){this.isLive$.next(!!r.live);let{availabilityStartTime:e,latestSegmentPublishTime:i,streamIsUnpublished:n,streamIsAlive:a}=r.live,s=(null!=(t=r.duration)?t:0)/1e3;this.liveSeekableDuration$.next(-1*s),this.liveDuration$.next((i-e)/1e3),this.liveAvailabilityStartTime$.next(r.live.availabilityStartTime);let o="active";a||(o=n?"unpublished":"unexpectedly_down"),this.liveStreamStatus$.next(o)}let a={text:r.streams.text,video:[],audio:[]};for(let e of["video","audio"]){let t=r.streams[e].filter((({mime:t,codecs:i})=>n(e,t,i))),i=new Set(t.map((({codecs:e})=>e))),s=JL(i);if(s&&(a[e]=t.filter((({codecs:e})=>e.startsWith(s)))),"video"===e){let e=this.tuning.preferHDR,t=a.video.some((e=>e.hdr)),i=a.video.some((e=>!e.hdr));LO.display.isHDR&&e&&t?a.video=a.video.filter((e=>e.hdr)):i&&(a.video=a.video.filter((e=>!e.hdr)))}}let s={...r,streams:a};return this.tracer.log("updateManifestEnd",e_(s)),s}.bind(this)),this.initRepresentations=Rb(this.destroyController.signal,async function*(e,t,i){var r;this.tracer.log("initRepresentationsStart",e_({initialVideo:e,initialAudio:t,sourceHls:i})),yb(this.manifest),yb(this.element),this.representationSubscription.unsubscribe(),this.state$.startTransitionTo("representations_ready");let n=e=>{this.representationSubscription.add(d_(e,"error").pipe(v_((e=>{var t;return!(null==(t=this.element)||!t.played.length)}))).subscribe((e=>{this.error$.next({id:"VideoSource",category:M_.VIDEO_PIPELINE,message:"Unexpected video source error",thrown:e})})))};this.source=this.tuning.useManagedMediaSource&&window.ManagedMediaSource?new ManagedMediaSource:new MediaSource;let a=document.createElement("source");if(n(a),a.src=URL.createObjectURL(this.source),this.element.appendChild(a),this.tuning.useManagedMediaSource&&bO())if(i){let e=document.createElement("source");n(e),e.type="application/x-mpegurl",e.src=i.url,this.element.appendChild(e)}else this.element.disableRemotePlayback=!0;this.isActiveLive$.next(this.isLive$.getValue());let s={fetcher:this.fetcher,tuning:this.tuning,getCurrentPosition:()=>this.element?1e3*this.element.currentTime:void 0,isActiveLowLatency:()=>this.isActiveLive$.getValue()&&this.isLowLatency$.getValue(),manifest:this.manifest},o=this.manifest.streams.video.reduce(((e,t)=>[...e,...t.representations]),[]);if(this.videoBufferManager=new NL("video",this.source,o,s),this.bufferManagers=[this.videoBufferManager],Tb(t)){let e=this.manifest.streams.audio.reduce(((e,t)=>[...e,...t.representations]),[]);this.audioBufferManager=new NL("audio",this.source,e,s),this.bufferManagers.push(this.audioBufferManager)}zL.isSupported(this.manifest.streams.text)&&!this.isLowLatency$.getValue()&&(this.liveTextManager=new zL(this.manifest.streams.text,s)),this.representationSubscription.add(this.fetcher.lastConnectionType$.subscribe(this.lastConnectionType$)),this.representationSubscription.add(this.fetcher.lastConnectionReused$.subscribe(this.lastConnectionReused$)),this.representationSubscription.add(this.fetcher.lastRequestFirstBytes$.subscribe(this.lastRequestFirstBytes$));let l=()=>{var e;null==(e=this.stallWatchdogSubscription)||e.unsubscribe(),this.currentStallDuration$.next(0)};if(this.representationSubscription.add(o_(...eI.map((e=>d_(this.element,e)))).pipe(A_((e=>this.element?AC(this.element.buffered,1e3*this.element.currentTime):0)),E_(),L_((e=>{e>this.tuning.dash.bufferEmptinessTolerance&&l()}))).subscribe(this.bufferLength$)),this.representationSubscription.add(o_(d_(this.element,"ended"),this.forceEnded$).subscribe((()=>{l()}))),this.isLive$.getValue()){this.subscription.add(this.liveDuration$.pipe(E_()).subscribe((e=>this.liveStreamEndTimestamp=Ab()))),this.subscription.add(d_(this.element,"pause").subscribe((()=>{this.livePauseWatchdogSubscription=l_(1e3).subscribe((e=>{let t=XP(this.manifestUrlString,2);this.manifestUrlString=KP(this.manifestUrlString,t+1e3,2),"active"===this.liveStreamStatus$.getValue()&&this.updateManifest()})),this.subscription.add(this.livePauseWatchdogSubscription)}))).add(d_(this.element,"play").subscribe((e=>{var t;return null==(t=this.livePauseWatchdogSubscription)?void 0:t.unsubscribe()}))),this.representationSubscription.add(s_({isActiveLive:this.isActiveLive$,isLowLatency:this.isLowLatency$}).pipe(A_((({isActiveLive:e,isLowLatency:t})=>e&&t)),E_()).subscribe((e=>{this.isManualDecreasePlaybackInLive()||qL(this.element,1)}))),this.representationSubscription.add(s_({bufferLength:this.bufferLength$,isActiveLive:this.isActiveLive$,isLowLatency:this.isLowLatency$}).pipe(v_((({bufferLength:e,isActiveLive:t,isLowLatency:i})=>t&&i&&!!e))).subscribe((({bufferLength:e})=>this.liveBuffer.next(e)))),this.representationSubscription.add(this.videoBufferManager.currentLowLatencySegmentLength$.subscribe((e=>{if(!this.isActiveLive$.getValue()&&!this.isLowLatency$.getValue()&&!e)return;let t=this.liveSeekableDuration$.getValue()-e/1e3;this.liveSeekableDuration$.next(Math.max(t,-1*this.tuning.dashCmafLive.maxLiveDuration)),this.liveDuration$.next(this.liveDuration$.getValue()+e/1e3)}))),this.representationSubscription.add(s_({isLive:this.isLive$,rtt:this.throughputEstimator.rtt$,bufferLength:this.bufferLength$,segmentServerLatency:this.videoBufferManager.currentLiveSegmentServerLatency$}).pipe(v_((({isLive:e})=>e)),E_(((e,t)=>t.bufferLength<e.bufferLength)),A_((({rtt:e,bufferLength:t,segmentServerLatency:i})=>(e/2+t+i+XP(this.manifestUrlString,2))/1e3))).subscribe(this.liveLatency$)),this.representationSubscription.add(s_({liveBuffer:this.liveBuffer.smoothed$,isActiveLive:this.isActiveLive$,isLowLatency:this.isLowLatency$}).subscribe((({liveBuffer:e,isActiveLive:t,isLowLatency:i})=>{if(!i||!t)return;let r=this.tuning.dashCmafLive.lowLatency.maxTargetOffset,n=this.tuning.dashCmafLive.lowLatency.maxTargetOffsetDeviation,a=this.tuning.dashCmafLive.lowLatency.playbackCatchupSpeedup,s=e-r;if(this.isManualDecreasePlaybackInLive())return;let o=1;Math.abs(s)>n&&(o=1+Math.sign(s)*a),qL(this.element,o)}))),this.representationSubscription.add(this.bufferLength$.subscribe((e=>{var t,i;let r=0;if(e){let e=1e3*(null!=(i=null==(t=this.element)?void 0:t.currentTime)?i:0);r=Math.min(...this.bufferManagers.map((t=>{var i,r;return null!=(r=null==(i=t.getLiveSegmentsToLoadState(this.manifest))?void 0:i.to)?r:e})))-e}this.liveLoadBufferLength$.getValue()!==r&&this.liveLoadBufferLength$.next(r)})));let e=0;this.representationSubscription.add(s_({liveLoadBufferLength:this.liveLoadBufferLength$,bufferLength:this.bufferLength$}).pipe(m_(1e3)).subscribe((async({liveLoadBufferLength:t,bufferLength:i})=>{if(!this.element||this.isUpdatingLive)return;let r=this.element.playbackRate,n=XP(this.manifestUrlString,2),a=1e3*Math.abs(this.livePositionFromPlayer$.getValue()),s=Math.min(a,this.tuning.dashCmafLive.normalizedTargetMinBufferSize*r),o=this.tuning.dashCmafLive.normalizedActualBufferOffset*r,l=this.tuning.dashCmafLive.normalizedLiveMinBufferSize*r,u=isFinite(t)?t:i,d=this.isActiveLive$.getValue()&&this.isLowLatency$.getValue(),c=a<=this.tuning.live.activeLiveDelay;this.isActiveLive$.next(c);let h="none";if(d?h="active_low_latency":this.isLowLatency$.getValue()&&c?(this.bufferManagers.forEach((e=>e.proceedLowLatencyLive())),h="active_low_latency"):0!==n&&u<s?h="live_forward_buffering":u<s+l&&(h="live_with_target_offset"),isFinite(t)&&(e=t>e?t:e),"live_forward_buffering"===h||"live_with_target_offset"===h){let i=e-(s+o),a=this.normolizeLiveOffset(Math.trunc(n+i/r)),l=Math.abs(a-n),u=0;!t||l<=this.tuning.dashCmafLive.offsetCalculationError?u=n:a>0&&l>this.tuning.dashCmafLive.offsetCalculationError&&(u=a),this.manifestUrlString=KP(this.manifestUrlString,u,2)}("live_with_target_offset"===h||"live_forward_buffering"===h)&&(e=0,await this.updateLive())}),(e=>{this.error$.next({id:"updateLive",category:M_.VIDEO_PIPELINE,thrown:e,message:"Failed to update live with subscription"})})))}let u=s_({allBuffersFull:o_(...this.bufferManagers.map((e=>e.fullyBuffered$))).pipe(A_((()=>this.bufferManagers.every((e=>e.fullyBuffered$.getValue()))))),someBufferEnded:o_(...this.bufferManagers.map((e=>e.onLastSegment$))).pipe(A_((()=>this.bufferManagers.some((e=>e.onLastSegment$.getValue())))))}).pipe(E_(),A_((({allBuffersFull:e,someBufferEnded:t})=>e&&t)),v_((e=>e)));if(this.representationSubscription.add(o_(this.forceEnded$,u).subscribe((()=>{var e;if(this.source&&"open"===this.source.readyState&&Array.from(this.source.sourceBuffers).every((e=>!e.updating)))try{null==(e=this.source)||e.endOfStream()}catch(e){this.error$.next({id:"EndOfStream",category:M_.VIDEO_PIPELINE,message:"Failed to end MediaSource stream",thrown:e})}}))),this.representationSubscription.add(o_(...this.bufferManagers.map((e=>e.error$))).subscribe(this.error$)),this.representationSubscription.add(this.videoBufferManager.playingRepresentation$.subscribe(this.currentVideoRepresentation$)),this.representationSubscription.add(this.videoBufferManager.playingRepresentationInit$.subscribe(this.currentVideoRepresentationInit$)),this.representationSubscription.add(this.videoBufferManager.currentSegmentLength$.subscribe(this.currentVideoSegmentLength$)),this.audioBufferManager&&(this.representationSubscription.add(this.audioBufferManager.playingRepresentation$.subscribe(this.currentAudioRepresentation$)),this.representationSubscription.add(this.audioBufferManager.currentSegmentLength$.subscribe(this.currentAudioSegmentLength$))),this.liveTextManager&&this.representationSubscription.add(this.liveTextManager.currentRepresentation$.subscribe(this.currentLiveTextRepresentation$)),"open"!==this.source.readyState){let e=this.tuning.dash.sourceOpenTimeout>=0;yield new Promise(((t,i)=>{var r;e&&(this.timeoutSourceOpenId=setTimeout((()=>{var e;"open"!==(null==(e=this.source)?void 0:e.readyState)&&this.tuning.dash.rejectOnSourceOpenTimeout?i(new Error("Timeout reject when wait sourceopen event")):t()}),this.tuning.dash.sourceOpenTimeout)),null==(r=this.source)||r.addEventListener("sourceopen",(()=>{this.timeoutSourceOpenId&&clearTimeout(this.timeoutSourceOpenId),t()}),{once:!0})}))}if(!this.isLive$.getValue()){let e=[null!=(r=this.manifest.duration)?r:0,...(0,MC.default)((0,MC.default)([...this.manifest.streams.audio,...this.manifest.streams.video],(e=>e.representations)),(e=>{let t=[];return e.duration&&t.push(e.duration),OL(e.segmentReference)&&e.segmentReference.totalSegmentsDurationMs&&t.push(e.segmentReference.totalSegmentsDurationMs),t}))];this.source.duration=Math.max(...e)/1e3}this.audioBufferManager&&Tb(t)?yield Promise.all([this.videoBufferManager.startWith(e),this.audioBufferManager.startWith(t)]):yield this.videoBufferManager.startWith(e),this.state$.setState("representations_ready"),this.tracer.log("initRepresentationsEnd")}.bind(this)),this.tick=()=>{var e,t,i,r;if(!this.element||!this.videoBufferManager||"open"!==(null==(e=this.source)?void 0:e.readyState))return;let n=1e3*this.element.currentTime;this.videoBufferManager.maintain(n),null==(t=this.audioBufferManager)||t.maintain(n),null==(i=this.liveTextManager)||i.maintain(n),(this.videoBufferManager.gaps.length||null!=(r=this.audioBufferManager)&&r.gaps.length)&&!this.gapWatchdogActive&&(this.gapWatchdogActive=!0,this.gapWatchdogSubscription=l_(this.tuning.gapWatchdogInterval).subscribe((()=>this.jumpGap()),(e=>{this.error$.next({id:"GapWatchdog",category:M_.WTF,message:"Error handling gaps",thrown:e})})),this.subscription.add(this.gapWatchdogSubscription))},this.throughputEstimator=e.throughputEstimator,this.tuning=e.tuning,this.tracer=e.tracer.createComponentTracer(this.constructor.name),this.fetcher=new kL({throughputEstimator:this.throughputEstimator,requestQuic:this.tuning.requestQuick,compatibilityMode:e.compatibilityMode,tracer:this.tracer,useEnableSubtitlesParam:e.tuning.useEnableSubtitlesParam}),this.subscription.add(this.fetcher.recoverableError$.subscribe(this.fetcherRecoverableError$)),this.subscription.add(this.fetcher.error$.subscribe(this.fetcherError$)),this.liveBuffer=GL.getLiveBufferSmoothedValue(this.tuning.dashCmafLive.lowLatency.maxTargetOffset,{...e.tuning.dashCmafLive.lowLatency.bufferEstimator}),this.initTracerSubscription()}async seekLive(e){var t,i,r;yb(this.element);let n="active"!==this.liveStreamStatus$.getValue()?Ab()-this.liveStreamEndTimestamp:0,a=this.normolizeLiveOffset(e+n);this.isActiveLive$.next(0===a),this.manifestUrlString=KP(this.manifestUrlString,a,2),this.manifest=await this.updateManifest(),this.manifest&&(this.isJumpGapAfterSeekLive=!0,await(null==(t=this.videoBufferManager)?void 0:t.seekLive(this.manifest.streams.video)),await(null==(i=this.audioBufferManager)?void 0:i.seekLive(this.manifest.streams.audio)),null==(r=this.liveTextManager)||r.seekLive(this.manifest.streams.text))}initBuffer(){yb(this.element),this.state$.setState("running"),this.subscription.add(o_(...ZL.map((e=>d_(this.element,e))),d_(window,"online")).subscribe((()=>this.tick()),(e=>{this.error$.next({id:"DashVKPlayer",category:M_.WTF,message:"Internal logic error",thrown:e})}))),this.subscription.add(d_(this.element,"progress").subscribe((()=>{this.element&&2===this.element.readyState&&!this.element.seeking&&(this.element.currentTime=this.element.currentTime)}))),this.subscription.add(d_(this.element,"waiting").subscribe((()=>{var e;this.element&&2===this.element.readyState&&!this.element.seeking&&DC(this.element.buffered,1e3*this.element.currentTime)&&(this.element.currentTime=this.element.currentTime);null==(e=this.stallWatchdogSubscription)||e.unsubscribe(),this.stallWatchdogSubscription=l_(50).subscribe((()=>{var e,t,i,r,n,a,s,o,l,u,d;if(!this.element||"open"!==(null==(e=this.source)?void 0:e.readyState))return;let c=this.currentStallDuration$.getValue();c+=50,this.currentStallDuration$.next(c);let h={timeInWaiting:c},p=Ab(),f=null!=(i=null==(t=this.videoBufferManager)?void 0:t.lastDataObtainedTimestamp)?i:0;this.videoLastDataObtainedTimestamp$.next(f);let m=null!=(n=null==(r=this.audioBufferManager)?void 0:r.lastDataObtainedTimestamp)?n:0,g=null!=(s=null==(a=this.videoBufferManager)?void 0:a.getForwardBufferDuration())?s:0,v=null!=(l=null==(o=this.audioBufferManager)?void 0:o.getForwardBufferDuration())?l:0,S=g<100&&p-f>this.tuning.dash.crashOnStallTWithoutDataTimeout,y=this.audioBufferManager&&v<100&&p-m>this.tuning.dash.crashOnStallTWithoutDataTimeout;if((S||y)&&c>this.tuning.dash.crashOnStallTWithoutDataTimeout||c>=this.tuning.dash.crashOnStallTimeout)throw new Error(`Stall timeout exceeded: ${c} ms`);if(this.isLive$.getValue()&&c%2e3==0){let e=this.normolizeLiveOffset(-1*this.livePositionFromPlayer$.getValue()*1e3);this.seekLive(e).catch((e=>{this.error$.next({id:"stallIntervalCallback",category:M_.VIDEO_PIPELINE,message:"stallIntervalCallback failed",thrown:e})})),h.liveLastOffset=e}else{let e=1e3*this.element.currentTime;null==(u=this.videoBufferManager)||u.maintain(e),null==(d=this.audioBufferManager)||d.maintain(e),h.position=e}this.tracer.log("stallIntervalCallback",e_(h))}),(e=>{this.error$.next({id:"StallWatchdogCallback",category:M_.NETWORK,message:"Can't restore DASH after stall.",thrown:e})})),this.subscription.add(this.stallWatchdogSubscription)}))),this.tick()}async switchRepresentation(e,t,i=!1){let r={video:this.videoBufferManager,audio:this.audioBufferManager,text:null}[e];return this.tuning.useNewSwitchTo?this.currentStallDuration$.getValue()>0?null==r?void 0:r.switchToWithPreviousAbort(t,i):null==r?void 0:r.switchTo(t,i):null==r?void 0:r.switchToOld(t,i)}async seek(e,t){var i,r,n,a,s;let o;yb(this.element),yb(this.videoBufferManager),o=t||1e3*this.element.duration<=this.tuning.dashSeekInSegmentDurationThreshold||Math.abs(1e3*this.element.currentTime-e)<=this.tuning.dashSeekInSegmentAlwaysSeekDelta?e:Math.max(null!=(i=this.videoBufferManager.findSegmentStartTime(e))?i:e,null!=(n=null==(r=this.audioBufferManager)?void 0:r.findSegmentStartTime(e))?n:e),this.warmUpMediaSourceIfNeeded(o),DC(this.element.buffered,o)||await Promise.all([this.videoBufferManager.abort(),null==(a=this.audioBufferManager)?void 0:a.abort()]),!Eb(this.element)&&!Eb(this.videoBufferManager)&&(this.videoBufferManager.maintain(o),null==(s=this.audioBufferManager)||s.maintain(o),this.element.currentTime=o/1e3,this.tracer.log("seek",e_({requestedPosition:e,forcePrecise:t,position:o})))}warmUpMediaSourceIfNeeded(e=(e=>null==(e=this.element)?void 0:e.currentTime)()){var t;Tb(this.element)&&Tb(this.source)&&Tb(e)&&"ended"===(null==(t=this.source)?void 0:t.readyState)&&1e3*this.element.duration-e>this.tuning.dash.seekBiasInTheEnd&&this.bufferManagers.forEach((e=>e.warmUpMediaSource()))}get isStreamEnded(){var e;return"ended"===(null==(e=this.source)?void 0:e.readyState)}stop(){var e,t,i;this.tracer.log("stop"),null==(e=this.element)||e.querySelectorAll("source").forEach((e=>{URL.revokeObjectURL(e.src),e.remove()})),this.element=null,this.source=null,this.manifest=null,this.currentVideoRepresentation$.next(void 0),null==(t=this.videoBufferManager)||t.destroy(),this.videoBufferManager=null,null==(i=this.audioBufferManager)||i.destroy(),this.audioBufferManager=null,this.bufferManagers=[],this.state$.setState("none")}setBufferTarget(e){for(let t of this.bufferManagers)t.setTarget(e)}getStreams(){var e;return null==(e=this.manifest)?void 0:e.streams}setPreloadOnly(e){for(let t of this.bufferManagers)t.setPreloadOnly(e)}destroy(){var e;this.subscription.unsubscribe(),this.representationSubscription.unsubscribe(),this.timeoutSourceOpenId&&clearTimeout(this.timeoutSourceOpenId),this.destroyController.abort(),this.fetcher.destroy(),this.stop(),"open"===(null==(e=this.source)?void 0:e.readyState)&&Array.from(this.source.sourceBuffers).every((e=>!e.updating))&&this.source.endOfStream(),this.source=null,this.tracer.end()}initTracerSubscription(){let e=r_(this.tracer.error.bind(this.tracer));this.subscription.add(this.error$.subscribe(e("error")))}isManualDecreasePlaybackInLive(){return!(!this.element||!this.isLive$.getValue())&&1-this.element.playbackRate>this.tuning.dashCmafLive.lowLatency.playbackCatchupSpeedup}normolizeLiveOffset(e){return 1e3*Math.trunc(e/1e3)}async updateLive(){var e,t;this.isUpdatingLive=!0,this.manifest=await this.updateManifest(),this.manifest&&(null==(e=this.bufferManagers)||e.forEach((e=>e.updateLive(this.manifest))),null==(t=this.liveTextManager)||t.updateLive(this.manifest)),this.isUpdatingLive=!1}jumpGap(){if(!this.element||!this.videoBufferManager)return;let e=this.videoBufferManager.getDebugBufferState();if(!e)return;let t=this.isActiveLive$.getValue()&&this.isLowLatency$.getValue(),i={isJumpGapAfterSeekLive:this.isJumpGapAfterSeekLive,isActiveLowLatency:t,initialCurrentTime:this.element.currentTime};this.isJumpGapAfterSeekLive&&!t&&this.element.currentTime>e.to&&(this.isJumpGapAfterSeekLive=!1,this.element.currentTime=0);let r=1e3*this.element.currentTime,n=[],a=1===this.element.readyState?this.tuning.endGapTolerance:0;for(let e of this.bufferManagers)for(let t of e.gaps)e.playingRepresentation$.getValue()===t.representation&&t.from-a<=r&&t.to+a>r&&(1e3*this.element.duration-t.to<this.tuning.endGapTolerance?n.push(1/0):n.push(t.to));if(n.length){let e=Math.max(...n)+10;this.gapWatchdogSubscription.unsubscribe(),this.gapWatchdogActive=!1,e===1/0?this.forceEnded$.next():(this.element.currentTime=e/1e3,i={...i,gapEnds:n,jumpTo:e,resultCurrentTime:this.element.currentTime},this.tracer.log("jumpGap",e_(i)))}}},iI=class{constructor(e,t){this.fov=e,this.orientation=t}},rI=class{constructor(e,t){this.rotating=!1,this.fading=!1,this.lastTickTS=0,this.lastCameraTurnTS=0,this.fadeStartSpeed=null,this.fadeTime=0,this.camera=e,this.options=t,this.rotationSpeed={x:0,y:0,z:0},this.fadeCorrection=1/(this.options.speedFadeTime/1e3)**2}turnCamera(e=0,t=0,i=0){this.pointCameraTo(this.camera.orientation.x+e,this.camera.orientation.y+t,this.camera.orientation.z+i)}pointCameraTo(e=0,t=0,i=0){t=this.limitCameraRotationY(t);let r=e-this.camera.orientation.x,n=t-this.camera.orientation.y,a=i-this.camera.orientation.z;this.camera.orientation.x=e,this.camera.orientation.y=t,this.camera.orientation.z=i,this.lastCameraTurn={x:r,y:n,z:a},this.lastCameraTurnTS=Date.now()}setRotationSpeed(e,t,i){this.rotationSpeed.x=null!=e?e:this.rotationSpeed.x,this.rotationSpeed.y=null!=t?t:this.rotationSpeed.y,this.rotationSpeed.z=null!=i?i:this.rotationSpeed.z}startRotation(){this.rotating=!0}stopRotation(e=!1){e?(this.setRotationSpeed(0,0,0),this.fadeStartSpeed=null):this.startFading(this.rotationSpeed.x,this.rotationSpeed.y,this.rotationSpeed.z),this.rotating=!1}onCameraRelease(){if(this.lastCameraTurn&&this.lastCameraTurnTS){let e=Date.now()-this.lastCameraTurnTS;if(e<this.options.speedFadeThreshold){let t=(1-e/this.options.speedFadeThreshold)*this.options.rotationSpeedCorrection;this.startFading(this.lastCameraTurn.x*t,this.lastCameraTurn.y*t,this.lastCameraTurn.z*t)}}}startFading(e,t,i){this.setRotationSpeed(e,t,i),this.fadeStartSpeed={...this.rotationSpeed},this.fading=!0}stopFading(){this.fadeStartSpeed=null,this.fading=!0,this.fadeTime=0}limitCameraRotationY(e){return Math.max(-this.options.maxYawAngle,Math.min(e,this.options.maxYawAngle))}tick(e){if(!this.lastTickTS)return this.lastTickTS=e,void(this.lastCameraTurnTS=Date.now());let t=e-this.lastTickTS,i=t/1e3;if(this.rotating)this.turnCamera(this.rotationSpeed.x*this.options.rotationSpeedCorrection*i,this.rotationSpeed.y*this.options.rotationSpeedCorrection*i,this.rotationSpeed.z*this.options.rotationSpeedCorrection*i);else if(this.fading&&this.fadeStartSpeed){let e=-this.fadeCorrection*(this.fadeTime/1e3)**2+1;this.setRotationSpeed(this.fadeStartSpeed.x*e,this.fadeStartSpeed.y*e,this.fadeStartSpeed.z*e),e>0?this.turnCamera(this.rotationSpeed.x*this.options.rotationSpeedCorrection*i,this.rotationSpeed.y*this.options.rotationSpeedCorrection*i,this.rotationSpeed.z*this.options.rotationSpeedCorrection*i):(this.stopRotation(!0),this.stopFading()),this.fadeTime=Math.min(this.fadeTime+t,this.options.speedFadeTime)}this.lastTickTS=e}},nI=class{constructor(e,t,i){this.videoInitialized=!1,this.active=!1,this.container=e,this.sourceVideoElement=t,this.params=i,this.canvas=this.createCanvas();let r=this.canvas.getContext("webgl");if(!r)throw new Error("Could not initialize WebGL context");this.gl=r,this.container.appendChild(this.canvas),this.camera=new iI(this.params.fov,this.params.orientation),this.cameraRotationManager=new rI(this.camera,{rotationSpeed:this.params.rotationSpeed,maxYawAngle:this.params.maxYawAngle,rotationSpeedCorrection:this.params.rotationSpeedCorrection,degreeToPixelCorrection:this.params.degreeToPixelCorrection,speedFadeTime:this.params.speedFadeTime,speedFadeThreshold:this.params.speedFadeThreshold}),this.updateFrameSize(),this.vertexBuffer=this.createVertexBuffer(),this.textureMappingBuffer=this.createTextureMappingBuffer(),this.updateTextureMappingBuffer(),this.program=this.createProgram(),this.videoTexture=this.createTexture(),this.gl.useProgram(this.program),this.videoElementDataLoadedFn=this.onDataLoadedHandler.bind(this),this.renderFn=this.render.bind(this)}play(){this.active||(this.videoInitialized?this.doPlay():this.sourceVideoElement.readyState>=2?(this.videoInitialized=!0,this.doPlay()):this.sourceVideoElement.addEventListener("loadeddata",this.videoElementDataLoadedFn))}stop(){this.active=!1}startCameraManualRotation(e,t){this.cameraRotationManager.setRotationSpeed(e*this.params.rotationSpeed,t*this.params.rotationSpeed,0),this.cameraRotationManager.startRotation()}stopCameraManualRotation(e=!1){this.cameraRotationManager.stopRotation(e)}turnCamera(e,t){this.cameraRotationManager.turnCamera(e,t)}pointCameraTo(e,t){this.cameraRotationManager.pointCameraTo(e,t)}pixelToDegree(e){return{x:this.params.degreeToPixelCorrection*this.params.fov.x*-e.x/this.viewportWidth,y:this.params.degreeToPixelCorrection*this.params.fov.y*e.y/this.viewportHeight}}getCameraRotation(){return this.camera.orientation}holdCamera(){this.cameraRotationManager.stopRotation(!0)}releaseCamera(){this.cameraRotationManager.onCameraRelease()}destroy(){this.sourceVideoElement.removeEventListener("loadeddata",this.videoElementDataLoadedFn),this.stop(),this.canvas.remove()}setViewportSize(e,t){this.viewportWidth=e,this.viewportHeight=t,this.canvas.width=this.viewportWidth,this.canvas.height=this.viewportHeight,this.gl.viewport(0,0,this.canvas.width,this.canvas.height)}onDataLoadedHandler(){this.videoInitialized=!0,this.doPlay()}doPlay(){this.updateFrameSize(),this.vertexBuffer=this.createVertexBuffer(),this.active=!0,this.sourceVideoElement.removeEventListener("loadeddata",this.videoElementDataLoadedFn),requestAnimationFrame(this.renderFn)}render(e){this.cameraRotationManager.tick(e),this.updateTexture(),this.updateTextureMappingBuffer();let t=this.gl.getAttribLocation(this.program,"a_vertex"),i=this.gl.getAttribLocation(this.program,"a_texel"),r=this.gl.getUniformLocation(this.program,"u_texture"),n=this.gl.getUniformLocation(this.program,"u_focus");this.gl.enableVertexAttribArray(t),this.gl.enableVertexAttribArray(i),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.vertexAttribPointer(t,2,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.textureMappingBuffer),this.gl.vertexAttribPointer(i,2,this.gl.FLOAT,!1,0,0),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.videoTexture),this.gl.uniform1i(r,0),this.gl.uniform2f(n,-this.camera.orientation.x,-this.camera.orientation.y),this.gl.drawArrays(this.gl.TRIANGLE_FAN,0,4),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.disableVertexAttribArray(t),this.gl.disableVertexAttribArray(i),this.active&&requestAnimationFrame(this.renderFn)}createShader(e,t){let i=this.gl.createShader(t);if(!i)throw this.destroy(),new Error(`Could not create shader (${t})`);if(this.gl.shaderSource(i,e),this.gl.compileShader(i),!this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS))throw this.destroy(),new Error("An error occurred while compiling the shader: "+this.gl.getShaderInfoLog(i));return i}createProgram(){let e=this.gl.createProgram();if(!e)throw this.destroy(),new Error("Could not create shader program");let t=this.createShader("attribute vec2 a_vertex;\nattribute vec2 a_texel;\n\nvarying vec2 v_texel;\n\nvoid main(void) {\n    // direct vertex drawing\n    gl_Position = vec4(a_vertex, 0.0, 1.0);\n    // save texel vector to pass to fragment shader\n    v_texel = a_texel;\n}\n",this.gl.VERTEX_SHADER),i=this.createShader("#ifdef GL_ES\n    precision highp float;\n    precision highp int;\n#else\n    precision highp float;\n#endif\n\n#define PI 3.14159265358979323846264\n\nvarying vec2 v_texel; // [0..1, 0..1]\n\nuniform sampler2D u_texture;\nuniform vec2 u_focus; // current central point [-180..180, -90..90] (degrees)\n\nvoid main(void) {\n    // center point of output projection\n    float lambda0 = u_focus.x / 360.0;\n    float phi0 = u_focus.y / 180.0;\n\n    float lambda = PI * 2.0 * (v_texel.x - 0.5 - lambda0); // [-pi..+pi] (rad)\n    float phi = PI * (v_texel.y - 0.5 - phi0); // [-pi/2..+pi/2] (rad)\n\n    float p = sqrt(lambda * lambda + phi * phi); // rou\n    float c = atan(p);\n    float cos_c = cos(c);\n    float sin_c = sin(c);\n\n    // geo coordinates of projection\n    float x = lambda0 + atan(\n        lambda * sin_c,\n        p * cos(phi0) * cos_c - phi * sin(phi0) * sin_c\n    );\n    float y = asin(cos_c * sin(phi0) + (phi * sin_c * cos(phi0)) / p);\n\n    // reprojected texture coordinates\n    vec2 tc = vec2(\n        mod(x / (PI * 2.0) - 0.5, 1.0), // [0..1]\n        mod(y / PI - 0.5, 1.0) // [0..1]\n    );\n\n    // sample using new coordinates\n    gl_FragColor = texture2D(u_texture, tc);\n}\n",this.gl.FRAGMENT_SHADER);if(this.gl.attachShader(e,t),this.gl.attachShader(e,i),this.gl.linkProgram(e),!this.gl.getProgramParameter(e,this.gl.LINK_STATUS))throw this.destroy(),new Error("Could not link shader program.");return e}createTexture(){let e=this.gl.createTexture();if(!e)throw this.destroy(),new Error("Could not create texture");return this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.bindTexture(this.gl.TEXTURE_2D,null),e}updateTexture(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.videoTexture),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.sourceVideoElement),this.gl.bindTexture(this.gl.TEXTURE_2D,null)}createVertexBuffer(){let e=this.gl.createBuffer();if(!e)throw this.destroy(),new Error("Could not create vertex buffer");let t=1,i=1,r=this.frameHeight/(this.frameWidth/this.viewportWidth);return r>this.viewportHeight?t=this.viewportHeight/r:i=r/this.viewportHeight,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([-t,-i,t,-i,t,i,-t,i]),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),e}createTextureMappingBuffer(){let e=this.gl.createBuffer();if(!e)throw this.destroy(),new Error("Could not create texture mapping buffer");return e}calculateTexturePosition(){let e=.5-this.camera.orientation.x/360,t=.5-this.camera.orientation.y/180,i=this.camera.fov.x/360/2,r=this.camera.fov.y/180/2;return[e-i,t-r,e+i,t-r,e+i,t+r,e-i,t+r]}updateTextureMappingBuffer(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.textureMappingBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([...this.calculateTexturePosition()]),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)}updateFrameSize(){this.frameWidth=this.sourceVideoElement.videoWidth,this.frameHeight=this.sourceVideoElement.videoHeight}createCanvas(){let e=document.createElement("canvas");return e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.width="100%",e.style.height="100%",e}},aI=class{constructor(){this.isSeeked$=new n_(!1),this.isBuffering$=new n_(!1),this.currentStallsCount=0,this.maxQualityLimit=void 0,this.lastUniqueVideoTrackSelectedTimestamp=0,this.predictedThroughputWithoutData=0,this.subscription=new cb,this.severeStallOccurred$=new n_(!1)}connect(e){this.currentStallDuration$=e.currentStallDuration$,this.videoLastDataObtainedTimestamp$=e.videoLastDataObtainedTimestamp$,this.throughput$=e.throughput$,this.rtt$=e.rtt$,this.qualityLimitsOnStall=e.qualityLimitsOnStall,this.subscription.add(e.isSeeked$.subscribe(this.isSeeked$)),this.subscription.add(e.isBuffering$.subscribe(this.isBuffering$)),this.subscription.add(e.looped$.subscribe((e=>this.currentStallsCount=0))),this.subscription.add(s_({isBuffering:this.isBuffering$,isSeeked:this.isSeeked$}).pipe(h_(this.qualityLimitsOnStall.stallDurationToBeCount),v_((({isBuffering:e,isSeeked:t})=>e&&!t))).subscribe((e=>{this.currentStallsCount++}))),this.subscription.add(s_({currentStallDuration:this.currentStallDuration$}).subscribe((({currentStallDuration:e})=>{let{stallDurationNoDataBeforeQualityDecrease:t,stallCountBeforeQualityDecrease:i,resetQualityRestrictionTimeout:r,ignoreStallsOnSeek:n}=this.qualityLimitsOnStall;if(Eb(this.lastUniqueVideoTrackSelected)||n&&this.isSeeked$.getValue())return;let a=this.rtt$.getValue(),s=this.throughput$.getValue(),o=this.videoLastDataObtainedTimestamp$.getValue(),l=Ab(),u=i&&this.currentStallsCount>=i,d=t&&l-this.lastUniqueVideoTrackSelectedTimestamp>=t+a&&l-o>=t+a&&e>=t;(u||d)&&(this.severeStallOccurred$.next(!0),window.clearTimeout(this.qualityRestrictionTimer),this.maxQualityLimit=this.lastUniqueVideoTrackSelected.quality,Tb(this.lastUniqueVideoTrackSelected.bitrate)&&s>this.lastUniqueVideoTrackSelected.bitrate&&(this.predictedThroughputWithoutData=this.lastUniqueVideoTrackSelected.bitrate)),e||(this.severeStallOccurred$.next(!1),window.clearTimeout(this.qualityRestrictionTimer),this.qualityRestrictionTimer=window.setTimeout((()=>{this.maxQualityLimit=void 0,this.predictedThroughputWithoutData=0}),r))})))}get videoMaxQualityLimit(){return this.maxQualityLimit}get predictedThroughput(){return this.predictedThroughputWithoutData}set lastVideoTrackSelected(e){var t;(null==(t=this.lastUniqueVideoTrackSelected)?void 0:t.id)!==e.id&&(this.lastUniqueVideoTrackSelected=e,this.lastUniqueVideoTrackSelectedTimestamp=Ab(),this.currentStallsCount=0)}destroy(){window.clearTimeout(this.qualityRestrictionTimer),this.subscription.unsubscribe()}},sI=class{constructor(){this.subscription=new cb,this.pipSize$=new n_(void 0),this.videoSize$=new n_(void 0),this.elementSize$=new n_(void 0),this.pictureInPictureWindowRemoveEventListener=pb}connect({observableVideo:e,video:t}){let i=e=>{let t=e.target;this.pipSize$.next({width:t.width,height:t.height})};this.subscription.add(Zb(t).subscribe(this.videoSize$)).add(e.enterPip$.subscribe((({pictureInPictureWindow:e})=>{this.pipSize$.next({width:e.width,height:e.height}),e.addEventListener("resize",i),this.pictureInPictureWindowRemoveEventListener=()=>{e.removeEventListener("resize",i)}}))).add(e.leavePip$.subscribe((()=>{this.pictureInPictureWindowRemoveEventListener()}))).add(s_({videoSize:this.videoSize$,pipSize:this.pipSize$,inPip:e.inPiP$}).pipe(A_((({videoSize:e,inPip:t,pipSize:i})=>t?i:e))).subscribe(this.elementSize$))}getValue(){return this.elementSize$.getValue()}subscribe(e,t){return this.elementSize$.subscribe(e,t)}getObservable(){return this.elementSize$}destroy(){this.pictureInPictureWindowRemoveEventListener(),this.subscription.unsubscribe()}},oI=class{constructor(e){this.subscription=new cb,this.videoState=new ZP("stopped"),this.droppedFramesManager=new vC,this.stallsManager=new aI,this.elementSizeManager=new sI,this.videoTracksMap=new Map,this.audioTracksMap=new Map,this.textTracksMap=new Map,this.videoStreamsMap=new Map,this.audioStreamsMap=new Map,this.videoTrackSwitchHistory=new QO,this.audioTrackSwitchHistory=new QO,this.syncPlayback=()=>{let e=this.videoState.getState(),t=this.params.desiredState.playbackState.getState(),i=this.params.desiredState.playbackState.getTransition(),r=this.params.desiredState.seekState.getState();if(!this.videoState.getTransition()){if("requested"===r.state&&"paused"!==(null==i?void 0:i.to)&&"stopped"!==e&&"stopped"!==t&&this.seek(r.position,r.forcePrecise),"stopped"===t)return void("stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.player.stop(),this.video.load(),this.params.output.position$.next(0),this.params.output.duration$.next(1/0),this.params.output.currentBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.videoState.setState("stopped"),JP(this.params.desiredState.playbackState,"stopped",!0)));switch(e){case"stopped":return this.videoState.startTransitionTo("ready"),void this.prepare();case"ready":return void("paused"===t?(this.videoState.setState("paused"),JP(this.params.desiredState.playbackState,"paused")):"playing"===t?(this.videoState.startTransitionTo("playing"),this.playIfAllowed()):"ready"===(null==i?void 0:i.to)&&JP(this.params.desiredState.playbackState,"ready"));case"playing":return void("paused"===t?(this.videoState.startTransitionTo("paused"),this.video.paused?this.videoState.setState("paused"):this.video.pause()):"playing"===t&&this.video.paused?this.playIfAllowed():"playing"===(null==i?void 0:i.to)&&JP(this.params.desiredState.playbackState,"playing"));case"paused":return void("playing"===t?(this.videoState.startTransitionTo("playing"),this.playIfAllowed()):"paused"===(null==i?void 0:i.to)&&JP(this.params.desiredState.playbackState,"paused"));default:return hb(e)}}},this.init3DScene=e=>{var t,i,r;if(this.scene3D)return;this.scene3D=new nI(this.params.container,this.video,{fov:this.params.tuning.spherical.fov,orientation:this.params.tuning.spherical.orientation||{x:(null==(t=e.projectionData)?void 0:t.pose.yaw)||0,y:(null==(i=e.projectionData)?void 0:i.pose.pitch)||0,z:(null==(r=e.projectionData)?void 0:r.pose.roll)||0},rotationSpeed:this.params.tuning.spherical.rotationSpeed,maxYawAngle:this.params.tuning.spherical.maxYawAngle,rotationSpeedCorrection:this.params.tuning.spherical.rotationSpeedCorrection,degreeToPixelCorrection:this.params.tuning.spherical.degreeToPixelCorrection,speedFadeTime:this.params.tuning.spherical.speedFadeTime,speedFadeThreshold:this.params.tuning.spherical.speedFadeThreshold});let n=this.elementSizeManager.getValue();n&&this.scene3D.setViewportSize(n.width,n.height)},this.destroy3DScene=()=>{this.scene3D&&(this.scene3D.destroy(),this.scene3D=void 0)},this.textTracksManager=new pO(e.source.url),this.params=e,this.video=nO(e.container,e.tuning),this.tracer=e.dependencies.tracer.createComponentTracer(this.constructor.name),this.params.output.element$.next(this.video),this.params.output.availableVideoTracks$.next([]),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.output.hostname$.next(tC(this.params.source.url)),this.params.output.isLive$.next(!1),this.params.output.autoVideoTrackLimitingAvailable$.next(!0),this.params.output.availableTextTracks$.next([]),this.params.desiredState.internalTextTracks.setState([]),this.player=new tI({throughputEstimator:this.params.dependencies.throughputEstimator,tuning:this.params.tuning,compatibilityMode:this.params.source.compatibilityMode,tracer:this.tracer}),this.subscribe()}getProviderSubscriptionInfo(){let{output:e,desiredState:t}=this.params,i=IO(this.video);this.subscription.add((()=>i.destroy()));let r=this.constructor.name,n=t=>{e.error$.next({id:r,category:M_.WTF,message:`${r} internal logic error`,thrown:t})};return{output:e,desiredState:t,observableVideo:i,genericErrorListener:n,connect:(e,t)=>this.subscription.add(e.subscribe(t,n))}}subscribe(){let{output:e,desiredState:t,observableVideo:i,genericErrorListener:r,connect:n}=this.getProviderSubscriptionInfo();this.subscription.add(this.params.output.availableVideoTracks$.pipe(v_((e=>!!e.length)),P_()).subscribe((e=>{this.droppedFramesManager.connect({logger:this.params.dependencies.logger,video:this.video,droppedFramesChecker:this.params.tuning.droppedFramesChecker,isAuto:this.params.desiredState.autoVideoTrackSwitching,playing$:i.playing$,pause$:i.pause$,tracks:e})})));let a=this.params.desiredState.seekState.stateChangeEnded$.pipe(A_((e=>"none"!==e.to.state)),E_());this.stallsManager.connect({isSeeked$:a,currentStallDuration$:this.player.currentStallDuration$.pipe(E_()),videoLastDataObtainedTimestamp$:this.player.videoLastDataObtainedTimestamp$,throughput$:this.params.dependencies.throughputEstimator.throughput$,rtt$:this.params.dependencies.throughputEstimator.rtt$,qualityLimitsOnStall:this.params.tuning.dash.qualityLimitsOnStall,isBuffering$:i.isBuffering$,looped$:i.looped$}),n(i.ended$,e.endedEvent$),n(i.looped$,e.loopedEvent$),n(i.error$,e.error$),n(i.isBuffering$,e.isBuffering$),n(i.currentBuffer$,e.currentBuffer$),n(i.playing$,e.firstFrameEvent$),n(i.canplay$,e.canplay$),n(i.inPiP$,e.inPiP$),n(i.inFullscreen$,e.inFullscreen$),n(i.loadedMetadata$,e.loadedMetadataEvent$),n(this.player.error$,e.error$),n(this.player.fetcherRecoverableError$,e.fetcherRecoverableError$),n(this.player.fetcherError$,e.fetcherError$),n(this.player.lastConnectionType$,e.httpConnectionType$),n(this.player.lastConnectionReused$,e.httpConnectionReused$),n(this.player.isLive$,e.isLive$),n(this.player.lastRequestFirstBytes$.pipe(v_(Tb),P_()),e.firstBytesEvent$),n(this.stallsManager.severeStallOccurred$,e.severeStallOccurred$),n(this.videoState.stateChangeEnded$.pipe(A_((e=>e.to))),this.params.output.playbackState$),this.subscription.add(i.loopExpected$.subscribe((e=>{t.seekState.setState({state:"requested",position:0,forcePrecise:!1})}))),this.subscription.add(i.looped$.subscribe((()=>this.player.warmUpMediaSourceIfNeeded()),r)),this.subscription.add(i.seeked$.subscribe(e.seekedEvent$,r)),this.subscription.add(lO(this.video,t.isLooped,r)),this.subscription.add(uO(this.video,t.volume,i.volumeState$,r)),this.subscription.add(i.volumeState$.subscribe(this.params.output.volume$,r)),this.subscription.add(dO(this.video,t.playbackRate,i.playbackRateState$,r)),this.elementSizeManager.connect({video:this.video,observableVideo:i}),n(yC(this.video,{threshold:this.params.tuning.autoTrackSelection.activeVideoAreaThreshold}),e.elementVisible$),this.subscription.add(i.playing$.subscribe((()=>{this.videoState.setState("playing"),JP(t.playbackState,"playing"),this.scene3D&&this.scene3D.play()}),r)).add(i.pause$.subscribe((()=>{this.videoState.setState("paused"),JP(t.playbackState,"paused")}),r)).add(i.canplay$.subscribe((()=>{"playing"===this.videoState.getState()&&this.playIfAllowed()}),r)),this.subscription.add(this.player.state$.stateChangeEnded$.subscribe((({to:e})=>{if("manifest_ready"===e){this.videoTracksMap=new Map,this.audioTracksMap=new Map,this.textTracksMap=new Map;let e=this.player.getStreams();if(yb(e,"Manifest not loaded or empty"),!this.params.tuning.isAudioDisabled){let t=[];for(let i of e.audio){t.push(RL(i));let e=[];for(let t of i.representations){let r=_L(t);e.push(r),this.audioTracksMap.set(r,{stream:i,representation:t})}this.audioStreamsMap.set(i,e)}this.params.output.availableAudioStreams$.next(t)}let t=[];for(let i of e.video){t.push(wL(i));let e=[];for(let t of i.representations){let r=bL({...t,streamId:i.id});r&&(e.push(r),this.videoTracksMap.set(r,{stream:i,representation:t}))}this.videoStreamsMap.set(i,e)}this.params.output.availableVideoStreams$.next(t);for(let t of e.text)for(let e of t.representations){let i=AL(t,e);this.textTracksMap.set(i,{stream:t,representation:e})}this.params.output.availableVideoTracks$.next(Array.from(this.videoTracksMap.keys())),this.params.output.availableAudioTracks$.next(Array.from(this.audioTracksMap.keys())),this.params.output.isAudioAvailable$.next(!!this.audioTracksMap.size),this.audioTracksMap.size&&this.textTracksMap.size&&this.params.desiredState.internalTextTracks.startTransitionTo(Array.from(this.textTracksMap.keys()))}else"representations_ready"===e&&(this.videoState.setState("ready"),this.player.initBuffer())}),r)),this.subscription.add(o_(this.player.currentStallDuration$,this.player.state$.stateChangeEnded$,t.videoTrack.stateChangeStarted$,t.autoVideoTrackSwitching.transitionStarted$,this.params.dependencies.throughputEstimator.rttAdjustedThroughput$,t.autoVideoTrackLimits.stateChangeStarted$,this.elementSizeManager.getObservable(),this.params.output.elementVisible$,this.droppedFramesManager.onDroopedVideoFramesLimit$,d_(this.video,"progress")).pipe(v_((()=>this.videoTracksMap.size>0))).subscribe((async()=>{let e=this.player.state$.getState(),i=this.player.state$.getTransition();if(!(0,_C.default)(["manifest_ready","running"],e)||i)return;t.autoVideoTrackSwitching.getTransition()&&t.autoVideoTrackSwitching.setState(t.autoVideoTrackSwitching.getState());let r=this.selectVideoAudioRepresentations();if(!r)return;let[n,a]=r,s=[...this.videoTracksMap.keys()].find((e=>{var t;return(null==(t=this.videoTracksMap.get(e))?void 0:t.representation.id)===n.id}));Tb(s)&&(this.stallsManager.lastVideoTrackSelected=s);let o=this.params.desiredState.autoVideoTrackLimits.getTransition();if(o&&this.params.output.autoVideoTrackLimits$.next(o.to),"manifest_ready"===e)await this.player.initRepresentations(n.id,null==a?void 0:a.id,this.params.sourceHls);else if(await this.player.switchRepresentation("video",n.id),a){let e=!!t.audioStream.getTransition();await this.player.switchRepresentation("audio",a.id,e)}}),r)),this.subscription.add(t.cameraOrientation.stateChangeEnded$.subscribe((({to:e})=>{this.scene3D&&e&&this.scene3D.pointCameraTo(e.x,e.y)}))),this.subscription.add(this.elementSizeManager.subscribe((e=>{this.scene3D&&e&&this.scene3D.setViewportSize(e.width,e.height)}))),this.subscription.add(this.player.currentVideoRepresentation$.pipe(E_()).subscribe((t=>{let i=[...this.videoTracksMap.entries()].find((([,{representation:e}])=>e.id===t));if(!i)return e.currentVideoTrack$.next(void 0),void e.currentVideoStream$.next(void 0);let[r,{stream:n}]=i,a=this.params.desiredState.videoStream.getTransition();a&&a.to&&a.to.id===n.id&&this.params.desiredState.videoStream.setState(a.to),e.currentVideoTrack$.next(r),e.currentVideoStream$.next(wL(n))}),r)),this.subscription.add(this.player.currentAudioRepresentation$.pipe(E_()).subscribe((t=>{let i=[...this.audioTracksMap.entries()].find((([,{representation:e}])=>e.id===t));if(!i)return void e.currentAudioStream$.next(void 0);let[r,{stream:n}]=i,a=this.params.desiredState.audioStream.getTransition();a&&a.to&&a.to.id===n.id&&this.params.desiredState.audioStream.setState(a.to),e.currentAudioStream$.next(RL(n))}),r)),this.subscription.add(this.player.currentVideoRepresentationInit$.subscribe((t=>{var i,r;if(null!=t&&t.is3dVideo&&null!=(i=this.params.tuning.spherical)&&i.enabled)try{this.init3DScene(t),e.is3DVideo$.next(!0)}catch(t){e.warning$.next({id:"DashProvider",message:`DashProvider could not initialize 3D-scene: ${t}`})}else this.destroy3DScene(),null!=(r=this.params.tuning.spherical)&&r.enabled&&e.is3DVideo$.next(!1)}),r)),this.subscription.add(this.player.currentVideoSegmentLength$.subscribe(e.currentVideoSegmentLength$,r)),this.subscription.add(this.player.currentAudioSegmentLength$.subscribe(e.currentAudioSegmentLength$,r)),this.textTracksManager.connect(this.video,t,e);let s=t.playbackState.stateChangeStarted$.pipe(A_((({to:e})=>"ready"===e)),E_());this.subscription.add(o_(s,t.autoVideoTrackSwitching.stateChangeStarted$,this.player.state$.stateChangeEnded$,u_(["init"])).subscribe((()=>{let e=t.autoVideoTrackSwitching.getState(),i="ready"===t.playbackState.getState()?this.params.tuning.dash.forwardBufferTargetPreload:e?this.params.tuning.dash.forwardBufferTargetAuto:this.params.tuning.dash.forwardBufferTargetManual;this.player.setBufferTarget(i)}))),this.subscription.add(o_(s,this.player.state$.stateChangeEnded$,u_(["init"])).subscribe((()=>this.player.setPreloadOnly("ready"===t.playbackState.getState()))));let o=o_(t.playbackState.stateChangeStarted$,t.videoTrack.stateChangeStarted$,t.seekState.stateChangeEnded$,this.videoState.stateChangeEnded$,u_(["init"])).pipe(h_(0));this.subscription.add(o.subscribe(this.syncPlayback,r))}selectVideoAudioRepresentations(){var e,t,i,r,n,a,s,o,l,u,d,c,h;if(this.player.isStreamEnded)return;let{desiredState:p,output:f}=this.params,m=p.autoVideoTrackSwitching.getState(),g=null==(e=p.videoTrack.getState())?void 0:e.id,v=[...this.videoTracksMap.keys()].find((({id:e})=>e===g)),S=f.currentVideoTrack$.getValue(),y=(null!=(r=null!=(i=p.videoStream.getState())?i:v&&(null==(t=this.videoTracksMap.get(v))?void 0:t.stream))?r:1===this.videoStreamsMap.size)?this.videoStreamsMap.keys().next().value:void 0;if(!y)return;let T=[...this.videoStreamsMap.keys()].find((({id:e})=>e===y.id)),E=T&&this.videoStreamsMap.get(T);if(!E)return;let b,_=AC(this.video.buffered,1e3*this.video.currentTime);b=this.player.isActiveLive$.getValue()?this.player.isLowLatency$.getValue()?this.params.tuning.dashCmafLive.lowLatency.maxTargetOffset:this.params.tuning.dashCmafLive.normalizedLiveMinBufferSize:this.player.isLive$.getValue()?this.params.tuning.dashCmafLive.normalizedTargetMinBufferSize:m?this.params.tuning.dash.forwardBufferTargetAuto:this.params.tuning.dash.forwardBufferTargetManual;let A=(1e3*this.video.duration||1/0)-1e3*this.video.currentTime,R=Math.min(_/Math.min(b,A||1/0),1),w=null!=(n=p.audioStream.getState())?n:1===this.audioStreamsMap.size?this.audioStreamsMap.keys().next().value:void 0,P=null!=(a=[...this.audioStreamsMap.keys()].find((({id:e})=>e===(null==w?void 0:w.id))))?a:this.audioStreamsMap.keys().next().value,O=0;if(P){if(v&&!m){let e=KO(v,E,null!=(s=this.audioStreamsMap.get(P))?s:[],this.params.tuning.autoTrackSelection.minVideoAudioRatio);O=Math.max(O,null!=(o=null==e?void 0:e.bitrate)?o:-1/0)}if(S){let e=KO(S,E,null!=(l=this.audioStreamsMap.get(P))?l:[],this.params.tuning.autoTrackSelection.minVideoAudioRatio);O=Math.max(O,null!=(u=null==e?void 0:e.bitrate)?u:-1/0)}}let C=eC(E,{container:this.elementSizeManager.getValue(),panelSize:this.params.panelSize,estimatedThroughput:this.params.dependencies.throughputEstimator.rttAdjustedThroughput$.getValue(),tuning:this.params.tuning.autoTrackSelection,limits:this.params.desiredState.autoVideoTrackLimits.getState(),reserve:O,forwardBufferHealth:R,current:S,visible:this.params.output.elementVisible$.getValue(),history:this.videoTrackSwitchHistory,playbackRate:this.video.playbackRate,droppedVideoMaxQualityLimit:this.droppedFramesManager.droppedVideoMaxQualityLimit,stallsVideoMaxQualityLimit:this.stallsManager.videoMaxQualityLimit,stallsPredictedThroughput:this.stallsManager.predictedThroughput,abrLogger:this.params.dependencies.abrLogger}),L=m?null!=C?C:v:null!=v?v:C,I=P&&((e,t,i,{estimatedThroughput:r,tuning:n,playbackRate:a,forwardBufferHealth:s,history:o,abrLogger:l,stallsPredictedThroughput:u})=>{bb(i,YO);let d=n.considerPlaybackRate&&Tb(a)?a:1,c=[...i].sort(WO(-1)),h=e.bitrate;yb(h);let p,f=d*zO(null!=s?s:.5,n.bitrateAudioFactorAtEmptyBuffer,n.bitrateAudioFactorAtFullBuffer),m=KO(e,t,i,n.minVideoAudioRatio),g=u||r;Tb(g)&&isFinite(g)&&(p=c.find((e=>!(!Tb(e.bitrate)||!Tb(null==m?void 0:m.bitrate))&&g-h>=e.bitrate*f&&e.bitrate>=m.bitrate))),p||(p=m);let v=null==o?void 0:o.last,S=p&&JO(n,l,p,o);return Tb(o)&&(null==S?void 0:S.bitrate)!==(null==v?void 0:v.bitrate)&&l({message:`\n    [AUDIO TRACKS ABR]\n    [available audio tracks]\n\t${i.map((e=>`{ id: ${e.id}, bitrate: ${e.bitrate} }`)).join("\n\t")}\n\n    [tuning]\n\t${(0,DO.default)(null!=n?n:{}).map((([e,t])=>`${e}: ${t}`)).join("\n\t")}\n\n    [limit params]\n    estimatedThroughput: ${r},\n    stallsPredictedThroughput: ${u},\n    reserve: ${h},\n    playbackRate: ${a},\n    playbackRateFactor: ${d},\n    forwardBufferHealth: ${s},\n    bitrateFactor: ${f},\n    minBufferToSwitchUp: ${n.minBufferToSwitchUp},\n\n    [selected audio track] ${null==S?void 0:S.id}\n    `}),S})(L,E,null!=(d=this.audioStreamsMap.get(P))?d:[],{estimatedThroughput:this.params.dependencies.throughputEstimator.rttAdjustedThroughput$.getValue(),stallsPredictedThroughput:this.stallsManager.predictedThroughput,tuning:this.params.tuning.autoTrackSelection,forwardBufferHealth:R,history:this.audioTrackSwitchHistory,playbackRate:this.video.playbackRate,abrLogger:this.params.dependencies.abrLogger}),x=null==(c=this.videoTracksMap.get(L))?void 0:c.representation,M=I&&(null==(h=this.audioTracksMap.get(I))?void 0:h.representation);return x&&M?[x,M]:x&&!M&&0===this.audioTracksMap.size?[x,void 0]:void 0}prepare(e=0){this.player.initManifest(this.video,this.params.source.url,e)}playIfAllowed(){aC(this.video,(()=>{this.params.output.soundProhibitedEvent$.next()})).then((e=>{e||(this.videoState.setState("paused"),JP(this.params.desiredState.playbackState,"paused",!0))}),(e=>this.params.output.error$.next({id:"ForcePlay",message:"play() failed even with workarounds",category:M_.DOM,thrown:e})))}destroy(){this.subscription.unsubscribe(),this.droppedFramesManager.destroy(),this.stallsManager.destroy(),this.elementSizeManager.destroy(),this.destroy3DScene(),this.textTracksManager.destroy(),this.player.destroy(),this.params.output.element$.next(void 0),this.params.output.currentVideoStream$.next(void 0),aO(this.video),this.tracer.end()}},lI=class extends oI{subscribe(){super.subscribe();let{output:e,observableVideo:t,connect:i}=this.getProviderSubscriptionInfo();i(t.timeUpdate$,e.position$),i(t.durationChange$,e.duration$)}seek(e,t){this.params.output.willSeekEvent$.next(),this.player.seek(e,t)}},uI=class extends oI{constructor(e){super(e),this.textTracksManager.destroy()}subscribe(){super.subscribe();let e=-1,{output:t,observableVideo:i,desiredState:r,connect:n}=this.getProviderSubscriptionInfo();this.params.output.position$.next(0),this.params.output.isLive$.next(!0),n(i.timeUpdate$,t.liveBufferTime$),n(this.player.liveSeekableDuration$,t.duration$),n(this.player.liveLatency$,t.liveLatency$);let a=new n_(1);n(i.playbackRateState$,a),this.subscription.add(this.params.output.position$.subscribe(this.player.livePositionFromPlayer$)).add(r.isLowLatency.stateChangeEnded$.pipe(A_((e=>e.to))).subscribe(this.player.isLowLatency$)).add(s_({liveBufferTime:t.liveBufferTime$,liveAvailabilityStartTime:this.player.liveAvailabilityStartTime$}).pipe(A_((({liveBufferTime:e,liveAvailabilityStartTime:t})=>e&&t?e+t:void 0))).subscribe(t.liveTime$)).add(this.player.liveStreamStatus$.pipe(v_((e=>Tb(e)))).subscribe((e=>t.isLiveEnded$.next("active"!==e&&0===t.position$.getValue())))).add(s_({liveDuration:this.player.liveDuration$,liveStreamStatus:this.player.liveStreamStatus$,playbackRate:o_(i.playbackRateState$,new n_(1))}).pipe(v_((({liveStreamStatus:e,liveDuration:t})=>"active"===e&&!!t))).subscribe((({liveDuration:i,playbackRate:r})=>{let n=t.liveBufferTime$.getValue(),a=t.position$.getValue(),{playbackCatchupSpeedup:s}=this.params.tuning.dashCmafLive.lowLatency;a||r<1-s||this.video.paused||Eb(n)||(e=i-n)}))).add(s_({time:t.liveBufferTime$,liveDuration:this.player.liveDuration$,playbackRate:o_(i.playbackRateState$,new n_(1))}).pipe(E_(((e,t)=>"active"===this.player.liveStreamStatus$.getValue()?e.liveDuration===t.liveDuration:e.time===t.time))).subscribe((({time:i,liveDuration:r,playbackRate:n})=>{let a=t.position$.getValue(),{playbackCatchupSpeedup:s}=this.params.tuning.dashCmafLive.lowLatency;if(!a&&!this.video.paused&&n>=1-s||Eb(i)||Eb(r))return;let o=-1*(r-i-e);t.position$.next(Math.min(o,0))}))).add(this.player.currentLiveTextRepresentation$.subscribe((e=>{if(e){let t=(({language:e,label:t,id:i,url:r,isAuto:n})=>({id:i,url:r,isAuto:n,type:"internal",language:e,label:t}))(e);this.params.output.availableTextTracks$.next([t])}})))}seek(e){this.params.output.willSeekEvent$.next();let t=-e,i=Math.trunc(t/1e3<=Math.abs(this.params.output.duration$.getValue())?t:0);this.player.seekLive(i).then((()=>{this.params.output.position$.next(e/1e3)}))}},dI=lA(Gw(),1),cI={},hI=(e,t)=>new fb((i=>{let r=(e,t)=>i.next(t);return e.on(t,r),()=>e.off(t,r)})),pI=class{constructor(e){this.subscription=new cb,this.videoState=new ZP("initializing"),this.trackLevels=new Map,this.syncPlayback=()=>{let e=this.videoState.getState(),t=this.params.desiredState.playbackState.getState(),i=this.params.desiredState.playbackState.getTransition(),r=this.params.desiredState.seekState.getState();if("initializing"!==e)switch("paused"!==(null==i?void 0:i.to)&&"requested"===r.state&&this.seek(r.position),t){case"stopped":switch(e){case"stopped":break;case"ready":case"playing":case"paused":this.stop();break;default:hb(e)}break;case"ready":switch(e){case"stopped":this.prepare();break;case"ready":case"playing":case"paused":break;default:hb(e)}break;case"playing":switch(e){case"playing":break;case"stopped":this.prepare();break;case"ready":case"paused":this.playIfAllowed();break;default:hb(e)}break;case"paused":switch(e){case"paused":break;case"stopped":this.prepare();break;case"ready":this.videoState.setState("paused"),JP(this.params.desiredState.playbackState,"paused");break;case"playing":this.pause();break;default:hb(e)}break;default:hb(t)}},this.textTracksManager=new pO(e.source.url),this.video=nO(e.container,e.tuning),this.params=e,this.params.output.element$.next(this.video),this.params.output.isLive$.next(!1),this.params.output.availableVideoTracks$.next([]),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.output.hostname$.next(tC(this.params.source.url)),this.loadHlsJs()}destroy(){var e,t;this.subscription.unsubscribe(),this.trackLevels.clear(),this.textTracksManager.destroy(),null==(e=this.hls)||e.detachMedia(),null==(t=this.hls)||t.destroy(),this.params.output.element$.next(void 0),aO(this.video)}loadHlsJs(){let e=!1,t=t=>{e||this.params.output.error$.next({id:"timeout"===t?"HlsJsTimeout":"HlsJsLoadError",category:M_.NETWORK,message:"Failed to load Hls.js",thrown:t}),e=!0},i=window.setTimeout((()=>t("timeout")),this.params.tuning.dynamicImportTimeout);(0,dI.default)(n.e(618).then(n.bind(n,6618)).then((t=>{e||(cI.Hls=t.default,cI.Events=t.default.Events,this.init())}),t),(()=>{window.clearTimeout(i),e=!0}))}init(){yb(cI.Hls,"hls.js not loaded"),this.hls=new cI.Hls({fragLoadingMaxRetry:5,levelLoadingMaxRetry:2,manifestLoadingMaxRetry:2,fragLoadingMaxRetryTimeout:16e3,manifestLoadingMaxRetryTimeout:2e3,levelLoadingMaxRetryTimeout:2e3}),this.subscribe(),this.videoState.setState("stopped")}subscribe(){yb(cI.Events,"hls.js not loaded");let{desiredState:e,output:t}=this.params,i=e=>{t.error$.next({id:"HlsJsProvider",category:M_.WTF,message:"HlsJsProvider internal logic error",thrown:e})},r=IO(this.video);this.subscription.add((()=>r.destroy()));let n=(e,t)=>this.subscription.add(e.subscribe(t,i));n(r.timeUpdate$,t.position$),n(r.durationChange$,t.duration$),n(r.ended$,t.endedEvent$),n(r.looped$,t.loopedEvent$),n(r.error$,t.error$),n(r.isBuffering$,t.isBuffering$),n(r.currentBuffer$,t.currentBuffer$),n(r.loadStart$,t.firstBytesEvent$),n(r.loadedMetadata$,t.loadedMetadataEvent$),n(r.playing$,t.firstFrameEvent$),n(r.canplay$,t.canplay$),n(r.seeked$,t.seekedEvent$),n(r.inPiP$,t.inPiP$),n(r.inFullscreen$,t.inFullscreen$),this.subscription.add(lO(this.video,e.isLooped,i)),this.subscription.add(uO(this.video,e.volume,r.volumeState$,i)),this.subscription.add(r.volumeState$.subscribe(this.params.output.volume$)),this.subscription.add(dO(this.video,e.playbackRate,r.playbackRateState$,i)),n(yC(this.video),t.elementVisible$),n(this.videoState.stateChangeEnded$.pipe(A_((e=>e.to))),this.params.output.playbackState$),this.subscription.add(hI(this.hls,cI.Events.ERROR).subscribe((e=>{var i;e.fatal&&t.error$.next({id:["HlsJsFatal",e.type,e.details].join("_"),category:M_.WTF,message:`HlsJs fatal ${e.type} ${e.details}, ${null==(i=e.err)?void 0:i.message} ${e.reason}`,thrown:e.error})}))),this.subscription.add(r.playing$.subscribe((()=>{this.videoState.setState("playing"),JP(e.playbackState,"playing")}),i)).add(r.pause$.subscribe((()=>{this.videoState.setState("paused"),JP(e.playbackState,"paused")}),i)).add(r.canplay$.subscribe((()=>{var e;"ready"===(null==(e=this.videoState.getTransition())?void 0:e.to)&&this.videoState.setState("ready"),"playing"===this.videoState.getState()&&this.playIfAllowed()}),i)),n(hI(this.hls,cI.Events.MANIFEST_PARSED).pipe(A_((({levels:e})=>e.reduce(((e,t)=>{var i,r;let n=t.name||t.height.toString(10),{width:a,height:s}=t,o=null!=(r=xO(null!=(i=t.attrs.QUALITY)?i:""))?r:Qb({width:a,height:s});if(!o)return e;let l=t.attrs["FRAME-RATE"]?parseFloat(t.attrs["FRAME-RATE"]):void 0,u={id:n.toString(),quality:o,bitrate:t.bitrate/1e3,size:{width:a,height:s},fps:l};return this.trackLevels.set(n,{track:u,level:t}),e.push(u),e}),[])))),t.availableVideoTracks$),n(hI(this.hls,cI.Events.MANIFEST_PARSED),(t=>{if(t.subtitleTracks.length>0){let i=[];for(let e of t.subtitleTracks){let t=e.name,r=e.attrs.URI||"",n=e.lang;i.push({id:t,url:r,language:n,type:"internal"})}e.internalTextTracks.startTransitionTo(i)}})),n(hI(this.hls,cI.Events.LEVEL_LOADING).pipe(A_((({url:e})=>tC(e)))),t.hostname$),n(hI(this.hls,cI.Events.FRAG_CHANGED),(e=>{var i,r,n,a;let{video:s,audio:o}=e.frag.elementaryStreams;t.currentVideoSegmentLength$.next(1e3*((null!=(i=null==s?void 0:s.endPTS)?i:0)-(null!=(r=null==s?void 0:s.startPTS)?r:0))),t.currentAudioSegmentLength$.next(1e3*((null!=(n=null==o?void 0:o.endPTS)?n:0)-(null!=(a=null==o?void 0:o.startPTS)?a:0)))})),this.subscription.add(cO(e.autoVideoTrackSwitching,(()=>this.hls.autoLevelEnabled),(e=>{this.hls.nextLevel=e?-1:this.hls.currentLevel,this.hls.loadLevel=e?-1:this.hls.loadLevel}),{onError:i}));let a=e=>{var t;return null==(t=Array.from(this.trackLevels.values()).find((({level:t})=>t===e)))?void 0:t.track},s=hI(this.hls,cI.Events.LEVEL_SWITCHED).pipe(A_((({level:e})=>a(this.hls.levels[e]))));s.pipe(v_(Tb)).subscribe(t.currentVideoTrack$,i),this.subscription.add(cO(e.videoTrack,(()=>a(this.hls.levels[this.hls.currentLevel])),(e=>{var t;if(Eb(e))return;let i=null==(t=this.trackLevels.get(e.id))?void 0:t.level;if(!i)return;let r=this.hls.levels.indexOf(i),n=this.hls.currentLevel,a=this.hls.levels[n];!a||i.bitrate>a.bitrate?this.hls.nextLevel=r:(this.hls.loadLevel=r,this.hls.loadLevel=r)}),{changed$:s,onError:i})),n(r.progress$,(()=>{this.params.dependencies.throughputEstimator.addRawThroughput(this.hls.bandwidthEstimate/1e3)})),this.textTracksManager.connect(this.video,e,t);let o=o_(e.playbackState.stateChangeStarted$,e.videoTrack.stateChangeStarted$,e.seekState.stateChangeEnded$,this.videoState.stateChangeEnded$,u_(["init"])).pipe(h_(0));this.subscription.add(o.subscribe(this.syncPlayback,i))}prepare(){this.videoState.startTransitionTo("ready"),this.hls.attachMedia(this.video),this.hls.loadSource(this.params.source.url)}async playIfAllowed(){this.videoState.startTransitionTo("playing"),await aC(this.video,(()=>{this.params.output.soundProhibitedEvent$.next()})).catch((e=>this.params.output.error$.next({id:"ForcePlay",message:"play() failed even with workarounds",category:M_.DOM,thrown:e})))||(this.videoState.setState("paused"),JP(this.params.desiredState.playbackState,"paused",!0))}pause(){this.videoState.startTransitionTo("paused"),this.video.paused?this.videoState.setState("paused"):this.video.pause()}seek(e){this.params.output.willSeekEvent$.next(),this.video.currentTime=e/1e3}stop(){this.params.output.position$.next(0),this.params.output.duration$.next(1/0),this.params.output.currentBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.hls.stopLoad(),this.hls.detachMedia(),this.video.removeAttribute("src"),this.video.load(),this.videoState.setState("stopped"),JP(this.params.desiredState.playbackState,"stopped",!0)}},fI="X-Playback-Duration",mI=async e=>{var t;let i=await IC(e),r=await i.text(),n=null==(t=/#EXT-X-VK-PLAYBACK-DURATION:(\d+)/m.exec(r))?void 0:t[1];return n?parseInt(n,10):i.headers.has(fI)?parseInt(i.headers.get(fI),10):void 0},gI=lA(sw(),1),vI=e=>{let t=null;if(e.QUALITY&&(t=xO(e.QUALITY)),!t&&e.RESOLUTION){let[i,r]=e.RESOLUTION.split("x").map((e=>parseInt(e,10)));t=Qb({width:i,height:r})}return null!=t?t:null},SI=0,yI=async(e,t=e,i,r)=>{let n=await(await IC(e,r)).text();SI+=1;try{let{qualityManifests:e,textTracks:i}=((e,t)=>{var i,r;let n=e.split("\n"),a=[],s=[];for(let e=0;e<n.length;e++){let o=n[e],l=o.match(/^#EXT-X-STREAM-INF:(.+)/),u=o.match(/^#EXT-X-MEDIA:TYPE=SUBTITLES,(.+)/);if(l||u){if(l){let r,s=(0,gI.default)(l[1].split(",").map((e=>e.split("=")))),o=null!=(i=s.QUALITY)?i:`stream-${s.BANDWIDTH}`,u=vI(s);s.BANDWIDTH&&(r=parseInt(s.BANDWIDTH,10)/1e3||void 0),!r&&s["AVERAGE-BANDWIDTH"]&&(r=parseInt(s["AVERAGE-BANDWIDTH"],10)/1e3||void 0);let d,c=s["FRAME-RATE"]?parseFloat(s["FRAME-RATE"]):void 0;if(s.RESOLUTION){let[e,t]=s.RESOLUTION.split("x").map((e=>parseInt(e,10)));e&&t&&(d={width:e,height:t})}let h=new URL(n[++e],t).toString();u&&a.push({id:o,quality:u,url:h,bandwidth:r,size:d,fps:c})}if(u){let e=(0,gI.default)(u[1].split(",").map((e=>{let t=e.indexOf("=");return[e.substring(0,t),e.substring(t+1)]})).map((([e,t])=>[e,t.replace(/^"|"$/g,"")]))),t=null==(r=e.URI)?void 0:r.replace(/playlist$/,"subtitles.vtt"),i=e.LANGUAGE,n=e.NAME;t&&i&&s.push({type:"internal",id:i,label:n,language:i,url:t,isAuto:!1})}}}if(!a.length)throw new Error("Empty manifest");return{qualityManifests:a,textTracks:s}})(n,t);return{qualityManifests:e,textTracks:i}}catch(r){if(SI<=i.manifestRetryMaxCount)return await(e=>new Promise((t=>{setTimeout((()=>{t()}),e)})))(wb(SI-1,{start:i.manifestRetryInterval,max:i.manifestRetryMaxInterval})),yI(e,t,i)}return{qualityManifests:[],textTracks:[]}},TI=yI,EI=class{constructor(e,t,i,r,n){this.subscription=new cb,this.abortControllers={destroy:new xC,nextManifest:null},this.prepareUrl=void 0,this.currentTextTrackData=null,this.availableTextTracks$=new n_(null),this.getCurrentTime$=new n_(null),this.error$=new mb,this.params={fetchManifestData:i,sourceUrl:r,downloadThreshold:n},this.subscription.add(e.pipe(m_(1e3)).subscribe((e=>{this.processLiveTime(e)}))),this.getCurrentTime$.next((()=>this.currentTextTrackData?this.currentTextTrackData.playlist.segmentStartTime/1e3+t.currentTime:0))}destroy(){this.subscription.unsubscribe(),this.abortControllers.destroy.abort()}async prepare(e){try{let t=new URL(e);t.searchParams.set("enable-subtitles","yes"),this.prepareUrl=t.toString();let{textTracks:i}=await this.fetchManifestData();await this.processTextTracks(i,this.params.sourceUrl)}catch(e){this.error("prepare",e)}}async processTextTracks(e,t){try{let i=await this.parseTextTracks(e,t);i&&(this.currentTextTrackData=i)}catch(e){this.error("processTextTracks",e)}}async parseTextTracks(e,t){for(let i of e){let e=new URL(i.url,t).toString(),r=await(await IC(e,{signal:this.abortControllers.destroy.signal})).text();return{textTrack:i,playlist:this.parsePlaylist(r,e)}}}parsePlaylist(e,t){let i={mediaSequence:0,programDateTime:"",segments:[],targetDuration:0,vkPlaybackDuration:0,segmentStartTime:0,vkStartTime:""},r=e.split("\n"),n=0;for(let e=0;e<r.length;++e){let a=r[e];switch(!0){case a.startsWith("#EXTINF:"):{let s=r[++e],o=new URL(s,t).toString(),l=1e3*Number(this.extractPlaylistRowValue("#EXTINF:",a));if(i.segments.push({time:{from:n,to:n+l},url:o}),n+=l,!i.segmentStartTime){let e=new Date(i.vkStartTime).valueOf(),t=new Date(i.programDateTime).valueOf();i.segmentStartTime=t-e}break}case a.startsWith("#EXT-X-TARGETDURATION:"):i.targetDuration=Number(this.extractPlaylistRowValue("#EXT-X-TARGETDURATION:",a));break;case a.startsWith("#EXT-X-MEDIA-SEQUENCE:"):i.mediaSequence=Number(this.extractPlaylistRowValue("#EXT-X-MEDIA-SEQUENCE:",a));break;case a.startsWith("#EXT-X-VK-PLAYBACK-DURATION:"):i.vkPlaybackDuration=Number(this.extractPlaylistRowValue("#EXT-X-VK-PLAYBACK-DURATION:",a));break;case a.startsWith("#EXT-X-PROGRAM-DATE-TIME:"):{let e=this.extractPlaylistRowValue("#EXT-X-PROGRAM-DATE-TIME:",a);i.programDateTime=e;let t=new Date(e);t.setMilliseconds(0),n=t.valueOf();break}case a.startsWith("#EXT-X-VK-START-TIME:"):i.vkStartTime=this.extractPlaylistRowValue("#EXT-X-VK-START-TIME:",a)}}return i}extractPlaylistRowValue(e,t){return"#EXTINF:"===e?t.substring(e.length,t.length-1):t.substring(e.length)}processLiveTime(e){if(Tb(e)&&this.currentTextTrackData){let{segments:t}=this.currentTextTrackData.playlist,{from:i}=t[0].time,{to:r}=t[t.length-1].time;if(e<i||e>r)return;r-e<this.params.downloadThreshold&&this.fetchNextManifestData();for(let i of t)if(i.time.from<=e&&i.time.to>=e){this.availableTextTracks$.next([{...this.currentTextTrackData.textTrack,url:i.url,isAuto:!0}]);break}}}async fetchNextManifestData(){try{if(this.abortControllers.nextManifest)return;this.abortControllers.nextManifest=new xC;let{textTracks:e}=await this.fetchManifestData(),t=await this.parseTextTracks(e,this.params.sourceUrl);this.currentTextTrackData&&t&&(this.currentTextTrackData.playlist.segments=t.playlist.segments)}catch(e){this.error("fetchNextManifestData",e)}finally{this.abortControllers.nextManifest=null}}async fetchManifestData(){var e;let t=null!=(e=this.prepareUrl)?e:this.params.sourceUrl;return await this.params.fetchManifestData(t,{signal:this.abortControllers.destroy.signal})}error(e,t){this.error$.next({id:"[LiveTextManager][HLS_LIVE_CMAF]",category:M_.WTF,thrown:t,message:e})}},bI=class{constructor(e){var t;this.subscription=new cb,this.videoState=new ZP("stopped"),this.textTracksManager=null,this.liveTextManager=null,this.manifests$=new n_([]),this.liveOffset=new fO,this.manifestStartTime$=new n_(void 0),this.syncPlayback=()=>{if(!this.manifests$.getValue().length)return;let e=this.videoState.getState(),t=this.params.desiredState.playbackState.getState(),i=this.params.desiredState.playbackState.getTransition(),r=this.params.desiredState.videoTrack.getTransition(),n=this.params.desiredState.autoVideoTrackSwitching.getTransition(),a=this.params.desiredState.autoVideoTrackLimits.getTransition();if("stopped"===t)return void("stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.video.removeAttribute("src"),this.video.load(),this.params.output.position$.next(0),this.params.output.duration$.next(1/0),this.params.output.currentBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.videoState.setState("stopped"),JP(this.params.desiredState.playbackState,"stopped",!0)));if(this.videoState.getTransition())return;let s=this.params.desiredState.seekState.getState();if("stopped"===e)return this.videoState.startTransitionTo("ready"),void this.prepare();if(r||n||a){let e=this.videoState.getState();return this.videoState.setState("changing_manifest"),this.videoState.startTransitionTo(e),this.prepare(),a&&this.params.output.autoVideoTrackLimits$.next(a.to),void("none"===s.state&&this.params.desiredState.seekState.setState({state:"requested",position:-this.liveOffset.getTotalOffset(),forcePrecise:!0}))}if("paused"!==(null==i?void 0:i.to)&&"requested"===s.state)return this.videoState.startTransitionTo("ready"),this.seek(s.position&&s.position-this.liveOffset.getTotalPausedTime()),void this.prepare();switch(e){case"ready":return void("ready"===t?JP(this.params.desiredState.playbackState,"ready"):"paused"===t?(this.videoState.setState("paused"),this.liveOffset.pause(),JP(this.params.desiredState.playbackState,"paused")):"playing"===t&&(this.videoState.startTransitionTo("playing"),this.playIfAllowed()));case"playing":return void("paused"===t?(this.videoState.startTransitionTo("paused"),this.liveOffset.pause(),this.video.paused?this.videoState.setState("paused"):this.video.pause()):"playing"===(null==i?void 0:i.to)&&JP(this.params.desiredState.playbackState,"playing"));case"paused":if("playing"===t)if(this.videoState.startTransitionTo("playing"),this.liveOffset.getTotalPausedTime()<this.params.config.maxPausedTime&&this.liveOffset.getTotalOffset()<this.maxSeekBackTime$.getValue())this.liveOffset.resume(),this.playIfAllowed(),this.params.output.position$.next(-this.liveOffset.getTotalOffset()/1e3);else{let e=this.liveOffset.getTotalOffset();e>=this.maxSeekBackTime$.getValue()&&(e=0,this.liveOffset.resetTo(e)),this.liveOffset.resume(),this.params.output.position$.next(-e/1e3),this.prepare()}else"paused"===(null==i?void 0:i.to)&&(JP(this.params.desiredState.playbackState,"paused"),this.liveOffset.pause());return;case"changing_manifest":break;default:return hb(e)}},this.params=e,this.video=nO(e.container,e.tuning),this.params.output.element$.next(this.video),this.masterManifest={id:"master",quality:Bb.INVARIANT,url:this.params.source.url};let i=(e,t)=>TI(e,this.params.source.url,{manifestRetryInterval:this.params.tuning.manifestRetryInterval,manifestRetryMaxInterval:this.params.tuning.manifestRetryMaxInterval,manifestRetryMaxCount:this.params.tuning.manifestRetryMaxCount},t);this.params.tuning.useHlsLiveNewTextManager?this.liveTextManager=new EI(this.params.output.liveTime$,this.video,i,this.params.source.url,this.params.tuning.hlsLiveNewTextManagerDownloadThreshold):this.textTracksManager=new pO(e.source.url),i(this.generateLiveUrl()).then((({qualityManifests:e,textTracks:t})=>{var i;0===e.length&&this.params.output.error$.next({id:"HlsLiveProviderInternal:empty_manifest",category:M_.WTF,message:"HlsLiveProvider: there are no qualities in manifest"}),null==(i=this.liveTextManager)||i.processTextTracks(t,this.params.source.url),this.manifests$.next([this.masterManifest,...e])})).catch((e=>{this.params.output.error$.next({id:"ExtractHlsQualities",category:M_.NETWORK,message:"Error fetching manifest and extracting qualities",thrown:e})})),this.params.output.isLive$.next(!0),this.params.output.canChangePlaybackSpeed$.next(!1),this.params.output.availableVideoTracks$.next([]),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.output.hostname$.next(tC(this.params.source.url)),this.params.output.availableTextTracks$.next([]),this.params.desiredState.internalTextTracks.setState([]),this.maxSeekBackTime$=new n_(null!=(t=e.source.maxSeekBackTime)?t:1/0),this.subscribe()}selectManifest(){var e,t,i,r;let{autoVideoTrackSwitching:n,videoTrack:a}=this.params.desiredState,s=n.getState(),o=a.getTransition(),l=null!=(r=null!=(i=null==(e=null==o?void 0:o.to)?void 0:e.id)?i:null==(t=a.getState())?void 0:t.id)?r:"master",u=this.manifests$.getValue();if(!u.length)return;let d=s?"master":l;return s&&!o&&a.startTransitionTo(this.masterManifest),u.find((e=>e.id===d))}subscribe(){let{output:e,desiredState:t}=this.params,i=t=>{e.error$.next({id:"HlsLiveProvider",category:M_.WTF,message:"HlsLiveProvider internal logic error",thrown:t})},r=IO(this.video);this.subscription.add((()=>r.destroy()));let n=(e,t)=>this.subscription.add(e.subscribe(t,i));n(r.ended$,e.endedEvent$),n(r.error$,e.error$),n(r.isBuffering$,e.isBuffering$),n(r.currentBuffer$,e.currentBuffer$),n(r.loadedMetadata$,e.firstBytesEvent$),n(r.loadedMetadata$,e.loadedMetadataEvent$),n(r.playing$,e.firstFrameEvent$),n(r.canplay$,e.canplay$),n(r.inPiP$,e.inPiP$),n(r.inFullscreen$,e.inFullscreen$),this.subscription.add(t.isLooped.stateChangeStarted$.subscribe((()=>t.isLooped.setState(!1)),i)),this.subscription.add(uO(this.video,t.volume,r.volumeState$,i)),this.subscription.add(r.volumeState$.subscribe(this.params.output.volume$,i)),this.subscription.add(dO(this.video,t.playbackRate,r.playbackRateState$,i)),n(yC(this.video),e.elementVisible$),this.liveTextManager?(n(this.liveTextManager.getCurrentTime$,this.params.output.getCurrentTime$),n(this.liveTextManager.error$,this.params.output.error$)):this.textTracksManager&&this.textTracksManager.connect(this.video,t,e),this.subscription.add(r.playing$.subscribe((()=>{this.videoState.setState("playing"),JP(t.playbackState,"playing")}),i)).add(r.pause$.subscribe((()=>{this.videoState.setState("paused"),JP(t.playbackState,"paused")}),i)).add(r.canplay$.subscribe((()=>{var e;"ready"===(null==(e=this.videoState.getTransition())?void 0:e.to)&&this.videoState.setState("ready"),"playing"===this.videoState.getState()&&this.playIfAllowed()}),i)),this.liveTextManager&&this.subscription.add(this.liveTextManager.availableTextTracks$.subscribe((e=>{e&&this.params.output.availableTextTracks$.next(e)}))),this.subscription.add(this.maxSeekBackTime$.pipe(E_(),A_((e=>-e/1e3))).subscribe(this.params.output.duration$,i)),this.subscription.add(r.loadedMetadata$.subscribe((()=>{let e=this.params.desiredState.seekState.getState(),t=this.videoState.getTransition(),i=this.params.desiredState.videoTrack.getTransition(),r=this.params.desiredState.autoVideoTrackSwitching.getTransition();if(i&&Tb(i.to)){let e=i.to.id;this.params.desiredState.videoTrack.setState(i.to);let t=this.manifests$.getValue().find((t=>t.id===e));t&&(this.params.output.currentVideoTrack$.next(t),this.params.output.hostname$.next(tC(t.url)))}r&&this.params.desiredState.autoVideoTrackSwitching.setState(r.to),t&&"changing_manifest"===t.from&&this.videoState.setState(t.to),e&&"requested"===e.state&&this.seek(e.position)}),i)),this.subscription.add(r.loadedData$.subscribe((()=>{var e,t,i;let r=null==(i=null==(t=null==(e=this.video)?void 0:e.getStartDate)?void 0:t.call(e))?void 0:i.getTime();this.manifestStartTime$.next(r||void 0)}),i)),this.subscription.add(s_({startTime:this.manifestStartTime$.pipe(v_(Tb)),currentTime:r.timeUpdate$}).subscribe((({startTime:e,currentTime:t})=>this.params.output.liveTime$.next(e+1e3*t)),i)),this.subscription.add(this.manifests$.pipe(A_((e=>e.map((({id:e,quality:t,size:i,bandwidth:r,fps:n})=>({id:e,quality:t,size:i,fps:n,bitrate:r})))))).subscribe(this.params.output.availableVideoTracks$,i));let a=o_(t.playbackState.stateChangeStarted$,t.seekState.stateChangeEnded$,t.videoTrack.stateChangeStarted$,t.autoVideoTrackSwitching.stateChangeStarted$,t.autoVideoTrackLimits.stateChangeStarted$,this.videoState.stateChangeEnded$,this.manifests$,u_(["init"])).pipe(h_(0));this.subscription.add(a.subscribe(this.syncPlayback,i))}destroy(){var e,t;this.subscription.unsubscribe(),null==(e=this.textTracksManager)||e.destroy(),null==(t=this.liveTextManager)||t.destroy(),this.params.output.element$.next(void 0),aO(this.video)}prepare(){var e,t,i;let r=this.selectManifest();if(Eb(r))return;let n=this.params.desiredState.autoVideoTrackLimits.getTransition(),a=this.params.desiredState.autoVideoTrackLimits.getState(),s=new URL(r.url);if((n||a)&&r.id===this.masterManifest.id){let{max:i,min:r}=null!=(t=null!=(e=null==n?void 0:n.to)?e:a)?t:{};for(let[e,t]of[[i,"mq"],[r,"lq"]]){let i=String(parseFloat(e||""));t&&e&&s.searchParams.set(t,i)}}let o="HLS_LIVE_CMAF"===this.params.format?2:0,l=KP(s.toString(),this.liveOffset.getTotalOffset(),o);null==(i=this.liveTextManager)||i.prepare(l),this.video.setAttribute("src",l),this.video.load(),mI(l).then((e=>{var t;if(Eb(e)){let e=null!=(t=this.params.source.maxSeekBackTime)?t:this.maxSeekBackTime$.getValue();(Eb(e)||!isFinite(e))&&IC(l).then((e=>e.text())).then((e=>{var t;let i=null==(t=/#EXT-X-STREAM-INF[^\n]+\n(.+)/m.exec(e))?void 0:t[1];if(i){let e=new URL(i,l).toString();mI(e).then((e=>{Eb(e)||this.maxSeekBackTime$.next(e)}))}})).catch((()=>{}))}else this.maxSeekBackTime$.next(e)}))}playIfAllowed(){aC(this.video,(()=>{this.params.output.soundProhibitedEvent$.next()})).then((e=>{e||(this.videoState.setState("paused"),this.liveOffset.pause(),JP(this.params.desiredState.playbackState,"paused",!0))}),(e=>this.params.output.error$.next({id:"ForcePlay",message:"play() failed even with workarounds",category:M_.DOM,thrown:e})))}seek(e){this.params.output.willSeekEvent$.next();let t=-e,i=t<this.maxSeekBackTime$.getValue()?t:0;this.liveOffset.resetTo(i),this.params.output.position$.next(-i/1e3),this.params.output.seekedEvent$.next()}generateLiveUrl(){let e=KP(this.params.source.url);if(this.params.tuning.useHlsLiveNewTextManager){let t=new URL(e);t.searchParams.set("enable-subtitles","yes"),e=t.toString()}return e}},_I=class{constructor(e){this.subscription=new cb,this.videoState=new ZP("stopped"),this.manifests$=new n_([]),this.syncPlayback=()=>{if(!this.manifests$.getValue().length)return;let e=this.videoState.getState(),t=this.params.desiredState.playbackState.getState(),i=this.params.desiredState.playbackState.getTransition(),r=this.params.desiredState.videoTrack.getTransition(),n=this.params.desiredState.autoVideoTrackSwitching.getTransition(),a=this.params.desiredState.autoVideoTrackLimits.getTransition();if("stopped"===t)return void("stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.video.removeAttribute("src"),this.video.load(),this.params.output.position$.next(0),this.params.output.duration$.next(1/0),this.params.output.currentBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.videoState.setState("stopped"),JP(this.params.desiredState.playbackState,"stopped",!0)));if(this.videoState.getTransition())return;let s=this.params.desiredState.seekState.getState();if("stopped"===e)return this.videoState.startTransitionTo("ready"),void this.prepare();if(r||n||a){let e=this.videoState.getState();this.videoState.setState("changing_manifest"),this.videoState.startTransitionTo(e);let{currentTime:t}=this.video;return this.prepare(),a&&this.params.output.autoVideoTrackLimits$.next(a.to),void("none"===s.state&&this.params.desiredState.seekState.setState({state:"requested",position:1e3*t,forcePrecise:!0}))}switch("paused"!==(null==i?void 0:i.to)&&"requested"===s.state&&this.seek(s.position),e){case"ready":return void("ready"===t?JP(this.params.desiredState.playbackState,"ready"):"paused"===t?(this.videoState.setState("paused"),JP(this.params.desiredState.playbackState,"paused")):"playing"===t&&(this.videoState.startTransitionTo("playing"),this.playIfAllowed()));case"playing":return void("paused"===t?(this.videoState.startTransitionTo("paused"),this.video.paused?this.videoState.setState("paused"):this.video.pause()):"playing"===(null==i?void 0:i.to)&&JP(this.params.desiredState.playbackState,"playing"));case"paused":return void("playing"===t?(this.videoState.startTransitionTo("playing"),this.playIfAllowed()):"paused"===(null==i?void 0:i.to)&&JP(this.params.desiredState.playbackState,"paused"));case"changing_manifest":break;default:return hb(e)}},this.textTracksManager=new pO(e.source.url),this.params=e,this.video=nO(e.container,e.tuning),this.params.output.element$.next(this.video),this.masterManifest={id:"master",quality:Bb.INVARIANT,url:this.params.source.url},this.params.output.isLive$.next(!1),this.params.output.availableVideoTracks$.next([]),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.output.hostname$.next(tC(this.params.source.url)),this.params.output.autoVideoTrackLimitingAvailable$.next(!0),TI(KP(this.params.source.url),this.params.source.url,{manifestRetryInterval:this.params.tuning.manifestRetryInterval,manifestRetryMaxInterval:this.params.tuning.manifestRetryMaxInterval,manifestRetryMaxCount:this.params.tuning.manifestRetryMaxCount}).then((({qualityManifests:e,textTracks:t})=>{this.manifests$.next([this.masterManifest,...e]),this.params.tuning.useNativeHLSTextTracks||this.params.desiredState.internalTextTracks.startTransitionTo(t)}),(e=>this.params.output.error$.next({id:"ExtractHlsQualities",category:M_.NETWORK,message:"Error fetching manifest and extracting qualities",thrown:e}))),this.subscribe()}selectManifest(){var e,t,i,r;let{autoVideoTrackSwitching:n,videoTrack:a}=this.params.desiredState,s=n.getState(),o=a.getTransition(),l=null!=(r=null!=(i=null==(e=null==o?void 0:o.to)?void 0:e.id)?i:null==(t=a.getState())?void 0:t.id)?r:"master",u=this.manifests$.getValue();if(!u.length)return;let d=s?"master":l;return s&&(!o||!o.from)&&a.startTransitionTo(this.masterManifest),u.find((e=>e.id===d))}subscribe(){let{output:e,desiredState:t}=this.params,i=t=>{e.error$.next({id:"HlsProvider",category:M_.WTF,message:"HlsProvider internal logic error",thrown:t})},r=IO(this.video);this.subscription.add((()=>r.destroy()));let n=(e,t)=>this.subscription.add(e.subscribe(t));if(n(r.timeUpdate$,e.position$),n(r.durationChange$,e.duration$),n(r.ended$,e.endedEvent$),n(r.looped$,e.loopedEvent$),n(r.error$,e.error$),n(r.isBuffering$,e.isBuffering$),n(r.currentBuffer$,e.currentBuffer$),n(r.loadedMetadata$,e.firstBytesEvent$),n(r.loadedMetadata$,e.loadedMetadataEvent$),n(r.playing$,e.firstFrameEvent$),n(r.canplay$,e.canplay$),n(r.seeked$,e.seekedEvent$),n(r.inPiP$,e.inPiP$),n(r.inFullscreen$,e.inFullscreen$),n(this.videoState.stateChangeEnded$.pipe(A_((e=>e.to))),this.params.output.playbackState$),this.subscription.add(lO(this.video,t.isLooped,i)),this.subscription.add(uO(this.video,t.volume,r.volumeState$,i)),this.subscription.add(r.volumeState$.subscribe(this.params.output.volume$,i)),this.subscription.add(dO(this.video,t.playbackRate,r.playbackRateState$,i)),this.textTracksManager.connect(this.video,t,e),this.subscription.add(r.playing$.subscribe((()=>{this.videoState.setState("playing"),JP(t.playbackState,"playing")}),i)).add(r.pause$.subscribe((()=>{this.videoState.setState("paused"),JP(t.playbackState,"paused")}),i)).add(r.canplay$.subscribe((()=>{var e;"ready"===(null==(e=this.videoState.getTransition())?void 0:e.to)&&this.videoState.setState("ready"),"playing"===this.videoState.getState()&&this.playIfAllowed()}),i).add(r.loadedMetadata$.subscribe((()=>{var e;let t=this.params.desiredState.seekState.getState(),i=this.videoState.getTransition(),r=this.params.desiredState.videoTrack.getTransition(),n=this.params.desiredState.autoVideoTrackSwitching.getTransition();if(r&&Tb(r.to)){let e=r.to.id;this.params.desiredState.videoTrack.setState(r.to);let t=this.manifests$.getValue().find((t=>t.id===e));t&&(this.params.output.currentVideoTrack$.next(t),this.params.output.hostname$.next(tC(t.url)))}let a=this.params.desiredState.playbackRate.getState();if(a!==(null==(e=this.params.output.element$.getValue())?void 0:e.playbackRate)){let e=this.params.output.element$.getValue();e&&(this.params.desiredState.playbackRate.setState(a),e.playbackRate=a)}n&&this.params.desiredState.autoVideoTrackSwitching.setState(n.to),i&&"changing_manifest"===i.from&&this.videoState.setState(i.to),"requested"===t.state&&this.seek(t.position)}),i))),this.subscription.add(this.manifests$.pipe(A_((e=>e.map((({id:e,quality:t,size:i,bandwidth:r,fps:n})=>({id:e,quality:t,size:i,fps:n,bitrate:r})))))).subscribe(this.params.output.availableVideoTracks$,i)),!LO.device.isIOS||!this.params.tuning.useNativeHLSTextTracks){let{textTracks:e}=this.video;this.subscription.add(o_(d_(e,"addtrack"),d_(e,"removetrack"),d_(e,"change"),u_(["init"])).subscribe((()=>{for(let t=0;t<e.length;t++)e[t].mode="hidden"}),i))}let a=o_(t.playbackState.stateChangeStarted$,t.seekState.stateChangeEnded$,t.videoTrack.stateChangeStarted$,t.autoVideoTrackSwitching.stateChangeStarted$,t.autoVideoTrackLimits.stateChangeStarted$,this.videoState.stateChangeEnded$,this.manifests$,u_(["init"])).pipe(h_(0));this.subscription.add(a.subscribe(this.syncPlayback,i))}destroy(){this.subscription.unsubscribe(),this.textTracksManager.destroy(),this.params.output.element$.next(void 0),aO(this.video)}prepare(){var e,t;let i=this.selectManifest();if(Eb(i))return;let r=this.params.desiredState.autoVideoTrackLimits.getTransition(),n=this.params.desiredState.autoVideoTrackLimits.getState(),a=new URL(i.url);if((r||n)&&i.id===this.masterManifest.id){let{max:i,min:s}=null!=(t=null!=(e=null==r?void 0:r.to)?e:n)?t:{};for(let[e,t]of[[i,"mq"],[s,"lq"]]){let i=String(parseFloat(e||""));t&&e&&a.searchParams.set(t,i)}}this.video.setAttribute("src",a.toString()),this.video.load()}playIfAllowed(){aC(this.video,(()=>{this.params.output.soundProhibitedEvent$.next()})).then((e=>{e||(this.videoState.setState("paused"),JP(this.params.desiredState.playbackState,"paused",!0))}),(e=>this.params.output.error$.next({id:"ForcePlay",message:"play() failed even with workarounds",category:M_.DOM,thrown:e})))}seek(e){this.params.output.willSeekEvent$.next(),this.video.currentTime=e/1e3}},AI=lA(PR(),1),RI=lA(Qw(),1),wI=lA(Jw(),1),PI=class{constructor(e){this.subscription=new cb,this.videoState=new ZP("stopped"),this.trackUrls={},this.textTracksManager=new pO,this.syncPlayback=()=>{let e=this.videoState.getState(),t=this.params.desiredState.playbackState.getState(),i=this.params.desiredState.playbackState.getTransition();if("stopped"===t)return void("stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.video.removeAttribute("src"),this.video.load(),this.params.output.position$.next(0),this.params.output.duration$.next(1/0),this.params.output.currentBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.videoState.setState("stopped"),JP(this.params.desiredState.playbackState,"stopped",!0)));if(this.videoState.getTransition())return;let r=this.params.desiredState.autoVideoTrackLimits.getTransition(),n=this.params.desiredState.videoTrack.getTransition(),a=this.params.desiredState.seekState.getState();if(!r||"ready"===e||n){if("stopped"===e)return this.videoState.startTransitionTo("ready"),void this.prepare();if(n){let{currentTime:e}=this.video;return this.prepare(),void("none"===a.state&&this.params.desiredState.seekState.setState({state:"requested",position:1e3*e,forcePrecise:!0}))}switch("paused"!==(null==i?void 0:i.to)&&"requested"===a.state&&this.seek(a.position),e){case"ready":return void("ready"===t?JP(this.params.desiredState.playbackState,"ready"):"paused"===t?(this.videoState.setState("paused"),JP(this.params.desiredState.playbackState,"paused")):"playing"===t&&(this.videoState.startTransitionTo("playing"),this.playIfAllowed()));case"playing":return void("paused"===t?(this.videoState.startTransitionTo("paused"),this.video.paused?this.videoState.setState("paused"):this.video.pause()):"playing"===(null==i?void 0:i.to)&&JP(this.params.desiredState.playbackState,"playing"));case"paused":return void("playing"===t?(this.videoState.startTransitionTo("playing"),this.playIfAllowed()):"paused"===(null==i?void 0:i.to)&&JP(this.params.desiredState.playbackState,"paused"));default:return hb(e)}}else this.handleQualityLimitTransition(r.to)},this.params=e,this.video=nO(e.container,e.tuning),this.params.output.element$.next(this.video),(0,AI.default)(this.params.source).reverse().forEach((([e,t],i)=>{let r=i.toString(10);this.trackUrls[r]={track:{quality:e,id:r},url:t}})),this.params.output.isLive$.next(!1),this.params.output.availableVideoTracks$.next((0,RI.default)(this.trackUrls).map((({track:e})=>e))),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.desiredState.autoVideoTrackSwitching.setState(!1),this.params.output.autoVideoTrackLimitingAvailable$.next(!0),this.subscribe()}subscribe(){let{output:e,desiredState:t}=this.params,i=t=>{e.error$.next({id:"MpegProvider",category:M_.WTF,message:"MpegProvider internal logic error",thrown:t})},r=IO(this.video);this.subscription.add((()=>r.destroy()));let n=(e,t)=>this.subscription.add(e.subscribe(t,i));n(r.timeUpdate$,e.position$),n(r.durationChange$,e.duration$),n(r.ended$,e.endedEvent$),n(r.looped$,e.loopedEvent$),n(r.error$,e.error$),n(r.isBuffering$,e.isBuffering$),n(r.currentBuffer$,e.currentBuffer$),n(r.loadedMetadata$,e.firstBytesEvent$),n(r.loadedMetadata$,e.loadedMetadataEvent$),n(r.playing$,e.firstFrameEvent$),n(r.canplay$,e.canplay$),n(r.seeked$,e.seekedEvent$),n(r.inPiP$,e.inPiP$),n(r.inFullscreen$,e.inFullscreen$),n(this.videoState.stateChangeEnded$.pipe(A_((e=>e.to))),this.params.output.playbackState$),this.subscription.add(lO(this.video,t.isLooped,i)),this.subscription.add(uO(this.video,t.volume,r.volumeState$,i)),this.subscription.add(r.volumeState$.subscribe(this.params.output.volume$,i)),this.subscription.add(dO(this.video,t.playbackRate,r.playbackRateState$,i)),n(yC(this.video),e.elementVisible$),this.subscription.add(r.playing$.subscribe((()=>{this.videoState.setState("playing"),JP(t.playbackState,"playing")}),i)).add(r.pause$.subscribe((()=>{this.videoState.setState("paused"),JP(t.playbackState,"paused")}),i)).add(r.canplay$.subscribe((()=>{var e,t;"ready"===(null==(e=this.videoState.getTransition())?void 0:e.to)&&this.videoState.setState("ready");let i=this.params.desiredState.videoTrack.getTransition();if(i&&Tb(i.to)){this.params.desiredState.videoTrack.setState(i.to),this.params.output.currentVideoTrack$.next(this.trackUrls[i.to.id].track);let e=this.params.desiredState.playbackRate.getState();if(e!==(null==(t=this.params.output.element$.getValue())?void 0:t.playbackRate)){let t=this.params.output.element$.getValue();t&&(this.params.desiredState.playbackRate.setState(e),t.playbackRate=e)}}"playing"===this.videoState.getState()&&this.playIfAllowed()}),i)),this.textTracksManager.connect(this.video,t,e);let a=o_(t.playbackState.stateChangeStarted$,t.videoTrack.stateChangeStarted$,t.seekState.stateChangeEnded$,t.autoVideoTrackLimits.stateChangeStarted$,this.videoState.stateChangeEnded$,u_(["init"])).pipe(h_(0));this.subscription.add(a.subscribe(this.syncPlayback,i))}destroy(){this.subscription.unsubscribe(),this.textTracksManager.destroy(),this.trackUrls={},this.params.output.element$.next(void 0),aO(this.video)}prepare(){var e;let t=null==(e=this.params.desiredState.videoTrack.getState())?void 0:e.id;yb(t,"MpegProvider: track is not selected");let{url:i}=this.trackUrls[t];yb(i,`MpegProvider: No url for ${t}`),this.params.tuning.requestQuick&&(i=DL(i)),this.video.setAttribute("src",i),this.video.load(),this.params.output.hostname$.next(tC(i))}playIfAllowed(){aC(this.video,(()=>{this.params.output.soundProhibitedEvent$.next()})).then((e=>{e||(this.videoState.setState("paused"),JP(this.params.desiredState.playbackState,"paused",!0))}),(e=>this.params.output.error$.next({id:"ForcePlay",message:"play() failed even with workarounds",category:M_.DOM,thrown:e})))}seek(e){this.params.output.willSeekEvent$.next(),this.video.currentTime=e/1e3}handleQualityLimitTransition(e){var t,i;this.params.output.autoVideoTrackLimits$.next(e);let r=e=>{this.params.output.currentVideoTrack$.next(e),this.params.desiredState.videoTrack.startTransitionTo(e)},n=e=>{let t=eC(o,{container:this.video.getBoundingClientRect(),panelSize:this.params.panelSize,estimatedThroughput:this.params.dependencies.throughputEstimator.throughput$.getValue(),tuning:this.params.tuning.autoTrackSelection,forwardBufferHealth:0,limits:e,abrLogger:this.params.dependencies.abrLogger});r(t)},a=null==(t=this.params.output.currentVideoTrack$.getValue())?void 0:t.quality,s=!(!e.max&&!e.min),o=(0,RI.default)(this.trackUrls).map((e=>e.track));if(!a||!s||jO({limits:e,lowestAvailableQuality:null==(i=(0,wI.default)(o,-1))?void 0:i.quality,highestAvailableQuality:o[0].quality}))return void n();let l=!e.max||qb(a,e.max),u=!e.min||jb(a,e.min);l&&u||n(e)}},OI=["stun:videostun.mycdn.me:80"],CI=()=>null,LI=class{constructor(e,t){this.ws=null,this.peerConnection=null,this.serverUrl="",this.streamKey="",this.stream=null,this.signalingType="JOIN",this.retryCount=0,this.externalStartCallback=CI,this.externalStopCallback=CI,this.externalErrorCallback=CI,this.options=this.normalizeOptions(t);let i=e.split("/");this.serverUrl=i.slice(0,i.length-1).join("/"),this.streamKey=i[i.length-1]}onStart(e){try{this.externalStartCallback=e}catch(e){this.handleSystemError(e)}}onStop(e){try{this.externalStopCallback=e}catch(e){this.handleSystemError(e)}}onError(e){try{this.externalErrorCallback=e}catch(e){this.handleSystemError(e)}}connect(){this.connectWS()}disconnect(){try{this.externalStopCallback(),this.closeConnections()}catch(e){this.handleSystemError(e)}}connectWS(){this.ws||(this.ws=new WebSocket(this.serverUrl),this.ws.onopen=this.onSocketOpen.bind(this),this.ws.onmessage=this.onSocketMessage.bind(this),this.ws.onclose=this.onSocketClose.bind(this),this.ws.onerror=this.onSocketError.bind(this))}onSocketOpen(){this.handleLogin()}onSocketClose(e){try{if(!this.ws)return;this.ws=null,e.code>1e3?(this.retryCount++,this.retryCount>this.options.maxRetryNumber?this.handleNetworkError():this.scheduleRetry()):this.externalStopCallback()}catch(e){this.handleRTCError(e)}}onSocketError(e){try{this.externalErrorCallback(new Error(e.toString()))}catch(e){this.handleRTCError(e)}}onSocketMessage(e){try{let t=this.parseMessage(e.data);switch(t.type){case"JOIN":case"CALL_JOIN":this.handleJoinMessage(t);break;case"UPDATE":this.handleUpdateMessage(t);break;case"STATUS":this.handleStatusMessage(t)}}catch(e){this.handleRTCError(e)}}handleJoinMessage(e){switch(e.inviteType){case"ANSWER":this.handleAnswer(e.sdp);break;case"CANDIDATE":this.handleCandidate(e.candidate)}}handleStatusMessage(e){if("UNPUBLISHED"===e.status)this.handleUnpublished()}async handleUpdateMessage(e){try{let t=await this.createOffer();this.peerConnection&&await this.peerConnection.setLocalDescription(t),this.handleAnswer(e.sdp)}catch(e){this.handleRTCError(e)}}async handleLogin(){try{let e={iceServers:[{urls:OI}]};this.peerConnection=new RTCPeerConnection(e),this.peerConnection.ontrack=this.onPeerConnectionStream.bind(this),this.peerConnection.onicecandidate=this.onPeerConnectionIceCandidate.bind(this),this.peerConnection.oniceconnectionstatechange=this.onPeerConnectionIceConnectionStateChange.bind(this);let t=await this.createOffer();await this.peerConnection.setLocalDescription(t),this.send({type:this.signalingType,inviteType:"OFFER",streamKey:this.streamKey,sdp:t.sdp,callSupport:!1})}catch(e){this.handleRTCError(e)}}async handleAnswer(e){try{this.peerConnection&&await this.peerConnection.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:e}))}catch(e){this.handleRTCError(e)}}async handleCandidate(e){if(e)try{this.peerConnection&&await this.peerConnection.addIceCandidate(e)}catch(e){this.handleRTCError(e)}}handleUnpublished(){try{this.closeConnections(),this.externalStopCallback()}catch(e){this.handleRTCError(e)}}handleSystemError(e){this.options.errorChanel&&this.options.errorChanel.next({id:"webrtc-provider-error",category:M_.WTF,message:e.message})}async onPeerConnectionStream(e){let t=e.streams[0];this.stream&&this.stream.id===t.id||(this.stream=t,this.externalStartCallback(this.stream))}onPeerConnectionIceCandidate(e){e.candidate&&this.send({type:this.signalingType,inviteType:"CANDIDATE",candidate:e.candidate})}onPeerConnectionIceConnectionStateChange(){if(this.peerConnection){let e=this.peerConnection.iceConnectionState;["failed","closed"].indexOf(e)>-1&&(this.retryCount++,this.retryCount>this.options.maxRetryNumber?this.handleNetworkError():(this.closeConnections(),this.scheduleRetry()))}}async createOffer(){if(!this.peerConnection)throw new Error("Can not create offer - no peer connection instance ");let e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0,voiceActivityDetection:!1}),t=e.sdp||"";if(!/^a=rtpmap:\d+ H264\/\d+$/m.test(t))throw new Error("No h264 codec support error");return e}handleRTCError(e){try{this.externalErrorCallback(e||new Error("RTC connection error"))}catch(e){this.handleSystemError(e)}}handleNetworkError(){try{this.externalErrorCallback(new Error("Network error"))}catch(e){this.handleSystemError(e)}}send(e){this.ws&&this.ws.send(JSON.stringify(e))}parseMessage(e){try{return JSON.parse(e)}catch(e){throw new Error("Can not parse socket message")}}closeConnections(){let e=this.ws;e&&(this.ws=null,e.close(1e3)),this.removePeerConnection()}removePeerConnection(){let e=this.peerConnection;e&&(this.peerConnection=null,e.close(),e.ontrack=null,e.onicecandidate=null,e.oniceconnectionstatechange=null,e=null)}scheduleRetry(){this.retryTimeout=setTimeout(this.connectWS.bind(this),1e3)}normalizeOptions(e={}){let t={stunServerList:OI,maxRetryNumber:3,errorChanel:null};return e.stunServerList&&(t.stunServerList=e.stunServerList),e.maxRetryNumber&&e.maxRetryNumber>0&&(t.maxRetryNumber=e.maxRetryNumber),t}},II=class{constructor(e){this.videoState=new ZP("stopped"),this.maxSeekBackTime$=new n_(0),this.syncPlayback=()=>{let e=this.videoState.getState(),t=this.params.desiredState.playbackState.getState(),i=this.params.desiredState.playbackState.getTransition();if("stopped"===t)return void("stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.video.pause(),this.video.srcObject=null,this.params.output.position$.next(0),this.params.output.duration$.next(0),this.params.output.currentBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.videoState.setState("stopped"),JP(this.params.desiredState.playbackState,"stopped",!0)));if(this.videoState.getTransition())return;let r=this.params.desiredState.videoTrack.getTransition();if("stopped"===e)return this.videoState.startTransitionTo("ready"),void this.prepare();if(r)this.prepare();else switch(e){case"ready":return void("paused"===t?(this.videoState.setState("paused"),JP(this.params.desiredState.playbackState,"paused")):"playing"===t&&(this.videoState.startTransitionTo("playing"),this.playIfAllowed()));case"playing":return void("paused"===t?(this.videoState.startTransitionTo("paused"),this.video.paused?this.videoState.setState("paused"):this.video.pause()):"playing"===(null==i?void 0:i.to)&&JP(this.params.desiredState.playbackState,"playing"));case"paused":return void("playing"===t?(this.videoState.startTransitionTo("playing"),this.playIfAllowed()):"paused"===(null==i?void 0:i.to)&&JP(this.params.desiredState.playbackState,"paused"));default:return hb(e)}},this.subscription=new cb,this.params=e,this.log=this.params.dependencies.logger.createComponentLog("WebRTCLiveProvider"),this.video=nO(e.container,e.tuning),this.liveStreamClient=new LI(this.params.source.url,{maxRetryNumber:this.params.tuning.webrtc.connectionRetryMaxNumber,errorChanel:this.params.output.error$}),this.liveStreamClient.onStart(this.onLiveStreamStart.bind(this)),this.liveStreamClient.onStop(this.onLiveStreamStop.bind(this)),this.liveStreamClient.onError(this.onLiveStreamError.bind(this)),this.params.output.availableTextTracks$.next([]),this.params.desiredState.internalTextTracks.setState([]),this.subscribe()}destroy(){this.subscription.unsubscribe(),this.liveStreamClient.disconnect(),this.params.output.element$.next(void 0),aO(this.video)}subscribe(){let{output:e,desiredState:t}=this.params,i=t=>{e.error$.next({id:"WebRTCLiveProvider",category:M_.WTF,message:"WebRTCLiveProvider internal logic error",thrown:t})};this.subscription.add(o_(this.videoState.stateChangeStarted$.pipe(A_((e=>({transition:e,type:"start"})))),this.videoState.stateChangeEnded$.pipe(A_((e=>({transition:e,type:"end"}))))).subscribe((({transition:e,type:t})=>{this.log({message:`[videoState change] ${t}: ${JSON.stringify(e)}`})})));let r=IO(this.video);this.subscription.add((()=>r.destroy()));let n=(e,t)=>this.subscription.add(e.subscribe(t,i));n(r.timeUpdate$,e.liveTime$),n(r.ended$,e.endedEvent$),n(r.looped$,e.loopedEvent$),n(r.error$,e.error$),n(r.isBuffering$,e.isBuffering$),n(r.currentBuffer$,e.currentBuffer$),n(yC(this.video),this.params.output.elementVisible$),this.subscription.add(r.durationChange$.subscribe((t=>{e.duration$.next(t===1/0?0:t)}))).add(r.canplay$.subscribe((()=>{var e;"ready"===(null==(e=this.videoState.getTransition())?void 0:e.to)&&this.videoState.setState("ready")}),i)).add(r.pause$.subscribe((()=>{this.videoState.setState("paused")}),i)).add(r.playing$.subscribe((()=>{this.videoState.setState("playing")}),i)).add(r.error$.subscribe(e.error$)).add(this.maxSeekBackTime$.subscribe(this.params.output.duration$)).add(uO(this.video,t.volume,r.volumeState$,i)).add(r.volumeState$.subscribe(e.volume$,i)).add(this.videoState.stateChangeEnded$.subscribe((i=>{switch(i.to){case"stopped":e.position$.next(0),e.duration$.next(0),t.playbackState.setState("stopped");break;case"ready":break;case"paused":t.playbackState.setState("paused");break;case"playing":t.playbackState.setState("playing");break;default:return hb(i.to)}}),i)).add(o_(t.playbackState.stateChangeStarted$,this.videoState.stateChangeEnded$,u_(["init"])).pipe(h_(0)).subscribe(this.syncPlayback.bind(this),i)),this.subscription.add(t.isLooped.stateChangeStarted$.subscribe((()=>t.isLooped.setState(!1)),i)),this.subscription.add(t.autoVideoTrackSwitching.stateChangeStarted$.subscribe((()=>t.autoVideoTrackSwitching.setState(!1)),i))}onLiveStreamStart(e){this.params.output.element$.next(this.video),this.params.output.duration$.next(0),this.params.output.position$.next(0),this.params.output.isLive$.next(!0),this.params.output.canChangePlaybackSpeed$.next(!1),this.params.output.hostname$.next(tC(this.params.source.url)),this.params.output.autoVideoTrackLimitingAvailable$.next(!1),this.params.output.availableVideoTracks$.next([]),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.output.currentVideoTrack$.next({id:"webrtc",quality:Bb.INVARIANT}),this.video.srcObject=e,JP(this.params.desiredState.playbackState,"playing")}onLiveStreamStop(){this.videoState.startTransitionTo("stopped"),this.syncPlayback(),this.params.output.position$.next(0),this.params.output.duration$.next(0),this.params.output.currentBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.params.output.endedEvent$.next()}onLiveStreamError(e){this.onLiveStreamStop(),this.params.output.error$.next({id:"WebRTC stream runtime error",category:M_.EXTERNAL_API,message:e.message,thrown:e})}playIfAllowed(){aC(this.video,(()=>{this.params.output.soundProhibitedEvent$.next()})).then((e=>{e||(this.videoState.setState("paused"),JP(this.params.desiredState.playbackState,"paused",!0))}),(e=>this.params.output.error$.next({id:"ForcePlay",message:"play() failed even with workarounds",category:M_.DOM,thrown:e})))}prepare(){this.liveStreamClient.connect()}},xI=class{constructor(e){this.iterator=e[Symbol.iterator](),this.next()}next(){this.current=this.iterator.next()}getValue(){if(this.current.done)throw new Error("Iterable is completed");return this.current.value}isCompleted(){return!!this.current.done}};var MI=class e{constructor(e,t,i,r){this.providerOutput=e,this.provider$=t,this.volumeMultiplierError$=i,this.volumeMultiplier=r,this.destroyController=new xC,this.subscriptions=new cb,this.audioContext=null,this.gainNode=null,this.mediaElementSource=null,this.subscriptions.add(this.provider$.pipe(v_((e=>!!e.type)),P_()).subscribe((({type:e})=>this.subscribe(e))))}subscribe(e){LO.browser.isSafari&&"MPEG"!==e||this.subscriptions.add(s_({video:this.providerOutput.element$,playbackState:this.providerOutput.playbackState$,volume:this.providerOutput.volume$}).pipe(v_((({playbackState:e,video:t,volume:{muted:i,volume:r}})=>"playing"===e&&!!t&&!i&&!!r)),P_()).subscribe((({video:e})=>{this.initAudioContextOnce(e).then((e=>{e||this.destroy()})).catch((e=>{this.handleError(e),this.destroy()}))})))}static isSupported(){return"AudioContext"in window&&"GainNode"in window&&"MediaElementAudioSourceNode"in window}async initAudioContextOnce(e){let{volumeMultiplier:t}=this,i=new(window.AudioContext||window.webkitAudioContext);this.audioContext=i;let r=i.createGain();if(this.gainNode=r,r.gain.value=t,r.connect(i.destination),"suspended"===i.state&&(await i.resume(),this.destroyController.signal.aborted))return!1;let n=i.createMediaElementSource(e);return this.mediaElementSource=n,n.connect(r),!0}cleanup(){this.mediaElementSource&&(this.mediaElementSource.disconnect(),this.mediaElementSource=null),this.gainNode&&(this.gainNode.disconnect(),this.gainNode=null),this.audioContext&&("closed"!==this.audioContext.state&&this.audioContext.close(),this.audioContext=null)}destroy(){this.destroyController.abort(),this.subscriptions.unsubscribe(),this.cleanup()}handleError(t){var i;this.volumeMultiplierError$.next({id:e.errorId,category:M_.VIDEO_PIPELINE,message:null!=(i=null==t?void 0:t.message)?i:`${e.errorId} exception`,thrown:t})}};MI.errorId="VolumeMultiplierManager";var NI,DI,kI,$I=MI,VI={chunkDuration:5e3,maxParallelRequests:5},UI=class{constructor(e){this.current$=new n_({type:void 0}),this.providerError$=new mb,this.noAvailableProvidersError$=new mb,this.volumeMultiplierError$=new mb,this.providerOutput={position$:new n_(0),duration$:new n_(1/0),volume$:new n_({muted:!1,volume:1}),availableVideoStreams$:new n_([]),currentVideoStream$:new n_(void 0),availableVideoTracks$:new n_([]),currentVideoTrack$:new n_(void 0),availableAudioStreams$:new n_([]),currentAudioStream$:new n_(void 0),availableAudioTracks$:new n_([]),currentVideoSegmentLength$:new n_(0),currentAudioSegmentLength$:new n_(0),isAudioAvailable$:new n_(!0),autoVideoTrackLimitingAvailable$:new n_(!1),autoVideoTrackLimits$:new n_(void 0),currentBuffer$:new n_(void 0),isBuffering$:new n_(!0),error$:new mb,fetcherError$:new mb,fetcherRecoverableError$:new mb,warning$:new mb,willSeekEvent$:new mb,soundProhibitedEvent$:new mb,seekedEvent$:new mb,loopedEvent$:new mb,endedEvent$:new mb,firstBytesEvent$:new mb,loadedMetadataEvent$:new mb,firstFrameEvent$:new mb,canplay$:new mb,isLive$:new n_(void 0),isLiveEnded$:new n_(null),isLowLatency$:new n_(!1),canChangePlaybackSpeed$:new n_(!0),liveTime$:new n_(void 0),liveBufferTime$:new n_(void 0),liveLatency$:new n_(void 0),severeStallOccurred$:new mb,availableTextTracks$:new n_([]),currentTextTrack$:new n_(void 0),hostname$:new n_(void 0),httpConnectionType$:new n_(void 0),httpConnectionReused$:new n_(void 0),inPiP$:new n_(!1),inFullscreen$:new n_(!1),element$:new n_(void 0),elementVisible$:new n_(!0),availableSources$:new n_(void 0),is3DVideo$:new n_(!1),playbackState$:new n_(""),getCurrentTime$:new n_(null)},this.subscription=new cb,this.volumeMultiplierManager=null,this.params=e,this.log=this.params.dependencies.logger.createComponentLog("ProviderContainer"),this.tracer=e.dependencies.tracer.createComponentTracer(this.constructor.name);let t=((e,{useHlsJs:t,useManagedMediaSource:i,useOldMSEDetection:r})=>{let{containers:n,protocols:a,codecs:s,nativeHlsSupported:o}=LO.video,l=(s.h264||s.h265)&&s.aac,u=a.mse&&(!r||!!window.MediaStreamTrack)||a.mms&&i;return e.filter((e=>{switch(e){case"DASH_SEP":case"DASH_LIVE":case"DASH_ONDEMAND":return u&&n.mp4&&l;case"DASH_WEBM":return u&&n.webm&&s.vp9&&s.opus;case"DASH_WEBM_AV1":return u&&n.webm&&s.av1&&s.opus;case"DASH_STREAMS":return u&&(n.mp4&&l||n.webm&&(s.vp9||s.av1)&&(s.opus||s.aac));case"DASH_LIVE_CMAF":return u&&n.mp4&&l&&n.cmaf;case"HLS":case"HLS_ONDEMAND":return o||t&&u&&n.mp4&&l;case"HLS_LIVE":case"HLS_LIVE_CMAF":return o;case"MPEG":return n.mp4;case"DASH":case"DASH_LIVE_WEBM":return!1;case"WEB_RTC_LIVE":return a.webrtc&&a.ws&&s.h264&&(n.mp4||n.webm);default:return hb(e)}}))})([...KL(this.params.tuning),...YL(this.params.tuning)],this.params.tuning).filter((t=>Tb(e.sources[t]))),{forceFormat:i,formatsToAvoid:r}=this.params.tuning,n=[];n=i?[i]:r.length?[...t.filter((e=>!(0,zP.default)(r,e))),...t.filter((e=>(0,zP.default)(r,e)))]:t,this.log({message:`Selected formats: ${n.join(" > ")}`}),this.tracer.log("Selected formats",e_(n)),this.screenFormatsIterator=new xI(n);let a=[...XL(!0),...XL(!1)];this.chromecastFormatsIterator=new xI(a.filter((t=>Tb(e.sources[t])))),this.providerOutput.availableSources$.next(e.sources);let{volumeMultiplier:s=1,tuning:{useVolumeMultiplier:o}}=this.params;o&&1!==s&&$I.isSupported()&&(this.volumeMultiplierManager=new $I(this.providerOutput,this.current$,this.volumeMultiplierError$,s))}init(){this.subscription.add(this.initProviderErrorHandling()),this.subscription.add(this.params.dependencies.chromecastInitializer.connection$.subscribe((()=>{this.reinitProvider()})))}destroy(){var e;this.destroyProvider(),this.current$.next({type:void 0}),this.subscription.unsubscribe(),null==(e=this.volumeMultiplierManager)||e.destroy(),this.volumeMultiplierManager=null,this.tracer.end()}initProvider(){let e,t=this.chooseDestination(),i=this.chooseFormat(t);if(Eb(i))this.handleNoFormatsError(t);else{try{e=this.createProvider(t,i)}catch(e){this.providerError$.next({id:"ProviderNotConstructed",category:M_.WTF,message:"Failed to create provider",thrown:e})}e?this.current$.next({type:i,provider:e,destination:t}):this.current$.next({type:void 0})}}reinitProvider(){this.tracer.log("reinitProvider"),this.destroyProvider(),this.initProvider()}switchToNextProvider(e){this.tracer.log("switchToNextProvider",{destination:e}),this.destroyProvider(),this.failoverIndex=void 0,this.skipFormat(e),this.initProvider()}destroyProvider(){let e=this.current$.getValue().provider;if(!e)return;this.log({message:"destroyProvider"}),this.tracer.log("destroyProvider");let t=1e3*this.providerOutput.position$.getValue(),i=this.params.desiredState.seekState.getState(),r="none"!==i.state;if(this.params.desiredState.seekState.setState({state:"requested",position:r?i.position:t,forcePrecise:!!r&&i.forcePrecise}),e.scene3D){let t=e.scene3D.getCameraRotation();this.params.desiredState.cameraOrientation.setState({x:t.x,y:t.y})}e.destroy();let n=this.providerOutput.isBuffering$;n.getValue()||n.next(!0)}createProvider(e,t){switch(this.log({message:`createProvider: ${e}:${t}`}),this.tracer.log("createProvider",{destination:e,format:t}),e){case"SCREEN":return this.createScreenProvider(t);case"CHROMECAST":return this.createChromecastProvider(t);default:return hb(e)}}createScreenProvider(e){let{sources:t,container:i,desiredState:r,panelSize:n}=this.params,a=this.providerOutput,s={container:i,source:null,desiredState:r,output:a,dependencies:this.params.dependencies,tuning:this.params.tuning,panelSize:n};switch(e){case"DASH_SEP":case"DASH_WEBM":case"DASH_WEBM_AV1":case"DASH_ONDEMAND":case"DASH_STREAMS":{let i=this.applyFailoverHost(t[e]),r=this.applyFailoverHost(t.HLS_ONDEMAND||t.HLS);return yb(i),new lI({...s,source:i,sourceHls:r})}case"DASH_LIVE_CMAF":{let i=this.applyFailoverHost(t[e]);return yb(i),new uI({...s,source:i})}case"HLS":case"HLS_ONDEMAND":{let i=this.applyFailoverHost(t[e]);return yb(i),LO.video.nativeHlsSupported||!this.params.tuning.useHlsJs?new _I({...s,source:i}):new pI({...s,source:i})}case"HLS_LIVE":case"HLS_LIVE_CMAF":{let i=this.applyFailoverHost(t[e]);return yb(i),new bI({...s,source:i,config:{maxPausedTime:this.params.tuning.live.maxPausedTime},format:e})}case"MPEG":{let i=this.applyFailoverHost(t[e]);return yb(i),new PI({...s,source:i})}case"DASH_LIVE":{let i=this.applyFailoverHost(t[e]);return yb(i),new bC({...s,source:i,config:{...VI,maxPausedTime:this.params.tuning.live.maxPausedTime}})}case"WEB_RTC_LIVE":{let n=this.applyFailoverHost(t[e]);return yb(n),new II({container:i,source:n,desiredState:r,output:a,dependencies:this.params.dependencies,tuning:this.params.tuning})}case"DASH":case"DASH_LIVE_WEBM":throw new Error(`${e} is no longer supported`);default:return hb(e)}}createChromecastProvider(e){let{sources:t,container:i,desiredState:r,meta:n}=this.params,a=this.providerOutput,s=this.params.dependencies.chromecastInitializer.connection$.getValue();return yb(s),new eO({connection:s,meta:n,container:i,source:t,format:e,desiredState:r,output:a,dependencies:this.params.dependencies,tuning:this.params.tuning})}chooseDestination(){return this.params.dependencies.chromecastInitializer.connection$.getValue()?"CHROMECAST":"SCREEN"}chooseFormat(e){switch(e){case"SCREEN":return this.screenFormatsIterator.isCompleted()?void 0:this.screenFormatsIterator.getValue();case"CHROMECAST":return this.chromecastFormatsIterator.isCompleted()?void 0:this.chromecastFormatsIterator.getValue();default:return hb(e)}}skipFormat(e){switch(e){case"SCREEN":return this.screenFormatsIterator.next();case"CHROMECAST":return this.chromecastFormatsIterator.next();default:return hb(e)}}handleNoFormatsError(e){switch(e){case"SCREEN":return this.noAvailableProvidersError$.next(this.params.tuning.forceFormat),void this.current$.next({type:void 0});case"CHROMECAST":return void this.params.dependencies.chromecastInitializer.disconnect();default:return hb(e)}}applyFailoverHost(e){if(void 0===this.failoverIndex)return e;let t=this.params.failoverHosts[this.failoverIndex];if(!t)return e;let i=e=>{let i=new URL(e);return i.host=t,i.toString()};if(void 0===e)return e;if("type"in e){if("raw"===e.type)return e;if("url"===e.type)return{...e,url:i(e.url)}}return(0,QP.default)((0,WP.default)(e).map((([e,t])=>[e,i(t)])))}initProviderErrorHandling(){let e=new cb,t=!1,i=0;return e.add(o_(this.providerOutput.error$.pipe(v_((e=>!this.params.tuning.ignoreAudioRendererError||!e.message||!/AUDIO_RENDERER_ERROR/gi.test(e.message)))),(r={desiredPlaybackState$:this.params.desiredState.playbackState,maxTransitionInterval:this.params.tuning.maxPlaybackTransitionInterval,position$:this.providerOutput.position$,providerChanged$:this.current$},new fb((e=>{let t=new cb,i=r.desiredPlaybackState$.stateChangeStarted$.pipe(A_((({from:e,to:t})=>`${e}-${t}`))),n=r.desiredPlaybackState$.stateChangeEnded$,a=r.providerChanged$.pipe(A_((({type:e})=>void 0!==e))),s=new mb,o=0,l="unknown";return t.add(i.subscribe((e=>{o&&window.clearTimeout(o),l=e,o=window.setTimeout((()=>s.next(e)),r.maxTransitionInterval)}))),t.add(n.subscribe((()=>{window.clearTimeout(o),l="unknown",o=0}))),t.add(a.subscribe((e=>{o&&(window.clearTimeout(o),o=0,e&&(o=window.setTimeout((()=>s.next(l)),r.maxTransitionInterval)))}))),t.add(s.subscribe(e)),()=>{window.clearTimeout(o),t.unsubscribe()}}))).pipe(A_((e=>({id:`ProviderHangup:${e}`,category:M_.WTF,message:`A ${e} transition failed to complete within reasonable time`}))))).subscribe(this.providerError$)),e.add(this.providerOutput.fetcherError$.subscribe(this.providerError$)),e.add(this.current$.subscribe((()=>{t=!1;let i=this.params.desiredState.playbackState.transitionEnded$.pipe(v_((({to:e})=>"playing"===e)),P_()).subscribe((()=>t=!0));e.add(i)}))),e.add(this.providerError$.subscribe((e=>{let r=this.current$.getValue().destination,n={error:e,currentDestination:r};if("CHROMECAST"===r)this.destroyProvider(),this.params.dependencies.chromecastInitializer.stopMedia().then((()=>this.switchToNextProvider("SCREEN")),(()=>this.params.dependencies.chromecastInitializer.disconnect()));else{let a=e.category===M_.NETWORK,s=e.category===M_.FATAL,o=this.params.failoverHosts.length>0&&(void 0===this.failoverIndex||this.failoverIndex<this.params.failoverHosts.length-1),l=i<this.params.tuning.providerErrorLimit&&!s,u=o&&!s&&(a&&t||!l);n={...n,isNetworkError:a,isFatalError:s,haveFailoverHost:o,tryFailover:u,canReinitProvider:l},l?(i++,this.reinitProvider()):u?(this.failoverIndex=void 0===this.failoverIndex?0:this.failoverIndex+1,this.reinitProvider()):(i=0,this.switchToNextProvider(null!=r?r:"SCREEN"))}this.tracer.error("providerError",e_(n))}))),e;var r}},BI="one_video_throughput",FI="one_video_rtt",HI=window.navigator.connection,jI=()=>{let e=null==HI?void 0:HI.downlink;if(Tb(e)&&10!==e)return 1e3*e},GI=()=>{let e=null==HI?void 0:HI.rtt;if(Tb(e)&&3e3!==e)return e},qI=(e,t,i)=>{let r=8*i;return r/(r/e+t)},zI=class e{constructor(t){var i,r;this.subscription=new cb,this.concurrentDownloads=new Set,this.tuningConfig=t;let n=e.load(BI)||(t.useBrowserEstimation?jI():void 0)||5e3,a=null!=(r=null!=(i=e.load(FI))?i:t.useBrowserEstimation?GI():void 0)?r:0;if(this.throughput$=new n_(n),this.rtt$=new n_(a),this.rttAdjustedThroughput$=new n_(qI(n,a,t.rttPenaltyRequestSize)),this.throughput=GL.getSmoothedValue(n,-1,t),this.rtt=GL.getSmoothedValue(a,1,t),t.useBrowserEstimation){let e=()=>{let e=jI();e&&this.throughput.next(e);let t=GI();Tb(t)&&this.rtt.next(t)};HI&&"onchange"in HI&&this.subscription.add(d_(HI,"change").subscribe(e)),e()}this.subscription.add(this.throughput.smoothed$.subscribe((e=>{Pb.set(BI,e.toFixed(0))}))),this.subscription.add(this.rtt.smoothed$.subscribe((e=>{Pb.set(FI,e.toFixed(0))}))),this.subscription.add(this.throughput.debounced$.subscribe(this.throughput$)),this.subscription.add(this.rtt.debounced$.subscribe(this.rtt$)),this.subscription.add(s_({throughput:this.throughput.smoothed$,rtt:this.rtt.smoothed$}).pipe(A_((({throughput:e,rtt:i})=>qI(e,i,t.rttPenaltyRequestSize))),v_((e=>{let i=this.rttAdjustedThroughput$.getValue()||0;return Math.abs(e-i)/i>=t.changeThreshold}))).subscribe(this.rttAdjustedThroughput$))}destroy(){this.concurrentDownloads.clear(),this.subscription.unsubscribe()}trackXHR(e){let t=0,i=Ab(),r=new cb;switch(this.subscription.add(r),this.concurrentDownloads.add(e),e.readyState){case 4:break;case 3:case 2:r.add(d_(e,"progress").pipe(P_()).subscribe((e=>{t=e.loaded,i=Ab()})));break;case 1:case 0:r.add(d_(e,"loadstart").subscribe((()=>{t=0,i=Ab()})))}r.add(d_(e,"loadend").subscribe((n=>{if(200===e.status){let e=n.loaded,r=Ab(),a=e-t,s=r-i;this.addRawSpeed(a,s,1)}this.concurrentDownloads.delete(e),r.unsubscribe()})))}trackStream(e,t=!1){let i=e.getReader();if(!i)return void e.cancel("Could not get reader");let r=0,n=Ab(),a=0,s=Ab(),o=t=>{this.concurrentDownloads.delete(e),i.releaseLock(),e.cancel(`Throughput Estimator error: ${t}`).catch((()=>{}))},l=async({done:u,value:d})=>{if(u)!t&&this.addRawSpeed(r,Ab()-n,1),this.concurrentDownloads.delete(e);else if(d){if(t){let e=Ab();if(e-s>this.tuningConfig.lowLatency.continuesByteSequenceInterval||e-n>this.tuningConfig.lowLatency.maxLastEvaluationTimeout){let e=s-n;e&&this.addRawSpeed(a,e,1,t),a=d.byteLength,n=Ab()}else a+=d.byteLength;s=Ab()}else r+=d.byteLength,a+=d.byteLength,a>=this.tuningConfig.streamMinSampleSize&&Ab()-s>=this.tuningConfig.streamMinSampleTime&&(this.addRawSpeed(a,Ab()-s,this.concurrentDownloads.size),a=0,s=Ab());await(null==i?void 0:i.read().then(l,o))}};this.concurrentDownloads.add(e),null==i||i.read().then(l,o)}addRawSpeed(t,i,r=1,n=!1){if(e.sanityCheck(t,i,n)){let e=8*t/i;this.throughput.next(e*r)}}addRawThroughput(e){this.throughput.next(e)}addRawRtt(e){this.rtt.next(e)}static sanityCheck(e,t,i=!1){let r=8*e/t;return!(!r||!isFinite(r)||r>1e6||r<30||i&&e<1e4||!i&&e<10240||!i&&t<=20)}static load(e){var t;let i=Pb.get(e);if(Tb(i))return null!=(t=parseInt(i,10))?t:void 0}},WI={configName:["core"],throughputEstimator:{type:"EmaAndMa",emaAlphaSlow:.2,emaAlphaFast:.7,emaAlpha:.45,basisTrendChangeCount:10,changeThreshold:.05,useBrowserEstimation:!0,rttPenaltyRequestSize:1048576,streamMinSampleSize:10240,streamMinSampleTime:300,deviationDepth:20,deviationFactor:.5,lowLatency:{continuesByteSequenceInterval:50,maxLastEvaluationTimeout:300}},autoTrackSelection:{bitrateFactorAtEmptyBuffer:2.8,bitrateAudioFactorAtEmptyBuffer:10,bitrateFactorAtFullBuffer:2,bitrateAudioFactorAtFullBuffer:7,minVideoAudioRatio:5,minAvailableThroughputAudioRatio:5,usePixelRatio:!0,pixelRatioMultiplier:void 0,pixelRatioLogBase:3,pixelRatioLogCoefficients:[1,0,1],limitByContainer:!0,containerSizeFactor:1.3,lazyQualitySwitch:!0,minBufferToSwitchUp:.4,considerPlaybackRate:!1,trackCooldownIncreaseQuality:15e3,trackCooldownDecreaseQuality:3e3,backgroundVideoQualityLimit:Bb.Q_4320P,activeVideoAreaThreshold:.1,highQualityLimit:Bb.Q_720P,trafficSavingLimit:Bb.Q_480P},droppedFramesChecker:{enabled:!1,percentLimit:.1,checkTime:1e3,countLimit:3,tickCountAfterQualityChange:5,qualityUpWaitingTime:5e3,minQualityBanLimit:Bb.Q_480P},dash:{forwardBufferTarget:6e4,forwardBufferTargetAuto:6e4,forwardBufferTargetManual:3e5,forwardBufferTargetPreload:5e3,seekBiasInTheEnd:2e3,maxSegmentDurationLeftToSelectNextSegment:3e3,minSafeBufferThreshold:.5,bufferPruningSafeZone:1e3,segmentRequestSize:1048576,representationSwitchForwardBufferGap:3e3,crashOnStallTimeout:25e3,crashOnStallTWithoutDataTimeout:5e3,enableSubSegmentBufferFeeding:!0,bufferEmptinessTolerance:100,useFetchPriorityHints:!0,qualityLimitsOnStall:{stallDurationNoDataBeforeQualityDecrease:500,stallDurationToBeCount:100,stallCountBeforeQualityDecrease:3,resetQualityRestrictionTimeout:1e4,ignoreStallsOnSeek:!1},enableBaseUrlSupport:!0,maxSegmentRetryCount:5,sourceOpenTimeout:1e3,rejectOnSourceOpenTimeout:!1},dashCmafLive:{maxActiveLiveOffset:1e4,normalizedTargetMinBufferSize:6e4,normalizedLiveMinBufferSize:5e3,normalizedActualBufferOffset:1e4,offsetCalculationError:3e3,maxLiveDuration:7200,lowLatency:{maxTargetOffset:3e3,maxTargetOffsetDeviation:250,playbackCatchupSpeedup:.05,isActiveOnDefault:!1,bufferEstimator:{emaAlpha:.45,changeThreshold:.05,deviationDepth:20,deviationFactor:.5,extremumInterval:5}}},live:{minBuffer:3e3,minBufferSegments:3,lowLatencyMinBuffer:1e3,lowLatencyMinBufferSegments:1,isLiveCatchUpMode:!1,lowLatencyActiveLiveDelay:3e3,activeLiveDelay:5e3,maxPausedTime:5e3},downloadBackoff:{bufferThreshold:100,start:100,factor:2,max:3e3,random:.1},enableWakeLock:!0,enableTelemetryAtStart:!1,forceFormat:void 0,formatsToAvoid:[],disableChromecast:!1,chromecastReceiverId:"07A4434E",useWebmBigRequest:!1,webmCodec:"vp9",androidPreferredFormat:"dash",preferCMAF:!1,preferWebRTC:!1,preferMultiStream:!1,preferHDR:!1,bigRequestMinInitSize:51200,bigRequestMinDataSize:1048576,stripRangeHeader:!0,flushShortLoopedBuffers:!0,insufficientBufferRuleMargin:1e4,seekNearDurationBias:1,dashSeekInSegmentDurationThreshold:18e4,dashSeekInSegmentAlwaysSeekDelta:1e4,endGapTolerance:300,stallIgnoreThreshold:33,gapWatchdogInterval:50,requestQuick:!1,useHlsJs:!1,useNativeHLSTextTracks:!1,useManagedMediaSource:!0,useNewSwitchTo:!1,useSafariEndlessRequestBugfix:!0,useRefactoredSearchGap:!1,isAudioDisabled:!1,autoplayOnlyInActiveTab:!0,dynamicImportTimeout:5e3,maxPlaybackTransitionInterval:2e4,providerErrorLimit:3,manifestRetryInterval:300,manifestRetryMaxInterval:1e4,manifestRetryMaxCount:10,audioVideoSyncRate:20,webrtc:{connectionRetryMaxNumber:3},spherical:{enabled:!1,fov:{x:135,y:76},rotationSpeed:45,maxYawAngle:175,rotationSpeedCorrection:10,degreeToPixelCorrection:5,speedFadeTime:2e3,speedFadeThreshold:50},useVolumeMultiplier:!1,ignoreAudioRendererError:!1,useEnableSubtitlesParam:!1,useOldMSEDetection:!1,useHlsLiveNewTextManager:!1,exposeInternalsToGlobal:!1,hlsLiveNewTextManagerDownloadThreshold:4e3,disableYandexPiP:!1,asyncResolveClientChecker:!1,autostartOnlyIfVisible:!1},QI=({seekState:e,position$:t})=>o_(e.stateChangeEnded$.pipe(A_((({to:e})=>{var t;return"none"===e.state?void 0:(null!=(t=e.position)?t:NaN)/1e3})),v_(Tb)),t.pipe(v_((()=>"none"===e.getState().state)))),YI=class{constructor(e={configName:[]},t=Sb.createRootTracer(!1)){if(this.subscription=new cb,this.logger=new gb,this.abrLogger=this.logger.createComponentLog("ABR"),this.internalsExposure=null,this.isPlaybackStarted=!1,this.hasLiveOffsetByPaused=new n_(!1),this.hasLiveOffsetByPausedTimer=0,this.playerInitRequest=0,this.playerInited=new n_(!1),this.wasSetStartedQuality=!1,this.desiredState={playbackState:new ZP("stopped"),seekState:new ZP({state:"none"}),volume:new ZP({volume:1,muted:!1}),videoTrack:new ZP(void 0),videoStream:new ZP(void 0),audioStream:new ZP(void 0),autoVideoTrackSwitching:new ZP(!0),autoVideoTrackLimits:new ZP({}),isLooped:new ZP(!1),isLowLatency:new ZP(!1),playbackRate:new ZP(1),externalTextTracks:new ZP([]),internalTextTracks:new ZP([]),currentTextTrack:new ZP(void 0),textTrackCuesSettings:new ZP({}),cameraOrientation:new ZP({x:0,y:0})},this.info={playbackState$:new n_(void 0),position$:new n_(0),duration$:new n_(1/0),muted$:new n_(!1),volume$:new n_(1),availableVideoStreams$:new n_([]),currentVideoStream$:new n_(void 0),availableQualities$:new n_([]),availableQualitiesFps$:new n_({}),currentQuality$:new n_(void 0),isAutoQualityEnabled$:new n_(!0),autoQualityLimitingAvailable$:new n_(!1),autoQualityLimits$:new n_({}),predefinedQualityLimitType$:new n_("unknown"),availableAudioStreams$:new n_([]),currentAudioStream$:new n_(void 0),availableAudioTracks$:new n_([]),isAudioAvailable$:new n_(!0),currentPlaybackRate$:new n_(1),currentBuffer$:new n_({start:0,end:0}),isBuffering$:new n_(!0),isStalled$:new n_(!1),isEnded$:new n_(!1),isLooped$:new n_(!1),isLive$:new n_(void 0),isLiveEnded$:new n_(null),canChangePlaybackSpeed$:new n_(void 0),atLiveEdge$:new n_(void 0),atLiveDurationEdge$:new n_(void 0),liveTime$:new n_(void 0),liveBufferTime$:new n_(void 0),liveLatency$:new n_(void 0),currentFormat$:new n_(void 0),availableTextTracks$:new n_([]),currentTextTrack$:new n_(void 0),throughputEstimation$:new n_(void 0),rttEstimation$:new n_(void 0),videoBitrate$:new n_(void 0),hostname$:new n_(void 0),httpConnectionType$:new n_(void 0),httpConnectionReused$:new n_(void 0),surface$:new n_("none"),chromecastState$:new n_("NOT_AVAILABLE"),chromecastDeviceName$:new n_(void 0),intrinsicVideoSize$:new n_(void 0),availableSources$:new n_(void 0),is3DVideo$:new n_(!1),currentVideoSegmentLength$:new n_(0),currentAudioSegmentLength$:new n_(0)},this.events={inited$:new mb,ready$:new mb,started$:new mb,playing$:new mb,paused$:new mb,stopped$:new mb,willStart$:new mb,willResume$:new mb,willPause$:new mb,willStop$:new mb,willDestruct$:new mb,watchCoverageRecord$:new mb,watchCoverageLive$:new mb,managedError$:new mb,fatalError$:new mb,fetcherRecoverableError$:new mb,ended$:new mb,looped$:new mb,seeked$:new mb,willSeek$:new mb,autoplaySoundProhibited$:new mb,firstBytes$:new mb,loadedMetadata$:new mb,firstFrame$:new mb,canplay$:new mb,log$:new mb,fetcherError$:new mb,severeStallOccured$:new mb},this.experimental={element$:new n_(void 0),tuningConfigName$:new n_([]),enableDebugTelemetry$:new n_(!1),dumpTelemetry:VO,getCurrentTime$:new n_(null)},this.initLogs(),this.tuning=(e=>{var t;return{...Xb(e,WI),configName:[...null!=(t=e.configName)?t:[],...WI.configName]}})(e),this.tracer=t,this.experimental.tuningConfigName$.next(this.tuning.configName),this.chromecastInitializer=new GP({receiverApplicationId:e.chromecastReceiverId,isDisabled:e.disableChromecast,dependencies:{logger:this.logger}}),this.throughputEstimator=new zI(this.tuning.throughputEstimator),e.exposeInternalsToGlobal&&(this.internalsExposure=new q_("CORE"),this.internalsExposure.expose({player:this})),this.initChromecastSubscription(),this.initDesiredStateSubscriptions(),Proxy&&Reflect)return new Proxy(this,{get:(e,t,i)=>{let r=Reflect.get(e,t,i);return"function"!=typeof r?r:(...i)=>{try{return r.apply(e,i)}catch(e){let r=i.map((e=>JSON.stringify(e,((e,t)=>{let i=typeof t;return(0,jP.default)(["number","string","boolean"],i)?t:null===t?null:`<${i}>`})))),n=`Player.${String(t)}`,a=`Exception calling ${n} (${r.join(", ")})`;throw this.events.fatalError$.next({id:n,category:M_.WTF,message:a,thrown:e}),e}}}})}initVideo(e){var t;this.config=e,null==(t=this.internalsExposure)||t.expose({config:e,logger:this.logger,tuning:this.tuning});let i=()=>{var t,i,r;let{container:n,...a}=e;this.tracer.log("initVideo",e_(a)),this.domContainer=(e=>{let t="string"==typeof e.container?document.getElementById(e.container):e.container;return yb(t,`Wrong container or containerId {${e.container}}`),t})(e),this.chromecastInitializer.contentId=null==(t=e.meta)?void 0:t.videoId,this.providerContainer=new UI({sources:e.sources,meta:null!=(i=e.meta)?i:{},failoverHosts:null!=(r=e.failoverHosts)?r:[],container:this.domContainer,desiredState:this.desiredState,dependencies:{throughputEstimator:this.throughputEstimator,chromecastInitializer:this.chromecastInitializer,tracer:this.tracer,logger:this.logger,abrLogger:this.abrLogger},tuning:this.tuning,volumeMultiplier:e.volumeMultiplier,panelSize:e.panelSize}),this.initProviderContainerSubscription(this.providerContainer),this.initStartingVideoTrack(this.providerContainer),this.initTracerSubscription(),this.providerContainer.init(),this.setLiveLowLatency(this.tuning.dashCmafLive.lowLatency.isActiveOnDefault),this.setMuted(this.tuning.isAudioDisabled),this.initDebugTelemetry(),this.initWakeLock(),this.playerInited.next(!0)},r=()=>{this.tuning.autostartOnlyIfVisible&&window.requestAnimationFrame?this.playerInitRequest=window.requestAnimationFrame((()=>i())):i()},n=()=>{this.tuning.asyncResolveClientChecker?LO.isInited$.pipe(v_((e=>!!e)),P_()).subscribe((()=>{console.log("Core SDK async start"),r()})):r()};return this.isNotActiveTabCase()?(this.tracer.log("request play from hidden tab"),d_(document,"visibilitychange").pipe(P_()).subscribe(n)):n(),this}destroy(){var e,t;this.tracer.log("destroy"),window.clearTimeout(this.hasLiveOffsetByPausedTimer),this.playerInitRequest&&window.cancelAnimationFrame(this.playerInitRequest),this.events.willDestruct$.next(),this.stop(),null==(e=this.providerContainer)||e.destroy(),this.throughputEstimator.destroy(),this.chromecastInitializer.destroy(),this.subscription.unsubscribe(),this.tracer.end(),null==(t=this.internalsExposure)||t.destroy()}prepare(){return this.subscription.add(this.playerInited.pipe(v_((e=>!!e)),P_()).subscribe((()=>{let e=this.desiredState.playbackState;this.tracer.log("prepare",{currentPlayBackState:e.getState()}),"stopped"===e.getState()&&e.startTransitionTo("ready")}))),this}play(){return this.subscription.add(this.playerInited.pipe(v_((e=>!!e)),P_()).subscribe((()=>{let e=this.desiredState.playbackState;this.tracer.log("play",{currentPlayBackState:e.getState()}),"playing"!==e.getState()&&e.startTransitionTo("playing")}))),this}pause(){return this.subscription.add(this.playerInited.pipe(v_((e=>!!e)),P_()).subscribe((()=>{let e=this.desiredState.playbackState;this.tracer.log("pause",{currentPlayBackState:e.getState()}),"paused"!==e.getState()&&e.startTransitionTo("paused")}))),this}stop(){return this.subscription.add(this.playerInited.pipe(v_((e=>!!e)),P_()).subscribe((()=>{let e=this.desiredState.playbackState;this.tracer.log("stop",{currentPlayBackState:e.getState()}),"stopped"!==e.getState()&&e.startTransitionTo("stopped")}))),this}seekTime(e,t=!0){return this.subscription.add(this.playerInited.pipe(v_((e=>!!e)),P_()).subscribe((()=>{let i=this.info.duration$.getValue(),r=this.info.isLive$.getValue(),n=e;e>=i&&!r&&(n=i-this.tuning.seekNearDurationBias),this.tracer.log("seekTime",{duration:i,isLive:r,time:e,calculatedTime:n,forcePrecise:t}),Number.isFinite(n)&&(this.events.willSeek$.next({from:this.getExactTime(),to:n}),this.desiredState.seekState.setState({state:"requested",position:1e3*n,forcePrecise:t}))}))),this}seekPercent(e){return this.subscription.add(this.playerInited.pipe(v_((e=>!!e)),P_()).subscribe((()=>{let t=this.info.duration$.getValue();this.tracer.log("seekPercent",{percent:e,duration:t}),isFinite(t)&&this.seekTime(Math.abs(t)*e,!1)}))),this}setVolume(e,t){return this.subscription.add(this.playerInited.pipe(v_((e=>!!e)),P_()).subscribe((()=>{var i;let r=this.desiredState.volume,n=r.getTransition(),a=null!=(i=null==n?void 0:n.to.muted)?i:this.info.muted$.getValue(),s=null!=t?t:this.tuning.isAudioDisabled||a;this.tracer.log("setVolume",{volume:e,isAudioDisabled:this.tuning.isAudioDisabled,chromecastState:this.chromecastInitializer.castState$.getValue(),muted:s}),"CONNECTED"===this.chromecastInitializer.castState$.getValue()?this.chromecastInitializer.setVolume(e):r.startTransitionTo({volume:e,muted:s})}))),this}setMuted(e){return this.subscription.add(this.playerInited.pipe(v_((e=>!!e)),P_()).subscribe((()=>{var t;let i=this.desiredState.volume,r=this.tuning.isAudioDisabled||e,n=i.getTransition(),a=null!=(t=null==n?void 0:n.to.volume)?t:this.info.volume$.getValue();this.tracer.log("setMuted",{isMuted:e,nextMuted:r,volume:a,isAudioDisabled:this.tuning.isAudioDisabled,chromecastState:this.chromecastInitializer.castState$.getValue()}),"CONNECTED"===this.chromecastInitializer.castState$.getValue()?this.chromecastInitializer.setMuted(r):i.startTransitionTo({volume:a,muted:r})}))),this}setVideoStream(e){return this.subscription.add(this.playerInited.pipe(v_((e=>!!e)),P_()).subscribe((()=>{this.desiredState.videoStream.startTransitionTo(e)}))),this}setAudioStream(e){return this.subscription.add(this.playerInited.pipe(v_((e=>!!e)),P_()).subscribe((()=>{this.desiredState.audioStream.startTransitionTo(e)}))),this}setQuality(e){return this.subscription.add(this.playerInited.pipe(v_((e=>!!e)),P_()).subscribe((()=>{yb(this.providerContainer);let t=this.providerContainer.providerOutput.availableVideoTracks$.getValue();this.tracer.log("setQuality",{isDelayed:0===t.length,quality:e}),void 0===this.desiredState.videoTrack.getState()&&void 0===this.desiredState.videoTrack.getPrevState()&&0===t.length?this.wasSetStartedQuality?this.providerContainer.providerOutput.availableVideoTracks$.pipe(v_((e=>e.length>0)),P_()).subscribe((t=>{this.setVideoTrackIdByQuality(t,e)})):this.explicitInitialQuality=e:t.length>0&&this.setVideoTrackIdByQuality(t,e)}))),this}setAutoQuality(e){return this.subscription.add(this.playerInited.pipe(v_((e=>!!e)),P_()).subscribe((()=>{this.tracer.log("setAutoQuality",{enable:e}),this.desiredState.autoVideoTrackSwitching.startTransitionTo(e)}))),this}setAutoQualityLimits(e){return this.subscription.add(this.playerInited.pipe(v_((e=>!!e)),P_()).subscribe((()=>{this.tracer.log("setAutoQualityLimits",e_(e)),this.desiredState.autoVideoTrackLimits.startTransitionTo(e)}))),this}setPredefinedQualityLimits(e){return this.subscription.add(this.playerInited.pipe(v_((e=>!!e)),P_()).subscribe((()=>{let t,{highQualityLimit:i,trafficSavingLimit:r}=this.tuning.autoTrackSelection;switch(e){case"high_quality":t={min:i,max:void 0};break;case"traffic_saving":t={max:r,min:void 0};break;default:t={max:void 0,min:void 0}}this.setAutoQualityLimits(t)}))),this}setPlaybackRate(e){return this.subscription.add(this.playerInited.pipe(v_((e=>!!e)),P_()).subscribe((()=>{var t;yb(this.providerContainer);let i=null==(t=this.providerContainer)?void 0:t.providerOutput.element$.getValue();this.tracer.log("setPlaybackRate",{playbackRate:e,isVideoElementAvailable:!!i}),i&&(this.desiredState.playbackRate.setState(e),i.playbackRate=e)}))),this}setExternalTextTracks(e){return this.subscription.add(this.playerInited.pipe(v_((e=>!!e)),P_()).subscribe((()=>{e.length&&this.tracer.log("setExternalTextTracks",e_(e)),this.desiredState.externalTextTracks.startTransitionTo(e.map((e=>({type:"external",...e}))))}))),this}selectTextTrack(e){return this.subscription.add(this.playerInited.pipe(v_((e=>!!e)),P_()).subscribe((()=>{var t;((e,t,i,r)=>{void 0!==e&&void 0===t.getState()&&void 0===t.getPrevState()&&0===(null==i?void 0:i.getValue().length)?i.pipe(v_((e=>e.length>0)),P_()).subscribe((i=>{i.find(r)&&t.startTransitionTo(e)})):(void 0===e||null!=i&&i.getValue().find(r))&&t.startTransitionTo(e)})(e,this.desiredState.currentTextTrack,null==(t=this.providerContainer)?void 0:t.providerOutput.availableTextTracks$,(t=>t.id===e)),this.tracer.log("selectTextTrack",{textTrackId:e})}))),this}setTextTrackCueSettings(e){return this.subscription.add(this.playerInited.pipe(v_((e=>!!e)),P_()).subscribe((()=>{this.tracer.log("setTextTrackCueSettings",{...e}),this.desiredState.textTrackCuesSettings.startTransitionTo(e)}))),this}setLiveLowLatency(e){let t=this.info.isLive$.getValue(),i=this.desiredState.isLowLatency.getState();return t&&i!==e?(this.tracer.log("live switch to low latency "+e),this.desiredState.isLowLatency.setState(e),this.seekTime(0)):this}setLooped(e){return this.subscription.add(this.playerInited.pipe(v_((e=>!!e)),P_()).subscribe((()=>{this.tracer.log("setLooped",{isLooped:e}),this.desiredState.isLooped.startTransitionTo(e)}))),this}toggleChromecast(){this.tracer.log("toggleChromecast"),this.chromecastInitializer.toggleConnection()}startCameraManualRotation(e,t){return this.subscription.add(this.playerInited.pipe(v_((e=>!!e)),P_()).subscribe((()=>{let i=this.getScene3D();this.tracer.log("startCameraManualRotation",{isScene3DAvailable:!!i,mx:e,my:t}),i&&i.startCameraManualRotation(e,t)}))),this}stopCameraManualRotation(e=!1){return this.subscription.add(this.playerInited.pipe(v_((e=>!!e)),P_()).subscribe((()=>{let t=this.getScene3D();this.tracer.log("stopCameraManualRotation",{isScene3DAvailable:!!t,immediate:e}),t&&t.stopCameraManualRotation(e)}))),this}moveCameraFocusPX(e,t){return this.subscription.add(this.playerInited.pipe(v_((e=>!!e)),P_()).subscribe((()=>{let i=this.getScene3D();if(this.tracer.log("moveCameraFocusPX",{isScene3DAvailable:!!i,dxpx:e,dypx:t}),i){let r=i.getCameraRotation(),n=i.pixelToDegree({x:e,y:t});this.desiredState.cameraOrientation.setState({x:r.x+n.x,y:r.y+n.y})}}))),this}holdCamera(){return this.subscription.add(this.playerInited.pipe(v_((e=>e)),P_()).subscribe((()=>{let e=this.getScene3D();e&&e.holdCamera()}))),this}releaseCamera(){return this.subscription.add(this.playerInited.pipe(v_((e=>!!e)),P_()).subscribe((()=>{let e=this.getScene3D();e&&e.releaseCamera()}))),this}getExactTime(){if(!this.providerContainer)return 0;let e=this.providerContainer.providerOutput.element$.getValue();if(Eb(e))return this.info.position$.getValue();let t=this.desiredState.seekState.getState(),i="none"===t.state?void 0:t.position;return Tb(i)?i/1e3:e.currentTime}getAllLogs(){return this.logger.getAllLogs()}getScene3D(){var e,t;let i=null==(e=this.providerContainer)?void 0:e.current$.getValue();if(null!=(t=null==i?void 0:i.provider)&&t.scene3D)return i.provider.scene3D}setIntrinsicVideoSize(...e){let t={width:e.reduce(((e,{width:t})=>e||t||0),0),height:e.reduce(((e,{height:t})=>e||t||0),0)};t.width&&t.height&&this.info.intrinsicVideoSize$.next({width:t.width,height:t.height})}initDesiredStateSubscriptions(){this.subscription.add(o_(this.desiredState.playbackState.stateChangeStarted$,this.desiredState.playbackState.forceChanged$).pipe(A_((e=>e.to))).subscribe(this.info.playbackState$)).add(this.desiredState.isLooped.stateChangeEnded$.pipe(A_((e=>e.to))).subscribe(this.info.isLooped$)).add(this.desiredState.playbackRate.stateChangeEnded$.pipe(A_((e=>e.to))).subscribe(this.info.currentPlaybackRate$)).add(this.desiredState.autoVideoTrackSwitching.stateChangeEnded$.pipe(A_((e=>e.to))).subscribe(this.info.isAutoQualityEnabled$)).add(this.desiredState.autoVideoTrackLimits.stateChangeEnded$.pipe(A_((e=>e.to))).subscribe((e=>{this.info.autoQualityLimits$.next(e);let{highQualityLimit:t,trafficSavingLimit:i}=this.tuning.autoTrackSelection;this.info.predefinedQualityLimitType$.next(FO({limits:e,highQualityLimit:t,trafficSavingLimit:i}))}))),this.subscription.add(this.desiredState.playbackState.stateChangeStarted$.pipe(v_((({from:e})=>"stopped"===e)),P_()).subscribe((()=>{this.initedAt=Ab(),this.events.inited$.next()}))).add(this.desiredState.playbackState.stateChangeEnded$.subscribe((e=>{switch(e.to){case"ready":this.events.ready$.next();break;case"playing":this.isPlaybackStarted||this.events.started$.next(),this.isPlaybackStarted=!0,this.events.playing$.next();break;case"paused":this.events.paused$.next();break;case"stopped":this.events.stopped$.next()}}))).add(this.desiredState.playbackState.stateChangeStarted$.subscribe((e=>{switch(e.to){case"paused":this.events.willPause$.next();break;case"playing":this.isPlaybackStarted?this.events.willResume$.next():this.events.willStart$.next();break;case"stopped":this.events.willStop$.next()}})))}initProviderContainerSubscription(e){this.subscription.add(e.providerOutput.willSeekEvent$.subscribe((()=>{let e=this.desiredState.seekState.getState();this.tracer.log("willSeekEvent",e_(e)),"requested"===e.state?this.desiredState.seekState.setState({...e,state:"applying"}):this.events.managedError$.next({id:`WillSeekIn${e.state}`,category:M_.WTF,message:"Received unexpeceted willSeek$"})}))).add(e.providerOutput.soundProhibitedEvent$.pipe(P_()).subscribe(this.events.autoplaySoundProhibited$)).add(e.providerOutput.severeStallOccurred$.subscribe(this.events.severeStallOccured$)).add(e.providerOutput.seekedEvent$.subscribe((()=>{let e=this.desiredState.seekState.getState();this.tracer.log("seekedEvent",e_(e)),"applying"===e.state&&(this.desiredState.seekState.setState({state:"none"}),this.events.seeked$.next())}))).add(e.current$.pipe(A_((e=>e.type))).subscribe(this.info.currentFormat$)).add(e.current$.pipe(A_((e=>e.destination)),E_()).subscribe((()=>this.isPlaybackStarted=!1))).add(e.providerOutput.availableVideoStreams$.subscribe(this.info.availableVideoStreams$)).add(s_({availableVideoTracks:e.providerOutput.availableVideoTracks$,currentVideoStream:e.providerOutput.currentVideoStream$}).pipe(A_((({availableVideoTracks:e,currentVideoStream:t})=>e.filter((e=>!t||t.id===e.streamId)).map((({quality:e})=>e)).sort(((e,t)=>Kb(e)?1:Kb(t)?-1:Hb(t,e)?1:-1))))).subscribe(this.info.availableQualities$)).add(e.providerOutput.availableVideoTracks$.subscribe((e=>{let t={};for(let i of e)i.fps&&(t[i.quality]=i.fps);this.info.availableQualitiesFps$.next(t)}))).add(e.providerOutput.availableAudioStreams$.subscribe(this.info.availableAudioStreams$)).add(e.providerOutput.currentVideoStream$.subscribe(this.info.currentVideoStream$)).add(e.providerOutput.currentAudioStream$.subscribe(this.info.currentAudioStream$)).add(e.providerOutput.availableAudioTracks$.subscribe(this.info.availableAudioTracks$)).add(e.providerOutput.isAudioAvailable$.pipe(E_()).subscribe(this.info.isAudioAvailable$)).add(e.providerOutput.currentVideoTrack$.pipe(v_((e=>Tb(e)))).subscribe((e=>{this.info.currentQuality$.next(null==e?void 0:e.quality),this.info.videoBitrate$.next(null==e?void 0:e.bitrate)}))).add(e.providerOutput.currentVideoSegmentLength$.pipe(E_(((e,t)=>Math.round(e)===Math.round(t)))).subscribe(this.info.currentVideoSegmentLength$)).add(e.providerOutput.currentAudioSegmentLength$.pipe(E_(((e,t)=>Math.round(e)===Math.round(t)))).subscribe(this.info.currentAudioSegmentLength$)).add(e.providerOutput.hostname$.pipe(E_()).subscribe(this.info.hostname$)).add(e.providerOutput.httpConnectionType$.pipe(E_()).subscribe(this.info.httpConnectionType$)).add(e.providerOutput.httpConnectionReused$.pipe(E_()).subscribe(this.info.httpConnectionReused$)).add(e.providerOutput.currentTextTrack$.subscribe(this.info.currentTextTrack$)).add(e.providerOutput.availableTextTracks$.subscribe(this.info.availableTextTracks$)).add(e.providerOutput.autoVideoTrackLimitingAvailable$.subscribe(this.info.autoQualityLimitingAvailable$)).add(e.providerOutput.autoVideoTrackLimits$.subscribe((e=>{this.desiredState.autoVideoTrackLimits.setState(null!=e?e:{})}))).add(e.providerOutput.currentBuffer$.pipe(A_((e=>e?{start:e.from,end:e.to}:{start:0,end:0}))).subscribe(this.info.currentBuffer$)).add(e.providerOutput.duration$.subscribe(this.info.duration$)).add(e.providerOutput.isBuffering$.subscribe(this.info.isBuffering$)).add(e.providerOutput.isLive$.subscribe(this.info.isLive$)).add(e.providerOutput.isLiveEnded$.pipe(L_((e=>e&&this.stop()))).subscribe(this.info.isLiveEnded$)).add(e.providerOutput.canChangePlaybackSpeed$.subscribe(this.info.canChangePlaybackSpeed$)).add(e.providerOutput.liveTime$.subscribe(this.info.liveTime$)).add(e.providerOutput.liveBufferTime$.subscribe(this.info.liveBufferTime$)).add(e.providerOutput.liveLatency$.subscribe(this.info.liveLatency$)).add(s_({hasLiveOffsetByPaused:o_(this.desiredState.playbackState.stateChangeStarted$,this.desiredState.playbackState.forceChanged$).pipe(A_((e=>e.to)),E_(),A_((e=>"paused"===e))),isLowLatency:e.providerOutput.isLowLatency$}).subscribe((({hasLiveOffsetByPaused:e,isLowLatency:t})=>{window.clearTimeout(this.hasLiveOffsetByPausedTimer),e?this.hasLiveOffsetByPausedTimer=window.setTimeout((()=>{this.hasLiveOffsetByPaused.next(!0)}),this.getActiveLiveDelay(t)):this.hasLiveOffsetByPaused.next(!1)}))).add(s_({atLiveEdge:s_({isLive:e.providerOutput.isLive$,isLowLatency:e.providerOutput.isLowLatency$,position:QI({seekState:this.desiredState.seekState,position$:e.providerOutput.position$})}).pipe(A_((({isLive:e,position:t,isLowLatency:i})=>{let r=this.getActiveLiveDelay(i);return e&&Math.abs(t)<r/1e3})),E_(),L_((e=>e&&this.setPlaybackRate(1)))),hasPausedTimeoutCase:this.hasLiveOffsetByPaused}).pipe(A_((({atLiveEdge:e,hasPausedTimeoutCase:t})=>e&&!t))).subscribe(this.info.atLiveEdge$)).add(s_({isLive:e.providerOutput.isLive$,position:e.providerOutput.position$,duration:e.providerOutput.duration$}).pipe(A_((({isLive:e,position:t,duration:i})=>e&&1e3*(Math.abs(i)-Math.abs(t))<this.tuning.live.activeLiveDelay)),E_(),L_((e=>e&&this.setPlaybackRate(1)))).subscribe(this.info.atLiveDurationEdge$)).add(e.providerOutput.volume$.pipe(A_((e=>e.muted)),E_()).subscribe(this.info.muted$)).add(e.providerOutput.volume$.pipe(A_((e=>e.volume)),E_()).subscribe(this.info.volume$)).add(QI({seekState:this.desiredState.seekState,position$:e.providerOutput.position$}).subscribe(this.info.position$)).add(o_(e.providerOutput.endedEvent$.pipe(w_(!0)),e.providerOutput.seekedEvent$.pipe(w_(!1))).pipe(E_()).subscribe(this.info.isEnded$)).add(e.providerOutput.endedEvent$.subscribe(this.events.ended$)).add(e.providerOutput.loopedEvent$.subscribe(this.events.looped$)).add(e.providerError$.subscribe(this.events.managedError$)).add(e.providerOutput.fetcherRecoverableError$.subscribe(this.events.fetcherRecoverableError$)).add(e.providerOutput.fetcherError$.subscribe(this.events.fatalError$)).add(e.volumeMultiplierError$.subscribe(this.events.managedError$)).add(e.noAvailableProvidersError$.pipe(A_((e=>({id:e?`No${e}`:"NoProviders",category:M_.VIDEO_PIPELINE,message:e?`${e} was forced but failed or not available`:"No suitable providers or all providers failed"})))).subscribe(this.events.fatalError$)).add(e.providerOutput.element$.subscribe(this.experimental.element$)).add(e.providerOutput.getCurrentTime$.subscribe(this.experimental.getCurrentTime$)).add(e.providerOutput.firstBytesEvent$.pipe(P_(),A_((e=>null!=e?e:Ab()-this.initedAt))).subscribe(this.events.firstBytes$)).add(e.providerOutput.loadedMetadataEvent$.subscribe(this.events.loadedMetadata$)).add(e.providerOutput.firstFrameEvent$.pipe(P_(),A_((()=>Ab()-this.initedAt))).subscribe(this.events.firstFrame$)).add(e.providerOutput.canplay$.pipe(P_(),A_((()=>Ab()-this.initedAt))).subscribe(this.events.canplay$)).add(this.throughputEstimator.throughput$.subscribe(this.info.throughputEstimation$)).add(this.throughputEstimator.rtt$.subscribe(this.info.rttEstimation$)).add(e.providerOutput.availableSources$.subscribe(this.info.availableSources$));let t=new n_(!1);this.subscription.add(e.providerOutput.seekedEvent$.subscribe((()=>t.next(!1)))).add(e.providerOutput.willSeekEvent$.subscribe((()=>t.next(!0))));let i=new n_(!0);this.subscription.add(e.current$.subscribe((()=>i.next(!0)))).add(this.desiredState.playbackState.stateChangeEnded$.pipe(v_((({to:e})=>"playing"===e)),P_()).subscribe((()=>i.next(!1))));let r=0,n=o_(e.providerOutput.isBuffering$,t,i).pipe(A_((()=>{let r=e.providerOutput.isBuffering$.getValue(),n=t.getValue()||i.getValue();return r&&!n})),E_());this.subscription.add(n.subscribe((e=>{e?r=window.setTimeout((()=>this.info.isStalled$.next(!0)),this.tuning.stallIgnoreThreshold):(window.clearTimeout(r),this.info.isStalled$.next(!1))}))),this.subscription.add(o_(e.providerOutput.canplay$,e.providerOutput.firstFrameEvent$,e.providerOutput.firstBytesEvent$).subscribe((()=>{let t=e.providerOutput.element$.getValue();this.setIntrinsicVideoSize({width:null==t?void 0:t.videoWidth,height:null==t?void 0:t.videoHeight})}))).add(e.providerOutput.currentVideoTrack$.subscribe((t=>{var i,r;let n=e.providerOutput.element$.getValue();this.setIntrinsicVideoSize({width:null==(i=null==t?void 0:t.size)?void 0:i.width,height:null==(r=null==t?void 0:t.size)?void 0:r.height},{width:null==n?void 0:n.videoWidth,height:null==n?void 0:n.videoHeight})}))).add(e.providerOutput.is3DVideo$.subscribe(this.info.is3DVideo$)),this.subscription.add(o_(e.providerOutput.inPiP$,e.providerOutput.inFullscreen$,e.providerOutput.element$,e.providerOutput.elementVisible$,this.chromecastInitializer.castState$).subscribe((()=>{let t,i=e.providerOutput.inPiP$.getValue(),r=e.providerOutput.inFullscreen$.getValue(),n=e.providerOutput.element$.getValue(),a=e.providerOutput.elementVisible$.getValue();t="CONNECTED"===this.chromecastInitializer.castState$.getValue()?"second_screen":n?a?i?"pip":r?"fullscreen":"inline":"invisible":"none",this.info.surface$.getValue()!==t&&this.info.surface$.next(t)})))}initChromecastSubscription(){this.subscription.add(this.chromecastInitializer.castState$.subscribe(this.info.chromecastState$)),this.subscription.add(this.chromecastInitializer.connection$.pipe(A_((e=>null==e?void 0:e.castDevice.friendlyName))).subscribe(this.info.chromecastDeviceName$)),this.subscription.add(this.chromecastInitializer.errorEvent$.subscribe(this.events.managedError$))}initStartingVideoTrack(e){let t=new cb;this.subscription.add(t),this.subscription.add(e.current$.pipe(E_(((e,t)=>e.provider===t.provider))).subscribe((()=>{t.unsubscribe(),t.add(e.providerOutput.availableVideoTracks$.pipe(v_((e=>e.length>0)),P_()).subscribe((e=>{this.setStartingVideoTrack(e)})))})))}setStartingVideoTrack(e){var t;let i;this.wasSetStartedQuality=!0;let r=null!=(t=this.explicitInitialQuality)?t:this.info.currentQuality$.getValue();r&&(i=e.find((({quality:e})=>e===r)),i||this.setAutoQuality(!0)),i||(i=eC(e,{container:this.domContainer.getBoundingClientRect(),panelSize:this.config.panelSize,estimatedThroughput:this.throughputEstimator.throughput$.getValue(),tuning:this.tuning.autoTrackSelection,limits:this.desiredState.autoVideoTrackLimits.getState(),playbackRate:this.info.currentPlaybackRate$.getValue(),forwardBufferHealth:0,abrLogger:this.abrLogger})),this.desiredState.videoTrack.startTransitionTo(i),this.info.currentQuality$.next(i.quality),this.info.videoBitrate$.next(i.bitrate)}initLogs(){this.subscription.add(o_(this.desiredState.videoTrack.stateChangeStarted$.pipe(A_((e=>({transition:e,entity:"quality",type:"start"})))),this.desiredState.videoTrack.stateChangeEnded$.pipe(A_((e=>({transition:e,entity:"quality",type:"end"})))),this.desiredState.autoVideoTrackSwitching.stateChangeStarted$.pipe(A_((e=>({transition:e,entity:"autoQualityEnabled",type:"start"})))),this.desiredState.autoVideoTrackSwitching.stateChangeEnded$.pipe(A_((e=>({transition:e,entity:"autoQualityEnabled",type:"end"})))),this.desiredState.seekState.stateChangeStarted$.pipe(A_((e=>({transition:e,entity:"seekState",type:"start"})))),this.desiredState.seekState.stateChangeEnded$.pipe(A_((e=>({transition:e,entity:"seekState",type:"end"})))),this.desiredState.playbackState.stateChangeStarted$.pipe(A_((e=>({transition:e,entity:"playbackState",type:"start"})))),this.desiredState.playbackState.stateChangeEnded$.pipe(A_((e=>({transition:e,entity:"playbackState",type:"end"}))))).pipe(A_((e=>({component:"desiredState",message:`[${e.entity} change] ${e.type}: ${JSON.stringify(e.transition)}`})))).subscribe(this.logger.log)),this.subscription.add(this.logger.log$.subscribe(this.events.log$))}initDebugTelemetry(){var e;let t=null==(e=this.providerContainer)?void 0:e.providerOutput;yb(this.providerContainer),yb(t),$O={},this.experimental.enableDebugTelemetry$.next(this.tuning.enableTelemetryAtStart),[this.experimental.enableDebugTelemetry$.subscribe((e=>{kO=e})),this.providerContainer.current$.subscribe((({type:e})=>UO("provider",e))),t.duration$.subscribe((e=>UO("duration",e))),t.availableVideoTracks$.pipe(v_((e=>!!e.length)),P_()).subscribe((e=>UO("tracks",e))),this.events.fatalError$.subscribe(new BO("fatalError")),this.events.managedError$.subscribe(new BO("managedError")),t.position$.subscribe(new BO("position")),t.currentVideoTrack$.pipe(A_((e=>null==e?void 0:e.quality))).subscribe(new BO("quality")),this.info.currentBuffer$.subscribe(new BO("buffer")),t.isBuffering$.subscribe(new BO("isBuffering"))].forEach((e=>this.subscription.add(e))),UO("codecs",LO.video.supportedCodecs)}initTracerSubscription(){let e=r_(this.tracer.log.bind(this.tracer)),t=r_(this.tracer.error.bind(this.tracer));this.subscription.add(this.info.playbackState$.subscribe(e("playbackState"))).add(this.info.isLooped$.subscribe(e("isLooped"))).add(this.info.currentPlaybackRate$.pipe(E_()).subscribe(e("currentPlaybackRate"))).add(this.info.isAutoQualityEnabled$.subscribe(e("isAutoQualityEnabled"))).add(this.info.autoQualityLimits$.subscribe(e("autoQualityLimits"))).add(this.info.currentFormat$.subscribe(e("currentFormat"))).add(this.info.availableQualities$.subscribe(e("availableQualities"))).add(this.info.availableQualitiesFps$.subscribe(e("availableQualitiesFps"))).add(this.info.availableAudioTracks$.subscribe(e("availableAudioTracks"))).add(this.info.isAudioAvailable$.subscribe(e("isAudioAvailable"))).add(s_({currentQuality:this.info.currentQuality$,videoBitrate:this.info.videoBitrate$}).pipe(v_((({currentQuality:e,videoBitrate:t})=>!!e&&!!t)),E_(((e,t)=>e.currentQuality===t.currentQuality))).subscribe(e("currentVideoTrack"))).add(this.info.currentVideoSegmentLength$.pipe(v_((e=>e>0)),E_()).subscribe(e("currentVideoSegmentLength"))).add(this.info.currentAudioSegmentLength$.pipe(v_((e=>e>0)),E_()).subscribe(e("currentAudioSegmentLength"))).add(this.info.hostname$.subscribe(e("hostname"))).add(this.info.currentTextTrack$.subscribe(e("currentTextTrack"))).add(this.info.availableTextTracks$.subscribe(e("availableTextTracks"))).add(this.info.autoQualityLimitingAvailable$.subscribe(e("autoQualityLimitingAvailable"))).add(s_({currentBuffer:this.info.currentBuffer$.pipe(v_((e=>e.end>0)),E_(((e,t)=>e.end===t.end&&e.start===t.start))),position:this.info.position$.pipe(E_())}).pipe(m_(1e3)).subscribe(e("currentBufferAndPosition"))).add(this.info.duration$.pipe(E_()).subscribe(e("duration"))).add(this.info.isBuffering$.subscribe(e("isBuffering"))).add(this.info.isLive$.pipe(E_()).subscribe(e("isLive"))).add(this.info.canChangePlaybackSpeed$.pipe(E_()).subscribe(e("canChangePlaybackSpeed"))).add(s_({liveTime:this.info.liveTime$,liveBufferTime:this.info.liveBufferTime$,position:this.info.position$}).pipe(v_((({liveTime:e,liveBufferTime:t})=>!!e&&!!t)),m_(1e3)).subscribe(e("liveBufferAndPosition"))).add(this.info.atLiveEdge$.pipe(E_(),v_((e=>!0===e))).subscribe(e("atLiveEdge"))).add(this.info.atLiveDurationEdge$.pipe(E_(),v_((e=>!0===e))).subscribe(e("atLiveDurationEdge"))).add(this.info.muted$.pipe(E_()).subscribe(e("muted"))).add(this.info.volume$.pipe(E_()).subscribe(e("volume"))).add(this.info.isEnded$.pipe(E_(),v_((e=>!0===e))).subscribe(e("isEnded"))).add(this.info.availableSources$.subscribe(e("availableSources"))).add(s_({throughputEstimation:this.info.throughputEstimation$,rtt:this.info.rttEstimation$}).pipe(v_((({throughputEstimation:e,rtt:t})=>!!e&&!!t)),m_(3e3)).subscribe(e("throughputEstimation"))).add(this.info.isStalled$.subscribe(e("isStalled"))).add(this.info.is3DVideo$.pipe(E_(),v_((e=>!0===e))).subscribe(e("is3DVideo"))).add(this.info.surface$.subscribe(e("surface"))).add(this.events.ended$.subscribe(e("ended"))).add(this.events.looped$.subscribe(e("looped"))).add(this.events.managedError$.subscribe(t("managedError"))).add(this.events.fatalError$.subscribe(t("fatalError"))).add(this.events.firstBytes$.subscribe(e("firstBytes"))).add(this.events.firstFrame$.subscribe(e("firstFrame"))).add(this.events.canplay$.subscribe(e("canplay")))}initWakeLock(){if(!window.navigator.wakeLock||!this.tuning.enableWakeLock)return;let e,t=()=>{null==e||e.release(),e=void 0},i=async()=>{t(),e=await window.navigator.wakeLock.request("screen").catch((e=>{e instanceof DOMException&&"NotAllowedError"===e.name||this.events.managedError$.next({id:"WakeLock",category:M_.DOM,message:String(e)})}))};this.subscription.add(o_(d_(document,"visibilitychange"),d_(document,"fullscreenchange"),this.desiredState.playbackState.stateChangeEnded$).subscribe((()=>{let r="visible"===document.visibilityState,n="playing"===this.desiredState.playbackState.getState(),a=!(!e||null!=e&&e.released);r&&n?a||i():t()}))).add(this.events.willDestruct$.subscribe(t))}setVideoTrackIdByQuality(e,t){let i=e.find((e=>e.quality===t));this.tracer.log("setVideoTrackIdByQuality",e_({quality:t,availableTracks:e_(e),track:e_(i),isAutoQuality:!i})),i?this.desiredState.videoTrack.startTransitionTo(i):this.setAutoQuality(!0)}getActiveLiveDelay(e=!1){return e?this.tuning.live.lowLatencyActiveLiveDelay:this.tuning.live.activeLiveDelay}isNotActiveTabCase(){return document.hidden&&this.tuning.autoplayOnlyInActiveTab&&!SC()}},KI=Object.create,XI=Object.defineProperty,JI=Object.getOwnPropertyDescriptor,ZI=Object.getOwnPropertyNames,ex=Object.getPrototypeOf,tx=Object.prototype.hasOwnProperty,ix=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),rx=(e,t,i)=>(i=null!=e?KI(ex(e)):{},((e,t,i,r)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let n of ZI(t))!tx.call(e,n)&&n!==i&&XI(e,n,{get:()=>t[n],enumerable:!(r=JI(t,n))||r.enumerable});return e})(!t&&e&&e.__esModule?i:XI(i,"default",{value:e,enumerable:!0}),e)),nx=ix(((e,t)=>{var i=function(e){return e&&e.Math===Math&&e};t.exports=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof global&&global)||i("object"==typeof e&&e)||function(){return this}()||Function("return this")()})),ax=ix(((e,t)=>{t.exports=function(e){try{return!!e()}catch(e){return!0}}})),sx=ix(((e,t)=>{var i=ax();t.exports=!i((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))})),ox=ix(((e,t)=>{var i=sx(),r=Function.prototype,n=r.apply,a=r.call;t.exports="object"==typeof Reflect&&Reflect.apply||(i?a.bind(n):function(){return a.apply(n,arguments)})})),lx=ix(((e,t)=>{var i=sx(),r=Function.prototype,n=r.call,a=i&&r.bind.bind(n,n);t.exports=i?a:function(e){return function(){return n.apply(e,arguments)}}})),ux=ix(((e,t)=>{var i=lx(),r=i({}.toString),n=i("".slice);t.exports=function(e){return n(r(e),8,-1)}})),dx=ix(((e,t)=>{var i=ux(),r=lx();t.exports=function(e){if("Function"===i(e))return r(e)}})),cx=ix(((e,t)=>{var i="object"==typeof document&&document.all;t.exports=void 0===i&&void 0!==i?function(e){return"function"==typeof e||e===i}:function(e){return"function"==typeof e}})),hx=ix(((e,t)=>{var i=ax();t.exports=!i((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))})),px=ix(((e,t)=>{var i=sx(),r=Function.prototype.call;t.exports=i?r.bind(r):function(){return r.apply(r,arguments)}})),fx=ix((e=>{var t={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,r=i&&!t.call({1:2},1);e.f=r?function(e){var t=i(this,e);return!!t&&t.enumerable}:t})),mx=ix(((e,t)=>{t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}})),gx=ix(((e,t)=>{var i=lx(),r=ax(),n=ux(),a=Object,s=i("".split);t.exports=r((function(){return!a("z").propertyIsEnumerable(0)}))?function(e){return"String"===n(e)?s(e,""):a(e)}:a})),vx=ix(((e,t)=>{t.exports=function(e){return null==e}})),Sx=ix(((e,t)=>{var i=vx(),r=TypeError;t.exports=function(e){if(i(e))throw new r("Can't call method on "+e);return e}})),yx=ix(((e,t)=>{var i=gx(),r=Sx();t.exports=function(e){return i(r(e))}})),Tx=ix(((e,t)=>{var i=cx();t.exports=function(e){return"object"==typeof e?null!==e:i(e)}})),Ex=ix(((e,t)=>{t.exports={}})),bx=ix(((e,t)=>{var i=Ex(),r=nx(),n=cx(),a=function(e){return n(e)?e:void 0};t.exports=function(e,t){return arguments.length<2?a(i[e])||a(r[e]):i[e]&&i[e][t]||r[e]&&r[e][t]}})),_x=ix(((e,t)=>{var i=lx();t.exports=i({}.isPrototypeOf)})),Ax=ix(((e,t)=>{var i=nx().navigator,r=i&&i.userAgent;t.exports=r?String(r):""})),Rx=ix(((e,t)=>{var i,r,n=nx(),a=Ax(),s=n.process,o=n.Deno,l=s&&s.versions||o&&o.version,u=l&&l.v8;u&&(r=(i=u.split("."))[0]>0&&i[0]<4?1:+(i[0]+i[1])),!r&&a&&((!(i=a.match(/Edge\/(\d+)/))||i[1]>=74)&&((i=a.match(/Chrome\/(\d+)/))&&(r=+i[1]))),t.exports=r})),wx=ix(((e,t)=>{var i=Rx(),r=ax(),n=nx().String;t.exports=!!Object.getOwnPropertySymbols&&!r((function(){var e=Symbol("symbol detection");return!n(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&i&&i<41}))})),Px=ix(((e,t)=>{var i=wx();t.exports=i&&!Symbol.sham&&"symbol"==typeof Symbol.iterator})),Ox=ix(((e,t)=>{var i=bx(),r=cx(),n=_x(),a=Px(),s=Object;t.exports=a?function(e){return"symbol"==typeof e}:function(e){var t=i("Symbol");return r(t)&&n(t.prototype,s(e))}})),Cx=ix(((e,t)=>{var i=String;t.exports=function(e){try{return i(e)}catch(e){return"Object"}}})),Lx=ix(((e,t)=>{var i=cx(),r=Cx(),n=TypeError;t.exports=function(e){if(i(e))return e;throw new n(r(e)+" is not a function")}})),Ix=ix(((e,t)=>{var i=Lx(),r=vx();t.exports=function(e,t){var n=e[t];return r(n)?void 0:i(n)}})),xx=ix(((e,t)=>{var i=px(),r=cx(),n=Tx(),a=TypeError;t.exports=function(e,t){var s,o;if("string"===t&&r(s=e.toString)&&!n(o=i(s,e))||r(s=e.valueOf)&&!n(o=i(s,e))||"string"!==t&&r(s=e.toString)&&!n(o=i(s,e)))return o;throw new a("Can't convert object to primitive value")}})),Mx=ix(((e,t)=>{t.exports=!0})),Nx=ix(((e,t)=>{var i=nx(),r=Object.defineProperty;t.exports=function(e,t){try{r(i,e,{value:t,configurable:!0,writable:!0})}catch(r){i[e]=t}return t}})),Dx=ix(((e,t)=>{var i=Mx(),r=nx(),n=Nx(),a="__core-js_shared__",s=t.exports=r[a]||n(a,{});(s.versions||(s.versions=[])).push({version:"3.38.0",mode:i?"pure":"global",copyright:"© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.38.0/LICENSE",source:"https://github.com/zloirock/core-js"})})),kx=ix(((e,t)=>{var i=Dx();t.exports=function(e,t){return i[e]||(i[e]=t||{})}})),$x=ix(((e,t)=>{var i=Sx(),r=Object;t.exports=function(e){return r(i(e))}})),Vx=ix(((e,t)=>{var i=lx(),r=$x(),n=i({}.hasOwnProperty);t.exports=Object.hasOwn||function(e,t){return n(r(e),t)}})),Ux=ix(((e,t)=>{var i=lx(),r=0,n=Math.random(),a=i(1..toString);t.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+a(++r+n,36)}})),Bx=ix(((e,t)=>{var i=nx(),r=kx(),n=Vx(),a=Ux(),s=wx(),o=Px(),l=i.Symbol,u=r("wks"),d=o?l.for||l:l&&l.withoutSetter||a;t.exports=function(e){return n(u,e)||(u[e]=s&&n(l,e)?l[e]:d("Symbol."+e)),u[e]}})),Fx=ix(((e,t)=>{var i=px(),r=Tx(),n=Ox(),a=Ix(),s=xx(),o=Bx(),l=TypeError,u=o("toPrimitive");t.exports=function(e,t){if(!r(e)||n(e))return e;var o,d=a(e,u);if(d){if(void 0===t&&(t="default"),o=i(d,e,t),!r(o)||n(o))return o;throw new l("Can't convert object to primitive value")}return void 0===t&&(t="number"),s(e,t)}})),Hx=ix(((e,t)=>{var i=Fx(),r=Ox();t.exports=function(e){var t=i(e,"string");return r(t)?t:t+""}})),jx=ix(((e,t)=>{var i=nx(),r=Tx(),n=i.document,a=r(n)&&r(n.createElement);t.exports=function(e){return a?n.createElement(e):{}}})),Gx=ix(((e,t)=>{var i=hx(),r=ax(),n=jx();t.exports=!i&&!r((function(){return 7!==Object.defineProperty(n("div"),"a",{get:function(){return 7}}).a}))})),qx=ix((e=>{var t=hx(),i=px(),r=fx(),n=mx(),a=yx(),s=Hx(),o=Vx(),l=Gx(),u=Object.getOwnPropertyDescriptor;e.f=t?u:function(e,t){if(e=a(e),t=s(t),l)try{return u(e,t)}catch(e){}if(o(e,t))return n(!i(r.f,e,t),e[t])}})),zx=ix(((e,t)=>{var i=ax(),r=cx(),n=/#|\.prototype\./,a=function(e,t){var n=o[s(e)];return n===u||n!==l&&(r(t)?i(t):!!t)},s=a.normalize=function(e){return String(e).replace(n,".").toLowerCase()},o=a.data={},l=a.NATIVE="N",u=a.POLYFILL="P";t.exports=a})),Wx=ix(((e,t)=>{var i=dx(),r=Lx(),n=sx(),a=i(i.bind);t.exports=function(e,t){return r(e),void 0===t?e:n?a(e,t):function(){return e.apply(t,arguments)}}})),Qx=ix(((e,t)=>{var i=hx(),r=ax();t.exports=i&&r((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))})),Yx=ix(((e,t)=>{var i=Tx(),r=String,n=TypeError;t.exports=function(e){if(i(e))return e;throw new n(r(e)+" is not an object")}})),Kx=ix((e=>{var t=hx(),i=Gx(),r=Qx(),n=Yx(),a=Hx(),s=TypeError,o=Object.defineProperty,l=Object.getOwnPropertyDescriptor,u="enumerable",d="configurable",c="writable";e.f=t?r?function(e,t,i){if(n(e),t=a(t),n(i),"function"==typeof e&&"prototype"===t&&"value"in i&&c in i&&!i[c]){var r=l(e,t);r&&r[c]&&(e[t]=i.value,i={configurable:d in i?i[d]:r[d],enumerable:u in i?i[u]:r[u],writable:!1})}return o(e,t,i)}:o:function(e,t,r){if(n(e),t=a(t),n(r),i)try{return o(e,t,r)}catch(e){}if("get"in r||"set"in r)throw new s("Accessors not supported");return"value"in r&&(e[t]=r.value),e}})),Xx=ix(((e,t)=>{var i=hx(),r=Kx(),n=mx();t.exports=i?function(e,t,i){return r.f(e,t,n(1,i))}:function(e,t,i){return e[t]=i,e}})),Jx=ix(((e,t)=>{var i=nx(),r=ox(),n=dx(),a=cx(),s=qx().f,o=zx(),l=Ex(),u=Wx(),d=Xx(),c=Vx();Dx();var h=function(e){var t=function(i,n,a){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(i);case 2:return new e(i,n)}return new e(i,n,a)}return r(e,this,arguments)};return t.prototype=e.prototype,t};t.exports=function(e,t){var r,p,f,m,g,v,S,y,T,E=e.target,b=e.global,_=e.stat,A=e.proto,R=b?i:_?i[E]:i[E]&&i[E].prototype,w=b?l:l[E]||d(l,E,{})[E],P=w.prototype;for(m in t)p=!(r=o(b?m:E+(_?".":"#")+m,e.forced))&&R&&c(R,m),v=w[m],p&&(e.dontCallGetSet?S=(T=s(R,m))&&T.value:S=R[m]),g=p&&S?S:t[m],(r||A||typeof v!=typeof g)&&(y=e.bind&&p?u(g,i):e.wrap&&p?h(g):A&&a(g)?n(g):g,(e.sham||g&&g.sham||v&&v.sham)&&d(y,"sham",!0),d(w,m,y),A&&(c(l,f=E+"Prototype")||d(l,f,{}),d(l[f],m,g),e.real&&P&&(r||!P[m])&&d(P,m,g)))}})),Zx=ix(((e,t)=>{var i=Math.ceil,r=Math.floor;t.exports=Math.trunc||function(e){var t=+e;return(t>0?r:i)(t)}})),eM=ix(((e,t)=>{var i=Zx();t.exports=function(e){var t=+e;return t!=t||0===t?0:i(t)}})),tM=ix(((e,t)=>{var i=eM(),r=Math.max,n=Math.min;t.exports=function(e,t){var a=i(e);return a<0?r(a+t,0):n(a,t)}})),iM=ix(((e,t)=>{var i=eM(),r=Math.min;t.exports=function(e){var t=i(e);return t>0?r(t,9007199254740991):0}})),rM=ix(((e,t)=>{var i=iM();t.exports=function(e){return i(e.length)}})),nM=ix(((e,t)=>{var i=yx(),r=tM(),n=rM(),a=function(e){return function(t,a,s){var o=i(t),l=n(o);if(0===l)return!e&&-1;var u,d=r(s,l);if(e&&a!=a){for(;l>d;)if((u=o[d++])!=u)return!0}else for(;l>d;d++)if((e||d in o)&&o[d]===a)return e||d||0;return!e&&-1}};t.exports={includes:a(!0),indexOf:a(!1)}})),aM=ix(((e,t)=>{t.exports=function(){}})),sM=ix((()=>{var e=Jx(),t=nM().includes,i=ax(),r=aM();e({target:"Array",proto:!0,forced:i((function(){return!Array(1).includes()}))},{includes:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}}),r("includes")})),oM=ix(((e,t)=>{var i=bx();t.exports=i})),lM=ix(((e,t)=>{sM();var i=oM();t.exports=i("Array","includes")})),uM=ix(((e,t)=>{var i=lM();t.exports=i})),dM=ix(((e,t)=>{var i=uM();t.exports=i})),cM=ix((()=>{})),hM=ix(((e,t)=>{var i=nx(),r=Ax(),n=ux(),a=function(e){return r.slice(0,e.length)===e};t.exports=a("Bun/")?"BUN":a("Cloudflare-Workers")?"CLOUDFLARE":a("Deno/")?"DENO":a("Node.js/")?"NODE":i.Bun&&"string"==typeof Bun.version?"BUN":i.Deno&&"object"==typeof Deno.version?"DENO":"process"===n(i.process)?"NODE":i.window&&i.document?"BROWSER":"REST"})),pM=ix(((e,t)=>{var i=hM();t.exports="NODE"===i})),fM=ix(((e,t)=>{var i=Xx();t.exports=function(e,t,r,n){return n&&n.enumerable?e[t]=r:i(e,t,r),e}})),mM=ix(((e,t)=>{var i=lx(),r=Lx();t.exports=function(e,t,n){try{return i(r(Object.getOwnPropertyDescriptor(e,t)[n]))}catch(e){}}})),gM=ix(((e,t)=>{var i=Tx();t.exports=function(e){return i(e)||null===e}})),vM=ix(((e,t)=>{var i=gM(),r=String,n=TypeError;t.exports=function(e){if(i(e))return e;throw new n("Can't set "+r(e)+" as a prototype")}})),SM=ix(((e,t)=>{var i=mM(),r=Tx(),n=Sx(),a=vM();t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,s={};try{(e=i(Object.prototype,"__proto__","set"))(s,[]),t=s instanceof Array}catch(e){}return function(i,s){return n(i),a(s),r(i)&&(t?e(i,s):i.__proto__=s),i}}():void 0)})),yM=ix(((e,t)=>{var i={};i[Bx()("toStringTag")]="z",t.exports="[object z]"===String(i)})),TM=ix(((e,t)=>{var i=yM(),r=cx(),n=ux(),a=Bx()("toStringTag"),s=Object,o="Arguments"===n(function(){return arguments}());t.exports=i?n:function(e){var t,i,l;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t]}catch(e){}}(t=s(e),a))?i:o?n(t):"Object"===(l=n(t))&&r(t.callee)?"Arguments":l}})),EM=ix(((e,t)=>{var i=yM(),r=TM();t.exports=i?{}.toString:function(){return"[object "+r(this)+"]"}})),bM=ix(((e,t)=>{var i=yM(),r=Kx().f,n=Xx(),a=Vx(),s=EM(),o=Bx()("toStringTag");t.exports=function(e,t,l,u){var d=l?e:e&&e.prototype;d&&(a(d,o)||r(d,o,{configurable:!0,value:t}),u&&!i&&n(d,"toString",s))}})),_M=ix(((e,t)=>{var i=Kx();t.exports=function(e,t,r){return i.f(e,t,r)}})),AM=ix(((e,t)=>{var i=bx(),r=_M(),n=Bx(),a=hx(),s=n("species");t.exports=function(e){var t=i(e);a&&t&&!t[s]&&r(t,s,{configurable:!0,get:function(){return this}})}})),RM=ix(((e,t)=>{var i=_x(),r=TypeError;t.exports=function(e,t){if(i(t,e))return e;throw new r("Incorrect invocation")}})),wM=ix(((e,t)=>{var i=lx(),r=cx(),n=Dx(),a=i(Function.toString);r(n.inspectSource)||(n.inspectSource=function(e){return a(e)}),t.exports=n.inspectSource})),PM=ix(((e,t)=>{var i=lx(),r=ax(),n=cx(),a=TM(),s=bx(),o=wM(),l=function(){},u=s("Reflect","construct"),d=/^\s*(?:class|function)\b/,c=i(d.exec),h=!d.test(l),p=function(e){if(!n(e))return!1;try{return u(l,[],e),!0}catch(e){return!1}},f=function(e){if(!n(e))return!1;switch(a(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return h||!!c(d,o(e))}catch(e){return!0}};f.sham=!0,t.exports=!u||r((function(){var e;return p(p.call)||!p(Object)||!p((function(){e=!0}))||e}))?f:p})),OM=ix(((e,t)=>{var i=PM(),r=Cx(),n=TypeError;t.exports=function(e){if(i(e))return e;throw new n(r(e)+" is not a constructor")}})),CM=ix(((e,t)=>{var i=Yx(),r=OM(),n=vx(),a=Bx()("species");t.exports=function(e,t){var s,o=i(e).constructor;return void 0===o||n(s=i(o)[a])?t:r(s)}})),LM=ix(((e,t)=>{var i=bx();t.exports=i("document","documentElement")})),IM=ix(((e,t)=>{var i=lx();t.exports=i([].slice)})),xM=ix(((e,t)=>{var i=TypeError;t.exports=function(e,t){if(e<t)throw new i("Not enough arguments");return e}})),MM=ix(((e,t)=>{var i=Ax();t.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(i)})),NM=ix(((e,t)=>{var i,r,n,a,s=nx(),o=ox(),l=Wx(),u=cx(),d=Vx(),c=ax(),h=LM(),p=IM(),f=jx(),m=xM(),g=MM(),v=pM(),S=s.setImmediate,y=s.clearImmediate,T=s.process,E=s.Dispatch,b=s.Function,_=s.MessageChannel,A=s.String,R=0,w={},P="onreadystatechange";c((function(){i=s.location}));var O=function(e){if(d(w,e)){var t=w[e];delete w[e],t()}},C=function(e){return function(){O(e)}},L=function(e){O(e.data)},I=function(e){s.postMessage(A(e),i.protocol+"//"+i.host)};(!S||!y)&&(S=function(e){m(arguments.length,1);var t=u(e)?e:b(e),i=p(arguments,1);return w[++R]=function(){o(t,void 0,i)},r(R),R},y=function(e){delete w[e]},v?r=function(e){T.nextTick(C(e))}:E&&E.now?r=function(e){E.now(C(e))}:_&&!g?(a=(n=new _).port2,n.port1.onmessage=L,r=l(a.postMessage,a)):s.addEventListener&&u(s.postMessage)&&!s.importScripts&&i&&"file:"!==i.protocol&&!c(I)?(r=I,s.addEventListener("message",L,!1)):r=P in f("script")?function(e){h.appendChild(f("script"))[P]=function(){h.removeChild(this),O(e)}}:function(e){setTimeout(C(e),0)}),t.exports={set:S,clear:y}})),DM=ix(((e,t)=>{var i=nx(),r=hx(),n=Object.getOwnPropertyDescriptor;t.exports=function(e){if(!r)return i[e];var t=n(i,e);return t&&t.value}})),kM=ix(((e,t)=>{var i=function(){this.head=null,this.tail=null};i.prototype={add:function(e){var t={item:e,next:null},i=this.tail;i?i.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}},t.exports=i})),$M=ix(((e,t)=>{var i=Ax();t.exports=/ipad|iphone|ipod/i.test(i)&&"undefined"!=typeof Pebble})),VM=ix(((e,t)=>{var i=Ax();t.exports=/web0s(?!.*chrome)/i.test(i)})),UM=ix(((e,t)=>{var i,r,n,a,s,o,l,u=nx(),d=DM(),c=Wx(),h=NM().set,p=kM(),f=MM(),m=$M(),g=VM(),v=pM(),S=u.MutationObserver||u.WebKitMutationObserver,y=u.document,T=u.process,E=u.Promise,b=d("queueMicrotask");b||(o=new p,l=function(){var e,t;for(v&&(e=T.domain)&&e.exit();t=o.get();)try{t()}catch(e){throw o.head&&i(),e}e&&e.enter()},f||v||g||!S||!y?!m&&E&&E.resolve?((a=E.resolve(void 0)).constructor=E,s=c(a.then,a),i=function(){s(l)}):v?i=function(){T.nextTick(l)}:(h=c(h,u),i=function(){h(l)}):(r=!0,n=y.createTextNode(""),new S(l).observe(n,{characterData:!0}),i=function(){n.data=r=!r}),b=function(e){o.head||i(),o.add(e)}),t.exports=b})),BM=ix(((e,t)=>{t.exports=function(e,t){try{1===arguments.length?console.error(e):console.error(e,t)}catch(e){}}})),FM=ix(((e,t)=>{t.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}})),HM=ix(((e,t)=>{var i=nx(),r=cx(),n=i.WeakMap;t.exports=r(n)&&/native code/.test(String(n))})),jM=ix(((e,t)=>{var i=kx(),r=Ux(),n=i("keys");t.exports=function(e){return n[e]||(n[e]=r(e))}})),GM=ix(((e,t)=>{t.exports={}})),qM=ix(((e,t)=>{var i,r,n,a,s,o=HM(),l=nx(),u=Tx(),d=Xx(),c=Vx(),h=Dx(),p=jM(),f=GM(),m="Object already initialized",g=l.TypeError,v=l.WeakMap;o||h.state?((a=h.state||(h.state=new v)).get=a.get,a.has=a.has,a.set=a.set,i=function(e,t){if(a.has(e))throw new g(m);return t.facade=e,a.set(e,t),t},r=function(e){return a.get(e)||{}},n=function(e){return a.has(e)}):(f[s=p("state")]=!0,i=function(e,t){if(c(e,s))throw new g(m);return t.facade=e,d(e,s,t),t},r=function(e){return c(e,s)?e[s]:{}},n=function(e){return c(e,s)}),t.exports={set:i,get:r,has:n,enforce:function(e){return n(e)?r(e):i(e,{})},getterFor:function(e){return function(t){var i;if(!u(t)||(i=r(t)).type!==e)throw new g("Incompatible receiver, "+e+" required");return i}}}})),zM=ix(((e,t)=>{var i=nx();t.exports=i.Promise})),WM=ix(((e,t)=>{var i=nx(),r=zM(),n=cx(),a=zx(),s=wM(),o=Bx(),l=hM(),u=Mx(),d=Rx(),c=r&&r.prototype,h=o("species"),p=!1,f=n(i.PromiseRejectionEvent),m=a("Promise",(function(){var e=s(r),t=e!==String(r);if(!t&&66===d||u&&(!c.catch||!c.finally))return!0;if(!d||d<51||!/native code/.test(e)){var i=new r((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};if((i.constructor={})[h]=n,!(p=i.then((function(){}))instanceof n))return!0}return!(t||"BROWSER"!==l&&"DENO"!==l||f)}));t.exports={CONSTRUCTOR:m,REJECTION_EVENT:f,SUBCLASSING:p}})),QM=ix(((e,t)=>{var i=Lx(),r=TypeError,n=function(e){var t,n;this.promise=new e((function(e,i){if(void 0!==t||void 0!==n)throw new r("Bad Promise constructor");t=e,n=i})),this.resolve=i(t),this.reject=i(n)};t.exports.f=function(e){return new n(e)}})),YM=ix((()=>{var e,t,i,r=Jx(),n=Mx(),a=pM(),s=nx(),o=px(),l=fM(),u=SM(),d=bM(),c=AM(),h=Lx(),p=cx(),f=Tx(),m=RM(),g=CM(),v=NM().set,S=UM(),y=BM(),T=FM(),E=kM(),b=qM(),_=zM(),A=WM(),R=QM(),w="Promise",P=A.CONSTRUCTOR,O=A.REJECTION_EVENT,C=A.SUBCLASSING,L=b.getterFor(w),I=b.set,x=_&&_.prototype,M=_,N=x,D=s.TypeError,k=s.document,$=s.process,V=R.f,U=V,B=!!(k&&k.createEvent&&s.dispatchEvent),F="unhandledrejection",H=function(e){var t;return!(!f(e)||!p(t=e.then))&&t},j=function(e,t){var i,r,n,a=t.value,s=1===t.state,l=s?e.ok:e.fail,u=e.resolve,d=e.reject,c=e.domain;try{l?(s||(2===t.rejection&&Q(t),t.rejection=1),!0===l?i=a:(c&&c.enter(),i=l(a),c&&(c.exit(),n=!0)),i===e.promise?d(new D("Promise-chain cycle")):(r=H(i))?o(r,i,u,d):u(i)):d(a)}catch(e){c&&!n&&c.exit(),d(e)}},G=function(e,t){e.notified||(e.notified=!0,S((function(){for(var i,r=e.reactions;i=r.get();)j(i,e);e.notified=!1,t&&!e.rejection&&z(e)})))},q=function(e,t,i){var r,n;B?((r=k.createEvent("Event")).promise=t,r.reason=i,r.initEvent(e,!1,!0),s.dispatchEvent(r)):r={promise:t,reason:i},!O&&(n=s["on"+e])?n(r):e===F&&y("Unhandled promise rejection",i)},z=function(e){o(v,s,(function(){var t,i=e.facade,r=e.value;if(W(e)&&(t=T((function(){a?$.emit("unhandledRejection",r,i):q(F,i,r)})),e.rejection=a||W(e)?2:1,t.error))throw t.value}))},W=function(e){return 1!==e.rejection&&!e.parent},Q=function(e){o(v,s,(function(){var t=e.facade;a?$.emit("rejectionHandled",t):q("rejectionhandled",t,e.value)}))},Y=function(e,t,i){return function(r){e(t,r,i)}},K=function(e,t,i){e.done||(e.done=!0,i&&(e=i),e.value=t,e.state=2,G(e,!0))},X=function(e,t,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===t)throw new D("Promise can't be resolved itself");var r=H(t);r?S((function(){var i={done:!1};try{o(r,t,Y(X,i,e),Y(K,i,e))}catch(t){K(i,t,e)}})):(e.value=t,e.state=1,G(e,!1))}catch(t){K({done:!1},t,e)}}};if(P&&(M=function(t){m(this,N),h(t),o(e,this);var i=L(this);try{t(Y(X,i),Y(K,i))}catch(e){K(i,e)}},N=M.prototype,(e=function(e){I(this,{type:w,done:!1,notified:!1,parent:!1,reactions:new E,rejection:!1,state:0,value:void 0})}).prototype=l(N,"then",(function(e,t){var i=L(this),r=V(g(this,M));return i.parent=!0,r.ok=!p(e)||e,r.fail=p(t)&&t,r.domain=a?$.domain:void 0,0===i.state?i.reactions.add(r):S((function(){j(r,i)})),r.promise})),t=function(){var t=new e,i=L(t);this.promise=t,this.resolve=Y(X,i),this.reject=Y(K,i)},R.f=V=function(e){return e===M||undefined===e?new t(e):U(e)},!n&&p(_)&&x!==Object.prototype)){i=x.then,C||l(x,"then",(function(e,t){var r=this;return new M((function(e,t){o(i,r,e,t)})).then(e,t)}),{unsafe:!0});try{delete x.constructor}catch(e){}u&&u(x,N)}r({global:!0,constructor:!0,wrap:!0,forced:P},{Promise:M}),d(M,w,!1,!0),c(w)})),KM=ix(((e,t)=>{t.exports={}})),XM=ix(((e,t)=>{var i=Bx(),r=KM(),n=i("iterator"),a=Array.prototype;t.exports=function(e){return void 0!==e&&(r.Array===e||a[n]===e)}})),JM=ix(((e,t)=>{var i=TM(),r=Ix(),n=vx(),a=KM(),s=Bx()("iterator");t.exports=function(e){if(!n(e))return r(e,s)||r(e,"@@iterator")||a[i(e)]}})),ZM=ix(((e,t)=>{var i=px(),r=Lx(),n=Yx(),a=Cx(),s=JM(),o=TypeError;t.exports=function(e,t){var l=arguments.length<2?s(e):t;if(r(l))return n(i(l,e));throw new o(a(e)+" is not iterable")}})),eN=ix(((e,t)=>{var i=px(),r=Yx(),n=Ix();t.exports=function(e,t,a){var s,o;r(e);try{if(!(s=n(e,"return"))){if("throw"===t)throw a;return a}s=i(s,e)}catch(e){o=!0,s=e}if("throw"===t)throw a;if(o)throw s;return r(s),a}})),tN=ix(((e,t)=>{var i=Wx(),r=px(),n=Yx(),a=Cx(),s=XM(),o=rM(),l=_x(),u=ZM(),d=JM(),c=eN(),h=TypeError,p=function(e,t){this.stopped=e,this.result=t},f=p.prototype;t.exports=function(e,t,m){var g,v,S,y,T,E,b,_=m&&m.that,A=!(!m||!m.AS_ENTRIES),R=!(!m||!m.IS_RECORD),w=!(!m||!m.IS_ITERATOR),P=!(!m||!m.INTERRUPTED),O=i(t,_),C=function(e){return g&&c(g,"normal",e),new p(!0,e)},L=function(e){return A?(n(e),P?O(e[0],e[1],C):O(e[0],e[1])):P?O(e,C):O(e)};if(R)g=e.iterator;else if(w)g=e;else{if(!(v=d(e)))throw new h(a(e)+" is not iterable");if(s(v)){for(S=0,y=o(e);y>S;S++)if((T=L(e[S]))&&l(f,T))return T;return new p(!1)}g=u(e,v)}for(E=R?e.next:g.next;!(b=r(E,g)).done;){try{T=L(b.value)}catch(e){c(g,"throw",e)}if("object"==typeof T&&T&&l(f,T))return T}return new p(!1)}})),iN=ix(((e,t)=>{var i,r,n=Bx()("iterator"),a=!1;try{i=0,(r={next:function(){return{done:!!i++}},return:function(){a=!0}})[n]=function(){return this},Array.from(r,(function(){throw 2}))}catch(e){}t.exports=function(e,t){try{if(!t&&!a)return!1}catch(e){return!1}var i=!1;try{var r={};r[n]=function(){return{next:function(){return{done:i=!0}}}},e(r)}catch(e){}return i}})),rN=ix(((e,t)=>{var i=zM(),r=iN(),n=WM().CONSTRUCTOR;t.exports=n||!r((function(e){i.all(e).then(void 0,(function(){}))}))})),nN=ix((()=>{var e=Jx(),t=px(),i=Lx(),r=QM(),n=FM(),a=tN();e({target:"Promise",stat:!0,forced:rN()},{all:function(e){var s=this,o=r.f(s),l=o.resolve,u=o.reject,d=n((function(){var r=i(s.resolve),n=[],o=0,d=1;a(e,(function(e){var i=o++,a=!1;d++,t(r,s,e).then((function(e){a||(a=!0,n[i]=e,--d||l(n))}),u)})),--d||l(n)}));return d.error&&u(d.value),o.promise}})})),aN=ix((()=>{var e,t=Jx(),i=Mx(),r=WM().CONSTRUCTOR,n=zM(),a=bx(),s=cx(),o=fM(),l=n&&n.prototype;t({target:"Promise",proto:!0,forced:r,real:!0},{catch:function(e){return this.then(void 0,e)}}),!i&&s(n)&&(e=a("Promise").prototype.catch,l.catch!==e&&o(l,"catch",e,{unsafe:!0}))})),sN=ix((()=>{var e=Jx(),t=px(),i=Lx(),r=QM(),n=FM(),a=tN();e({target:"Promise",stat:!0,forced:rN()},{race:function(e){var s=this,o=r.f(s),l=o.reject,u=n((function(){var r=i(s.resolve);a(e,(function(e){t(r,s,e).then(o.resolve,l)}))}));return u.error&&l(u.value),o.promise}})})),oN=ix((()=>{var e=Jx(),t=QM();e({target:"Promise",stat:!0,forced:WM().CONSTRUCTOR},{reject:function(e){var i=t.f(this);return(0,i.reject)(e),i.promise}})})),lN=ix(((e,t)=>{var i=Yx(),r=Tx(),n=QM();t.exports=function(e,t){if(i(e),r(t)&&t.constructor===e)return t;var a=n.f(e);return(0,a.resolve)(t),a.promise}})),uN=ix((()=>{var e=Jx(),t=bx(),i=Mx(),r=zM(),n=WM().CONSTRUCTOR,a=lN(),s=t("Promise"),o=i&&!n;e({target:"Promise",stat:!0,forced:i||n},{resolve:function(e){return a(o&&this===s?r:this,e)}})})),dN=ix((()=>{YM(),nN(),aN(),sN(),oN(),uN()})),cN=ix((()=>{var e,t=Jx(),i=Mx(),r=zM(),n=ax(),a=bx(),s=cx(),o=CM(),l=lN(),u=fM(),d=r&&r.prototype;t({target:"Promise",proto:!0,real:!0,forced:!!r&&n((function(){d.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=o(this,a("Promise")),i=s(e);return this.then(i?function(i){return l(t,e()).then((function(){return i}))}:e,i?function(i){return l(t,e()).then((function(){throw i}))}:e)}}),!i&&s(r)&&(e=a("Promise").prototype.finally,d.finally!==e&&u(d,"finally",e,{unsafe:!0}))})),hN=ix(((e,t)=>{cM(),dN(),cN();var i=oM();t.exports=i("Promise","finally")})),pN=ix(((e,t)=>{var i=hN();t.exports=i})),fN=ix(((e,t)=>{var i=pN();t.exports=i})),mN=ix(((e,t)=>{var i=ax();t.exports=!i((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))})),gN=ix(((e,t)=>{var i=Vx(),r=cx(),n=$x(),a=jM(),s=mN(),o=a("IE_PROTO"),l=Object,u=l.prototype;t.exports=s?l.getPrototypeOf:function(e){var t=n(e);if(i(t,o))return t[o];var a=t.constructor;return r(a)&&t instanceof a?a.prototype:t instanceof l?u:null}})),vN=ix(((e,t)=>{var i=lx(),r=Vx(),n=yx(),a=nM().indexOf,s=GM(),o=i([].push);t.exports=function(e,t){var i,l=n(e),u=0,d=[];for(i in l)!r(s,i)&&r(l,i)&&o(d,i);for(;t.length>u;)r(l,i=t[u++])&&(~a(d,i)||o(d,i));return d}})),SN=ix(((e,t)=>{t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]})),yN=ix(((e,t)=>{var i=vN(),r=SN();t.exports=Object.keys||function(e){return i(e,r)}})),TN=ix(((e,t)=>{var i=hx(),r=ax(),n=lx(),a=gN(),s=yN(),o=yx(),l=n(fx().f),u=n([].push),d=i&&r((function(){var e=Object.create(null);return e[2]=2,!l(e,2)})),c=function(e){return function(t){for(var r,n=o(t),c=s(n),h=d&&null===a(n),p=c.length,f=0,m=[];p>f;)r=c[f++],(!i||(h?r in n:l(n,r)))&&u(m,e?[r,n[r]]:n[r]);return m}};t.exports={entries:c(!0),values:c(!1)}})),EN=ix((()=>{var e=Jx(),t=TN().entries;e({target:"Object",stat:!0},{entries:function(e){return t(e)}})})),bN=ix(((e,t)=>{EN();var i=Ex();t.exports=i.Object.entries})),_N=ix(((e,t)=>{var i=bN();t.exports=i})),AN=ix(((e,t)=>{var i=_N();t.exports=i})),RN=ix(((e,t)=>{var i=hx(),r=Vx(),n=Function.prototype,a=i&&Object.getOwnPropertyDescriptor,s=r(n,"name"),o=s&&"something"===function(){}.name,l=s&&(!i||i&&a(n,"name").configurable);t.exports={EXISTS:s,PROPER:o,CONFIGURABLE:l}})),wN=ix((e=>{var t=hx(),i=Qx(),r=Kx(),n=Yx(),a=yx(),s=yN();e.f=t&&!i?Object.defineProperties:function(e,t){n(e);for(var i,o=a(t),l=s(t),u=l.length,d=0;u>d;)r.f(e,i=l[d++],o[i]);return e}})),PN=ix(((e,t)=>{var i,r=Yx(),n=wN(),a=SN(),s=GM(),o=LM(),l=jx(),u=jM(),d="prototype",c="script",h=u("IE_PROTO"),p=function(){},f=function(e){return"<"+c+">"+e+"</"+c+">"},m=function(e){e.write(f("")),e.close();var t=e.parentWindow.Object;return e=null,t},g=function(){try{i=new ActiveXObject("htmlfile")}catch(e){}g="undefined"!=typeof document?document.domain&&i?m(i):function(){var e,t=l("iframe"),i="java"+c+":";return t.style.display="none",o.appendChild(t),t.src=String(i),(e=t.contentWindow.document).open(),e.write(f("document.F=Object")),e.close(),e.F}():m(i);for(var e=a.length;e--;)delete g[d][a[e]];return g()};s[h]=!0,t.exports=Object.create||function(e,t){var i;return null!==e?(p[d]=r(e),i=new p,p[d]=null,i[h]=e):i=g(),void 0===t?i:n.f(i,t)}})),ON=ix(((e,t)=>{var i,r,n,a=ax(),s=cx(),o=Tx(),l=PN(),u=gN(),d=fM(),c=Bx(),h=Mx(),p=c("iterator"),f=!1;[].keys&&("next"in(n=[].keys())?(r=u(u(n)))!==Object.prototype&&(i=r):f=!0);var m=!o(i)||a((function(){var e={};return i[p].call(e)!==e}));m?i={}:h&&(i=l(i)),s(i[p])||d(i,p,(function(){return this})),t.exports={IteratorPrototype:i,BUGGY_SAFARI_ITERATORS:f}})),CN=ix(((e,t)=>{var i=ON().IteratorPrototype,r=PN(),n=mx(),a=bM(),s=KM(),o=function(){return this};t.exports=function(e,t,l,u){var d=t+" Iterator";return e.prototype=r(i,{next:n(+!u,l)}),a(e,d,!1,!0),s[d]=o,e}})),LN=ix(((e,t)=>{var i=Jx(),r=px(),n=Mx(),a=RN(),s=cx(),o=CN(),l=gN(),u=SM(),d=bM(),c=Xx(),h=fM(),p=Bx(),f=KM(),m=ON(),g=a.PROPER,v=a.CONFIGURABLE,S=m.IteratorPrototype,y=m.BUGGY_SAFARI_ITERATORS,T=p("iterator"),E="keys",b="values",_="entries",A=function(){return this};t.exports=function(e,t,a,p,m,R,w){o(a,t,p);var P,O,C,L=function(e){if(e===m&&D)return D;if(!y&&e&&e in M)return M[e];switch(e){case E:case b:case _:return function(){return new a(this,e)}}return function(){return new a(this)}},I=t+" Iterator",x=!1,M=e.prototype,N=M[T]||M["@@iterator"]||m&&M[m],D=!y&&N||L(m),k="Array"===t&&M.entries||N;if(k&&((P=l(k.call(new e)))!==Object.prototype&&P.next&&(!n&&l(P)!==S&&(u?u(P,S):s(P[T])||h(P,T,A)),d(P,I,!0,!0),n&&(f[I]=A))),g&&m===b&&N&&N.name!==b&&(!n&&v?c(M,"name",b):(x=!0,D=function(){return r(N,this)})),m)if(O={values:L(b),keys:R?D:L(E),entries:L(_)},w)for(C in O)(y||x||!(C in M))&&h(M,C,O[C]);else i({target:t,proto:!0,forced:y||x},O);return(!n||w)&&M[T]!==D&&h(M,T,D,{name:m}),f[t]=D,O}})),IN=ix(((e,t)=>{t.exports=function(e,t){return{value:e,done:t}}})),xN=ix(((e,t)=>{var i=yx(),r=aM(),n=KM(),a=qM(),s=Kx().f,o=LN(),l=IN(),u=Mx(),d=hx(),c="Array Iterator",h=a.set,p=a.getterFor(c);t.exports=o(Array,"Array",(function(e,t){h(this,{type:c,target:i(e),index:0,kind:t})}),(function(){var e=p(this),t=e.target,i=e.index++;if(!t||i>=t.length)return e.target=void 0,l(void 0,!0);switch(e.kind){case"keys":return l(i,!1);case"values":return l(t[i],!1)}return l([i,t[i]],!1)}),"values");var f=n.Arguments=n.Array;if(r("keys"),r("values"),r("entries"),!u&&d&&"values"!==f.name)try{s(f,"name",{value:"values"})}catch(e){}})),MN=ix(((e,t)=>{var i=hx(),r=Kx(),n=mx();t.exports=function(e,t,a){i?r.f(e,t,n(0,a)):e[t]=a}})),NN=ix((()=>{var e=Jx(),t=tN(),i=MN();e({target:"Object",stat:!0},{fromEntries:function(e){var r={};return t(e,(function(e,t){i(r,e,t)}),{AS_ENTRIES:!0}),r}})})),DN=ix(((e,t)=>{xN(),NN();var i=Ex();t.exports=i.Object.fromEntries})),kN=ix(((e,t)=>{t.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}})),$N=ix((()=>{xN();var e,t=kN(),i=nx(),r=bM(),n=KM();for(e in t)r(i[e],e),n[e]=n.Array})),VN=ix(((e,t)=>{var i=DN();$N(),t.exports=i})),UN=ix(((e,t)=>{var i=VN();t.exports=i})),BN=ix(((e,t)=>{var i=TM(),r=String;t.exports=function(e){if("Symbol"===i(e))throw new TypeError("Cannot convert a Symbol value to a string");return r(e)}})),FN=ix(((e,t)=>{var i=eM(),r=BN(),n=Sx(),a=RangeError;t.exports=function(e){var t=r(n(this)),s="",o=i(e);if(o<0||o===1/0)throw new a("Wrong number of repetitions");for(;o>0;(o>>>=1)&&(t+=t))1&o&&(s+=t);return s}})),HN=ix(((e,t)=>{var i=lx(),r=iM(),n=BN(),a=FN(),s=Sx(),o=i(a),l=i("".slice),u=Math.ceil,d=function(e){return function(t,i,a){var d,c,h=n(s(t)),p=r(i),f=h.length,m=void 0===a?" ":n(a);return p<=f||""===m?h:((c=o(m,u((d=p-f)/m.length))).length>d&&(c=l(c,0,d)),e?h+c:c+h)}};t.exports={start:d(!1),end:d(!0)}})),jN=ix(((e,t)=>{var i=Ax();t.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(i)})),GN=ix((()=>{var e=Jx(),t=HN().start;e({target:"String",proto:!0,forced:jN()},{padStart:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}})})),qN=ix(((e,t)=>{GN();var i=oM();t.exports=i("String","padStart")})),zN=ix(((e,t)=>{var i=qN();t.exports=i})),WN=ix(((e,t)=>{var i=zN();t.exports=i})),QN=rx(dM(),1),YN=((DI=YN||{}).PROD="prod",DI.VK_ALIAS="vk_alias",DI.VIDEOTEST="videotest",DI.TEST="test",DI.OKCDN="okcdn",DI.AUTO="auto",DI),KN=((NI=KN||{}).Q144P="mobile",NI.Q240P="lowest",NI.Q360P="low",NI.Q480P="medium",NI.Q720P="high",NI.Q1080P="fullhd",NI.Q1440P="quadhd",NI.Q2160P="ultrahd",NI.UNKNOWN="unknown",NI),XN=(e=>(e.MP4="mp4",e.DASH="dash",e.DASH_SEP="dash_sep",e.ONDEMAND_DASH="ondemand_dash",e.HLS="hls",e.ONDEMAND_HLS="ondemand_hls",e.WEBM="webm",e.AV1="av1",e.ONDEMAND_DASH_LIVE="ondemand_dash_live",e.ONDEMAND_HLS_LIVE="ondemand_hls_live",e.WEBRTC="webrtc",e.UNKNOWN="unknown",e.RTMP="rtmp",e))(XN||{}),JN=(e=>(e.HTTP1="http1",e.HTTP2="http2",e.HTTP3="http3",e))(JN||{}),ZN=(e=>(e.SLIDER="slider",e.DOUBLE_TAP="double_tap",e.TIME_CODE="time_code",e.EPISODE="episode",e.REWIND="rewind",e.LIVE="live",e.UNKNOWN="unknown",e))(ZN||{}),eD=((kI=eD||{}).GRAPH_SHOW="iGraphShow",kI.GRAPH_HIDE="iGraphHide",kI.NEXT_AREA="iNextChapterArea",kI.NEXT_BUTTON="iNextChapterBtn",kI.WATCH_AGAIN="iWatchAgainBtn",kI),tD={action_play:"ap",action_play_interactive:"api",first_bytes:"fb",player_ready:"pr",first_frame:"ff",seek:"sk",watch_coverage_record:"wr",watch_coverage_live:"wl",empty_buffer:"eb",action_stop:"as",close_at_empty_buffer:"cb",content_error:"er",player_interface_click:"pc",next_movie:"nm",track_switch:"ts",failover:"fo",quality:"qt"},iD={vsid:"si",isid:"is",vid:"vi",place:"pl",quality:"qt",cdn_host:"ch",stat_type:"st",param:"pm",vk_app_id:"va",track_code:"tc",connection_type:"cnt",connection_reused:"cr",cached_data:"cd",live:"lv",muted:"mu",mode:"mo",subtitles:"sb",failover:"fo",download_speed:"ds",manual_quality:"mq",ref_domain:"rd",direct_url:"du"},rD={unknown:"un",mobile:"m",lowest:"ls",low:"l",medium:"md",high:"h",fullhd:"f",quadhd:"q",ultrahd:"u"},nD={pip:"pi",fullscreen:"fs",external:"ex",prefetch:"pr",airplay:"ap",chromecast:"cc",invisible:"iv"},aD="1.0.76",sD={prod:"https://api.ok.ru",vk_alias:"https://api.mycdn.me",videotest:"https://videotestapi.ok.ru/api",test:"https://apitest.ok.ru",okcdn:"https://api.okcdn.ru",auto:""},oD={apiEnv:"vk_alias",apiKey:"CIOPGQJGDIHBABABA",requestRetryCount:1,firstFlushTime:5e3,flushDebounceTime:1e4,flushMaxWait:6e4,storageExpiration:1296e5,watchCoverageInterval:15e3,disabledOperations:["quality"],disabledCustomFields:[],shorten:!0,maxLoops:100,embedUrlParams:[],useBeacon:!0,synchronizeTime:!0,debugLog:!1,clearStorageAtUnload:!0,useVKComIsMobileLogic:!1,backoff:{start:1e3,factor:1.5,max:3e5,random:.1}};var lD=rx(fN(),1),uD=rx(AN(),1),dD=rx(UN(),1),cD=e=>{var t;let{operation:i,custom:r}=e,n=(0,dD.default)((0,uD.default)(r).map((([e,t])=>{var i,r,n;let a=null!=(i=iD[e])?i:e,s=t;return t&&("mode"===e?s=null!=(r=nD[t])?r:t:"quality"===e&&(s=null!=(n=rD[t])?n:t)),[a,s]})));return{...e,operation:null!=(t=tD[i])?t:i,custom:n}},hD=/Mobile|mini|Fennec|Android|iP(ad|od|hone)|opera (mini|mobi)/i,pD=class{constructor(e){this.consequentAuthErrors=0,this.authorized$=new n_(!1),this.params=e}async authorize(e){return this.authToken=null!=e?e:await this.refreshAuthToken(),this._authorizeWithBackoff()}logBeacon(e){let t=this.createLogParams(e),i=this.sessionKey;i&&(this.params.apiTransport.sendBeacon("log.externalLog",t,i)||this.logRequest(e).catch((()=>{})))}async logRequest(e){var t;let i="log.externalLog",r=this.createLogParams(e),n=null!=(t=this.sessionKey)?t:await this._authorizeWithBackoff();if(!n)return;let a=async(e,t=this.params.config.requestRetryCount)=>{try{return await this.params.apiTransport.sendRequest(i,r,n)}catch(r){if(!r||!("error_code"in r))return void this.params.error$.next({id:"logRequestUnknown",category:M_.NETWORK,message:`Unknown ${i} error`,thrown:r});let n=null==r?void 0:r.error_code;switch(n){case 102:case 103:case 104:return this.authorized$.next(!1),this.sessionKey=await this._authorizeWithBackoff(),t>0?a(e,t-1):void 0;case 401:return this.authorized$.next(!1),this.authToken=await this.refreshAuthToken(),this.sessionKey=await this._authorizeWithBackoff(),t>0?a(e,t-1):void 0;default:return void this.params.error$.next({id:`LogRequest#${n}`,category:M_.EXTERNAL_API,message:`${i} error`,data:r})}}};return a(e)}destroy(){window.clearTimeout(this.backoffTimeoutId),this.backoffTimeoutId=0}async refreshAuthToken(){if(this.params.refreshAuthToken)return this.refreshAuthTokenPromise||(this.refreshAuthTokenPromise=(0,lD.default)(this.params.refreshAuthToken(),(()=>{this.refreshAuthTokenPromise=void 0}))),this.refreshAuthTokenPromise}createLogParams(e){let t="WEB",i=!1;if(this.params.config.useVKComIsMobileLogic){let{appVersion:e}=window.navigator;i=hD.test(e)}else this.params.mobile&&(i=!0);return i&&(t="M_WEB"),{collector:"ok.mobile.apps.video",data:JSON.stringify({application:`@vkontakte/videoplayer-statistics:${aD}`,platform:t,items:this.params.config.shorten?e.map(cD):e})}}_authorizeWithBackoff(){if(!this.consequentAuthErrors)return this._authorize();let e=wb(this.consequentAuthErrors,this.params.config.backoff);return new Promise((t=>{this.backoffTimeoutId||(this.backoffTimeoutId=window.setTimeout((()=>{(0,lD.default)(this._authorize().then(t).catch((e=>this.params.error$.next({id:"AuthorizeBackoff",category:M_.NETWORK,message:"Otherwise unhandled error in authorization",thrown:e}))),(()=>this.backoffTimeoutId=0))}),e))}))}async _authorize(){if(this.authorizePromise)return this.authorizePromise;this.sessionKey=void 0,this.authorized$.next(!1);let e={session_data:{version:2,device_id:this.params.deviceId,client_version:aD.split("-")[0],client_type:"SDK_JS"}};return void 0!==this.authToken&&(e.session_data.auth_token=this.authToken,e.session_data.version=3),this.authorizePromise=(0,lD.default)(this.params.apiTransport.sendRequest("auth.anonymLogin",e).then((e=>{var t;return(!e||!e.session_key)&&this.params.error$.next({id:"AuthorizeFailed",category:M_.EXTERNAL_API,message:"No session key",data:e}),this.sessionKey=null!=(t=null==e?void 0:e.session_key)?t:void 0,this.sessionKey})).catch((async e=>{this.sessionKey=void 0;let t=null==e?void 0:e.error_code;if(401===t)return this.authToken=await this.refreshAuthToken(),this._authorizeWithBackoff();t?this.params.error$.next({id:`Authorize#${t}`,category:M_.EXTERNAL_API,message:"authorize error",data:e}):this.params.error$.next({id:"AuthorizeUnknown",category:M_.NETWORK,message:"authorize error",thrown:e})})),(()=>{this.authorizePromise=void 0,this.consequentAuthErrors=this.sessionKey?0:this.consequentAuthErrors+1,this.authorized$.next(void 0!==this.sessionKey)})),this.authorizePromise}},fD=class{constructor(){Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}addEventListener(e,t,i){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push({callback:t,options:i})}removeEventListener(e,t){if(!(e in this.listeners))return;let i=this.listeners[e];for(let e=0,r=i.length;e<r;e++)if(i[e].callback===t)return void i.splice(e,1)}dispatchEvent(e){if(!(e.type in this.listeners))return;let t=this.listeners[e.type].slice();for(let i=0,r=t.length;i<r;i++){let r=t[i];try{r.callback.call(this,e)}catch(e){Promise.resolve().then((()=>{throw e}))}r.options&&r.options.once&&this.removeEventListener(e.type,r.callback)}return!e.defaultPrevented}},mD=class extends fD{constructor(){super(),this.listeners||fD.call(this),Object.defineProperty(this,"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(this,"onabort",{value:null,writable:!0,configurable:!0}),Object.defineProperty(this,"reason",{value:void 0,writable:!0,configurable:!0})}toString(){return"[object AbortSignal]"}dispatchEvent(e){"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),super.dispatchEvent(e)}},gD=class{constructor(){Object.defineProperty(this,"signal",{value:new mD,writable:!0,configurable:!0})}abort(e){let t;try{t=new Event("abort")}catch(e){"undefined"!=typeof document?document.createEvent?(t=document.createEvent("Event"),t.initEvent("abort",!1,!1)):(t=document.createEventObject(),t.type="abort"):t={type:"abort",bubbles:!1,cancelable:!1}}let i=e;if(void 0===i)if("undefined"==typeof document)i=new Error("This operation was aborted"),i.name="AbortError";else try{i=new DOMException("signal is aborted without reason")}catch(e){i=new Error("This operation was aborted"),i.name="AbortError"}this.signal.reason=i,this.signal.dispatchEvent(t)}toString(){return"[object AbortController]"}};function vD(e){return e.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL?(console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill"),!0):"function"==typeof e.Request&&!e.Request.prototype.hasOwnProperty("signal")||!e.AbortController}"undefined"!=typeof Symbol&&Symbol.toStringTag&&(gD.prototype[Symbol.toStringTag]="AbortController",mD.prototype[Symbol.toStringTag]="AbortSignal");var SD=vD({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}),yD=SD?function(e){"function"==typeof e&&(e={fetch:e});let{fetch:t,Request:i=t.Request,AbortController:r,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:n=!1}=e;if(!vD({fetch:t,Request:i,AbortController:r,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:n}))return{fetch:t,Request:a};let a=i;(a&&!a.prototype.hasOwnProperty("signal")||n)&&(a=function(e,t){let r;t&&t.signal&&(r=t.signal,delete t.signal);let n=new i(e,t);return r&&Object.defineProperty(n,"signal",{writable:!1,enumerable:!1,configurable:!0,value:r}),n},a.prototype=i.prototype);let s=t;return{fetch:(e,t)=>{let i=a&&a.prototype.isPrototypeOf(e)?e.signal:t?t.signal:void 0;if(i){let r;try{r=new DOMException("Aborted","AbortError")}catch(e){r=new Error("Aborted"),r.name="AbortError"}if(i.aborted)return Promise.reject(r);let n=new Promise(((e,t)=>{i.addEventListener("abort",(()=>t(r)),{once:!0})}));return t&&t.signal&&delete t.signal,Promise.race([n,s(e,t)])}return s(e,t)},Request:a}}({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}):void 0,TD=SD?yD.fetch:window.fetch,ED=(SD?yD.Request:window.Request,SD||window.AbortController,SD||window.AbortSignal,rx(dM(),1)),bD=rx(AN(),1),_D=class{constructor(e){this.params=e,this.apiKey=e.config.apiKey,this.apiEnv=e.config.apiEnv,this.apiBaseUrl=sD[this.apiEnv],this.timeSynchronisation=e.timeSynchronisation,this.isApiBaseUrlFetched=!1}async resolveApiBaseUrl(){var e;if("auto"!==this.apiEnv||this.isApiBaseUrlFetched)return this.apiBaseUrl;try{let t=atob("aHR0cHM6Ly9kbnMuZ29vZ2xlL3Jlc29sdmU/bmFtZT12aWRlby5fZW5kcG9pbnQub2sucnUmdHlwZT1UWFQ="),i=await(await TD(t,{method:"GET",mode:"cors",cache:"no-cache"})).json(),r=null==(e=null==i?void 0:i.Answer[0])?void 0:e.data;if(!r)throw new Error("Wrong DNS response");return r}catch(e){return this.params.error$.next({id:"OneStat:ApiTransport:resolveApiBaseUrl",category:M_.NETWORK,message:"Unhandled resolve api base url error",thrown:e}),sD.vk_alias}finally{this.isApiBaseUrlFetched=!0}}sendBeacon(e,t,i){if(!window.Blob||!window.navigator.sendBeacon)return!1;let r=this._prepareQueryParams({method:e,queryParams:t,sessionKey:i}),n=new window.Blob([r.toString()],{type:"application/x-www-form-urlencoded"});try{return window.navigator.sendBeacon(`${this.apiBaseUrl}/fb.do`,n)}catch(i){this.params.error$.next({id:"OneStat:ApiTransport:sendBeacon",category:M_.NETWORK,message:"Unhandled beacon error",thrown:i,data:{method:e,params:t}})}return!1}async sendRequest(e,t,i){let r=Ab(),n=n=>{n instanceof TypeError&&(0,ED.default)(["Failed to fetch","NetworkError when attempting to fetch resource."],n.message)?this.params.error$.next({id:"Network",category:M_.NETWORK,message:"Request failed",thrown:n}):this.params.error$.next({id:"OneStat:ApiTransport:sendRequest",category:M_.NETWORK,message:"Unhandled request error",thrown:n,data:{method:e,params:t,sessionKey:i,time:Ab()-r}})};return this.apiBaseUrl=await this.resolveApiBaseUrl(),TD(`${this.apiBaseUrl}/fb.do`,{method:"post",headers:{"Content-type":"application/x-www-form-urlencoded"},body:this._prepareQueryParams({method:e,queryParams:t,sessionKey:i})}).then((e=>{var t,i;let a=0===Number(e.headers.get("content-length")),s=new Date(null!=(t=e.headers.get("date"))?t:"").getTime(),o=Ab()-r;if(isFinite(s)&&(null==(i=this.timeSynchronisation)||i.addServerTime(s,o)),!a)return e.json().then((e=>Object.prototype.hasOwnProperty.call(e,"error_msg")?Promise.reject(e):e),n)}),n)}_prepareQueryParams(e){let t=new URLSearchParams({format:"JSON",method:e.method,application_key:this.apiKey});return void 0!==e.sessionKey&&t.append("session_key",e.sessionKey),(0,bD.default)(e.queryParams).forEach((([e,i])=>t.append(e,"string"==typeof i?i:JSON.stringify(i)))),t}},AD=rx(dM(),1),RD=rx(AN(),1),wD="onestat_events",PD=e=>t=>t.timestamp+e>=Ab(),OD=class{constructor(e){this.unsaltedStorage=[],this.isPaused=!1,this.isUrgent=e=>{let{operation:t}=e;return(0,AD.default)(["action_play","watch_coverage_record","watch_coverage_live"],t)},this.params=e,this.api=e.api,this.error$=e.error$,this.userSalt=e.userSalt,this.loggerDebugLog=e.debugLogger.createComponentLog("stat logger"),this.firstFlush=Jb((()=>this.safeFlush()),this.params.config.firstFlushTime,{maxWait:this.params.config.firstFlushTime});let t=Pb.isPersistent()?this.params.config.flushMaxWait:0;this.debouncedFlush=Jb((()=>this.safeFlush()),this.params.config.flushDebounceTime,{maxWait:t}),this.subscription=this.api.authorized$.subscribe((e=>{e&&this.debouncedFlush()})),this.housekeepStorage()}safeFlush(){try{this.flush()}catch(e){this.error$.next({id:"LoggerError",category:M_.WTF,message:e?String(e):"Unknown logger error",thrown:e})}}readFromStorage(){let e=Pb.get(wD);try{return e?JSON.parse(e):{}}catch(e){}return{}}addToStorage(e){var t;if(!this.userSalt)return void this.unsaltedStorage.push(e);let i=this.readFromStorage(),r=(null!=(t=i[this.userSalt])?t:[]).filter(PD(this.params.config.storageExpiration));Pb.set(wD,JSON.stringify({...i,[this.userSalt]:[...r,e]}))}getFromStorage(){var e;return this.userSalt?(null!=(e=this.readFromStorage()[this.userSalt])?e:[]).filter(PD(this.params.config.storageExpiration)):this.unsaltedStorage}markStorageSent(){if(!this.userSalt)return void(this.unsaltedStorage=[]);let e=this.readFromStorage();delete e[this.userSalt],Pb.set(wD,JSON.stringify(e))}housekeepStorage(){let e=this.readFromStorage();for(let[t,i]of(0,RD.default)(e)){let r=i.filter(PD(this.params.config.storageExpiration));r.length?e[t]=r:delete e[t],this.loggerDebugLog({message:`${i.length} retrieved from storage, ${r.length} of them actual`})}Pb.set(wD,JSON.stringify(e))}log(e){this.addToStorage(e),!this.isPaused&&(this.isUrgent(e)?this.flush():this.lastVsid!==e.custom.vsid?this.firstFlush():this.debouncedFlush(),this.lastVsid=e.custom.vsid)}flush({wantBeacon:e,clearStorage:t}={wantBeacon:!1,clearStorage:!0}){let i=this.getFromStorage();0!==i.length&&(this.api.authorized$.getValue()?(e&&this.params.config.useBeacon?(this.loggerDebugLog({message:`Flushing ${i.length} events through beacon`}),this.api.logBeacon(i)):(this.loggerDebugLog({message:`Flushing ${i.length} events`}),this.api.logRequest(i)),t&&this.markStorageSent()):this.api.authorize(),this.firstFlush.cancel(),this.debouncedFlush.cancel())}pause(){this.isPaused=!0,this.debouncedFlush.cancel()}resume(){this.isPaused=!1,this.debouncedFlush()}destroy(){this.subscription.unsubscribe(),this.firstFlush.cancel(),this.debouncedFlush.cancel()}},CD=e=>e&&{[BP.HTTP1]:"http1",[BP.HTTP2]:"http2",[BP.QUIC]:"http3"}[e],LD=e=>{if(void 0!==e)switch(e){case VP.MPEG:return"mp4";case VP.DASH:case VP.DASH_LIVE:case VP.DASH_STREAMS:return"dash";case VP.DASH_SEP:return"dash_sep";case VP.DASH_ONDEMAND:return"ondemand_dash";case VP.DASH_WEBM:case VP.DASH_LIVE_WEBM:return"webm";case VP.DASH_WEBM_AV1:return"av1";case VP.DASH_LIVE_CMAF:return"ondemand_dash_live";case VP.HLS:case VP.HLS_LIVE:return"hls";case VP.HLS_ONDEMAND:return"ondemand_hls";case VP.HLS_LIVE_CMAF:return"ondemand_hls_live";case VP.WEB_RTC_LIVE:return"webrtc";default:return hb(e)}},ID=e=>{if(void 0!==e)switch(e){case FP.NONE:case FP.INLINE:return;case FP.FULLSCREEN:return"fullscreen";case FP.SECOND_SCREEN:return"chromecast";case FP.PIP:return"pip";case FP.INVISIBLE:return"invisible";default:return hb(e)}},xD=e=>{switch(e){case"slow-2g":case"2g":return"poor";case"3g":return"good";case"4g":return"excellent"}},MD=class{constructor(e){this.offset=void 0,this.offset=e}getOffset(){var e;return null!=(e=this.offset)?e:0}setOffset(e){this.offset=e}now(){var e;return Date.now()+(null!=(e=this.offset)?e:0)}date(e=new Date){var t;return e.setTime(e.getTime()+(null!=(t=this.offset)?t:0)),e}addServerTime(e,t){let i=e-Date.now()-t/2;Math.abs(i)<1e3?this.offset=0:void 0===this.offset?this.offset=Math.round(i):this.offset=Math.round(.2*i+.8*this.offset)}},ND=rx(WN(),1),DD=(e,t)=>new fb((i=>{let r,n=new cb,a=o_(d_(window,"beforeunload"),e.events.willDestruct$),s=new n_(void 0);n.add(e.info.isLive$.pipe(E_()).subscribe((t=>{r&&(r.unsubscribe(),s.next(void 0)),r=t?e.info.liveTime$.pipe(A_((e=>e&&e/1e3))).subscribe(s):e.info.position$.subscribe(s),n.add(r)})));let{playing$:o,paused$:l}=e.events,u=e.events.willSeek$.pipe(v_((()=>e.info.playbackState$.getValue()===$P.PLAYING))),d=e.events.seeked$.pipe(v_((()=>e.info.playbackState$.getValue()===$P.PLAYING))),c=!1,h=new mb;n.add(u.subscribe((()=>{c||h.next(),c=!0}))),n.add(d.subscribe((()=>c=!1)));let p,f=new mb,m=new mb,g=o_(o,d,f),v=o_(l,h,a,e.events.looped$,m),S=()=>{m.next(),f.next()};if(n.add(g.subscribe((()=>p=s.getValue()))),n.add(v.subscribe((()=>{let e=s.getValue();Eb(p)||p===e||Eb(e)||(i.next({from:p,to:e}),p=void 0)}))),t.forceInterval&&isFinite(t.forceInterval)){let e=0;n.add(g.subscribe((()=>e=window.setTimeout(S,t.forceInterval)))),n.add(v.subscribe((()=>window.clearTimeout(e))))}return n})),kD="_one-stat_",$D=`${kD}uuid`,VD=`${kD}deviceId`,UD=()=>{let e=new cb;return{subscription:e,subscribe:(t,i)=>{t&&e.add(t.subscribe(i))}}},BD=class{constructor(e,t){var i,r,n;this.subscription=new cb,this.debugLogger=new gb,this.oneStatDebugLog=this.debugLogger.createComponentLog("onestat"),this.loopCounter=0,this.disabled=!1,this.vsid$=new n_(void 0),this.isid$=new n_(void 0),this.zenUid$=new n_(void 0),this.seekAction$=new n_("unknown"),this.statContext=e,this.config=(e=>Xb(e,oD))(null!=(i=t.config)?i:{}),Tb(t.apiEnv)&&(this.config.apiEnv=t.apiEnv),this.config.synchronizeTime&&(this.timeSynchronisation=new MD);let a=new mb;this.experimental={error$:a},Pb.get($D)&&Pb.remove($D);let s=Pb.get(VD);this.statContext.deviceId?this.deviceId=this.statContext.deviceId:s?this.deviceId=s:(this.deviceId=function(){let e,t,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),r=new Array(36),n=0;for(t=0;t<36;t++)8===t||13===t||18===t||23===t?r[t]="-":14===t?r[t]="4":(n<=2&&(n=33554432+16777216*Math.random()|0),e=15&n,n>>=4,r[t]=i[19===t?3&e|8:e]);return r.join("")}(),Pb.set(VD,this.deviceId)),this.resetViewSession(),t.useIsid&&this.isid$.next(null!=(r=t.isid)?r:(0,ND.default)(Math.floor(Math.random()*2**64).toString(36),13,"0")),this.zenUid$.next(t.zenUid);let o=new _D({config:this.config,error$:a,timeSynchronisation:this.timeSynchronisation});this.api=new pD({config:this.config,apiTransport:o,refreshAuthToken:t.refreshAuthToken,mobile:null!=(n=this.statContext.mobile)&&n,deviceId:this.deviceId,error$:a}),this.logger=new OD({config:this.config,debugLogger:this.debugLogger,api:this.api,error$:a,userSalt:t.userSalt});let{isEmbed:l,topOrigin:u}=(()=>{let e,t=[];try{e=window.self!==window.top}catch(t){t instanceof DOMException&&"SecurityError"===t.name?e=!0:(e=!1,console.error(t))}try{window.location.ancestorOrigins&&(t=[...window.location.ancestorOrigins])}catch(e){console.error(e)}try{!t.length&&document.referrer&&(t=[new URL(document.referrer).origin])}catch(e){console.error(e)}return{isEmbed:e,origins:t,topOrigin:(0,Ub.default)(t,-1),immediateOrigin:(0,Ub.default)(t,0)}})();this.isEmbed=l,this.embedParent=u?new URL(u).hostname:void 0,this.subscribe()}updateContext(e){this.statContext={...this.statContext,...e}}attachTo(e){let t,i=new cb,r=(e,t)=>i.add(e.subscribe(t));r(e.events.willStart$,(()=>{let t=e.info.position$.getValue();this.logActionPlay({position:t}),this.statContext.projectId&&this.logActionPlayInteractive()})),r(e.events.looped$,(()=>{this.resetViewSession(),++this.loopCounter>this.config.maxLoops&&(this.disabled=!0),this.logActionPlay({position:e.info.position$.getValue()})})),r(e.events.seeked$,(()=>{this.logSeek({action:this.seekAction$.getValue(),time:e.info.position$.getValue()}),this.seekAction$.next("unknown")})),r(e.events.paused$,(()=>{this.logPause({position:e.info.position$.getValue()})})),r(e.events.willResume$,(()=>{this.logPlay()})),r(e.events.started$,(()=>{this.statContext.clip&&this.logWatchCoverageRecord({start:0,end:0})})),r(e.events.playing$,(()=>{this.logPlaying()})),r(DD(e,{forceInterval:this.config.watchCoverageInterval}),(t=>{var i,r,n,a;let s=e.info.isLive$.getValue(),o=e.info.atLiveEdge$.getValue(),l={start:parseFloat(t.from.toFixed(3)),end:parseFloat(t.to.toFixed(3))};if(o){let t=null!=(i=e.info.liveLatency$.getValue())?i:0,s=null!=(n=null==(r=e.info.currentBuffer$.getValue())?void 0:r.end)?n:0,o=null!=(a=e.info.liveBufferTime$.getValue())?a:0,u=Math.round(1e3*(t-(s-o))),d=Math.round(1e3*t);u&&d&&(l.latency=u,l.bufferLatency=d)}s?this.logWatchCoverageLive(l):this.logWatchCoverageRecord(l)})),r(e.info.isStalled$,(e=>{e?t=Ab():(Tb(t)&&this.logEmptyBuffer({duration:Ab()-t}),t=void 0)}));let n=!1;i.add(e.events.fatalError$.pipe(P_()).subscribe((()=>n=!0))),r(e.events.willStop$,(()=>{if(e.info.isStalled$.getValue()){let e=Tb(t)?Ab()-t:void 0;this.logCloseAtEmptyBuffer({duration:null!=e?e:0}),t=void 0}else n||this.logActionStop()})),r(e.events.managedError$,(({id:e})=>{this.logError({fatal:!1,errorType:e})})),r(e.events.fatalError$,(({id:e})=>{this.logError({fatal:!0,errorType:e})}));let a,s,o,l,u,d=!1;return r(e.events.firstBytes$,(e=>{a=Ab(),this.logFirstBytes({time:e})})),r(e.events.willStart$,(()=>s=Ab())),r(e.info.currentBuffer$,(e=>{!d&&e&&e.end-e.start>0&&Tb(a)&&(this.logPlayerReady({duration:Ab()-a}),d=!0)})),r(e.events.firstFrame$,(()=>{Tb(a)&&!d&&(this.logPlayerReady({duration:Ab()-a}),d=!0),Tb(s)&&this.logFirstFrame({time:Ab()-s})})),r(e.info.currentVideoStream$,(e=>{e&&(o&&e.id!==o&&this.logTrackSwitch(e),o=e.id)})),r(e.info.currentAudioStream$,(e=>{e&&(l&&e.id!==l&&this.logTrackSwitch(e),l=e.id)})),r(e.info.atLiveEdge$,(e=>this.updateContext({liveEdge:e}))),r(s_({muted:e.info.muted$,volume:e.info.volume$}),(({muted:e,volume:t})=>this.updateContext({audible:!e&&t>0}))),r(e.info.currentQuality$,(e=>{let t=(e=>e&&{[Bb.INVARIANT]:"unknown",[Bb.Q_144P]:"mobile",[Bb.Q_240P]:"lowest",[Bb.Q_360P]:"low",[Bb.Q_480P]:"medium",[Bb.Q_576P]:"unknown",[Bb.Q_720P]:"high",[Bb.Q_1080P]:"fullhd",[Bb.Q_1440P]:"quadhd",[Bb.Q_2160P]:"ultrahd",[Bb.Q_4320P]:"unknown"}[e])(e);this.updateContext({quality:t}),t&&this.logQuality(t)})),r(e.info.isAutoQualityEnabled$,(e=>this.updateContext({autoQuality:e}))),r(e.info.currentFormat$,(e=>this.updateContext({contentType:LD(e)}))),r(e.info.currentPlaybackRate$,(e=>this.updateContext({rate:e}))),r(e.info.is3DVideo$,(e=>this.updateContext({is3d:e}))),r(e.info.hostname$,(e=>{let t=void 0!==u&&u!==e;this.updateContext({cdnHostname:e,failover:t}),t&&this.logFailover(e),u=e})),r(e.info.throughputEstimation$,(e=>this.updateContext({downloadSpeed:e}))),r(e.info.httpConnectionType$,(e=>{this.statContext.firstConnectionType||this.updateContext({firstConnectionType:CD(e)}),this.updateContext({connectionType:CD(e)})})),r(e.info.httpConnectionReused$,(e=>{Eb(this.statContext.firstConnectionReused)&&this.updateContext({firstConnectionReused:e}),this.updateContext({connectionReused:e})})),r(e.info.surface$,(e=>this.updateContext({mode:ID(e)}))),r(s_({current:e.info.currentTextTrack$,available:e.info.availableTextTracks$}),(({current:e,available:t})=>{let i=t.find((({id:t})=>t===e)),r=i&&(i.isAuto?`${i.language}_auto`:i.language);this.updateContext({subtitles:null==r?void 0:r.split(".")[0]})})),this.player=e,this.uiEvents&&this.attachToUi(this.uiEvents),this.resubscribeBeforeunload(),this.subscription.add(i),i}attachToUi(e){this.uiEvents=e;let{subscription:t,subscribe:i}=UD();return this.player&&(i(e.actionRewind$,(()=>{this.player&&(this.resetViewSession(),this.logActionPlay({position:this.player.info.position$.getValue()}))})),i(e.actionSeek$,this.seekAction$),i(e.inPiP$,(e=>{var t;let i=e?"pip":ID(null==(t=this.player)?void 0:t.info.surface$.getValue());this.updateContext({mode:i})})),i(e.inFullscreen$,(e=>{var t;let i=e?"fullscreen":ID(null==(t=this.player)?void 0:t.info.surface$.getValue());this.updateContext({mode:i})})),i(e.actionSetSubtitle$,(e=>this.updateContext({subtitles:e.split(".")[0]}))),i(e.nextMovie$,(e=>this.logNextMovie(e))),this.resubscribeBeforeunload(),this.subscription.add(t)),t}attachToAds(e){let{subscription:t,subscribe:i}=UD();return i(e.slotRequested$,(()=>this.logAdSlotRequest())),i(e.started$,(e=>this.logAdStarted(e))),i(e.paused$,(()=>this.logAdPaused())),i(e.resumed$,(()=>this.logAdResumed())),i(e.ended$,(()=>this.logAdEnded())),i(e.skipped$,(()=>this.logAdSkipped())),i(e.clicked$,(()=>this.logAdClicked())),i(e.error$,(e=>this.logError({errorType:e,fatal:!1}))),this.resubscribeBeforeunload(),this.subscription.add(t),t}attachToInteractive(e){let{subscription:t,subscribe:i}=UD();return i(e.click$,(e=>this.logInterfaceClick(e))),i(e.nextMovie$,(e=>this.logNextMovie(e))),this.resubscribeBeforeunload(),this.subscription.add(t),t}authorize(e){return this.api.authorize(e)}pause(){this.logger.pause(),this.oneStatDebugLog({message:"paused"})}resume(){this.logger.resume(),this.oneStatDebugLog({message:"resumed"})}destroy(){this.logger.flush(),this.subscription.unsubscribe(),this.api.destroy(),this.logger.destroy()}resetViewSession(){this.oneStatDebugLog({message:"VSID reset"}),this.vsid$.next((0,ND.default)(Math.floor(Math.random()*2**32).toString(36),7,"0"))}getDeviceId(){return this.deviceId}setFieldBlacklist(){}logInited(){}logReady(e){this.log({operation:"player_ready",param:String(e.time)})}logStarted(...e){this.logActionPlay(...e)}logPlay(){this.log({operation:"play_toggle"})}logPlaying(){this.log({operation:"playing"})}logPause(e){this.log({operation:"pause",param:String(Math.round(e.position))})}logSeek(e){this.log({operation:"seek",param:e.action,time:e.time})}logFirstBytes(e){this.log({operation:"first_bytes",param:String(e.time)})}logFirstFrame(e){this.log({operation:"first_frame",param:String(e.time)})}logError(e){this.log({operation:"content_error",param:`${e.fatal?"fatal":"recoverable"}_${e.errorType}`})}logWatchCoverageRecord(e){this.log({operation:"watch_coverage_record",param:`${e.start}-${e.end}`},{in_history:this.statContext.inHistory?1:void 0})}logWatchCoverageLive(e){var t,i;let r=null!=(i=null==(t=this.timeSynchronisation)?void 0:t.getOffset())?i:0,n=e.start+r,a=e.end+r;this.log({operation:"watch_coverage_live",param:`${n}-${a}`},{in_history:this.statContext.inHistory?1:void 0,latency:e.latency,buffer_latency:e.bufferLatency})}logEmptyBuffer(e){this.log({operation:"empty_buffer",param:String(e.duration)})}logDownloadSpeed(){}logAdSlotRequest(){this.log({operation:"adv",param:"slot_request"})}logAdStarted(e){this.log({operation:"adv",param:e})}logAdPaused(){this.log({operation:"adv",param:"pause"})}logAdResumed(){this.log({operation:"adv",param:"resume"})}logAdEnded(){this.log({operation:"adv",param:"ended"})}logAdSkipped(){this.log({operation:"adv",param:"skip"})}logAdClicked(){this.log({operation:"adv",param:"click"})}logInterfaceClick(e){this.log({operation:"player_interface_click",param:e})}logNextMovie(e){this.log({operation:"next_movie",param:String(e)})}subscribe(){this.resubscribeBeforeunload();let e=window.navigator.connection;e&&"onchange"in e&&"effectiveType"in e&&this.subscription.add(o_(d_(e,"change"),u_(["init"])).subscribe((()=>this.updateContext({network:xD(e.effectiveType)})))),this.config.debugLog&&this.debugLogger.log$.subscribe((e=>{console.debug("%c stat ","background:#fa6470;",`component: ${e.component}.`,e.message)}))}resubscribeBeforeunload(){var e;null==(e=this.beforeunloadSubscription)||e.unsubscribe(),this.beforeunloadSubscription=d_(window,"beforeunload").subscribe((()=>this.logger.flush({wantBeacon:!0,clearStorage:this.config.clearStorageAtUnload}))),this.subscription.add(this.beforeunloadSubscription)}logPlayerReady(e){this.log({operation:"player_ready",param:String(Math.round(e.duration))})}logActionPlay(e){this.log({operation:"action_play",param:String(Math.round(e.position))})}logActionPlayInteractive(){this.statContext.projectId&&this.log({operation:"action_play_interactive",param:String(this.statContext.movieId)},{vid:this.statContext.projectId})}logFailover(e){this.log({operation:"failover",param:e})}logCloseAtEmptyBuffer(e){this.log({operation:"close_at_empty_buffer",param:String(Math.round(e.duration))})}logActionStop(){this.log({operation:"action_stop"})}logTrackSwitch(e){this.log({operation:"track_switch",param:e.id})}logQuality(e){this.log({operation:"quality",param:e})}log(e,t={}){if(this.disabled)return void this.oneStatDebugLog({message:`operation ${e.operation} but statistics is disabled`});if((0,QN.default)(this.config.disabledOperations,e.operation))return void this.oneStatDebugLog({message:`operation ${e.operation} but it is disabled`});this.oneStatDebugLog({message:`operation ${e.operation} ${e.param}`});let i=this.createLogItem(e,t);this.logger.log(i)}createLogItem({operation:e,param:t,time:i},r={}){var n,a,s,o,l,u;let d=null!=(a=null==(n=this.timeSynchronisation)?void 0:n.now())?a:Ab(),c=this.vsid$.getValue();yb(c);let h,p,f=this.isid$.getValue(),m="empty_buffer"===e||"close_at_empty_buffer"===e?this.statContext.connectionType:this.statContext.firstConnectionType,g=this.statContext.firstConnectionReused;if(this.isEmbed||"embed"===this.statContext.place){h=this.embedParent;let e=[...new URLSearchParams(location.search).entries()].filter((([e,t])=>(0,QN.default)(this.config.embedUrlParams,e)));p=new URLSearchParams(e).toString()}else"direct"===this.statContext.place&&(this.statContext.refDomain?h=null!=(o=null==(s=i_(this.statContext.refDomain))?void 0:s.hostname)?o:this.statContext.refDomain:document.referrer&&(h=null!=(u=null==(l=i_(document.referrer))?void 0:l.hostname)?u:document.referrer),p=location.href.substring(0,1024));let v={vsid:c,isid:f,vid:this.statContext.movieId,uid:this.zenUid$.getValue(),ct:this.statContext.contentType,place:this.isEmbed?"embed":this.statContext.place,quality:this.statContext.quality,cdn_host:this.statContext.cdnHostname,stat_type:!0===this.statContext.autoplay?"auto":!1===this.statContext.autoplay?"":void 0,param:t,vk_app_id:this.statContext.vkAppId,track_code:this.statContext.trackCode,connection_type:m,connection_reused:!0===g?1:!1===g?0:void 0,cached_data:!0===this.statContext.cached?1:!1===this.statContext.cached?0:void 0,live:this.statContext.liveEdge?1:void 0,muted:!1===this.statContext.audible?1:void 0,mode:this.statContext.mode,subtitles:this.statContext.subtitles,download_speed:this.statContext.downloadSpeed,manual_quality:this.statContext.autoQuality?void 0:1,ref_domain:h,direct_url:p,rate:1===this.statContext.rate||Eb(this.statContext.rate)?void 0:this.statContext.rate.toFixed(2),view_360:this.statContext.is3d?1:void 0,aid:this.statContext.albumId,vk_playlist_id:this.statContext.vkPlaylistId,...r};for(let e of this.config.disabledCustomFields)delete v[e];return{operation:e,type:1,time:i,network:this.statContext.network,timestamp:d,custom:v}}};const FD=e=>{var t,i;return(null==(t=e.additionalParams)?void 0:t.itemId)||(null==(i=e.additionalParams)?void 0:i.item_id)};const HD="local-video-history";class jD{static getInstance(){return"undefined"==typeof window?new jD:(window.localVideoHistory||(window.localVideoHistory=new jD),window.localVideoHistory)}constructor(){if(this.items={},this.subscribers={},"undefined"==typeof window)return;try{this.items=JSON.parse(localStorage.getItem(HD)||"{}")}catch(e){}const e=e=>{this.onLocalStorageEvent(e)};window.addEventListener("storage",e),window.onunload=()=>{window.removeEventListener("storage",e),this.sync()}}onLocalStorageEvent(e){let{newValue:t,key:i}=e;if(i===HD&&null!==t)try{const e=JSON.parse(t);Object.keys(this.subscribers).forEach((t=>{this.subscribers[t].forEach((i=>{var r,n;null!=(r=e[t])&&r.position&&(null==(n=this.items[t])?void 0:n.position)!==e[t].position&&i(e[t].position)}))})),this.items=JSON.parse(t)}catch(e){}}savePosition(e,t){const i=this.items[e]?this.items[e].position:0;this.items[e]={position:t,timestamp:Date.now()},i!==t&&this.subscribers[e]&&this.subscribers[e].forEach((e=>{e(t)})),this.sync()}sync(){this.localStorageSyncTimer&&clearTimeout(this.localStorageSyncTimer),this.localStorageSyncTimer=setTimeout((()=>{try{localStorage.setItem(HD,JSON.stringify(this.items))}catch(e){}}),250)}subscribe(e,t){return this.subscribers[e]?this.subscribers[e].push(t):this.subscribers[e]=[t],()=>{this.unsubscribe(e,t)}}unsubscribe(e,t){if(this.subscribers[e])if(Array.isArray(this.subscribers[e])){const i=this.subscribers[e].indexOf(t);i&&this.subscribers[e].splice(i,1)}else delete this.subscribers[e]}getPosition(e){var t;return(null==(t=this.items[e])?void 0:t.position)||0}getItem(e){return this.items[e]}getItems(){return this.items}clear(){this.items={},this.sync()}}function GD(e){var t;const i=FD(e),{startPosition:r}=e;if(!i)return r;const n=jD.getInstance().getPosition(i),a=(null==(t=e.additionalParams)?void 0:t.duration)||0;return function(e,t){const i=t/(e/100);return e>5400&&i>95||i>90}(a,Math.max(null!=r?r:0,n))?0:r?n>r?n!==a?n:void 0:r:n}const qD=e=>e instanceof Error?e:new Error(String(e)),zD=e=>{var t;return(null==e||null==(t=e.videoInfo)?void 0:t.videoContentId)||(null==e?void 0:e.streams)&&e.streams[0]&&e.streams[0].url},WD=e=>{let t,i=!1;return function(){return i||(i=!0,t=e(...arguments)),t}},QD=e=>{const t=Object.keys(e),i={};for(let r=0;r<t.length;r++){const n=t[r],a=e[n];void 0!==a&&(i[n]=a)}return i},YD=e=>"object"==typeof e&&null!==e,KD=e=>"string"==typeof e&&e.length>0,XD=e=>YD(e),JD=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return t.reduce(((e,t)=>{if(!YD(t))return e;const i=Object.assign({},e,QD(t));return YD(t.additional)&&(i.additional=Object.assign({},e.additional,QD(t.additional))),i}),{})},ZD=e=>{const t=(e=>{const t=[];if(!XD(e))return t;let i=e,r=0;const n=()=>{var e,a;XD(i)&&t.push(i),XD(null==(e=i)?void 0:e.cause)&&(i=null==(a=i)?void 0:a.cause,r++,r<3&&n())};return n(),t})(e);if(0===t.length)return null;const i=[];let r="",n="";for(let e=0;e<t.length;e++){const a=t[e];a.message&&(r+=`caused by: ${a.message}\n`),a.stack&&(n+=`caused by: ${a.stack}\n`),YD(a.zenLoggerContext)&&i.unshift(a.zenLoggerContext)}return JD(...i,{additional:{causeMessage:r,causeStack:n}})},ek=(e,t,i)=>{const r=(e=>KD(e)?{message:e}:XD(e)?{name:e.name,message:e.message,stack:e.stack}:null)(e),n=XD(e)&&YD(e.zenLoggerContext)?e.zenLoggerContext:null,a=XD(i)?i:XD(e)&&XD(e.cause)?e.cause:null,s=ZD(a);return JD(s,n,t,r)},tk=e=>{try{var t;if(void 0===e)return"undefined";if(null===e)return"null";if("number"==typeof e)return e.toString();if("function"==typeof e)return e.toString().slice(0,100);const i=null==e||null==(t=e.constructor)?void 0:t.name,r="undefined"==typeof window||window.Set?JSON.stringify(e,(()=>{const e=new Set;return(t,i)=>i&&"object"==typeof i?e.has(i)?"[Circular]":(e.add(i),i):i})()):JSON.stringify(e);return(i?`${i}: ${r}`:r).slice(0,100)}catch(t){return typeof e}};function ik(e,t,i,r){void 0===r&&(r=ik),KD(e.message)||(YD(e.additional)||(e.additional={}),e.message?e.additional.invalidMessage=tk(e.message):e.additional.invalidEntry=tk(t),e.message=i),KD(e.stack)||(e.stack=((e,t)=>{const i=new Error(e);try{Error.captureStackTrace(i,t)}catch(e){}return i.stack})(e.message,r),e.name="Error")}const rk=()=>window,nk=()=>{rk().zenReqContext={}};var ak=n(7702);"undefined"==typeof window&&ak.initReqContext,"undefined"==typeof window&&ak.runWithReqContext,"undefined"==typeof window&&ak.runWithoutReqContext;const sk="undefined"==typeof window?ak.getReqContext:()=>{const e=rk();if(e.zenReqContext||nk(),!YD(e.zenReqContext))throw new Error("ReqContext is not an object");return e.zenReqContext},ok=()=>"undefined"==typeof window?global:window;class lk{constructor(e){var t;this.staticContext=e,this.log=(t=(e,t,i,r)=>{var n,a;const s=ok(),o=ek(t,i,r),l=JD(this.staticContext,this.getContext(),o);ik(l,t,"RequestLogger placeholder",this.log),null==(n=s.zenLogger)||null==(a=n[e])||a.call(n,l)},function(){try{t(...arguments)}catch(e){}})}fatal(e,t,i){this.log("fatal",e,t,i)}error(e,t,i){this.log("error",e,t,i)}warn(e,t,i){this.log("warn",e,t,i)}info(e,t,i){this.log("info",e,t,i)}debug(e,t,i){this.log("debug",e,t,i)}trace(e,t,i){this.log("trace",e,t,i)}getContext(){try{const e=sk();return YD(e.zenLoggerContext)?e.zenLoggerContext:{}}catch(e){return{}}}setContext(e){try{sk().zenLoggerContext=e}catch(e){}}extendContext(e){try{sk().zenLoggerContext=JD(this.getContext(),e)}catch(e){}}}const uk=new lk({service:"video-player-core",version:"1.105.2"});class dk{constructor(e,t,i){this.getStorage=e,this.prefix=t,this.version=i}set(e,t,i){const r=this.pullData();r[e]=t,i&&function(e,t,i){t._expired||(t._expired={}),t._expired[e]=Date.now()+i}(e,r,i),this.pushData(r)}get(e){if(function(e,t){if(!t._expired||!t._expired[e])return!1;const i=t._expired[e];return Date.now()-i>=0}(e,this.pullData()))return void this.delete(e);return this.pullData()[e]}delete(e){const t=this.pullData();Object.prototype.hasOwnProperty.call(t,e)&&(delete t[e],function(e,t){t._expired&&delete t._expired[e]}(e,t),this.pushData(t))}clear(){const e={version:this.version};this.pushData(e)}pullData(){try{const e=String(this.getStorage().getItem(this.prefix)),t=JSON.parse(e)||{};return t.version=this.version,t}catch(e){return uk.error(e),{version:this.version}}}pushData(e){try{const t=JSON.stringify(e);this.getStorage().setItem(this.prefix,t)}catch(e){uk.error(e)}}}class ck{constructor(e){void 0===e&&(e={}),this.items=new Map(Object.entries(e))}get length(){return this.items.size}clear(){this.items.clear()}getItem(e){var t;return null!=(t=this.items.get(e))?t:null}setItem(e,t){this.items.set(e,t)}removeItem(e){this.items.delete(e)}key(e){var t;return null!=(t=[...this.items.keys()][e])?t:null}}class hk extends ck{constructor(e){super(Object.assign({},e)),this.storage=e}clear(){super.clear(),this.storage.clear()}getItem(e){var t;return null!=(t=this.items.get(e))?t:null}setItem(e,t){super.setItem(e,t),this.storage.setItem(e,t)}removeItem(e){super.removeItem(e),this.storage.removeItem(e)}}const pk=WD((()=>new hk(window.sessionStorage))),fk=WD((()=>new ck)),mk=(WD((()=>{if("undefined"==typeof window)throw new Error("try fire getSessionStorage on server");return new dk((()=>function(e){if(void 0===e&&(e=!1),"undefined"==typeof window)throw new Error("try fire getWindowSessionStorage on server");return yk("sessionStorage")&&window.sessionStorage?e?pk():window.sessionStorage:fk()}()),"zen","1")})),WD((()=>new hk(window.localStorage)))),gk=WD((()=>new ck)),vk=WD((()=>new dk((()=>{return void 0===e&&(e=!1),yk("localStorage")&&window.localStorage?e?mk():window.localStorage:gk();var e}),"zen","2"))),Sk=e=>{window.addEventListener("unload",(()=>{vk().delete(e)}))},yk=e=>{const t="test";try{return window[e].setItem(t,t),window[e].removeItem(t),!0}catch(e){return!1}},Tk=e=>`${null==e?void 0:e.origin}${null==e?void 0:e.pathname}`,Ek={},bk={};n(2917);const _k="disablePictureInPicture";function Ak(e){void 0===e&&(e=window);try{return(e.navigator||{}).userAgent||""}catch(e){return""}}function Rk(e,t){return function(e){return void 0===e&&(e=window),Ak(e).includes("YaBrowser")}(e)?function(e){void 0===e&&(e=window);const t=Ak(e).match(/YaBrowser\/([\d.]+)/),i=t&&t[1]||"";return i?parseFloat(i):-1}(e)<18.6?"pip":"x-yandex-pip":_k in t?_k:void 0}function wk(e,t,i){const r=Rk(e,i);r&&(t?i.removeAttribute(r):i.setAttribute(r,"true"))}var Pk=n(4792);const Ok=()=>{const{userAgent:e}=navigator,t=e.match(/AppleWebKit/)&&!e.match(/Chrome/);return Boolean(t)};let Ck,Lk,Ik,xk;!function(e){e.preroll="preroll",e.midroll="midroll",e.postPauseroll="postPauseroll",e.postroll="postroll",e.inroll="inroll"}(Ck||(Ck={})),function(e){e.DIRECT="direct",e.MT="mt"}(Lk||(Lk={})),function(e){e[e.PLAYING=1]="PLAYING",e[e.NOT_PLAYING=2]="NOT_PLAYING"}(Ik||(Ik={})),function(e){e.WATERFALL="waterfall",e.PIXEL="pixel"}(xk||(xk={}));const Mk=0;function Nk(e,t){var i,r,n,a,s,o,l,u,d,c,h,p,f,m,g,v,S,y,T;const{partnerId:E,partner_id:b=E,category:_=Mk,impId:A,imp_id:R=A,hasPreroll:w,videoContentId:P,video_content_id:O=P,videoContentName:C,video_content_name:L=C,videoPublisherId:I,video_publisher_id:x=I,videoPublisherName:M,video_publisher_name:N=M,videoGenreId:D,video_genre_id:k=D,videoGenreName:$,video_genre_name:V=$,distrId:U,distr_id:B=U,adBreaks:F,adProvider:H,ad_provider:j=H,adStatType:G,ad_stat_type:q=G,slotId:z,slot_id:W=z,mytargetId:Q,mytarget_id:Y=Q,statId:K,stat_id:X=K,rest:J=e.adConfig}=Object.assign({},e,e.videoInfo,e.adConfig),Z=function(e){return((null==e?void 0:e.zenSlots)||"").split(";").map((e=>parseInt(e,10))).join(",")}(t),ee=function(e){return((null==e?void 0:e.zenSlots)||"").split(";").map((e=>{const[t,,i]=e.split(",");return`${t},${"-1"!==i&&i?i:0};`})).join("")}(t);return Object.assign({},J,{additionalParams:{from:null==(i=e.additionalParams)?void 0:i.from,reqid:null==(r=e.additionalParams)?void 0:r.rid,puid:null==(n=e.additionalParams)?void 0:n.rid,vsid:null==(a=e.additionalParams)?void 0:a.vsid,slots:null==t?void 0:t.zenSlots,"video-content-id":null==(s=e.additionalParams)?void 0:s["video-content-id"],"partner-stat-id":null==(o=e.additionalParams)?void 0:o["partner-stat-id"],duration:null==(l=e.additionalParams)||null==(u=l.duration)?void 0:u.toFixed(),from_block:null==(d=e.additionalParams)?void 0:d.from_block,strongest_id:null==(c=e.additionalParams)?void 0:c.strongest_id,item_id:(null==(h=e.additionalParams)?void 0:h.item_id)||(null==(p=e.additionalParams)?void 0:p.itemId),stream_block:null==(f=e.additionalParams)?void 0:f.stream_block,rid:null==(m=e.additionalParams)?void 0:m.rid,ppi:null==(g=e.additionalParams)?void 0:g.ppi,"zen-content-id":null==(v=e.videoInfo)?void 0:v.videoContentId,"video-content-duration":null==(S=e.additionalParams)||null==(y=S.duration)?void 0:y.toFixed(),content_id:null==(T=e.adConfig)?void 0:T.videoContentId,"dzen-exp-ids":ee,testIds:Z},partnerId:Number(b),category:Number(_),impId:void 0!==R?parseInt(String(R),10)||0:void 0,hasPreroll:"boolean"==typeof w?w:void 0,videoContentId:O,videoContentName:L,videoPublisherId:x,videoPublisherName:N,videoGenreId:k,videoGenreName:V,distrId:B,adBreaks:F,adProvider:j,adStatType:q,slotId:W,mytargetId:Y,statId:X})}let Dk;!function(e){e.PlayAdViewers="PlayAdViewers",e.AdStart="AdStart",e.AdPodImpression="AdPodImpression",e.AdPodLoading="AdPodLoading",e.AdPodError="AdPodError",e.AdPodStart="AdPodStart",e.AdPodSkip="AdPodSkip",e.AdPodResume="AdPodResume",e.AdPodPause="AdPodPause",e.AdPodEnd="AdPodEnd",e.AdEnd="AdEnd",e.AdClickThru="AdClickThru",e.InrollAdStart="InrollAdStart",e.InrollAdPodStart="InrollAdPodStart",e.InrollAdPodEnd="InrollAdPodEnd",e.InrollAdEnd="InrollAdEnd"}(Dk||(Dk={}));function kk(e){void 0===e&&(e=window);const t=e.navigator.userAgent.toLowerCase();return/ipad|iphone|ipod/.test(t)&&!e.MSStream&&!function(e){return void 0===e&&(e=window),e.navigator.userAgent.includes("UCBrowser")}(e)}class $k{constructor(e,t,i,r){this.multiroll=e,this.setRemainingTime=t,this.playAdViewers=i,this.config=r,this.cachedMidrollViewers=null,this.defaultMaxDelay=30,this.localStorageKey="zenAdWatchedStorage",this.currentEmbedPoint=null,this.adWatchedStorage=this.getStorageData()}isNearEmbeddingPoint(e,t,i){const r=t.filter((t=>t>=e&&t-e<=i));return 0===r.length?null:Math.min(...r)}shouldPlayByTime(e,t,i){var r,n,a;if(e<i&&this.setRemainingTime(i-e),e>=i)return!0;return(null!=(r=this.config)&&r.shouldPlayerAdUseCustomWatchedTime?this.adWatchedStorage.time:t)>=i+(null!=(n=null==(a=this.config)?void 0:a.maxDelayUntilNextEpisode)?n:this.defaultMaxDelay)}getCurrentDate(){return(new Date).toISOString().split("T")[0]}getStorageData(){const e=localStorage.getItem(this.localStorageKey),t=this.getCurrentDate();if(e)try{const i=JSON.parse(e);if(i.date===t)return i}catch(e){}const i={time:0,count:0,date:t};return localStorage.setItem(this.localStorageKey,JSON.stringify(i)),i}updateStorage(e,t){void 0===e&&(e=0),void 0===t&&(t=!1);const i=this.getStorageData();i.time+=e,t&&i.count++,localStorage.setItem(this.localStorageKey,JSON.stringify(i)),this.adWatchedStorage=i}async playAd(e,t){await this.playAdViewers(e,t),this.updateStorage(0,!0)}getWatchedTimeParams(e){var t;return null!=(t=this.config)&&t.shouldPlayerAdUseCustomWatchedTime?{watchedTime:this.adWatchedStorage.time,sourceWatchedTime:this.adWatchedStorage.time}:{watchedTime:e,sourceWatchedTime:e}}async setWatchedTime(e,t,i,r){var n,a,s,o,l,u,d;if(!this.multiroll||r-i<=20)return;this.updateStorage(e);const c=null!=(n=null==(a=this.config)?void 0:a.adEmbedding)?n:[],h=null!=(s=null==(o=this.config)?void 0:o.isDelayUntilNextEpisodeEnabled)&&s,p=null!=(l=null==(u=this.config)?void 0:u.maxDelayUntilNextEpisode)?l:this.defaultMaxDelay,f=this.getWatchedTimeParams(t),m=Object.assign({},f,{currentTime:i,videoType:"VOD",duration:r});if(null===this.currentEmbedPoint&&(this.currentEmbedPoint=h?this.isNearEmbeddingPoint(i,c,p):null),this.cachedMidrollViewers&&(null==(d=this.cachedMidrollViewers)?void 0:d.length)>0&&h&&null!==this.currentEmbedPoint&&this.shouldPlayByTime(i,t,this.currentEmbedPoint))return await this.playAd(this.cachedMidrollViewers,f.watchedTime),this.cachedMidrollViewers=null,void(this.currentEmbedPoint=null);const g=await this.multiroll.getNextAdInfo(m);if(null!=g&&g.remainingTime){const e=h?this.isNearEmbeddingPoint(i+g.remainingTime,c,p):null;if(e){const t=e-i;if(this.setRemainingTime(t),!this.cachedMidrollViewers){const e=await this.multiroll.midroll.loadViewers(m);(null==e?void 0:e.length)>0&&(this.cachedMidrollViewers=e)}return}this.setRemainingTime(g.remainingTime)}if(!this.cachedMidrollViewers){const e=await this.multiroll.midroll.loadViewers(m);(null==e?void 0:e.length)>0&&await this.playAd(e,f.watchedTime)}}}const Vk=["error"],Uk="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";let Bk,Fk,Hk;!function(e){e[e.AD_FREE_SESSION=1]="AD_FREE_SESSION",e[e.SKIPPABLE_PARTNER_ID=2]="SKIPPABLE_PARTNER_ID",e[e.IOS_FULLSCREEN=3]="IOS_FULLSCREEN"}(Bk||(Bk={})),function(e){e.preroll="preroll",e.midroll="midroll",e.postPauseroll="postPauseroll",e.postroll="postroll",e.inroll="inroll"}(Fk||(Fk={})),function(e){e.DEFAULT_ERROR="DEFAULT_ERROR",e.YANDEX_RPC_ERROR="YANDEX_RPC_ERROR",e.BROADCAST_AD_BLOCK_INIT_ERROR="BROADCAST_AD_BLOCK_INIT_ERROR",e.AD_TYPE_IS_NOT_RECOGNIZED="AD_TYPE_IS_NOT_RECOGNIZED",e.INVALID_METADATA="INVALID_METADATA",e.INVALID_STREAM_URL="INVALID_STREAM_URL",e.UNSUPPORTED_MEDIA_TYPE="UNSUPPORTED_MEDIA_TYPE",e.SCRIPT_INIT_ERROR="SCRIPT_INIT_ERROR",e.MPD_WIDEVINE_CERT_LOAD_ERROR="MPD_WIDEVINE_CERT_LOAD_ERROR",e.MPD_SHAKA_INIT_ERROR="MPD_SHAKA_INIT_ERROR",e.NATIVE_HLS_NOT_SUPPORTED_ERROR="NATIVE_HLS_NOT_SUPPORTED_ERROR",e.HLS_JS_NOT_SUPPORTED_ERROR="HLS_JS_NOT_SUPPORTED_ERROR",e.REFRESH_SUBTITLES_ERROR="REFRESH_SUBTITLES_ERROR",e.ON_TICK_ERROR="ON_TICK_ERROR",e.FAIRPLAY_NOT_SUPPORTED="FAIRPLAY_NOT_SUPPORTED",e.FAIRPLAY_CERT_LOAD_ERROR="FAIRPLAY_CERT_LOAD_ERROR",e.FAIRPLAY_CREATE_MEDIA_KEYS_ERROR="FAIRPLAY_CREATE_MEDIA_KEYS_ERROR",e.FAIRPLAY_CREATE_KEY_SESSION_ERROR="FAIRPLAY_CREATE_KEY_SESSION_ERROR",e.FAIRPLAY_SPC_LOAD_ERROR="FAIRPLAY_SPC_LOAD_ERROR",e.FAIRPLAY_CREATE_KEY_ERROR="FAIRPLAY_CREATE_KEY_ERROR",e.FAIRPLAY_INVALID_CONTENT_ID="FAIRPLAY_INVALID_CONTENT_ID",e.DRM_PROXY_ERROR="DRM_PROXY_ERROR",e.DRM_PROXY_ERROR_SIGNATURE_EXPIRED="DRM_PROXY_ERROR_SIGNATURE_EXPIRED",e.NO_HLS_JS_INSTANCE="NO_HLS_JS_INSTANCE",e.AD_IS_ALREADY_PLAYING="AD_IS_ALREADY_PLAYING",e.META_INFO_REQUEST_FAILED="META_INFO_REQUEST_FAILED",e.MULTIROLL_INIT_ERROR="MULTIROLL_INIT_ERROR",e.REACT_COMPONENT_DID_CATCH_ERROR_INFO="REACT_COMPONENT_DID_CATCH_ERROR_INFO",e.PLAY_AD_VIEWERS_ERROR="PLAY_AD_VIEWERS_ERROR",e.SAGA_ERROR="SAGA_ERROR",e.STRM_ABD_INVALID_RESPONSE="STRM_ABD_INVALID_RESPONSE",e.REPRESENTATION_CHANGE="REPRESENTATION_CHANGE",e.RECOVER_TASK_ERROR="RECOVER_TASK_ERROR",e.PRELOAD_SOURCE_FAILED="PRELOAD_SOURCE_FAILED",e.REGIONAL_LIMITATION_MANIFEST="REGIONAL_LIMITATION_MANIFEST",e.REGIONAL_LIMITATION_LEVEL="REGIONAL_LIMITATION_LEVEL",e.REGIONAL_LIMITATION_SEGMENT="REGIONAL_LIMITATION_SEGMENT",e.SIGNATURE_EXPIRED_MANIFEST="SIGNATURE_EXPIRED_MANIFEST",e.SIGNATURE_EXPIRED_LEVEL="SIGNATURE_EXPIRED_LEVEL",e.SIGNATURE_EXPIRED_SEGMENT="SIGNATURE_EXPIRED_SEGMENT",e.NO_STREAMS="NO_STREAMS",e.NO_CODECS="NO_CODECS",e.NO_MSE="NO_MSE",e.NO_DRM="NO_DRM",e.NO_PLAYABLE_STREAMS="NO_PLAYABLE_STREAMS",e.SHAKA_FILTER_ERROR="SHAKA_FILTER_ERROR",e.SHAKA_CONFIGURE_ERROR="SHAKA_CONFIGURE_ERROR",e.SHAKA_LOAD_SOURCE_ERROR="SHAKA_LOAD_SOURCE_ERROR",e.MEDIA_ERR_CUSTOM="MEDIA_ERR_CUSTOM",e.MEDIA_ERR_ABORTED="MEDIA_ERR_ABORTED",e.MEDIA_ERR_NETWORK="MEDIA_ERR_NETWORK",e.MEDIA_ERR_DECODE="MEDIA_ERR_DECODE",e.MEDIA_ERR_SRC_NOT_SUPPORTED="MEDIA_ERR_SRC_NOT_SUPPORTED",e.MEDIA_ERR_ENCRYPTED="MEDIA_ERR_ENCRYPTED"}(Hk||(Hk={}));class jk{get multiroll(){var e;return null==(e=this.adManager)?void 0:e.getMultiroll()}constructor(){this.adManagerState={},this.adWatchedCount=0,this.loadSourceSession=new Pk.WO,this.adWatchedLocalStorage={time:0,count:0,date:(new Date).toJSON().slice(0,10)},this.userVolume=1,this.userMute=!1,this.userPlaybackRate=1,this.userQuality=void 0,this.startPosition={utc:void 0,videoTime:void 0},this.isAdFreeSession=!1,this.multirollInited=!1,this.getCurrentDate=()=>(new Date).toJSON().slice(0,10)}init(e){var t,i,r,n,a;let{player:s,onePlayer:o,playerConfig:l,playerElement:u,htmlVideoElement:d,videoSource:c,sessionParams:h}=e;if(this.adConfig=Nk(c,h),null==(t=this.adConfig)||!t.partnerId)return;this.player=s,this.onePlayer=o;const p=document.createElement("div");p.className="zen-ui-video-video-player__ad",p.style.width="100%",p.style.height="100%",p.style.position="absolute",p.style.top="0",p.style.left="0",p.style.display="none";const f=document.createElement("div");f.className="zen-ui-video-video-player__ad-mt",f.style.width="100%",f.style.height="100%",f.style.position="absolute",f.style.top="0",f.style.left="0",f.style.display="none";const m=document.createElement("video");m.setAttribute("playsinline","playsinline"),m.className="zen-ui-video-video-player__player ad-video",m.style.width="100%",m.style.height="100%",m.style.position="absolute",m.style.top="0",m.style.left="0",u.tabIndex=-1,this.playerConfig=l,null==(i=u.parentElement)||i.appendChild(f),null==(r=u.parentElement)||r.appendChild(p),f.appendChild(m),this.adManager=new Pk.X2({lang:"ru",playerContainerElement:u,playerVideoElement:d,callbacks:{onExpectedStalledChange:()=>{},onAdSkippableStateChange:e=>{},onAdVolumeAvailabilityStateChange:e=>{},onAdPodCloseStateChange:e=>{},onAdError:()=>{},onAdPodDurationChange:e=>{this.player.handlers.onAdPodDurationChange.emit(e)},onAdPodCurrentTimeChange:e=>{this.player.handlers.onAdPodCurrentTimeChange.emit(e)},onAdPodTimeToSkipChange:e=>{this.player.handlers.onAdPodTimeToSkipChange.emit(e)},onAdInteraction:()=>{},onBeforeAdPodStart:e=>{this.player.handlers.onBeforeAdPodStart.emit(e.adPlaybackController)},onAdPodSkip:()=>{},onAdPodEnd:()=>{},onAdPodStart:e=>{},onAdPodClick:()=>{},onAdLoaded:e=>{},onAdSDKVersionDefined:e=>{}},playerAdMtDiv:f,playerAdVideo:m,playerAdDiv:p,playerDiv:u,yaDirectPixel:null!=c&&c.yaDirectPixelUrl&&null!=c&&c.yaDirectPixelData?{yaDirectPixelUrl:c.yaDirectPixelUrl,yaDirectPixelData:c.yaDirectPixelData}:void 0,getPlayerContainerDocument:()=>(null==u?void 0:u.ownerDocument)||document,rejectPlayerPlayDeferred:e=>{},resolvePlayerPlayDeferred:()=>{},preloadVideoControllerSource:()=>{},getPlayerIsLive:()=>!!this.onePlayer.info.isLive$.getValue(),hasPlayerVideoController:()=>!!this.onePlayer,pauseVideoController:()=>{this.onePlayer.pause()},toggleVideoControllerAdShown:e=>{const t={adParams:{},state:e?Ik.PLAYING:Ik.NOT_PLAYING,type:void 0};s.publicStatesPlayer.adState=t,s.handlers.onAdStateChange.emit(t)},getVideoControllerBandwidthEstimate:()=>this.onePlayer.info.throughputEstimation$.getValue(),getVideoControllerDuration:()=>this.onePlayer.info.duration$.getValue(),getVideoControllerUtcPosition:()=>this.onePlayer.info.liveTime$.getValue()||0,getVideoControllerCurrentTime:()=>this.onePlayer.info.position$.getValue(),getVideoControllerVideoEngine:()=>{},playVideoController:()=>{this.onePlayer.play()},captureVideoControllerScreenshot:e=>Promise.resolve(void 0),clearVideoControllerScreenshot:()=>{},hidePlayerPoster:()=>{},shouldCaptureScreenshot:()=>!1,attachEncoder:async()=>{var e;await this.player.resume(null==(e=this.startPosition)?void 0:e.videoTime),this.onePlayer.setPlaybackRate(this.userPlaybackRate),this.userQuality&&(this.onePlayer.setAutoQuality(!1),this.onePlayer.setQuality(this.userQuality))},detachEncoder:async()=>{var e,t,i;(this.userVolume=this.onePlayer.info.volume$.getValue(),this.userMute=this.onePlayer.info.muted$.getValue(),this.userPlaybackRate=Number(null==(e=this.onePlayer.info)?void 0:e.currentPlaybackRate$.getValue()),null!=(t=this.onePlayer.info)&&t.isAutoQualityEnabled$.getValue())?this.userQuality=void 0:this.userQuality=null==(i=this.onePlayer.info)?void 0:i.currentQuality$.getValue();this.player.deinit()},resetPosterFitStyle:()=>{},setBackgroundImage:e=>{},setBackgroundVisibility:e=>{},onceCanPlay:e=>{},onMetadataChange:e=>{},getSTRMChunkUrls:()=>[],createExpectedStalled:(e,t)=>({reason:e,details:t,getElapsedTime:()=>1e3*this.onePlayer.info.position$.getValue()}),getPlayerContainer:()=>u,logger:window.console,adConfigImpId:null==c||null==(n=c.adConfig)?void 0:n.impId,adConfigPartnerId:null==c||null==(a=c.adConfig)?void 0:a.partnerId,admanMeta:{dzenuid:null==c?void 0:c.dzenuid,vid:null==c?void 0:c.vid,ea:null==c?void 0:c.ea,eg:null==c?void 0:c.eg},isSkipAllPodsFlagEnabled:!1,isIOS:kk(window),getControllerWatchedTime:()=>s.publicStatesPlayer.watchedTime,getControllerCurrentTime:()=>s.publicStatesPlayer.currentTime,getControllerStartPosition:()=>({utc:this.onePlayer.info.liveTime$.getValue(),videoTime:this.onePlayer.info.position$.getValue()}),getControllerSourcePreviewParam:()=>Ok()?"":Uk,getDefaultSourcePreviewParam:()=>Ok()?"":Uk,getControllerProgramDateTime:()=>{},getControllerIsFullscreen:()=>this.player.publicStatesPlayer.isFullscreen,getControllerIsPip:()=>this.player.getIsPip(),getAdOriginalBroadcastAdCueId:()=>this.adManagerState.originalBroadcastAdCueId,getCueId:()=>{},getUtcPositionMs:()=>0,getNextAdInfo:()=>()=>this.adManagerState.nextAdInfo,getControllerStartStage:()=>Pk.k_.started,getControllerPreload:()=>!1,getControllerVsid:()=>(null==h?void 0:h.vsid)||"",getAdConfig:()=>null==c?void 0:c.adConfig,getAdInfo:()=>this.adManagerState.adInfo,getControllerVolume:()=>this.onePlayer.info.volume$.getValue(),getControllerMuted:()=>this.onePlayer.info.muted$.getValue(),getAdControlsSettings:()=>({controlsVisibility:null!=l&&l.isNativeAdControlsHidden?{mute:!1,timeline:!1,play:!1,loader:!1}:{}}),getInStreamPlayingState:()=>this.adManagerState.inStreamPlayingState,getControllerAutoplay:()=>void 0!==(null==l?void 0:l.autoplayMode),getControllerFrom:()=>{var e;return null==c||null==(e=c.additionalParams)?void 0:e.from},updateAdInfo:e=>{this.adManagerState.adInfo=e},putStartPosition:e=>{this.startPosition=e},putResourcesIdle:e=>{},putInStreamPlayingState:e=>{},putVideoSize:e=>{},putShowAdSkin:e=>{},putShowSkipAdButton:e=>{},putOriginalBroadcastAdCues:e=>{},getMinimalChance:()=>1,playerVersion:this.player.getVersion(),shouldPlayAd:()=>this.shouldPlayAd()}),this.adManager.on("InrollAdEnd",(e=>{this.player.logAdEvent({name:Dk.InrollAdEnd,params:e})})),this.adManager.on("AdPodEnd",(e=>{this.player.logAdEvent({name:Dk.AdPodEnd,params:e})})),this.adManager.on("InrollAdPodEnd",(e=>{this.player.logAdEvent({name:Dk.InrollAdPodEnd,params:e})})),this.adManager.on("PlayAdViewers",(e=>{this.player.logAdEvent({name:Dk.PlayAdViewers,params:e})})),this.adManager.on("AdClickThru",(e=>{this.player.logAdEvent({name:Dk.AdClickThru,params:e})})),this.adManager.on("AdStart",(e=>{var t;"mt"===(null==(t=this.adConfig)?void 0:t.adProvider)?f.style.display="initial":p.style.display="initial",this.player.publicStatesPlayer.nextAdRemainingTime=void 0,this.player.handlers.onNextAdRemainingTimeChange.emit(void 0);const i={watchedTime:s.publicStatesPlayer.watchedTime,position:s.publicStatesPlayer.currentTime,duration:s.publicStatesPlayer.duration};this.player.logAdEvent({name:Dk.AdStart,params:Object.assign({},e,i)});const r={adParams:e,state:Ik.PLAYING,type:void 0};s.publicStatesPlayer.adState=r,s.handlers.onAdStateChange.emit(r)})),this.adManager.on("InrollAdStart",(e=>{this.player.logAdEvent({name:Dk.InrollAdStart,params:e})})),this.adManager.on("AdPodPause",(e=>{this.player.logAdEvent({name:Dk.AdPodPause,params:e})})),this.adManager.on("AdPodError",(e=>{this.player.logAdEvent({name:Dk.AdPodError,params:e})})),this.adManager.on("AdPodSkip",(e=>{this.player.logAdEvent({name:Dk.AdPodSkip,params:e})})),this.adManager.on("AdPodStart",(e=>{var t,i,r;this.player.logAdEvent({name:Dk.AdPodStart,params:e});const n=null==(t=this.adManager)?void 0:t.getCurrentAdPlaybackQueue();!this.onePlayer.info.muted$.getValue()&&null!=(i=this.playerConfig)&&i.shouldPlayerAdSubtractVolume&&null!=(r=this.playerConfig)&&r.playerAdSubtractVolume&&this.playerConfig.playerAdSubtractVolume>0&&(null==n||n.setVolume(Math.max(0,this.userVolume-this.playerConfig.playerAdSubtractVolume))),this.player.handlers.onAdPodStart.emit({})})),this.adManager.on("AdEnd",(e=>{f.style.display="none",p.style.display="none",this.onePlayer.setVolume(this.userVolume),this.onePlayer.setMuted(this.userMute),this.player.logAdEvent({name:Dk.AdEnd,params:e});const t={adParams:e,state:Ik.NOT_PLAYING,type:void 0};s.publicStatesPlayer.adState=t,s.handlers.onAdStateChange.emit(t)})),this.adManager.on("AdPodResume",(e=>{this.player.logAdEvent({name:Dk.AdPodResume,params:e})})),this.adManager.on("AdPodLoading",(e=>{this.player.logAdEvent({name:Dk.AdPodLoading,params:e})})),this.adManager.on("InrollAdPodStart",(e=>{this.player.logAdEvent({name:Dk.InrollAdPodStart,params:e})})),this.adManager.on("AdPodImpression",(e=>{this.player.logAdEvent({name:Dk.AdPodImpression,params:e})})),this.adManager.on("BroadcastAdBlockInitError",(e=>{var t;let{error:i,metadata:r}=e;null==(t=this.player)||t.logError(i,{message:Hk.BROADCAST_AD_BLOCK_INIT_ERROR,additional:r})})),this.adManager.on("PlayAdViewersError",(e=>{var t;let{error:i}=e,r=function(e,t){if(null==e)return{};var i,r,n={},a=Object.keys(e);for(r=0;r<a.length;r++)i=a[r],t.indexOf(i)>=0||(n[i]=e[i]);return n}(e,Vk);null==(t=this.player)||t.logError(i,{message:Hk.PLAY_AD_VIEWERS_ERROR,additional:r})})),this.adManager.on("AdIsAlreadyPlayingError",(e=>{var t;null==(t=this.player)||t.logError(new Error(Hk.AD_IS_ALREADY_PLAYING),{additional:e})})),this.adManager.on("UnrecognizedAdTypeError",(()=>{var e;null==(e=this.player)||e.logError(new Error(Hk.AD_TYPE_IS_NOT_RECOGNIZED),{})})),this.adManager.on("MultirollInitError",(e=>{var t;let{error:i,adConfig:r}=e;null==(t=this.player)||t.logError(i,{message:Hk.MULTIROLL_INIT_ERROR,additional:r},"0"===String(i.code)||!i.code)})),this.adManager.on("InvalidMetadataError",(e=>{var t;null==(t=this.player)||t.logError(e,{message:Hk.INVALID_METADATA})}))}async loadSource(e,t,i){var r,n,a,s;this.multirollInited=!1,null!=e&&e.adConfig&&(this.adConfig=Nk(e,t)),this.updateEpisodes(null==i?void 0:i.episodes),this.adWatchedCount=(null==(r=this.adWatchedLocalStorage)?void 0:r.count)||0,this.shouldPlayAd()&&null!=(n=this.adConfig)&&n.hasPreroll&&(this.currentRollType=Fk.preroll),await(null==(a=this.adManager)?void 0:a.initMultirollModule(this.adConfig,this.loadSourceSession)),this.multirollInited=!0,this.midrollController=new $k(this.multiroll,(e=>{const t=Math.round(e);this.player.publicStatesPlayer.nextAdRemainingTime=t,this.player.handlers.onNextAdRemainingTimeChange.emit(t)}),(async(e,t)=>{var i;await(null==(i=this.adManager)?void 0:i.playAdViewers(Fk.midroll,Gk(e,Fk.midroll),{},this.adConfig)),this.player.playInrollAd(t)}),{adEmbedding:(null==(s=this.adConfig)?void 0:s.adEmbedding)||[],shouldPlayerAdUseCustomWatchedTime:null==i?void 0:i.shouldPlayerAdUseCustomWatchedTime,isDelayUntilNextEpisodeEnabled:(null==i?void 0:i.shouldPlayerAdConsiderEpisodes)||(null==i?void 0:i.isDelayUntilNextEpisodeEnabled),maxDelayUntilNextEpisode:(null==i?void 0:i.playerAdEpisodeDelta)||(null==i?void 0:i.maxDelayUntilNextEpisode)}),this.play()}skipAdPod(){var e;null==(e=this.adManager)||e.skipAdmanAd(),this.player.skipAdPod()}shouldPlayAd(){return void 0===this.getDoNotPlayAdReason()}async play(){var e,t,i;if(!this.multirollInited)return;const r=null==(e=this.adManager)?void 0:e.getCurrentAdPlaybackQueue();if(r&&void 0!==this.adManagerState.adInfo)r.resumeAd();else if(null==(t=this.adManager)||null==(i=t.getTimer())||i.play(),this.multiroll&&this.shouldPlayAd()){if(this.currentRollType===Fk.preroll){var n;const e=await this.multiroll.preroll.loadViewers();null==(n=this.adManager)||n.playAdViewers(Fk.preroll,Gk(e,Fk.preroll),{},this.adConfig),this.currentRollType=void 0}if(this.currentRollType===Fk.postPauseroll){var a;const e=await this.multiroll.postPauseroll.loadViewers({pausedTime:this.onePlayer.info.position$.getValue()});null==(a=this.adManager)||a.playAdViewers(Fk.postPauseroll,Gk(e,Fk.postPauseroll),{},this.adConfig),this.currentRollType=void 0}}}pause(){var e,t,i,r,n;const a=null==(e=this.adManager)?void 0:e.getCurrentAdPlaybackQueue();a&&void 0!==this.adManagerState.adInfo?a.pauseAd():(null==(t=this.adManager)||null==(i=t.getAdman())||i.pause(),null==(r=this.adManager)||null==(n=r.getTimer())||n.pause(),this.currentRollType=Fk.postPauseroll)}async setWatchedTime(e,t,i,r){var n;await(null==(n=this.midrollController)?void 0:n.setWatchedTime(e,t,i,r))}async end(){if(this.multiroll){var e;const t=await this.multiroll.postroll.loadViewers();null==(e=this.adManager)||e.playAdViewers(Fk.postroll,Gk(t,Fk.postroll),{},this.adConfig),this.adWatchedCount=this.adWatchedCount+1,this.loadSourceSession.stop(Pk.GS.end)}}stop(){var e;this.adManager&&(this.adManager.stopAdmanAd(),null==(e=this.adManager.getTimer())||e.stop(),this.adManager.stopAd({stopAdReason:Pk.Ip.LoadSource,data:{loadPositionAfterAd:void 0}}),this.adManager.resetPlannedAdViewers(),this.adManager.resetMultiroll())}destroy(){var e,t;this.adManager&&(this.stop(),this.adManager.destroy(),null==(e=this.adManager.getConfig().playerAdMtDiv.parentElement)||e.removeChild(this.adManager.getConfig().playerAdMtDiv),null==(t=this.adManager.getConfig().playerAdDiv.parentElement)||t.removeChild(this.adManager.getConfig().playerAdDiv),this.loadSourceSession.stop(Pk.GS.destroy))}updateEpisodes(e){e&&this.adConfig&&!this.adConfig.adEmbedding&&(this.adConfig.adEmbedding=e.map((e=>parseInt(e.timeStartInSeconds.toString()))))}getDoNotPlayAdReason(){var e,t,i;return kk(window)&&null!=(e=this.player)&&null!=(t=e.publicStatesPlayer)&&t.isFullscreen?Bk.IOS_FULLSCREEN:1===(null==(i=this.adManagerState.adConfig)?void 0:i.partnerId)?Bk.SKIPPABLE_PARTNER_ID:this.isAdFreeSession?Bk.AD_FREE_SESSION:void 0}}function Gk(e,t){return e.map((e=>({adViewer:e,additionalData:{},adType:t})))}let qk,zk,Wk,Qk,Yk,Kk,Xk,Jk,Zk;!function(e){e.PROD="prod",e.VK_ALIAS="vk_alias",e.VIDEOTEST="videotest",e.TEST="test",e.AUTO="auto"}(qk||(qk={})),function(e){e.MP4="mp4",e.DASH="dash",e.DASH_SEP="dash_sep",e.ONDEMAND_DASH="ondemand_dash",e.HLS="hls",e.ONDEMAND_HLS="ondemand_hls",e.WEBM="webm",e.AV1="av1",e.ONDEMAND_DASH_LIVE="ondemand_dash_live",e.ONDEMAND_HLS_LIVE="ondemand_hls_live",e.WEBRTC="webrtc",e.UNKNOWN="unknown",e.RTMP="rtmp"}(zk||(zk={})),function(e){e.AUTO="auto",e.MANUAL=""}(Wk||(Wk={})),function(e){e.HTTP1="http1",e.HTTP2="http2",e.HTTP3="http3"}(Qk||(Qk={})),function(e){e[e.YES=1]="YES",e[e.NO=0]="NO"}(Yk||(Yk={})),function(e){e.EXCELLENT="excellent",e.GOOD="good",e.POOR="poor"}(Kk||(Kk={})),function(e){e.PIP="pip",e.FULLSCREEN="fullscreen",e.EXTERNAL="external",e.PREFETCH="prefetch",e.AIRPLAY="airplay",e.CHROMECAST="chromecast",e.INVISIBLE="invisible"}(Xk||(Xk={})),function(e){e.SLIDER="slider",e.DOUBLE_TAP="double_tap",e.TIME_CODE="time_code",e.EPISODE="episode",e.REWIND="rewind",e.LIVE="live",e.UNKNOWN="unknown"}(Jk||(Jk={})),function(e){e.GRAPH_SHOW="iGraphShow",e.GRAPH_HIDE="iGraphHide",e.NEXT_AREA="iNextChapterArea",e.NEXT_BUTTON="iNextChapterBtn",e.WATCH_AGAIN="iWatchAgainBtn"}(Zk||(Zk={}));const e$=e=>e&&{[BP.HTTP1]:Qk.HTTP1,[BP.HTTP2]:Qk.HTTP2,[BP.QUIC]:Qk.HTTP3}[e],t$=e=>{if(void 0!==e)switch(e){case VP.MPEG:return zk.MP4;case VP.DASH_LIVE:return zk.DASH;case VP.DASH_SEP:return zk.DASH_SEP;case VP.DASH_ONDEMAND:return zk.ONDEMAND_DASH;case VP.DASH_WEBM:case VP.DASH_LIVE_WEBM:return zk.WEBM;case VP.DASH_WEBM_AV1:return zk.AV1;case VP.DASH_LIVE_CMAF:return zk.ONDEMAND_DASH_LIVE;case VP.HLS:case VP.HLS_LIVE:return zk.HLS;case VP.HLS_ONDEMAND:return zk.ONDEMAND_HLS;case VP.HLS_LIVE_CMAF:return zk.ONDEMAND_HLS_LIVE;case VP.WEB_RTC_LIVE:return zk.WEBRTC;default:return hb(e)}},i$=e=>{if(void 0!==e)switch(e){case FP.NONE:case FP.INLINE:return;case FP.FULLSCREEN:return Xk.FULLSCREEN;case FP.SECOND_SCREEN:return Xk.CHROMECAST;case FP.PIP:return Xk.PIP;default:return hb(e)}},r$=e=>{switch(e){case"slow-2g":case"2g":return Kk.POOR;case"3g":return Kk.GOOD;case"4g":return Kk.EXCELLENT}};let n$,a$;!function(e){e.CREATE_PLAYER="CreatePlayer",e.AD_EVENT="AdEvent",e.SET_SOURCE="SetSource",e.START="Start",e.WATCHED_4_SECS="4SecWatched",e.WATCHED_10_SECS="10SecWatched",e.WATCHED_20_SECS="20SecWatched",e.HEARTBEAT="30SecHeartbeat",e.FATAL="Fatal",e.ERROR="Error",e.PLAYER_ALIVE="PlayerAlive",e.END="End",e.STALLED="Stalled",e.STALLED_END="StalledEnd",e.FIRST_BYTE="FirstByte",e.CAN_PLAY="CanPlay",e.CHANGE_FORMAT="ChangeFormat",e.INITED=" Inited",e.READY="Ready",e.STARTED="Started",e.PLAYING="Playing",e.PAUSED="Paused",e.STOPPED="Stopped",e.SEEKED="Seeked",e.WILL_SEEK="WillSeek",e.USER_RATING="UserRating"}(n$||(n$={})),function(e){e.ERROR="error",e.EVENT="event"}(a$||(a$={}));var s$=n(4891),o$=n(94),l$=n(957);const u$=(e,t)=>{for(const i of t.split(".")){if(!(0,l$.isObject)(e)){e=void 0;break}e=e[i]}return e},d$="__ADB_CONFIG__",c$=(0,l$.isObject)(d$)&&d$.fn&&(0,o$.T)(d$.fn.encodeUrl)?d$.fn.encodeUrl:void 0,h$=void 0!==c$?e=>c$(e):void 0,p$=((e=window)=>{if(h$)return h$;const t=(0,s$.K)(e);for(;t.length;){const e=t.pop();if(!e)continue;const i=u$(e,"ya.videoAd.encodeUrl");if((0,o$.T)(i))return i}})(window);function f$(e,t=!0){const i=(e=>"hidden"in e?"hidden":"webkitHidden"in e?"webkitHidden":void 0)(e);if(!i)return t;return!e[i]}var m$=n(2611);function g$(e){console.error&&console.error(e)}var v$=n(2220);const S$="https://telemetry.dzen.ru";function y$(e){return void 0===e&&(e="/log"),S$+e}y$();const T$=`${S$}/batchLogHandle`;function E$(){return y$(`/${(0,v$.W)((e=5,t=20,Math.floor(Math.random()*(t-e+1))+e))}`);var e,t}const b$=(0,o$.T)(p$),_$="OneStreamPlayer",A$="1.1.0";class R${constructor(e){let{vsid:t,logUrl:i,eventIndexKey:r,serviceName:n=_$}=void 0===e?{}:e;this.rootFields={},this.labels={},this.additionalParamsFields={},this.stateFields={},this.dataFields={},this.currentBatchObject=[],this.eventIndex=0,this.eventIndexKey="__event_index",this.setRootFields=e=>{Object.entries(e).forEach((e=>{let[t,i]=e;void 0===i?delete this.rootFields[t]:this.rootFields[t]=i}))},this.setDataParameters=e=>{Object.entries(e).forEach((e=>{let[t,i]=e;void 0===i?delete this.dataFields[t]:this.dataFields[t]=i}))},this.setStateParameters=e=>{Object.entries(e).forEach((e=>{let[t,i]=e;void 0===i?delete this.stateFields[t]:this.stateFields[t]=i}))},this.setAdditionalParameters=e=>{Object.entries(e).forEach((e=>{let[t,i]=e;void 0===i?delete this.additionalParamsFields[t]:this.additionalParamsFields[t]=i}))},this.setLabels=e=>{Object.entries(e).forEach((e=>{let[t,i]=e;void 0===i?delete this.labels[t]:this.labels[t]=i}))},this.logUrl=i,this.rootFields={vsid:t},this.serviceName=n,r&&(this.eventIndexKey=r,this.eventIndex=parseInt(window.sessionStorage.getItem(this.eventIndexKey)||"0")||0)}logEvent(e){let{name:t,type:i,data:r,state:n,additionalStatsLabels:a,root:s,batched:o}=e;this.push({eventType:i,eventName:t,data:r,additionalStatsLabels:a,root:s,state:n,batched:o})}sendBatch(){const e=this.getLogUrl({[this.serviceName]:A$});try{if(this.currentBatchObject.length>0){const t=`[${this.currentBatchObject.map((e=>JSON.stringify(e,w$()))).join(",")}]`;this.sendData(e,t),this.currentBatchObject=[]}}catch(e){e instanceof Error&&g$(new m$.e(e,{details:{version:A$}}))}}push(e){let{eventName:t,eventType:i,additionalStatsLabels:r,batched:n=!1,data:a,state:s,root:o}=e;const l=this.getLogUrl(Object.assign({[this.serviceName]:A$,[i]:t},r));try{const e=Object.assign({},this.rootFields,o,{service:this.serviceName,labels:Object.assign({},this.labels,r),additionalParameters:{from_block:this.additionalParamsFields.from_block,ppi:this.additionalParamsFields.ppi,reqid:this.additionalParamsFields.reqid,stream_block:this.additionalParamsFields.stream_block},timestamp:Date.now(),eventType:i,eventName:t,version:A$,documentIsVisible:f$(document),isVideoADB:b$,eventIndex:this.eventIndex,data:Object.assign({},this.dataFields,a,{state:Object.assign({},this.stateFields,s),additionalParameters:Object.assign({},this.additionalParamsFields)})});if(n)return this.currentBatchObject.push(e),void this.incrementEventIndex();this.sendData(l,JSON.stringify([e],w$())),this.incrementEventIndex()}catch(e){e instanceof Error&&g$(new m$.e(e,{details:{version:A$,eventType:i,eventName:t}}))}}getLogUrl(e){const{logUrl:t=(b$?E$():T$)}=this;return t}sendData(e,t){!async function(e){let{url:t,data:i,contentType:r}=e;const n={method:"POST",body:i,keepalive:!0,priority:"low",mode:"no-cors",credentials:"omit"};void 0!==r&&(n.headers={"Content-Type":r}),await fetch(t,n).catch((async()=>await fetch(t,n).catch((()=>null))))}({url:e,data:t,contentType:"application/json"})}incrementEventIndex(){this.eventIndex++,window.sessionStorage.setItem(this.eventIndexKey,this.eventIndex.toFixed())}}const w$=()=>{const e=new WeakSet;return(t,i)=>{if("object"==typeof i&&null!==i){if(e.has(i))return;e.add(i)}return i}};function P$(e,t,i=" "){const r=t-e.length;if(r>0){let t=i;for(;t.length<r;)t+=t;return(t.length>r?t.substr(0,r):t)+e}return e}const O$="ZWP";function C$(e){return P$(String(e%Math.pow(10,4)),4,"0")}function L$(e){return void 0===e&&(e=1e3),[(0,v$.W)(44),O$,C$(e),P$(Date.now().toString().slice(0,10),10,"0")].join("x")}const I$="ms.dzen.ru";var x$;!function(e){e.Embed="EMBED",e.Zen="ZEN"}(x$||(x$={}));const M$={[x$.Embed]:{[n$.START]:`531321.${I$}`,[n$.PLAYING]:`531321.${I$}`,[n$.PAUSED]:`551321.${I$}`,[n$.END]:`551321.${I$}`,[n$.HEARTBEAT]:`541321.${I$}`},[x$.Zen]:{[n$.START]:`531121.${I$}`,[n$.PLAYING]:`531121.${I$}`,[n$.PAUSED]:`551121.${I$}`,[n$.END]:`551121.${I$}`,[n$.HEARTBEAT]:`541121.${I$}`}};const N$="_one-stat_",D$=`${N$}uuid`,k$=`${N$}vsid`,$$=`${N$}eventindex`;class V${constructor(e,t){var i,r,n,a,s;this.subscription=new cb,this.playerAliveTickInterval=-1,this.sendCurrentBatchInterval=-1,this.player=null,this.stalledId=0,this.stalledDuration=0,this.watched4Sent=!1,this.watched10Sent=!1,this.watched20Sent=!1,this.watchedTime=0,this.playerAlivePayload=null,this.playerAliveTimer=0,this.bufferSizes=[],this.createTime=0,this.additionalParametersFrom="",this.playerAliveTickInterval=window.setInterval(this.playerAliveTick.bind(this),1e3),this.sendCurrentBatchInterval=window.setInterval(this.sendCurrentBatch.bind(this),5e3);const o=(null==(i=t.device)?void 0:i.id)||window.localStorage.getItem(D$)||function(){const e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),t=new Array(36);let i,r,n=0;for(r=0;r<36;r++)8===r||13===r||18===r||23===r?t[r]="-":14===r?t[r]="4":(n<=2&&(n=33554432+16777216*Math.random()|0),i=15&n,n>>=4,t[r]=e[19===r?3&i|8:i]);return t.join("")}();window.localStorage.setItem(D$,o);const l=t.vsid||window.sessionStorage.getItem(k$)||L$();window.sessionStorage.setItem(k$,l),this.attachTo(e),this.stats=new R$({serviceName:"OneStreamPlayer",eventIndexKey:$$}),this.stats.setRootFields(Object.assign({},t,{vsid:l,device:{id:o}})),this.stats.setLabels(t.labels||{}),this.stats.setDataParameters(Object.assign({},t.data,{ssid:L$()})),this.stats.setStateParameters((null==(r=t.data)?void 0:r.state)||{}),this.stats.setAdditionalParameters((null==(n=t.data)?void 0:n.additionalParameters)||{}),this.additionalParametersFrom=(null==(a=t.data)||null==(s=a.additionalParameters)?void 0:s.from)||"",this.subscribe()}pause(){throw new Error("Method not implemented.")}resume(){throw new Error("Method not implemented.")}attachTo(e){const t=new cb,i=(e,i)=>t.add(e.subscribe(i));let r;i(e.info.isStalled$,(e=>{e?(Tb(r)?this.stalledDuration+=Ab()-r:r=Ab(),this.logStalled({stalledDuration:this.stalledDuration,stalledId:this.stalledId})):Tb(r)&&(this.stalledDuration+=Ab()-r,this.logStalledEnd({stalledDuration:this.stalledDuration,stalledId:this.stalledId}),r=void 0,this.stalledId++)})),i(e.events.fatalError$,(e=>{this.logError(e,!0)})),i(e.events.managedError$,(e=>{this.logError(e,!1)})),i(e.events.inited$,(()=>{this.logInited()})),i(e.events.firstBytes$,(()=>{this.logFirstBytes()})),i(e.events.firstFrame$,(()=>{const t=e.info.muted$.getValue();this.logFirstFrame({isMuted:t})})),i(e.events.canplay$,(()=>{this.logCanPlay()})),i(e.events.stopped$,(()=>{this.logStopped()})),i(e.events.playing$,(()=>{this.logPlaying(Object.assign({},this.playerAlivePayload))})),i(e.events.paused$,(()=>{this.logPaused()})),i(e.events.seeked$,(()=>{this.logSeeked()})),i(e.events.willSeek$,(()=>{this.logWillSeek()}));let n=0,a=!1;return i(e.events.seeked$,(()=>{a=!0})),i(e.events.willSeek$,(()=>{a=!0})),i(e.info.position$.pipe(O_()),(t=>{a?a=!1:this.watchedTime+=t[1]-t[0],this.stats.setStateParameters({watchedTime:this.watchedTime});const i=e.info.muted$.getValue(),r=e.info.duration$.getValue();var s;this.watchedTime>0&&this.logWatchedTime({duration:r,isFullscreen:(null==(s=this.player)?void 0:s.info.surface$.getValue())===FP.FULLSCREEN,isMuted:i,time:e.info.position$.getValue(),watchedSec:this.watchedTime});this.watchedTime-n>30&&(n=this.watchedTime,this.logHeartbeat({duration:r,watchedTime:this.watchedTime,isMuted:i})),Math.floor(r)===Math.floor(t[1])&&this.logEnded(Object.assign({},this.playerAlivePayload))})),i(e.info.atLiveEdge$,(e=>this.stats.setStateParameters({liveEdge:e}))),i(s_({muted:e.info.muted$,volume:e.info.volume$}),(e=>{let{muted:t,volume:i}=e;return this.stats.setDataParameters({audible:!t&&i>0})})),i(e.info.position$,(e=>this.stats.setDataParameters({time:e}))),i(e.info.currentQuality$,(e=>this.stats.setStateParameters({quality:e}))),i(e.info.isAutoQualityEnabled$,(e=>this.stats.setStateParameters({auto:e}))),i(e.info.currentFormat$,(e=>{var t,i,r;e&&this.stats.setRootFields({streamUrl:null==(t=this.player)||null==(i=t.info.availableSources$.getValue())||null==(r=i[e])?void 0:r.url});this.stats.setRootFields({engine:t$(e)}),this.log({name:n$.CHANGE_FORMAT,batched:!0})})),i(e.info.currentPlaybackRate$,(e=>this.stats.setStateParameters({playbackRate:e}))),i(e.info.hostname$,(e=>{this.stats.setRootFields({host:e})})),i(e.info.throughputEstimation$,(e=>this.stats.setStateParameters({bandwidthEstimate:e}))),i(e.info.httpConnectionType$,(e=>{this.stats.setRootFields({connectionType:e$(e)})})),i(e.info.currentBuffer$,(e=>{this.stats.setStateParameters({remainingBufferedTime:((null==e?void 0:e.end)||0)-((null==e?void 0:e.start)||0)})})),i(e.info.surface$,(e=>this.stats.setStateParameters({mode:i$(e)}))),i(e.info.position$,(()=>this.updatePlayerAlivePayload(e))),i(e.info.duration$,(()=>this.updatePlayerAlivePayload(e))),i(e.info.muted$,(()=>this.updatePlayerAlivePayload(e))),i(e.info.playbackState$,(()=>this.updatePlayerAlivePayload(e))),i(e.info.currentBuffer$,(()=>this.updateBufferSizes(e))),this.player=e,this.resubscribeBeforeunload(),this.subscription.add(t),t}destroy(){this.sendCurrentBatch(),clearInterval(this.playerAliveTickInterval),clearInterval(this.sendCurrentBatchInterval),this.subscription.unsubscribe()}logAdEvent(e){this.log({name:n$.AD_EVENT,state:{ad:(null==e?void 0:e.name)||""},batched:!0})}logRating(e){this.log({name:n$.USER_RATING,data:{rating:e},batched:!0})}logInited(){this.createTime=Date.now(),this.log({name:n$.CREATE_PLAYER,batched:!0})}logFirstBytes(){this.log({name:n$.FIRST_BYTE,batched:!0})}logEnded(e){this.log({name:n$.END,data:Object.assign({},e),batched:!0})}logStalledEnd(e){var t;this.log({name:n$.STALLED_END,data:{stalledDuration:e.stalledDuration,stalledId:e.stalledId,watchedSec:this.watchedTime,duration:null==(t=this.player)?void 0:t.info.duration$.getValue()},batched:!0})}logError(e,t){var i;this.log({name:t?n$.FATAL:n$.ERROR,data:Object.assign({},this.playerAlivePayload,{message:null==e?void 0:e.message,watchedSec:this.watchedTime,category:null==e?void 0:e.category,error:e,duration:null==(i=this.player)?void 0:i.info.duration$.getValue()})}),this.sendCurrentBatch()}logPlayerAlive(){this.playerAlivePayload&&this.log({name:n$.PLAYER_ALIVE,data:{duration:this.playerAlivePayload.duration,isMuted:this.playerAlivePayload.isMuted,watchedSec:this.watchedTime},state:{currentTime:this.playerAlivePayload.currentTime,watchedTime:this.playerAlivePayload.watchedTime,state:this.playerAlivePayload.state,bitrate:this.playerAlivePayload.bitrate,auto:this.playerAlivePayload.auto,stalledCount:this.playerAlivePayload.stalledCount,stalledTime:this.playerAlivePayload.stalledTime,remainingBufferedTime:this.playerAlivePayload.remainingBufferedTime},batched:!0})}logWatchedTime(e){const{watchedSec:t}=e,i={isFullscreen:e.isFullscreen,isMuted:e.isMuted,time:e.time};t>=4&&!this.watched4Sent&&(this.watched4Sent=!0,this.log({name:n$.WATCHED_4_SECS,data:Object.assign({duration:e.duration,watchedSec:4},i),state:{watchedTime:e.watchedSec},batched:!0})),t>=10&&!this.watched10Sent&&(this.watched10Sent=!0,this.log({name:n$.WATCHED_10_SECS,data:Object.assign({duration:e.duration,watchedSec:10},i),state:{watchedTime:e.watchedSec},batched:!0})),t>=20&&!this.watched20Sent&&(this.watched20Sent=!0,this.log({name:n$.WATCHED_20_SECS,data:Object.assign({duration:e.duration,watchedSec:20},i),state:{watchedTime:e.watchedSec},batched:!0}))}logHeartbeat(e){this.log({name:n$.HEARTBEAT,data:{duration:e.duration,isMuted:e.isMuted},state:{watchedTime:e.watchedTime},batched:!0})}logStalled(e){this.log({name:n$.STALLED,data:{stalledDuration:e.stalledDuration,stalledId:e.stalledId},batched:!0}),this.sendCurrentBatch()}logFirstFrame(e){var t;this.log({name:n$.START,data:{isMuted:e.isMuted,duration:null==(t=this.player)?void 0:t.info.duration$.getValue()},batched:!0}),this.sendCurrentBatch()}logCanPlay(){this.log({name:n$.CAN_PLAY,batched:!0})}logPlaying(e){this.log({name:n$.PLAYING,data:Object.assign({},e),batched:!0})}logPaused(){this.log({name:n$.PAUSED,batched:!0})}logStopped(){this.log({name:n$.STOPPED,batched:!0})}logSeeked(){this.log({name:n$.SEEKED,batched:!0})}logWillSeek(){this.log({name:n$.WILL_SEEK,batched:!0})}subscribe(){this.resubscribeBeforeunload();const e=window.navigator.connection;e&&"onchange"in e&&"effectiveType"in e&&this.subscription.add(o_(d_(e,"change"),u_(["init"])).subscribe((()=>this.stats.setStateParameters({network:r$(e.effectiveType)}))))}resubscribeBeforeunload(){var e;null==(e=this.beforeunloadSubscription)||e.unsubscribe(),this.beforeunloadSubscription=d_(window,"beforeunload").subscribe((()=>{this.sendCurrentBatch()})),this.subscription.add(this.beforeunloadSubscription)}log(e){!function(e,t){const i="other"===t?x$.Embed:x$.Zen;let r;const n=e;if(Object.keys(M$[i]).includes(n))try{r=`https://${M$[i][n]}`,fetch(`${r}/?_t=${Date.now()}`)}catch(e){}}(e.name,this.additionalParametersFrom),this.stats.logEvent({name:e.name,type:e.type||a$.EVENT,data:this.addRequiredParams(e.data),state:e.state,root:e.root,batched:e.batched})}addRequiredParams(e){const t=[...this.bufferSizes];return this.bufferSizes=[],Object.assign({},e,{bufferSizes:t,time:Date.now()-this.createTime})}playerAliveTick(){this.playerAliveTimer!==this.watchedTime&&(this.playerAliveTimer=this.watchedTime,(this.playerAliveTimer<=10||Math.round(this.playerAliveTimer)%5==0)&&this.logPlayerAlive())}updatePlayerAlivePayload(e){const t=e.info.currentBuffer$.getValue();let i;t&&(i=t.end-t.start),this.playerAlivePayload={currentTime:e.info.position$.getValue(),duration:e.info.duration$.getValue(),isMuted:e.info.muted$.getValue(),watchedTime:this.watchedTime,state:e.info.playbackState$.getValue(),bitrate:e.info.videoBitrate$.getValue(),auto:e.info.isAutoQualityEnabled$.getValue(),stalledCount:this.stalledId,stalledTime:this.stalledDuration,remainingBufferedTime:i}}sendCurrentBatch(){this.stats.sendBatch()}updateBufferSizes(e){const t=e.info.currentBuffer$.getValue();let i;if(t){const e=t.end-t.start;i=Math.round(100*e)/100,this.bufferSizes[this.bufferSizes.length-1]!==i&&this.bufferSizes.push(i)}}}const U$="player-qoe",B$=`${U$}-watched-time`,F$=`${U$}-questions-count`,H$=`${U$}-last-answered-time`;class j${constructor(){this.storage=localStorage;const{watchedTime:e,questionsCount:t,lastAnswerTime:i}=this.getMaximumData();this.watchedTime=e,this.questionsCount=t,this.lastAnswerTime=i}accountWatchedTime(e){e<3||(this.watchedTime+=e,this.storage.setItem(B$,this.watchedTime.toString()))}canShowQuestion(){const{watchedTime:e,questionsCount:t,lastAnswerTime:i}=this.getMaximumData(),r=e>=1800,n=t<3,a=Date.now()-i>=864e5;return!!(r&&n&&a)}questionIsShowing(){this.questionsCount+=1;const{watchedTime:e,questionsCount:t,lastAnswerTime:i}=this.getMaximumData();3===this.questionsCount&&this.reset(),this.storage.setItem(B$,e.toString()),this.storage.setItem(F$,t.toString()),this.storage.setItem(H$,i.toString())}questionIsAnswered(){this.reset(),this.storage.setItem(B$,this.watchedTime.toString()),this.storage.setItem(F$,this.questionsCount.toString()),this.storage.setItem(H$,this.lastAnswerTime.toString())}reset(){this.watchedTime=0,this.questionsCount=0,this.lastAnswerTime=Date.now()}getMaximumData(){return{watchedTime:Math.max(this.watchedTime||0,Number(this.storage.getItem(B$))||0),questionsCount:Math.max(this.questionsCount||0,Number(this.storage.getItem(F$))||0),lastAnswerTime:Math.max(this.lastAnswerTime||0,Number(this.storage.getItem(H$))||0)}}}const G$={autoplayOnlyInActiveTab:!1,dash:{forwardBufferTargetPreload:6e3,sourceOpenTimeout:-1},autoTrackSelection:{activeVideoAreaThreshold:-1},useSafariEndlessRequestBugfix:!0};function q$(e,t){let i={};try{i=JSON.parse((null==e?void 0:e.oneVideoPlayerConfig)||"")}catch(e){i={configName:[]}}const r=Object.assign({},G$,i);r.useNewSwitchTo=!1;const n=Object.keys(t);return 1===n.length&&n[0]===VP.HLS&&(r.useHlsJs=!0),r}var z$=n(6722);function W$(e){if(e&&function(e){const t=(0,z$.parseUrl)(e).pathname;return 0===t.indexOf("/vod/")||0===t.indexOf("/live/")||0===t.indexOf("/kal/")}(e))return(0,z$.addParamToUrl)(e,"json_preview","1")}function Q$(e,t){for(let i=0,r=e.length;i<r;i++)if(e[i]===t)return!0;return!1}function Y$(e,t){const i=document.querySelectorAll(t);let r=e.parentNode;for(;r&&!Q$(i,r);)r=r.parentNode;return r}function K$(e,t){if(e&&t){const i=e=>{var i;(e.shiftKey||(null==(i=e.touches)?void 0:i.length)>1)&&(e.shiftKey&&e.preventDefault(),setTimeout((()=>{!function(e){if(!e)return!1;const{body:t}=document,i=document.createElement("textarea");i.style.position="absolute",i.style.top="0",i.textContent=e,t.appendChild(i),i.select();const r=document.execCommand("copy");t.removeChild(i)}(t())}),1e3))};if(e){let t=null;try{t=Y$(e,'[data-testid="video-punch-preview"]')||Y$(e,".zen-ui-video-video-player")||Y$(e,'[aria-label="Видеоплеер"]')}catch(e){return}if(t)return t.addEventListener("click",i),t.addEventListener("touchstart",i),()=>{t.removeEventListener("click",i),t.removeEventListener("touchstart",i)}}}}const X$={ru:"Русский",en:"English",uk:"Українська",be:"Беларуская (тарашкевiца)",es:"Español",fi:"Suomi",de:"Deutsch",it:"Italiano",bg:"Български",hr:"Hrvatski",hu:"Magyar",sr:"Српски",pt:"Português",el:"Ελληνικά",pl:"Polski",fr:"Français",ko:"한국어","zh-CN":"汉语",lt:"Lietuvių",ja:"日本語",cs:"Čeština",et:"Eesti",tt:"Татарча",ba:"Башҡортса",cv:"Чăвашла",sk:"Slovenčina",ro:"Română",no:"Norsk",lv:"Latviešu",az:"Azərbaycan dili",hy:"Հայերեն",sv:"Svenska",nl:"Nederlands",tk:"Türkmen",ka:"ქართული",da:"Dansk",uz:"O‘zbek",th:"ภาษาไทย",id:"Bahasa Indonesia",tg:"Тоҷикӣ",sl:"Slovenščina",bs:"Bosanski","pt-BR":"Português brasileiro",fa:"فارسی",vi:"Tiếng Việt",hi:"हिन्दी",si:"සිංහල",bn:"বাংলা",tl:"Tagalog",mn:"Монгол",my:"ဗမာစာ",tr:"Türkçe",ne:"नेपाली",ur:"اردو",ky:"Кыргыз тили",pa:"پنجابی",os:"Ирон",kn:"ಕನ್ನಡ",sw:"Kiswahili",kk:"Қазақша",ar:"العربية",he:"עברית",ab:"Аҧсшәа",eu:"Euskara",eo:"Esperanto"},J$={abk:"as",ara:"ar",aze:"az",bak:"ba",bel:"be",ben:"bn",bos:"bs",bul:"bg",ces:"cs",chv:"cv",dan:"da",deu:"de",ell:"el",eng:"en",epo:"eo",est:"et",eus:"eu",fas:"fa",fin:"fi",fra:"fr",heb:"he",hin:"hi",hrv:"hr",hun:"hu",hye:"hy",ind:"id",ita:"it",jpn:"ja",kan:"kn",kat:"ka",kaz:"kk",kir:"ky",kor:"ko",lav:"lv",lit:"lt",mon:"mn",mya:"my",nep:"ne",nld:"nl",nor:"no",oss:"os",pan:"pa",pol:"pl",por:"pt",ron:"ro",rus:"ru",sin:"si",slk:"sk",slv:"sl",spa:"es",srp:"sr",swa:"sw",swe:"sv",tat:"tt",tgk:"tg",tgl:"tl",tha:"th",tuk:"tk",tur:"tr",ukr:"uk",urd:"ur",uzb:"uz",vie:"vi"};let Z$;!function(e){e.TINY="tiny",e.LOWEST="lowest",e.LOW="low",e.MEDIUM="medium",e.HIGH="high",e.FULL_HD="fullhd",e.QUAD_HD="quadhd",e.ULTRA_HD="ultrahd"}(Z$||(Z$={}));const eV={[Z$.TINY]:Bb.Q_144P,[Z$.LOWEST]:Bb.Q_240P,[Z$.LOW]:Bb.Q_360P,[Z$.MEDIUM]:Bb.Q_480P,[Z$.HIGH]:Bb.Q_720P,[Z$.FULL_HD]:Bb.Q_1080P,[Z$.QUAD_HD]:Bb.Q_1440P,[Z$.ULTRA_HD]:Bb.Q_2160P},tV=/^[-._0-9A-Za-zА-Яа-яËё]+\.(?:[A-Za-zА-Яа-яËё]+|xn--[-A-Za-z0-9]+)$/,iV=/^(?:ftp|https?):\/\//i;function rV(e){var t;const i={};e.streams=null==(t=e.streams)?void 0:t.map((e=>{var t;const i=!!(e=>{try{const t=new URL(e);return tV.test(t.hostname)&&iV.test(e)}catch(e){return!1}})(e.url)&&(null==(t=new URL(e.url))?void 0:t.searchParams.get("dzen_dash"));return i?{url:e.url,type:i}:e}));const r=(e.streams||[]).filter((e=>{var t;return Object.values(Z$).includes(null==(t=e.type)?void 0:t.toLowerCase())})).reduce(((e,t)=>Object.assign({},e,{[eV[t.type]]:t.url})),{});return(e.streams||[]).forEach((e=>{var t;const n=null==(t=e.type)?void 0:t.toLowerCase();switch(!0){case"dash"===n:i.DASH_SEP={type:"url",url:e.url};break;case"hls"===n:i.HLS={type:"url",url:e.url};break;case Object.values(Z$).includes(n):i.MPEG=r;break;case e.url.includes(".m3u8"):i.HLS={type:"url",url:e.url};break;case e.url.includes(".mp4"):i.MPEG={"Invariant quality":e.url};break;case e.url.includes(".mpd"):default:i.DASH_SEP={type:"url",url:e.url}}})),i}const nV=[{pattern:/^PIPELINE_ERROR_(\w+)(?:\s*:\s*(.+))?$/,template:"PIPELINE_ERROR",extract:e=>({type:e[1],message:e[2]})}];function aV(e){for(const t of nV){t.pattern.lastIndex=0;const i=e.message.match(t.pattern);if(i)return{message:t.template,additional:Object.assign({},t.extract(i),e.data,{originalError:e.thrown?String(e.thrown):void 0},{category:e.category,id:e.id})}}return{message:e.message,additional:Object.assign({},e.data,{originalError:e.thrown?String(e.thrown):void 0},{category:e.category,id:e.id})}}function sV(e){for(;e.firstChild;)e.removeChild(e.firstChild)}class oV{constructor(e,t){this.videoPlayer=e,this.player=t,this.previousTimeOnWillSeek=void 0,this.lastPosition=0,this.subscription=new cb,this.canSendEvents=!1,this.canSendEvents="undefined"!=typeof window&&!!window.parent&&window.parent!==window&&"function"==typeof window.parent.postMessage,this.canSendEvents&&this.subscribeToEvents()}subscribeToEvents(){this.subscription=new cb,this.subscription.add(this.player.events.inited$.subscribe((()=>this.handleInited()))),this.subscription.add(this.player.events.started$.subscribe((()=>{this.handleStarted({time:this.player.info.position$.getValue(),duration:this.player.info.duration$.getValue(),muted:this.player.info.muted$.getValue()?1:0,quality:this.player.info.currentQuality$.getValue()})}))),this.subscription.add(this.player.events.playing$.subscribe((()=>{this.handleResumed({time:this.player.info.position$.getValue(),duration:this.player.info.duration$.getValue(),muted:this.player.info.muted$.getValue()?1:0,quality:this.player.info.currentQuality$.getValue()})}))),this.subscription.add(this.player.events.paused$.subscribe((()=>{this.handlePaused({time:this.player.info.position$.getValue()})}))),this.subscription.add(this.player.events.ended$.subscribe((()=>{this.handleEnded({time:this.player.info.position$.getValue()})}))),this.subscription.add(this.player.events.willSeek$.subscribe((e=>{this.handleWillSeek(e.from)}))),this.subscription.add(this.player.events.seeked$.subscribe((()=>{this.handleSeeked(this.player.info.position$.getValue())}))),this.subscription.add(this.player.events.fatalError$.subscribe((e=>{this.handleFatalError({time:this.player.info.position$.getValue(),code:"5",message:e.message})}))),this.subscription.add(this.player.events.managedError$.subscribe((e=>{this.handleNonFatalError({time:this.player.info.position$.getValue(),code:"0",message:e.message})}))),this.subscription.add(this.player.info.position$.subscribe((e=>{Math.abs(e-this.lastPosition)>=1&&(this.handleTimeUpdate({time:e,duration:this.player.info.duration$.getValue()}),this.lastPosition=e)}))),this.subscription.add(this.player.info.currentQuality$.subscribe((e=>{e&&this.handleQualityChange({time:this.player.info.position$.getValue(),quality:e})}))),this.subscription.add(this.player.info.isBuffering$.subscribe((e=>{e?this.handleBufferingStarted({time:this.player.info.position$.getValue(),quality:this.player.info.currentQuality$.getValue()}):this.handleBufferingEnded({time:this.player.info.position$.getValue(),quality:this.player.info.currentQuality$.getValue()})}))),this.subscription.add(this.player.info.playbackState$.subscribe((e=>{e===$P.READY&&this.handlePlayerReady()}))),this.subscription.add(this.player.info.availableQualities$.subscribe((e=>{e.length>0&&this.handleQualityList({list:e})}))),this.subscription.add(this.player.info.volume$.subscribe((e=>{this.handleVolumeChange({volume:e,muted:this.player.info.muted$.getValue()?1:0})}))),this.subscription.add(this.player.info.muted$.subscribe((e=>{this.handleVolumeChange({volume:this.player.info.volume$.getValue(),muted:e?1:0})}))),this.subscription.add(this.player.info.currentPlaybackRate$.subscribe((e=>{this.handlePlaybackRateChange({time:this.player.info.position$.getValue(),rate:e})}))),this.subscription.add(this.player.events.firstFrame$.subscribe((()=>{this.handleContentImpression({time:this.player.info.position$.getValue()})}))),this.player.info.availableSources$.subscribe((()=>{var e,t;this.handleSourceUpdated({id:null==(e=this.videoPlayer.getVideoSource())||null==(t=e.videoInfo)?void 0:t.videoContentId})}))}destroy(){var e;this.canSendEvents&&(null==(e=this.subscription)||e.unsubscribe())}sendEmbedEvent(e,t){if(!this.canSendEvents)return;const i=Object.assign({event:e},t);try{window.parent.postMessage(i,"*")}catch(e){console.error("Embed Logger: Error sending postMessage:",e)}}handleInited(){this.sendEmbedEvent("inited",{})}handleStarted(e){const t=Object.assign({},e,{time:void 0!==e.time?Math.floor(e.time):void 0});this.sendEmbedEvent("started",t)}handleResumed(e){const t=Object.assign({},e,{time:void 0!==e.time?Math.floor(e.time):void 0});this.sendEmbedEvent("resumed",t)}handleTimeUpdate(e){const t=Object.assign({},e,{time:void 0!==e.time?Math.floor(e.time):void 0});this.sendEmbedEvent("timeupdate",t)}handlePaused(e){const t={time:void 0!==e.time?Math.floor(e.time):void 0};this.sendEmbedEvent("paused",t)}handleEnded(e){const t={time:void 0!==e.time?Math.floor(e.time):void 0};this.sendEmbedEvent("ended",t)}handleFatalError(e){const t={time:void 0!==e.time?Math.floor(e.time):0,code:e.code,message:e.message};this.sendEmbedEvent("error",t)}handleNonFatalError(e){const t={time:void 0!==e.time?Math.floor(e.time):0,code:e.code,message:e.message};this.sendEmbedEvent("error",t)}handleWillSeek(e){this.previousTimeOnWillSeek=void 0!==e?Math.floor(e):void 0}handleSeeked(e){const t={time:void 0!==e?Math.floor(e):void 0,previousTime:this.previousTimeOnWillSeek};this.previousTimeOnWillSeek=void 0,this.sendEmbedEvent("rewound",t)}handleQualityChange(e){const t=Object.assign({},e,{time:void 0!==e.time?Math.floor(e.time):void 0});this.sendEmbedEvent("qualityChange",t)}handleBufferingStarted(e){const t=Object.assign({},e,{time:void 0!==e.time?Math.floor(e.time):void 0});this.sendEmbedEvent("bufferingStarted",t)}handleBufferingEnded(e){const t=Object.assign({},e,{time:void 0!==e.time?Math.floor(e.time):void 0});this.sendEmbedEvent("bufferingEnded",t)}handlePlayerReady(){this.sendEmbedEvent("playerReady",{})}handleSourceUpdated(e){const t={id:e.id,params:{}};this.sendEmbedEvent("sourceUpdated",t)}handleContentImpression(e){const t={time:void 0!==e.time?Math.floor(e.time):void 0};this.sendEmbedEvent("contentImpression",t)}handleAdShown(e){const t=Object.assign({},e,{time:void 0!==e.time?Math.floor(e.time):void 0});this.sendEmbedEvent("adShown",t)}handleAdEnd(e){const t={time:void 0!==e.time?Math.floor(e.time):void 0};this.sendEmbedEvent("adEnd",t)}handleAdSkip(e){const t={time:void 0!==e.time?Math.floor(e.time):void 0};this.sendEmbedEvent("adSkip",t)}handleVolumeChange(e){const t=Object.assign({},e);this.sendEmbedEvent("volumechange",t)}handlePlaybackRateChange(e){const t=Object.assign({},e,{time:void 0!==e.time?Math.floor(e.time):void 0});this.sendEmbedEvent("playbackRateChange",t)}handleFullscreenChange(e){const t=Object.assign({},e);this.sendEmbedEvent("fullscreen",t)}handleFullscreenError(e){const t=Object.assign({},e);this.sendEmbedEvent("fullscreenError",t)}handleClickout(e){const t=Object.assign({},e);this.sendEmbedEvent("clickout",t)}handleQualityList(e){const t=Object.assign({},e);this.sendEmbedEvent("qualityList",t)}}var lV;class uV{getVideoElement(){return this.htmlVideoElement}constructor(e){this.realPlayingState=t.Unstarted,this.player=null,this.subscription=new cb,this.initingState=r.NOT_INITED,this.preloadPlayers={},this.usedPreloadElements={},this.freePreloadElements=[],this.preloadElementsCreated=0,this.pipAllowed=!1,this.firstFramePlayed=!1,this.qoeAccumulator=new j$,this.currentCue="",this.publicStatesPlayer={currentTime:0,watchedTime:0,watchedAccuracyTime:0,currentAccuracyTime:0,playingState:t.Unstarted,isMuted:!1,isFullscreen:!1,currentPlaybackRate:1,playbackRates:[]},this.htmlVideoElement=null,this.handlers=new c,this.emitMuteChange=(e,t)=>{this.publicStatesPlayer.isMuted=e,t?this.handlers.onMuteChangeByUser.emit(e):this.handlers.onMuteChange.emit(e)},this.sessionParams=e}initAdManager(){var e;this.adManager&&(null==(e=this.adManager)||e.destroy());this.playerElement&&this.htmlVideoElement&&this.playerConfig&&this.videoSource&&this.player&&(this.adManager=new jk,this.adManager.init({player:this,onePlayer:this.player,playerConfig:this.playerConfig,htmlVideoElement:this.htmlVideoElement,playerElement:this.playerElement,videoSource:this.videoSource,sessionParams:this.sessionParams}))}async init(e,t,i,n){var a,s,o;null==(a=this.unsubscribeFromLocalVideoHistory)||a.call(this),this.lastPositionFromLocalHistory=void 0;const l=FD(i),u=Object.assign({},i,{startPosition:t.isLocalWatchingHistoryEnabled&&void 0===i.startPosition?GD(i):i.startPosition}),d=this.initingState===r.NOT_INITED,c=void 0!==this.playerElement&&this.playerElement!==e,h=!this.isEqualSource(u);if(t.isLocalWatchingHistoryEnabled&&l&&(this.unsubscribeFromLocalVideoHistory=jD.getInstance().subscribe(l,(e=>{this.lastPositionFromLocalHistory=e}))),this.playerElement=e,this.heartbeatTimes=t.heartbeatTimes,this.playerConfig=t,this.videoSource=Object.assign({},u,{additionalParams:Object.assign({},u.additionalParams,{from:(null==(s=u.additionalParams)?void 0:s.from)||"",vsid:this.sessionParams.vsid||window.sessionStorage.getItem(k$)||L$()})}),e&&u){if(this.player)h?(this.clearPublicState(u),this.updateSource(u)):this.isPlayerReady()&&this.handleContentImpression();else if(this.clearPublicState(u),c)await this.reinitVideo(e,this.playerConfig,this.videoSource,u.startPosition||0,!0);else if(this.playerElement){var p;this.sessionParams.isPlayerControlsVisible||e.addEventListener("click",this.handlePlayerElemClick),null!=(p=this.adManager)&&p.adManagerState.adInfo?this.adManager.play():this.reinitVideo(this.playerElement,this.playerConfig,this.videoSource,u.startPosition||0,!0)}this.handlers.onSyncStates.emit(this.publicStatesPlayer),this.setFrameFit(t.frameFit),this.setTransform(t.scale,t.deltaX,t.deltaY),d&&t.isAutoplay||n||this.setMuted(t.isMuted),this.setNativeAdControlsVisibility(!(null!=(o=this.playerConfig)&&o.isNativeAdControlsHidden)),this.setNativeTextTrackVisibility(!1),this.initHeartbeatHandler()}else this.emitError(!0,{message:`player not configured: element: ${typeof e}; source: ${typeof u}`})}getIsInlineInited(){return this.isInlineInited}setIsInlineInited(e){this.isInlineInited=e}setStatLogger(e){this.statLogger=e}isPlayerReady(){return!0}logError(e,t,i){const{videoSource:r,playerConfig:n}=this;(e=>{let{sessionParams:t,errParams:i,videoSource:r,playerConfig:n,playerApi:a,originErr:s,isFatal:o}=e;i.additional=Object.assign({},i.additional);const l=r&&r.additionalParams;l&&(i.additional.item_id=l.item_id,i.additional.stream_block=l.stream_block),r&&r.videoInfo&&(i.additional.videoContentId=r.videoInfo.videoContentId),r&&r.adConfig&&(i.additional.partnerId=r.adConfig.partnerId),n&&"sandbox"===n.apiName&&(i.additional.sandboxVersion=t.sandboxVersion),a&&a.getVersion&&(i.additional.playerVersion=a.getVersion()),o||(i.isBackground=!0);const u=`ZenVideoPlayer error: ${i.message||""}`;uk.error(u,i,s)})({sessionParams:this.sessionParams,playerApi:this,videoSource:r,playerConfig:n,errParams:t,originErr:e,isFatal:i})}async waitPlayerApi(){}async getHtmlVideoElement(){return this.htmlVideoElement}getIsAdVisible(){var e;return(null==(e=this.publicStatesPlayer.adState)?void 0:e.state)===Ik.PLAYING}async fallbackPreloadSource(e,t,i){t.isAutoplay=!1,await this.init(e,t,i)}abortPreloadSource(e){const t=zD(e);if(t&&this.preloadPlayers[t]){const e=this.usedPreloadElements[t];e&&(this.freePreloadElements.push(e),delete this.usedPreloadElements[t]),this.preloadPlayers[t].destroy(),delete this.preloadPlayers[t]}}async preloadSource(e){if(this.isEqualSource(e))return;const t=this.convertStreams(e),i=q$(this.playerConfig,t);i.useManagedMediaSource=!1;const r=new YI(i);let n=this.freePreloadElements.shift();if(n){var a;const e=null==(a=n.firstChild)?void 0:a.error;e&&this.emitError(!1,{message:`HTMLVideoElement error: ${e.code} - ${e.message}`})}else n=document.createElement("div"),n.appendChild(document.createElement("video"));r.initVideo({container:n,sources:this.convertStreams(e)}),r.prepare();const s=zD(e);s&&(this.usedPreloadElements[s]=n,this.preloadPlayers[s]=r)}async preloadSourceWithFallback(e){var t;const{playerElement:i,playerConfig:n}=e,a=Object.assign({},e.videoSource,{startPosition:n.isLocalWatchingHistoryEnabled&&void 0===e.videoSource.startPosition?GD(e.videoSource):e.videoSource.startPosition});this.isEqualSource(a)||(this.initingState===r.NOT_INITED&&this.reinitVideo(i,Object.assign({},n,{isAutoplay:!1}),a,void 0,!0),(null==(t=this.player)?void 0:t.prepare)&&this.player.prepare())}async autoplay(){this.initingState!==r.ERROR&&(this.inlineLogStatEvent("autoplay"),this.safePlay())}async autopause(){return this.pause()}async seek(e){var t;null==(t=this.player)||t.seekTime(e||0)}async seekBy(e,t){var i;"seconds"===t&&(null==(i=this.player)||i.seekTime(this.player.info.position$.getValue()+e))}async setFullscreen(e){this.publicStatesPlayer.isFullscreen=e,this.playerElement&&(e?(e=>{if(e.requestFullscreen)return e.requestFullscreen();if(e.msRequestFullscreen)return e.msRequestFullscreen();if(e.webkitRequestFullscreen)return e.webkitRequestFullscreen();if(e.mozRequestFullScreen)return e.mozRequestFullScreen();const t=e.querySelector("video");null!=t&&t.webkitEnterFullscreen?t.webkitEnterFullscreen():Promise.reject()})(this.playerElement):((e,t)=>{if(e.exitFullscreen)return e.exitFullscreen();if(e.msExitFullscreen)return e.msExitFullscreen();if(e.webkitExitFullscreen)return e.webkitExitFullscreen();if(e.mozCancelFullScreen)return e.mozCancelFullScreen();const i=t.querySelector("video");null!=i&&i.webkitExitFullscreen?i.webkitExitFullscreen():Promise.reject()})(document,this.playerElement))}toggleFullscreen(){this.setFullscreen(!this.publicStatesPlayer.isFullscreen)}toggleAdFreeSessionState(e){this.adManager&&(this.adManager.isAdFreeSession=e)}updateEpisodes(e){var t;null==(t=this.adManager)||t.updateEpisodes(e)}setMuted(e,t){if(this.publicStatesPlayer.isMuted=e,this.player){this.player.setMuted(e);for(const t of Object.values(this.freePreloadElements))t.firstChild.muted=e;for(const t of Object.values(this.preloadPlayers))t.setMuted(e);this.emitMuteChange(e,t)}}setNativeAdControlsVisibility(e){}setPictureInPictureAllowed(e){this.pipAllowed=e,this.htmlVideoElement&&wk(window,this.pipAllowed,this.htmlVideoElement)}sendRatingLog(e){var t;null==(t=this.statistic)||t.logRating(e)}canShowQoeQuestion(){return this.qoeAccumulator.canShowQuestion()}markQoeQuestionShown(){return this.qoeAccumulator.questionIsShowing()}markQoeQuestionAnswered(){return this.qoeAccumulator.questionIsAnswered()}getIsPip(){var e;return(null==(e=this.player)?void 0:e.info.surface$.getValue())===FP.PIP}getVolume(){return this.player?100*this.player.info.volume$.getValue():100}getMuted(){var e;return this.player?this.player.info.muted$.getValue():null==(e=this.playerConfig)?void 0:e.isMuted}setVolume(e){var t;this.player&&(e=null!=(t=e)?t:100,this.player.setVolume(e/100),this.handlers.onVolumeChange.emit(this.getVolume()))}skipAdPod(){}playInrollAd(e){}async setFrameFit(e){this.htmlVideoElement&&(this.htmlVideoElement.style.objectFit=e)}setTransform(e,t,i){if("number"==typeof e||"number"==typeof t||"number"==typeof i){if(!this.htmlVideoElement)return void(this.playerConfig&&(this.playerConfig.deltaX=t,this.playerConfig.deltaY=i,this.playerConfig.scale=e));this.htmlVideoElement.style.transform=((e,t,i)=>{let r="";return"number"==typeof e&&(r+=`scale(${e})`),"number"!=typeof t&&"number"!=typeof i||(r+=` translate(${t||0}px, ${i||0}px)`),r.trim()})(e,t,i)}}getCurrentTime(){var e,t,i;return Math.round((null==(e=this.player)||null==(t=e.info)||null==(i=t.position$)?void 0:i.getValue())||0)}getCurrentAccuracyTime(){var e;return(null==(e=this.player)?void 0:e.info.position$.getValue())||0}getWatchedTime(){return this.publicStatesPlayer.watchedTime}getIsFullscreen(){return this.publicStatesPlayer.isFullscreen}getPlayingState(){var e;return(null==(e=this.publicStatesPlayer)?void 0:e.playingState)||t.Unstarted}async unsafeDirectPlay(){this.player&&this.player.play()}safePlay(){var e;return null==(e=this.adManager)||e.play(),this.unsafeDirectPlay()}pause(){var e,t;null==(e=this.player)||e.pause(),null==(t=this.adManager)||t.pause()}setVideoTrack(e){var t,i,r;"auto"===e?null==(t=this.player)||t.setAutoQuality(!0):(null==(i=this.player)||i.setAutoQuality(!1),null==(r=this.player)||r.setQuality(e))}setPlaybackRate(e){this.player&&this.player.setPlaybackRate&&this.player.setPlaybackRate(e)}setTextTrack(e){if(!this.player)return;this.player.selectTextTrack(e);const t=function(e,t){if(e&&t)for(let i=0;i<e.textTracks.length;i++)if(e.textTracks[i].id===t)return e.textTracks[i];return null}(this.htmlVideoElement,e||null),i=function(e){return e?{name:e.label,value:e.id,lang:e.language,source:e}:null}(t);this.removeCueChangeHandler(),t&&i?(this.publicStatesPlayer.currentTextTrack=i,this.handlers.onTextTrackChange.emit(i)):e||(this.publicStatesPlayer.currentTextTrack=void 0,this.handlers.onTextTrackChange.emit(void 0)),this.addCueChangeHandler(t)}removeCueChangeHandler(){const{currentTextTrack:e}=this.publicStatesPlayer;var t;e&&this.cueChangeListener&&(null==(t=e.source)||t.removeEventListener("cuechange",this.cueChangeListener),this.currentCue="")}addCueChangeHandler(e){e&&(e.mode="hidden",this.cueChangeListener=()=>this.cueChangeHandler(),e.addEventListener("cuechange",this.cueChangeListener))}cueChangeHandler(){var e;const t=null==(e=this.publicStatesPlayer)?void 0:e.currentTextTrack;if(t){let e="";for(let h=0;h<((null==(i=t.source)||null==(r=i.activeCues)?void 0:r.length)||0);h++){var i,r,n,a,s,o,l,u,d,c;e+=(null==(n=t.source)||null==(a=n.activeCues)||null==(s=a.getCueById(null==(o=t.source)||null==(l=o.activeCues)?void 0:l[h].id))?void 0:s.text)||(null==(u=t.source)||null==(d=u.activeCues)||null==(c=d[h])?void 0:c.text)||""}this.currentCue=e}}openReportWindow(){}flushPlayer(e){e&&this.setPlayingState(t.Unstarted),o(this.handlers).forEach((e=>{this.handlers[e].offAll()}))}unhandleEvents(e){o(e).forEach((t=>{var i;const r=null==(i=this.handlers[t])?void 0:i.off;r&&r(e[t])}))}handleEvents(e){o(e).forEach((t=>{var i;const r=null==(i=this.handlers[t])?void 0:i.on;r&&r(e[t])}))}isEqualSource(e){if(!this.videoSource)return!1;const t=zD(e),i=zD(this.videoSource);return!!t&&!!i&&i===t}canBeReused(e){const{playerConfig:t}=this;return!!t&&t.apiName===e.apiName}async destroy(){var e,t,i,n,a,s;null==(e=this.unsubscribeFromLocalVideoHistory)||e.call(this),null==(t=this.adManager)||t.destroy(),null==(i=this.statistic)||i.destroy(),null==(n=this.yandexEmbedStat)||n.destroy(),this.handlers.onDestroy.emit(),null==(a=this.subscription)||a.unsubscribe(),null==(s=this.player)||s.destroy(),this.cleanupCurrentPlayerFromPreload(),this.player=null,this.clearPublicState(),this.initingState=r.DESTROYED}cleanupCurrentPlayerFromPreload(){Object.entries(this.preloadPlayers).forEach((e=>{let[t,i]=e;i===this.player&&delete this.preloadPlayers[t]}))}getPlace(){var e;return(null==(e=this.playerConfig)?void 0:e.placeName)||"default"}checkIsNativePreloadPlayer(){var e;return null==(e=this.playerConfig)?void 0:e.isNativePreloadPlayer}getUtcStartTime(){}getVsid(){var e,t;return null==(e=this.videoSource)||null==(t=e.additionalParams)?void 0:t.vsid}getSessionParams(){return this.sessionParams}getPlayerConfig(){return this.playerConfig}getVideoSource(){return this.videoSource}getIsPaused(){var e;return"paused"===(null==(e=this.player)?void 0:e.info.playbackState$.getValue())}getIsPlayedVideo(){return this.realPlayingState!==t.Unstarted&&this.realPlayingState!==t.Error}getIsAutoplayImpossible(){return!1}async getAdConfig(){var e;return null==(e=this.videoSource)?void 0:e.adConfig}setNativeTextTrackVisibility(e){}setPlayingState(e){this.publicStatesPlayer.playingState=e,this.handlers.onStateChange.emit(e)}inlineLogStatEvent(e,t){if(void 0===t&&(t=this.getWatchedTime()),this.statLogger&&this.isInlineInited)try{const i=this.getCurrentTime();this.statLogger(e,{watchedTime:t,currentTime:i})}catch(t){this.emitError(!1,{message:"Failed inline log stat event",additional:{event:e}},qD(t))}}handleCurrentTimeChange(e,t,i){var n,a,s,o;const l=Math.floor(e),u=Math.floor(i);if(isNaN(l)||isNaN(u))return;if(this.publicStatesPlayer.currentTextTrack){const t=function(e,t){const i=/([^<]+)?<(\d{2}:\d{2}:\d{2}\.\d{3})>(?:<c>)?([^<]+)(?:<\/c>)?/g,r=[];let n,a="";const s=e.split("<")[0];for(s&&r.push({text:s,startTime:0});null!==(n=i.exec(e));){const e=n[3],t=n[2],[i,a,s]=t.split(":"),o=3600*parseInt(i)+60*parseInt(a)+parseFloat(s);r.push({text:e,startTime:o})}return r.forEach((e=>{t>=e.startTime&&(a+=e.text)})),a.trim()}(this.currentCue,e);this.publicStatesPlayer.subtitles=t,this.handlers.onSubtitlesChange.emit(t)}if(this.initingState===r.INITIALIZING&&i>0&&this.handleResourcesIdle(),this.publicStatesPlayer.watchedAccuracyTime=i,this.publicStatesPlayer.currentAccuracyTime=e,this.handlers.onCurrentAccuracyWatchedTimeChange.emit(i),l===this.publicStatesPlayer.currentTime&&u===this.publicStatesPlayer.watchedTime)return;if(0===l&&null!=(n=this.videoSource)&&n.startPosition&&!i)return;this.handlers.onCurrentTimeChange.emit(l,u);const d=this.videoSource&&FD(this.videoSource);null!=(a=this.playerConfig)&&a.isLocalWatchingHistoryEnabled&&d&&0!==l&&(this.publicStatesPlayer.watchedTime!==u||this.publicStatesPlayer.currentTime!==l)&&jD.getInstance().savePosition(d,l),this.heartbeatHandler&&this.watchTimeAccumulator&&this.heartbeatHandler(this.watchTimeAccumulator(u));const c=u-this.publicStatesPlayer.watchedTime;this.publicStatesPlayer.currentTime=l,this.publicStatesPlayer.watchedTime=u,null==(s=this.adManager)||s.setWatchedTime(c,i,e,(null==(o=this.player)?void 0:o.info.duration$.getValue())||0)}handleStateChange(e){var i;null!=(i=this.playerConfig)&&i.isLocalWatchingHistoryEnabled&&e===t.Playing&&this.realPlayingState===t.Paused&&this.lastPositionFromLocalHistory&&this.lastPositionFromLocalHistory!==this.getCurrentTime()&&(this.seek(this.lastPositionFromLocalHistory),this.lastPositionFromLocalHistory=void 0),this.setPlayingState(e),this.realPlayingState=e}handleResourcesIdle(){this.initingState=r.INITED,this.handlers.onResourcesIdle.emit()}initHeartbeatHandler(){if(!this.videoSource)return;if(!this.heartbeatTimes)return;const e=zD(this.videoSource);e?(this.heartbeatHandler=((e,t,i)=>{var r,n;const a=vk(),s=(null==(r=document.location)||null==(n=r.pathname)?void 0:n.split("/").length)>2||!a,o=`heartbeat-${Tk(document.location)}`,l=`heartbeat-${document.referrer?Tk(new URL(document.referrer)):"empty"}`,u=(null==a?void 0:a.get(l))||(null==a?void 0:a.get(o))||{};Ek[e]=u[e]||Ek[e]||{};const d=Ek[e];return Sk(o),r=>{for(const e of t)!d[e]&&r>=e&&(d[e]=!0,i(e));s||(u[e]=d,a.set(o,u,72e5))}})(e,this.heartbeatTimes,(e=>this.handleHeartbeat(e))),this.watchTimeAccumulator=(e=>{var t,i;const r=vk(),n=(null==(t=document.location)||null==(i=t.pathname)?void 0:i.split("/").length)>2||!r,a=`watch-time-accumulator-${Tk(document.location)}`,s=`watch-time-accumulator-${document.referrer?Tk(new URL(document.referrer)):"empty"}`,o=(null==r?void 0:r.get(s))||(null==r?void 0:r.get(a))||{};bk[e]=o[e]||bk[e]||{lastAcc:0,totalAcc:0};const l=bk[e];return Sk(a),t=>(t<l.lastAcc?l.totalAcc+=t:l.totalAcc+=t-l.lastAcc,l.lastAcc=t,n||(o[e]=l,r.set(a,o,72e5)),l.totalAcc)})(e)):this.emitError(!1,{message:"Init heartbeat: streamUrl and videoCountentId is empty"})}handleHeartbeat(e){e&&this.inlineLogStatEvent("heartbeat",e),this.handlers.onHeartbeat.emit(e)}emitError(e,t,i){const n=i||new Error(t.message);this.logError(n,t,e),e&&(this.initingState=r.ERROR,this.handlers.onError.emit())}clearPublicState(e){this.publicStatesPlayer.tileMetaInfoUrl="",this.publicStatesPlayer.currentTime=(null==e?void 0:e.startPosition)||0,this.publicStatesPlayer.textTracks=[],this.publicStatesPlayer.watchedAccuracyTime=0,this.publicStatesPlayer.watchedTime=0,this.publicStatesPlayer.currentAccuracyTime=0,this.publicStatesPlayer.currentTime=0}handlePlaybackRateChange(e){this.publicStatesPlayer.currentPlaybackRate=e||1,this.handlers.onPlaybackRateChange.emit(e||1)}async updateSource(e){if(!this.player)return this.emitError(!0,{message:"Player is not exists"}),void this.destroy();if(!e)return this.emitError(!0,{message:"VideoSource is empty"}),void this.destroy();if(!this.playerElement)return this.emitError(!0,{message:"Player element is not mounted"}),void this.destroy();this.videoSource=e;try{this.playerElement&&this.reinitVideo(this.playerElement,this.playerConfig,this.videoSource,e.startPosition,!0),this.initHeartbeatHandler(),this.handlers.onSourceUpdate.emit()}catch(e){return this.emitError(!0,{message:"Failed update source"},qD(e)),void this.destroy()}return this.player}handlePlayerElemClick(){var e;if(this.getIsAdVisible()&&(null==(e=this.playerConfig)||!e.isNativeAdControlsHidden))return;const i=this.getPlayingState();this.getIsAdVisible()||(i===t.Playing?(this.pause(),this.inlineLogStatEvent("pause")):(this.safePlay(),this.inlineLogStatEvent("play")))}handleContentImpression(){var e,t;const i=null==(e=this.player)?void 0:e.info.currentFormat$.getValue(),r=null==(t=this.player)?void 0:t.info.availableSources$.getValue();if(i&&r){const e=W$(r[i].url);this.publicStatesPlayer.tileMetaInfoUrl=e,this.handlers.onTileMetaInfoUrlChange.emit(e)}this.handlers.onContentImpression.emit()}convertStreams(e){if(!e)return{};const t=rV(e);return this.convertedStreams=t,t}resume(e){var t;this.reinitVideo(this.playerElement,this.playerConfig,this.videoSource,e||0),null==(t=this.player)||t.play()}deinit(){var e,t;null==(e=this.subscription)||e.unsubscribe(),null==(t=this.player)||t.destroy(),this.cleanupCurrentPlayerFromPreload(),this.player=null,this.initingState=r.DESTROYED}reinitVideo(e,t,i,r,n){var a,s;if(this.playerElement=e||this.playerElement,this.playerConfig=t||this.playerConfig,this.videoSource=i||this.videoSource,null!=(a=this.playerConfig)&&a.htmlVideoPoolLenght&&this.preloadElementsCreated<(null==(s=this.playerConfig)?void 0:s.htmlVideoPoolLenght)){var o;for(let e=0;e<this.playerConfig.htmlVideoPoolLenght-this.preloadElementsCreated;e++){const e=document.createElement("video");e.setAttribute("playsinline","playsinline"),e.className="zen-ui-video-video-player__player",e.style.width="100%",e.style.height="100%",e.style.position="absolute",e.style.top="0",e.style.left="0";const t=document.createElement("div");t.appendChild(e),this.freePreloadElements.push(t)}this.preloadElementsCreated=(null==(o=this.playerConfig)?void 0:o.htmlVideoPoolLenght)||0}this.debugInfoUnsubscribe&&this.debugInfoUnsubscribe(),this.debugInfoUnsubscribe=K$(this.playerElement,(()=>((e,t)=>{const i={Browser:navigator.userAgent,Config:null==t?void 0:t.experimental.tuningConfigName$.getValue().join(", "),"Core Version":kP,"Shared Version":db,VSID:null==e?void 0:e.getVsid(),"Session Params":null==e?void 0:e.getSessionParams(),"Player Config":null==e?void 0:e.getPlayerConfig(),"Video Source":null==e?void 0:e.getVideoSource(),Position:`${null==e?void 0:e.publicStatesPlayer.currentTime}s`,State:`${null==e?void 0:e.publicStatesPlayer.playingState}`,URL:window.location.href};return t&&Object.entries(t.info).forEach((e=>{let[t,r]=e;i[t]=r.getValue()})),JSON.stringify(i)})(this,this.player)));const l=this.videoSource?zD(this.videoSource):void 0;return l&&this.preloadPlayers[l]?this.initVideoPlayer({position:r,adInit:n,player:this.preloadPlayers[l]}):this.initVideoPlayer({position:r,adInit:n})}initVideoPlayer(e){var i,n;let{position:a,adInit:s,player:o}=e;this.firstFramePlayed=!1,this.handleStateChange(t.Unstarted),this.initingState=r.INITIALIZING;const l=this.convertStreams(this.videoSource);if(this.player&&(o?(this.player.pause(),this.player.seekTime(0)):this.deinit(),this.clearPublicState(this.videoSource)),null==(i=this.statistic)||i.destroy(),null==(n=this.yandexEmbedStat)||n.destroy(),this.htmlVideoElement&&sV(this.htmlVideoElement),this.updatePlaybackRateRange(),this.playerElement&&this.videoSource){var u,d,c,h,p,f,m,g,v,S,y,T,E;this.lastPositionFromLocalHistory=void 0;const e=q$(this.playerConfig,l);this.player=o||new YI(e);const{puid:i,from:n}=(null==(u=this.videoSource)?void 0:u.additionalParams)||{};if(this.statistic=new V$(this.player,{vsid:null==(d=this.videoSource)||null==(c=d.additionalParams)?void 0:c.vsid,puid:i,labels:{from:n},slots:this.sessionParams.zenSlots,testIds:(C=this.sessionParams,((null==C?void 0:C.zenSlots)||"").split(";").map((e=>parseInt(e,10)))),device:{id:this.sessionParams.deviceId||""},videoContentId:null==(h=this.videoSource)||null==(p=h.videoInfo)?void 0:p.videoContentId,isVideoADB:this.sessionParams.isAdBlockPlayerBundle,streamUrl:(null==(f=l.DASH_SEP)?void 0:f.url)||(null==(m=l.HLS)?void 0:m.url),data:{state:{},place:null==(g=this.playerConfig)?void 0:g.placeName,coreVersion:kP,sharedVersion:db,additionalParameters:Object.assign({},null==(v=this.videoSource)?void 0:v.additionalParams)}}),this.yandexEmbedStat=new oV(this,this.player),this.initingState=r.SETTINGSOURCE,o){const e=zD(this.videoSource);if(e){const t=this.usedPreloadElements[e];t&&(sV(this.playerElement),this.playerElement.append(t))}}else{var b;if(!this.htmlVideoElement)this.htmlVideoElement=document.createElement("video"),this.htmlVideoElement.setAttribute("playsinline","playsinline"),this.htmlVideoElement.className="zen-ui-video-video-player__player",this.htmlVideoElement.style.width="100%",this.htmlVideoElement.style.height="100%",this.htmlVideoElement.style.position="absolute",this.htmlVideoElement.style.top="0",this.htmlVideoElement.style.left="0",null==(b=this.playerElement)||b.appendChild(this.htmlVideoElement);this.player.initVideo({container:this.playerElement,sources:l})}var _,A;if("short-feed"===(null==(S=this.playerConfig)?void 0:S.placeName)&&this.player.setLooped(!0),s)this.initAdManager(),null==(_=this.adManager)||_.loadSource(this.videoSource,this.sessionParams,this.playerConfig);if(this.adManager)this.adManager.onePlayer=this.player,this.adManager.isAdFreeSession=!(null==(A=this.playerConfig)||!A.isAdFreeSession);this.subscription.unsubscribe(),this.subscription=new cb;const L=Number(null==(y=this.videoSource.additionalParams)?void 0:y.one_video_id);if(null!=(T=this.playerConfig)&&T.oneVideoStatistic&&L){var R,w,P,O;const e=new BD({movieId:L,place:null==(R=this.playerConfig)?void 0:R.placeName,autoplay:!(null==(w=this.playerConfig)||!w.isAutoplay),mobile:!1,clip:"short-feed"===(null==(P=this.playerConfig)?void 0:P.placeName)},{config:{apiKey:"CPCHNNLGDIHBABABA"},zenUid:null==(O=this.videoSource.additionalParams)?void 0:O.strongest_id});e.authorize().catch((e=>{this.logError(e,{message:`One Stat auth error ${String(e)}`},!1)})),this.subscription.add(e.attachTo(this.player))}this.subscription.add(this.player.events.playing$.subscribe((()=>this.handleStateChange(t.Playing)))),this.subscription.add(this.player.events.paused$.subscribe((()=>{if(this.publicStatesPlayer.playingState!==t.Ended)return this.handleStateChange(t.Paused)}))),this.subscription.add(this.player.events.ended$.subscribe((()=>(this.qoeAccumulator.accountWatchedTime(this.publicStatesPlayer.watchedTime),this.handleStateChange(t.Ended))))),this.subscription.add(this.player.events.stopped$.subscribe((()=>this.handleStateChange(t.Ended)))),this.subscription.add(this.player.events.looped$.subscribe((()=>this.handleStateChange(t.Ended)))),this.subscription.add(this.player.events.inited$.subscribe((()=>{this.handleStateChange(t.Unstarted)}))),this.subscription.add(this.player.experimental.element$.subscribe((e=>{void 0!==e&&(this.htmlVideoElement=e||null,this.convertedStreams&&1===Object.keys(this.convertedStreams).length&&this.convertedStreams.MPEG&&this.htmlVideoElement.removeAttribute("crossOrigin"),wk(window,this.pipAllowed,this.htmlVideoElement))}))),this.subscription.add(this.player.events.firstBytes$.subscribe((()=>{this.handleResourcesIdle()}))),this.subscription.add(this.player.info.duration$.subscribe((e=>{const t=Math.floor(e);!isNaN(t)&&isFinite(e)&&(this.publicStatesPlayer.duration=e,this.handlers.onDurationChange.emit(e))}))),this.subscription.add(this.player.info.currentPlaybackRate$.subscribe((e=>{this.handlePlaybackRateChange(e)}))),this.subscription.add(this.player.info.isAutoQualityEnabled$.subscribe((e=>{if(this.publicStatesPlayer.currentVideoTrack){const t=Object.assign({},this.publicStatesPlayer.currentVideoTrack,{auto:e});this.publicStatesPlayer.currentVideoTrack=t,this.handlers.onVideoTrackChange.emit(t)}}))),this.subscription.add(this.player.info.availableQualities$.subscribe((e=>{const t=[...new Set(e)].map((e=>({name:e,value:e,height:parseInt(e.replace("p","")),bitrate:.18*parseInt(e.replace("p",""))})));this.publicStatesPlayer.videoTracks=t,this.handlers.onVideoTracksChange.emit(t)}))),this.subscription.add(this.player.info.currentQuality$.subscribe((e=>{var t;const i={auto:null==(t=this.player)?void 0:t.info.isAutoQualityEnabled$.getValue(),name:e,value:e,width:parseInt((e||"").replace("p","")),bitrate:.18*parseInt((e||"").replace("p",""))};this.publicStatesPlayer.currentVideoTrack=i,this.handlers.onVideoTrackChange.emit(i)}))),this.subscription.add(this.player.info.availableTextTracks$.subscribe((e=>{const t=e.map((e=>{return{name:e.label||(t=e.language||"",null!=(i=null!=(r=X$[t])?r:X$[J$[t]])?i:t),value:e.id,lang:e.language};var t,i,r}));this.publicStatesPlayer.textTracks=t,this.handlers.onTextTracksChange.emit(t)})));let I=!1;this.subscription.add(this.player.events.seeked$.subscribe((()=>{I=!0}))),this.subscription.add(this.player.events.willSeek$.subscribe((()=>{I=!0}))),this.subscription.add(this.player.info.volume$.subscribe((e=>{this.handlers.onVolumeChange.emit(100*e)}))),this.subscription.add(this.player.info.muted$.subscribe((e=>{this.firstFramePlayed&&this.emitMuteChange(e)}))),this.subscription.add(this.player.info.position$.pipe(O_()).subscribe((e=>{if(I)I=!1;else{const t=this.publicStatesPlayer.watchedAccuracyTime+(e[1]-e[0]);this.handleCurrentTimeChange(Math.max(0,e[1]),(new Date).getTime(),Math.max(0,t))}}))),this.subscription.add(this.player.events.firstFrame$.subscribe((()=>{var e;this.setMuted((null==(e=this.player)?void 0:e.info.muted$.getValue())||!1),this.firstFramePlayed=!0,this.handleContentImpression()}))),this.subscription.add(this.player.events.fatalError$.subscribe((e=>{const t=aV(e);this.emitError(!0,t,{message:e.message,name:e.category,stack:e.thrown.stack}),console.error(e)}))),this.subscription.add(this.player.events.managedError$.subscribe((e=>{const t=aV(e);this.emitError(!1,t,{message:e.message,name:e.category,stack:e.thrown.stack}),console.error(e)}))),this.setMuted((null==(E=this.playerConfig)?void 0:E.isMuted)||!1);const x=a||this.videoSource.startPosition||0;x>0&&this.player.seekTime(x)}var C}getVersion(){return"1.0.0"}setVideoStyle(e){this.htmlVideoElement&&(this.htmlVideoElement.style.objectFit=e.objectFit||"",this.htmlVideoElement.style.transform=e.transform||"")}getDuration(){var e;return null==(e=this.player)?void 0:e.info.duration$.getValue()}updatePlaybackRateRange(){const e=u(.25,2);this.publicStatesPlayer.playbackRates=e,this.handlers.onPlaybackRatesChange.emit(e)}getApiName(){return"one"}logAdEvent(e){var t;this.handlers.onLogEvent.emit(e),null==(t=this.statistic)||t.logAdEvent(e)}}n.p=`${((null==(lV=document.currentScript)?void 0:lV.src)||"").split("/").slice(0,-1).join("/")}/`,window.OneVideoPlayer=uV})(),(window.zenAppModules=window.zenAppModules||{})["video-player-core@1.105.2"]=a})();
//# sourceMappingURL=https://s3-zen.mds.yandex.net/zen-eb/source-maps/prod/video-player-core/1.105.2/one.modern.bundle.js.map